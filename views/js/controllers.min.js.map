{"version":3,"file":"routes.js","sources":["routes.js","../lib/rrule/rrule.js","../lib/rrule/nlp.js","../lib/rrule/rrule.amd.js","../calendar/eventService.js","../lib/fullcalendar/fullcalendar.js","../lib/fullcalendar/fullcalendar.amd.js","../calendar/calendar.js","../lib/qtip/jquery.qtip.js","../calendar/tooltips/eventTooltip.js","../calendar/tooltips/eventTooltip!tpl","../lib/bean.min.js","../calendar/mediator.js","../calendar/tooltips/editEventTooltip.js","../calendar/tooltips/createEventTooltip.js","../calendar/modals/modal.js","../calendar/testTakersService.js","../calendar/widgets/testTakersList.js","../lib/jquery.serialize-object.min.js","../calendar/modals/editEventModal.js","Main/index.js"],"names":["define","require","config","paths","editDeliveryForm","timeZoneList","Main","actions","index","root","serverSide","module","exports","getnlp","_nlp","_RRuleNLP","Error","dateutil","MONTH_DAYS","ONE_DAY","MAXYEAR","ORDINAL_BASE","Date","PY_WEEKDAYS","getYearDay","date","dateNoTime","getFullYear","getMonth","getDate","Math","ceil","isLeapYear","year","tzOffset","getTimezoneOffset","daysBetween","date1","date2","date1_ms","getTime","date2_ms","difference_ms","abs","round","toOrdinal","fromOrdinal","ordinal","millisecsFromBase","monthRange","month","getWeekday","getMonthDays","getDay","combine","time","getHours","getMinutes","getSeconds","clone","dolly","setMilliseconds","cloneDates","dates","clones","i","length","push","sort","a","b","timeToUntilString","comp","comps","getUTCFullYear","getUTCMonth","getUTCDate","getUTCHours","getUTCMinutes","getUTCSeconds","test","String","join","untilStringToDate","until","re","bits","exec","UTC","Time","hour","minute","second","this","prototype","range","start","end","arguments","rang","repeat","value","times","array","Array","concat","pymod","r","divmod","div","floor","mod","plb","obj","Boolean","contains","arr","val","indexOf","M365MASK","M366MASK","M28","M29","M30","M31","MDAY366MASK","slice","MDAY365MASK","NMDAY366MASK","NMDAY365MASK","M366RANGE","M365RANGE","WDAYMASK","wdaymask","Weekday","weekday","n","nth","equals","other","toString","s","getJsWeekday","RRule","options","noCache","_string","_cache","all","before","after","between","origOptions","invalid","keys","Object","defaultKeys","DEFAULT_OPTIONS","forEach","key","FREQUENCIES","freq","byeaster","opts","YEARLY","dtstart","wkst","MO","bysetpos","v","byweekno","byyearday","bymonthday","byweekday","bymonth","MONTHLY","WEEKLY","bynmonthday","bynweekday","wday","byhour","HOURLY","byminute","MINUTELY","bysecond","SECONDLY","timeset","j","k","DAILY","TU","WE","TH","FR","SA","SU","interval","count","parseText","text","language","fromText","optionsToString","strValues","pairs","toUpperCase","strings","attr","iterator","_iter","CallbackIterResult","result","_cacheGet","IterResult","_cacheAdd","inc","args","dt","toText","gettext","isFullyConvertibleToText","isFullyConvertible","what","_value","cached","loopItems","item","hasOwnProperty","iterResult","accept","getValue","day","ii","Iterinfo","rebuild","getdayset","ydayset","mdayset","wdayset","ddayset","gettimeset","htimeset","mtimeset","stimeset","call","filtered","dm","tmp","pos","dayset","fixday","total","mmask","wnomask","nwdaymask","eastermask","mdaymask","nmdaymask","yearlen","nextyearlen","daypos","timepos","poslist","yearordinal","res","e","_len","daysinmonth","parseString","rfcString","replace","attrs","split","Number","toLowerCase","days","match","fromString","string","rrule","lastyear","lastmonth","yearweekday","mrange","easter","y","offset","c","d","f","g","h","l","m","yearStart","rr","firstyday","no1wkst","firstwkst","wyearlen","numweeks","lnumweeks","lyearweekday","lno1wkst","lyearlen","ranges","first","last","set","method","init","_result","minDate","maxDate","tooEarly","tooLate","add","allowedMethods","ender","amd","ToText","id","ENGLISH","reverse","allWeeks","filter","someWeeks","isWeekdays","sortWeekDays","IMPLEMENTED","common","canConvert","monthNames","plural","_bymonth","_bymonthday","_byweekday","list","weekdaytext","monthtext","npos","dayNames","callback","finalDelim","delim","delimJoin","delimiter","finalDelimiter","o","self","realCallback","arg","map","S","ttr","expect","parseInt","isDone","symbol","nextSymbol","ON","F","substr","wkd","decodeWKD","MDAYs","decodeM","on","the","decodeNTH","parse","Parser","tokens","rules","done","best","bestSymbol","p","rule","name","SKIP","number","numberAsText","every","day(s)","weekday(s)","week(s)","month(s)","year(s)","third","for","time(s)","monday","tuesday","wednesday","thursday","friday","saturday","sunday","january","february","march","april","may","june","july","august","september","october","november","december","comma","nlp","_","$","feedback","actionManager","moment","loadingBar","EventService","that","$treeElt","$calendar","tree","reference","instance","tz","classAttrPrefix","createEvent","ajax","url","type","data","global","dataType","success","response","uri","loadEvent","eventData","fullCalendar","trigger","parent","classUri","label","cssClass","message","stop","error","xhr","getRequestErrorMessage","encodeHtml","saveEvent","fcEvent","errorCallback","undefined","title","_tzm","format","recurrence","ttexcluded","resultserver","rruleOptions","_ambigZone","getCurrentTZOffset","toDate","groups","isArray","maxexec","eventsToBeAdded","getRecurringEvents","eventsToBeRemoved","recurringEventIds","eventToRemove","warning","deleteEvent","extend","_resourceContext","action","getBy","deselect_branch","selected","responseJSON","parseJSON","responseText","errors","isEmpty","each","eventId","timeZone","getCurrentTZName","getEventById","events","getEventElement","event","diff","zone","parseZone","rEventKey","rEventDate","startMoment","endMoment","rEvent","cloneDeep","subEvent","subEventNum","parentEventId","className","durationEditable","highlightEvent","deselectedOther","removeClass","addClass","trim","find","setTZ","isNaN","getInstance","factory","jQuery","mergeOptions","combinedVal","chain","complexVals","complexOptions","isPlainObject","unshift","apply","massageOverrides","input","subObj","overrides","views","inArray","subName","subVal","compensateScroll","rowEls","scrollbarWidths","left","css","border-left-width","margin-left","right","border-right-width","margin-right","uncompensateScroll","disableCursor","enableCursor","distributeHeight","els","availableHeight","shouldRedistribute","minOffset1","minOffset2","flexEls","flexOffsets","flexHeights","usedHeight","undistributeHeight","el","minOffset","naturalOffset","outerHeight","height","naturalHeight","newHeight","matchCellWidths","maxInnerWidth","innerEl","innerWidth","outerWidth","width","setPotentialScroller","containerEl","scrollHeight","clientHeight","unsetScroller","getScrollParent","position","scrollParent","parents","eq","ownerDocument","document","getOuterRect","top","bottom","getClientRect","getScrollbarWidths","getCssFloat","clientWidth","getContentRect","leftRightWidth","widths","innerHeight","getIsLeftRtlScrollbars","_isLeftRtlScrollbars","computeIsLeftRtlScrollbars","border","padding","overflow","direction","appendTo","children","remove","prop","parseFloat","isPrimaryMouseButton","ev","which","ctrlKey","intersectRects","rect1","rect2","max","min","constrainPoint","point","rect","getRectCenter","diffPoints","point1","point2","intersectionToSeg","subjectRange","constraintRange","segStart","segEnd","isStart","isEnd","subjectStart","subjectEnd","constraintStart","constraintEnd","diffDayTime","duration","stripTime","ms","diffDay","diffByUnit","unit","computeIntervalUnit","intervalUnits","computeRangeAs","isInt","isDuration","as","durationHasTime","dur","hours","minutes","seconds","milliseconds","isNativeDate","isTimeString","str","createObject","proto","copyOwnProps","src","dest","hasOwnProp","copyNativeMethods","names","hasOwnPropMethod","isAtomic","applyAll","functions","thisObj","isFunction","ret","firstDefined","htmlEscape","stripHtmlEntities","cssToStr","cssProps","statements","capitaliseFirstLetter","charAt","compareNumbers","proxy","methodName","debounce","func","wait","timeoutId","context","timestamp","later","setTimeout","makeMoment","parseAsUTC","isAmbigTime","isAmbigZone","ambigMatch","mom","isSingleString","isMoment","transferAmbigs","ambigDateOfMonthRegex","ambigTimeOrZoneRegex","utc","_ambigTime","utcOffset","_fullCalendar","commonlyAmbiguate","inputs","preserveTime","anyAmbigTime","anyAmbigZone","len","moms","fc","stripZone","setMomentValues","oldMomentFormat","formatStr","oldMomentProto","formatDate","formatDateWithChunks","getFormatStringChunks","chunks","formatDateWithChunk","chunk","token","maybeStr","tokenOverrides","maybe","formatRange","separator","isRTL","localeData","lang","longDateFormat","formatRangeWithChunks","chunkStr","leftI","rightI","middleI","leftStr","rightStr","middleStr1","middleStr2","middleStr","formatSimilarChunk","similarUnitMap","isSame","formatStringChunkCache","chunkFormatString","chunker","Class","isCellsEqual","cell1","cell2","grid","row","col","isBgEvent","rendering","getEventRendering","isInverseBgEvent","source","groupEventsById","eventsById","_id","compareNormalRanges","range1","range2","eventStartMS","compareSegs","seg1","seg2","eventDurationMS","allDay","localeCompare","getDraggedElMeta","eventProps","startTime","stick","prefix","dataAttrPrefix","isDaySegCollision","seg","otherSegs","otherSeg","leftCol","rightCol","compareDaySegCols","placeSlotSegs","segs","levels","level0","buildSlotSegLevels","computeForwardSlotSegs","computeSlotSegPressures","computeSlotSegCoords","computeSlotSegCollisions","level","forwardSegs","forwardSeg","forwardPressure","seriesBackwardPressure","seriesBackwardCoord","forwardCoord","compareForwardSlotSegs","backwardCoord","results","isSlotSegCollision","Calendar_constructor","element","render","content","elementVisible","calcSize","renderView","initialRender","tm","theme","prependTo","header","t","Header","headerElement","prepend","defaultView","handleWindowResize","windowResizeProxy","windowResize","windowResizeDelay","window","resize","destroy","currentView","removeElement","unbind","is","viewType","ignoreWindowResize","deactivateButton","freezeContentHeight","view","viewsByType","instantiateView","setElement","activateButton","massageCurrentDate","isDisplayed","isWithin","intervalStart","intervalEnd","display","unfreezeContentHeight","updateHeaderTitle","updateTodayButton","getAndRenderEvents","updateSize","shouldRecalc","_calcSize","suggestedViewHeight","contentHeight","aspectRatio","target","_element","refetchEvents","destroyEvents","fetchAndRenderEvents","renderEvents","displayEvents","clearEvents","lazyFetching","isFetchNeeded","fetchEvents","reportEvents","_events","reportEventChange","updateTitle","now","getNow","disableButton","enableButton","select","hasTime","defaultTimedEventDuration","defaultAllDayEventDuration","unselect","prev","computePrevDate","next","computeNextDate","prevYear","nextYear","today","gotoDate","dateInput","incrementDate","delta","zoomTo","newDate","spec","getViewSpec","getUnitViewSpec","getCalendar","getView","option","initOptions","rerenderEvents","changeView","getMomentLocaleData","_months","monthNamesShort","_monthsShort","_weekdays","dayNamesShort","_weekdaysShort","firstDay","_week","dow","_fullCalendar_weekCalc","weekCalc","weekNumberCalculation","timezone","local","_locale","_lang","getIsAmbigTimezone","rezoneDate","toArray","getEventEnd","getDefaultEventEnd","humanizeDuration","locale","humanize","EventManager","defaultDate","getSuggestedViewHeight","isHeightAuto","populateInstanceComputableOptions","instanceComputableOptions","langCode","langData","calendar","sections","append","renderSection","sectionEl","buttonStr","groupEl","groupChildren","isOnlyButtons","buttonName","viewSpec","buttonClick","overrideText","defaultText","themeIcon","normalIcon","innerHtml","classes","button","viewsWithButtons","buttonTextOverride","buttonTextDefault","buttonText","themeButtonIcons","buttonIcons","click","hasClass","mousedown","not","mouseup","hover","removeAttr","getViewsWithButtons","rangeStart","rangeEnd","cache","fetchID","currentFetchID","sources","pendingSourceCnt","fetchEventSource","_fetchEventSource","eventInputs","eventInput","abstractEvent","isArraySource","buildEventFromInput","expandEvent","fetchers","sourceFetchers","pushLoading","popLoading","customData","complete","startParam","endParam","timezoneParam","ajaxDefaults","addEventSource","sourceInput","buildEventSource","normalizers","sourceNormalizers","origArray","removeEventSource","grep","isSourcesEqual","source1","source2","getSourcePrimitive","googleCalendarId","updateEvent","mutateEvent","getMiscEventProps","props","isMiscEventPropName","renderEvent","stickySource","removeEvents","eventID","clientEvents","loadingLevel","out","eventDataTransform","eventGUID","_recurring","isValid","allDayDefault","assignDatesToEvent","normalizeEventRange","backupEventDates","normalizeEventRangeTimes","isAfter","forceEventDuration","ensureVisibleEventRange","_rangeStart","_rangeEnd","dowHash","endTime","isBefore","newProps","largeUnit","diffDates","date0","oldProps","clearEnd","startDelta","endDelta","durationDelta","undoFunc","miscProps","_start","_end","_allDay","subtract","mutateEvents","dateDelta","undo","isAmbigTimezone","undoFunctions","valueOf","getBusinessHoursEvents","wholeDay","optionVal","businessHours","defaultVal","isEventRangeAllowed","constraint","eventConstraint","overlap","eventOverlap","isRangeAllowed","isSelectionRangeAllowed","selectConstraint","selectOverlap","isExternalDropRangeAllowed","constraintEvents","anyContainment","peerEvents","peerEvent","peerOverlap","constraintToEvents","eventContainsRange","getPeerEvents","eventIntersectsRange","constraintInput","eventStart","eventEnd","eventSources","getEventCache","version","fcViews","fn","singleRes","removeData","CalendarBase","allowValueOptimization","setUTCValues","setLocalValues","dayIDs","newMomentProto","week","weeks","isoWeek","dayHours","asDays","wasAmbigTime","hasZone","wasAmbigZone","tzo","toISOString","units","_d","setTime","updateOffset","T","Y","M","D","A","H","members","subClass","superClass","constructor","mixin","Popover","isHidden","documentMousedownProxy","margin","show","hide","_this","parentEl","autoHide","documentMousedown","closest","off","viewportTop","viewportLeft","viewportOffset","origin","offsetParent","windowEl","viewportEl","scrollTop","scrollLeft","viewportConstrain","GridCoordMap","rowCoords","colCoords","bounds","build","computeRowCoords","computeColCoords","computeBounds","clear","getCell","x","coords","cell","rowCnt","colCnt","hitRow","hitCol","inBounds","ComboCoordMap","coordMaps","DragListener","isListening","isDragging","originX","originY","mousemoveProxy","mouseupProxy","subjectEl","subjectHref","scrollEl","scrollBounds","scrollTopVel","scrollLeftVel","scrollIntervalId","scrollHandlerProxy","scrollSensitivity","scrollSpeed","scrollIntervalMs","preventDefault","startListening","distance","startDrag","scroll","pageX","pageY","listenStart","mousemove","minDistance","distanceSq","dx","dy","drag","dragStart","updateScroll","stopListening","stopDrag","stopScrolling","dragStop","listenStop","computeScrollBounds","topCloseness","bottomCloseness","leftCloseness","rightCloseness","sensitivity","topVel","leftVel","setScrollVel","constrainScrollVel","setInterval","scrollWidth","scrollIntervalFunc","frac","clearInterval","scrollStop","scrollHandler","CellDragListener","coordMap","origCell","coordAdjust","subjectRect","origPoint","computeCoords","subjectCenter","cellOver","cellOut","cellDone","MouseFollower","sourceEl","top0","left0","mouseY0","mouseX0","topDelta","leftDelta","isFollowing","isAnimating","updatePosition","shouldRevert","destroyEl","revertDuration","animate","getEl","visibility","opacity","zIndex","sourceOffset","RowRenderer","cellHtml","opt","rowHtml","rowType","renderCell","getHtmlRenderer","rowCellHtml","bookendCells","cells","intro","outro","prependHtml","appendHtml","rendererName","generalName","specificName","provider","renderer","Grid","rowData","colData","elsByFill","externalDragStartProxy","colHeadFormat","eventTimeFormat","displayEventTime","displayEventEnd","cellDuration","computeColHeadFormat","computeEventTimeFormat","computeDisplayEventTime","computeDisplayEventEnd","setRange","updateCells","rangeToSegs","getRowData","getColData","computeCellRange","computeCellDate","getRowEl","getColEl","getCellDayEl","items","dayMousedown","bindSegHandlers","bindGlobalHandlers","unbindGlobalHandlers","renderSkeleton","renderDates","destroyDates","dayClickCell","selectionRange","isSelectable","dragListener","isOrig","computeSelection","renderSelection","destroySelection","reportSelection","renderRangeHelper","sourceSeg","fakeEvent","fabricateHelperEvent","renderHelper","editable","destroyHelper","renderHighlight","destroyHighlight","firstCell","lastCell","renderFill","destroyFill","highlightSegClasses","renderFillSegEls","segElMethod","html","renderedSegs","fillSegHtml","node","fillSegTag","classesMethod","cssMethod","headHtml","widgetHeaderClass","headCellHtml","bgCellHtml","getDayClasses","widgetContentClass","intervalDuration","highlightStateClass","mousedOverSeg","isDraggingSeg","isResizingSeg","isDraggingExternal","eventsToSegs","bgSegs","fgSegs","renderBgSegs","renderFgSegs","triggerSegMouseout","destroyFgSegs","destroyBgSegs","getEventSegs","renderFgSegEls","disableResizing","fgSegHtml","resolveEventEl","bgEventSegEl","bgEventSegClasses","bgEventSegCss","background-color","backgroundColor","color","businessHoursSegClasses","mouseenter","triggerSegMouseover","mouseleave","isEventResizable","segResizeMousedown","isEventDraggable","segDragMousedown","dropLocation","mouseFollower","segDragStart","hideEvent","computeEventDrop","renderDrag","destroyDrag","showEvent","segDragStop","reportEventDrop","startCell","endCell","dragEnd","applyDragOpacity","style","externalDragStart","ui","listenToExternalDrag","meta","computeExternalDrop","reportExternalDrop","resizeLocation","segResizeStart","computeEventStartResize","computeEventEndResize","renderEventResize","destroyEventResize","segResizeStop","reportEventResize","computeEventResize","defaultDuration","getEventTimeText","displayEnd","getSegClasses","isDraggable","isResizable","getEventSkinCss","eventColor","sourceColor","optionColor","border-color","borderColor","textColor","rangeToSegsFunc","eventRanges","eventsToRanges","eventRangeToSegs","eventGroup","eventsToInverseRanges","eventsToNormalRanges","normalRange","viewStart","viewEnd","normalRanges","inverseRanges","event0","eventRange","DayGrid","numbersVisible","bottomCoordPadding","breakOnWeeks","cellDates","dayToCellOffsets","dayEls","helperEls","isRigid","cellCnt","dayRowHtml","destroySegPopover","renderBusinessHours","dayCellHtml","updateCellDates","offsets","isHiddenDay","rowFirst","rowLast","segFirst","segLast","computeDayRange","dateToCellOffset","rowStructs","helperNodes","renderSegRows","rowNode","skeletonTop","rowEl","skeletonEl","tbodyEl","nodes","renderFillRow","trEl","startCol","endCol","popoverSegs","allDaySegs","rowStruct","pop","segRows","groupSegRows","renderSegRow","timeText","titleHtml","isResizableFromStart","isEventResizableFromStart","isResizableFromEnd","isEventResizableFromEnd","skinCss","timeHtml","rowSegs","emptyCellsUntil","td","loneCellMatrix","tr","cellMatrix","levelSegs","segLevels","buildSegLevels","levelCnt","tbody","segMatrix","segPopover","limitRows","levelLimit","rowLevelLimit","unlimitRow","computeRowLevelLimit","limitRow","iterInnerHeights","childNode","trHeight","rowHeight","trEls","segsBelow","getCellSegs","moreLink","renderMoreLink","moreWrap","moreNodes","limitedNodes","totalSegsBelow","colSegsBelow","rowspan","segMoreNodes","moreTd","get","moreEls","limitedEls","hiddenSegs","getMoreLinkText","clickOption","moreEl","dayEl","allSegs","reslicedAllSegs","resliceDaySegs","reslicedHiddenSegs","showSegPopover","topEl","renderSegPopoverContent","isTheme","segContainer","dayDate","dayStart","dayEnd","dayRange","num","startLevel","TimeGrid","slotDuration","snapDuration","minTime","maxTime","axisFormat","slatEls","slatTops","helperEl","businessHourSegs","processOptions","renderHtml","slatRowHtml","slotBgCellHtml","slotDate","axisHtml","slotNormal","asMinutes","slotTime","axisStyleAttr","skipHiddenDays","computeSnapTime","colDate","colRange","isResize","computeSlatTops","updateSegVerticals","originTop","computeTimeTop","computeDateTop","startOfDayDate","slatIndex","slatRemainder","slatTop","slatBottom","slatCoverage","tops","tableEl","renderSegTable","segCols","colSegs","tdEl","groupSegCols","eventSkeletonEl","computeSegVerticals","generateSegPositionCss","generateSegVerticalCss","fullTimeText","startTimeText","isMultiDayEvent","shouldOverlap","View","isSkeletonRendered","isEventsRendered","intervalUnit","isSelected","scrollerEl","nextDayThreshold","isHiddenDayHash","initThemingProps","initHiddenDays","initialize","setDate","computeRange","startOf","computeTitle","computeTitleFormat","destroySkeleton","scrollState","queryScroll","computeInitialScroll","forceScroll","triggerRender","triggerDestroy","destroyBusinessHours","updateHeight","updateWidth","setScroll","setHeight","computeScrollerHeight","totalHeight","both","otherHeight","triggerEventRender","triggerEventDestroy","renderedEventSegEach","custom","startEditable","mutateResult","triggerEventDrop","triggerExternalDrop","triggerEventResize","ignore","hiddenDays","dayCnt","isExclusive","endTimeMS","startDay","endDay","Calendar","dirDefaults","langDefaults","viewSpecCache","langOptionHash","defaults","rtlDefaults","buildViewSpec","viewTypes","singleUnit","requestedViewType","viewClass","viewOverrides","defaultsChain","overridesChain","class","buildViewSpecOptions","buildViewSpecButtonText","queryButtonText","isValidViewType","titleRangeSeparator","monthYearFormat","center","weekends","weekNumbers","weekNumberTitle","dragOpacity","dragRevertDuration","dragScroll","unselectAuto","dropAccept","eventLimit","eventLimitText","eventLimitClick","dayPopoverFormat","englishDefaults","langs","datepickerLang","dpLangCode","dpOptions","fcOptions","weekHeader","dpComputableOptions","datepicker","regional","en","setDefaults","newFcOptions","momOptions","momComputableOptions","prevText","nextText","currentText","showMonthAfterYear","yearSuffix","dayOfMonthFormat","mediumTimeFormat","smallTimeFormat","extraSmallTimeFormat","hourFormat","noMeridiemTimeFormat","smallDayDateFormat","weekFormat","smallWeekFormat","otherEvent","BasicView","basic","dayGrid","dayNumbersVisible","weekNumbersVisible","weekNumberWidth","headRowEl","hasRigidRows","headIntroHtml","weekNumberStyleAttr","numberIntroHtml","dayIntroHtml","introHtml","numberCellHtml","isAuto","scrollerHeight","setGridHeight","MonthView","isFixedWeeks","weekMode","months","fixedWeekCount","basicWeek","basicDay","AGENDA_DEFAULTS","allDaySlot","allDayText","scrollTime","slotEventOverlap","AGENDA_ALL_DAY_EVENT_LIMIT","AgendaView","agenda","timeGrid","axisWidth","noScrollRowEls","bottomRuleEl","bottomRuleHeight","weekText","slotBgIntroHtml","timedSegs","dayEvents","timedEvents","daySegs","agendaWeek","agendaDay","__","eventService","getCalendarHeight","$contentBlock","$container","TypeError","defaultOptions","calendarLoading","Deferred","base_lang","selectable","selectHelper","noop","timeFormat","loading","resolve","eventRender","$element","eventDrop","revertFunc","eventResize","unix","recurringEvents","rEventVal","assign","addEvent","getEvent","deferred","promise","goToEvent","$eventElement","$scroller","qtip","QTip","tooltip","NULL","elements","NAMESPACE","timers","img","plugins","disabled","FALSE","onTooltip","lastClass","rendered","destroyed","waiting","hiddenDuringWait","positioning","triggering","invalidOpt","invalidContent","jquery","then","sanitizeOptions","once","metadata","api","status","my","at","TRUE","ready","PLUGINS","sanitize","convertNotation","notation","setCallback","category","checks","RegExp","createWidgetClass","cls","WIDGET","delay","showMethod","CLASS_DISABLED","clearTimeout","toggle","hideMethod","relatedTarget","ontoTooltip","SELECTOR","ontoTarget","fixed","stopImmediatePropagation","inactiveMethod","inactive","repositionMethod","offsetWidth","reposition","delegate","selector","body","QTIP","ATTR_ID","elem","posOptions","docBody","newTarget","metadata5","html5","container","solo","viewport","CORNER","overwrite","ATTR_HAS","suppress","oldtitle","camel","vendorCss","cur","ucProp","cssPrefixes","intCss","Tip","_ns","size","Modal","Ie6","PROTOTYPE","CHECKS","trackingBound","X","WIDTH","HEIGHT","TOP","LEFT","BOTTOM","RIGHT","CENTER","FLIPINVERT","SHIFT","INACTIVE_EVENTS","CLASS_FIXED","CLASS_DEFAULT","CLASS_FOCUS","CLASS_HOVER","replaceSuffix","BROWSER","ie","createElement","innerHTML","getElementsByTagName","NaN","iOS","navigator","userAgent","_when","deferreds","when","posClass","_createPosClass","tracking","adjust","mouse","role","aria-live","aria-atomic","aria-describedby","aria-hidden","toggleClass","_createTitle","_updateTitle","_createButton","_updateContent","_setWidget","_unassignEvents","_assignEvents","_trigger","immediate","process","timer","one","builtin","^id$","nextid","new_id","^prerender","^content.text$","^content.attr$","^content.title$","_removeTitle","^content.button$","_updateButton","^content.title.(text|button)$","^position.(my|at)$","^position.container$","^show.ready$","^style.classes$","^style.(width|height)","^style.widget|content.title","^style.def","^events.(render|show|move|hide|focus|blur)$","^(show|hide|position).(event|target|fixed|inactive|leave|distance|viewport|adjust)","precedance","rmove","rrender","previous","nodeType","_update","empty","_waitForContent","images","imagesLoaded","titlebar","widget","insertBefore","abbrev","effect","pluginCalculations","adjusted","newClass","tooltipWidth","tooltipHeight","targetWidth","targetHeight","visible","isScroll","win","doc","documentElement","scrollX","scrollY","imagemap","svg","ownerSVGElement","adjustable","queue","removeAttribute","scrolled","parentOffset","quirks","compatMode","getBoundingClientRect","C","Corner","corner","forceY","invert","z","state","has","fix","identicalState","allow","contentOptions","sameTarget","search","focus","bind","_storeMouse","Event","blur","autofocus","fadeTo","qtips","curIndex","newIndex","zindex","disable","enable","isString","close","aria-label","def","_bind","targets","suffix","ns","_unbind","originalEvent","isDefaultPrevented","_bindEvents","showEvents","hideEvents","showTargets","hideTargets","similarTargets","toggleEvents","showIndex","splice","_assignInitialEvents","hoverIntent","prerender","showTarget","hideTarget","onTarget","containerTarget","viewportTarget","documentTarget","windowTarget","leave","nodeName","enabled","isAncestor","inactiveEvents","limit","special","currentTarget","newValue","command","returned","makeArray","timeStamp","keepData","elems","old","cleanData","triggerHandler","move","hidden","TIP","MARGIN","BORDER","COLOR","BG_COLOR","TRANSPARENT","IMPORTANT","HASCANVAS","getContext","INVALID","PIXEL_RATIO","devicePixelRatio","BACKING_STORE_RATIO","backingStorePixelRatio","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","SCALE","createVML","tag","tip","lineJoin","miterLimit","save","stopPropagation","create","_swapDimensions","_resetDimensions","_useTitle","_parseCorner","_parseWidth","side","use","_parseRadius","_invalidColour","compare","_parseColours","borderSide","colorElem","_calculateSize","bigHyp","ratio","isCenter","base","pow","smallHyp","sqrt","hyp","_calculateTip","scale","width2","height2","tips","br","bl","tl","tc","bc","rc","lc","lt","rt","lb","rb","_drawCoords","beginPath","moveTo","lineTo","closePath","update","bigCoords","translate","newSize","inner","curSize","mimic","lineHeight","restore","clearRect","fillStyle","fill","coordsize","antialias","$this","path","fillcolor","filled","stroked","opera","calculate","corners","userOffset","shiftflip","popposite","opposite","newCorner","shiftonly","xy","shift","horizontal","vertical","cornerTop","cornerLeft","user","^position.my|style.tip.(corner|mimic|border)$","^style.tip.(height|width)$","^content.title|style.(classes|widget)$","MODAL","OVERLAY","MODALCLASS","MODALSELECTOR","focusable","expr","mapName","isTabIndexNotNaN","parentNode","href","focusInputs","blurElems","focusableElems","stealFocus","targetOnTop","current","onLast","prevState","modal","escape","keyCode","stealfocus","visibleModals","detach","overlay","modal_zindex","oEvent","^show.modal.(on|blur)$","elemWidth","elemHeight","otherSide","side1","side2","lengthName","targetLength","elemLength","initialPos","mySide","atSide","isShift","myLength","atLength","sideOffset","viewportScroll","containerStatic","containerOffset","overflow1","overflow2","viewportWidth","viewportHeight","newMy","methodX","methodY","polys","polygon","baseCoords","newWidth","compareX","compareY","realX","realY","ax","ay","bx","by","_angles","ellipse","cx","cy","rx","ry","rxc","cos","PI","rys","sin","circle","frameOffset","mtx","transformed","points","strokeWidth2","getBBox","baseVal","x1","y1","x2","y2","numberOfItems","getItem","createSVGPoint","getScreenCTM","matrixTransform","parentWindow","frameElement","area","imageOffset","shape","image","coordsString","coordsArray","IE6","BGIFRAME","_scroll","bgiframe","adjustBGIFrame","redrawContainer","redraw","tipAdjust","dimensions","plugin","drawing","perc","ie6","^content|style$","merge","isShown","validate","qtipApi","$elements","formIsValid","$form","valid","hb","template","Handlebars","depth0","helpers","partials","program1","stack1","helper","buffer","escapeExpression","hash","helperMissing","functionType","program3","program5","compilerInfo","inverse","program","N","u","w","compareDocumentPosition","condition","mousewheel","E","reg","rightClick","clientX","clientY","isNative","isBean","srcElement","returnValue","cancelBubble","stopped","isImmediatePropagationStopped","__beanDel","ft","O","customType","original","namespaces","eventType","handler","inNamespaces","matches","removed","put","del","entries","querySelectorAll","propertyName","L","attachEvent","detachEvent","dispatchEvent","fireEvent","createEventObject","P","B","I","fire","setSelectorEngine","noConflict","q","CollectGarbage","bean","eventContainer","eventName","eventHandler","eventTooltip","tooltipTpl","mediator","events.hide","position.adjust.resize","getId","tplOptions","content.text","content.title","border-bottom","getClassUri","validateRules","[name=\"label\"]","style.width","startUTCStr","endUTCStr","tpl","compile","position.target","getForm","$label","submit","getFormData","serializeArray","TestTakersService","loadTestTakers","rejext","testTakersService","assignedSummaryTpl","excludedSummaryTpl","$assignedList","$excludedList","applyFilter","$input","moveOptions","$options","$option","unselectOptions","ttassigned","updateSummary","updateGroups","deliveryId","$select","unwrap","wrap","Zepto","named","addPair","JSON","stringify","addPairs","serialize","serializeJSON","patterns","serializeObject","FormSerializer","formTpl","GenerisTreeSelectClass","TestTakersList","pad","createOffset","sign","initialData","testTakersList","position.my","position.at","style.classes","publishedFromatted","published","executionsMessage","getExecutionsMessage","executions","initDatepickers","initGroupTree","initForm","modified","isEqual","formData","parseRrule","updateRruleValue","groupTree","checkedNodes","serverParameters","openNodes","rootNode","paginate","onChangeCallback","getChecked","timeList","dateFormat","beforeShow","textbox","dpDiv","autocomplete","request","term","minLength","updateDatetime","getStartMoment","getEndMoment","rruleData",".js-delivery-end-time, .js-delivery-start-time",".js-delivery-end-date, .js-delivery-start-date",".js-label",".js-maxexec","[name=\"resultserver\"]","[name=\"rrule[count]\"]","startVal","endVal","binder","EditEventTooltip","CreateEventTooltip","EditEventModal","timeZoneListTpl","DeliverySchedule","editEventTooltip","createEventTooltip","editEventModal","$calendarContainer","$tzSelect","initTree","eventClick","selectEvent","eventResizeStart","hideTooltips","viewRender","viewDisplay","viewDestroy","initTzSelect","initTooltips","register","showCreateEventTooltip","showEditEventModal","treeInstance","showEditEventTooltip","$moreLinks","isTrigger","position.adjust.y","position.adjust.x","offsetY","offsetX","selectTreeNode","select_branch","classId","elt","open_branch"],"mappings":"AAuBAA,OAAA,2CAAA,WAUA,MAPAC,SAAAC,QACAC,OACAC,iBAAA,mDACAC,aAAA,mDAKAC,MACAC,SACAC,MAAA,6BCrBA,SAAAC,MAEA,GAAAC,YAAA,mBAAAC,SAAAA,OAAAC,QAGAC,OAAA,WACA,IAAAA,OAAAC,KACA,GAAAJ,WAEAG,OAAAC,KAAAb,QAAA,aACA,MAAAY,OAAAC,KAAAL,KAAAM,WACA,KAAA,IAAAC,OACA,gEAIA,OAAAH,QAAAC,MAaAG,UAEAC,YAAA,GAAA,GAAA,GAAA,GAAA,GAAA,GAAA,GAAA,GAAA,GAAA,GAAA,GAAA,IAKAC,QAAA,MAKAC,QAAA,KAOAC,aAAA,GAAAC,MAAA,KAAA,EAAA,GAMAC,aAAA,EAAA,EAAA,EAAA,EAAA,EAAA,EAAA,GAKAC,WAAA,SAAAC,MACA,GAAAC,YAAA,GAAAJ,MACAG,KAAAE,cAAAF,KAAAG,WAAAH,KAAAI,UACA;MAAAC,MAAAC,MACAL,WAAA,GAAAJ,MAAAG,KAAAE,cAAA,EAAA,IACAV,SAAAE,SAAA,GAGAa,WAAA,SAAAC,MAIA,MAHAA,gBAAAX,QACAW,KAAAA,KAAAN,eAEAM,KAAA,IAAA,GAAAA,KAAA,MAAA,GAAAA,KAAA,MAAA,GAMAC,SAAA,SAAAT,MACA,MAAA,IAAAA,KAAAU,oBAAA,KAMAC,YAAA,SAAAC,MAAAC,OAGA,GAAAC,UAAAF,MAAAG,UAAAvB,SAAAiB,SAAAG,OACAI,SAAAH,MAAAE,UAAAvB,SAAAiB,SAAAI,OAEAI,cAAAZ,KAAAa,IAAAJ,SAAAE,SAEA,OAAAX,MAAAc,MAAAF,cAAAzB,SAAAE,UAMA0B,UAAA,SAAApB,MACA,MAAAR,UAAAmB,YAAAX,KAAAR,SAAAI,eAMAyB,YAAA,SAAAC,SACA,GAAAC,mBAAAD,QAAA9B,SAAAE,OACA,OAAA,IAAAG,MAAAL,SAAAI,aAAAmB,UACAvB,SAAAiB,SAAAjB,SAAAI,cACA2B,kBACA/B,SAAAiB,SAAA,GAAAZ,MAAA0B;EAMAC,WAAA,SAAAhB,KAAAiB,OACA,GAAAzB,MAAA,GAAAH,MAAAW,KAAAiB,MAAA,EACA,QAAAjC,SAAAkC,WAAA1B,MAAAR,SAAAmC,aAAA3B,QAGA2B,aAAA,SAAA3B,MACA,GAAAyB,OAAAzB,KAAAG,UACA,OAAA,IAAAsB,OAAAjC,SAAAe,WAAAP,MACA,GACAR,SAAAC,WAAAgC,QAMAC,WAAA,SAAA1B,MACA,MAAAR,UAAAM,YAAAE,KAAA4B,WAMAC,QAAA,SAAA7B,KAAA8B,MAEA,MADAA,MAAAA,MAAA9B,KACA,GAAAH,MACAG,KAAAE,cAAAF,KAAAG,WAAAH,KAAAI,UACA0B,KAAAC,WAAAD,KAAAE,aAAAF,KAAAG,eAIAC,MAAA,SAAAlC,MACA,GAAAmC,OAAA,GAAAtC,MAAAG,KAAAe,UAEA,OADAoB,OAAAC,gBAAA,GACAD,OAGAE,WAAA,SAAAC,OAEA,IAAA,GADAC,WACAC,EAAA,EAAAA,EAAAF,MAAAG,OAAAD,IACAD,OAAAG,KAAAlD,SAAA0C,MAAAI,MAAAE,IAEA;MAAAD,SAMAI,KAAA,SAAAL,OACAA,MAAAK,KAAA,SAAAC,EAAAC,GACA,MAAAD,GAAA7B,UAAA8B,EAAA9B,aAIA+B,kBAAA,SAAAhB,MAYA,IAAA,GAVAiB,MADA/C,KAAA,GAAAH,MAAAiC,MACAkB,OACAhD,KAAAiD,iBACAjD,KAAAkD,cAAA,EACAlD,KAAAmD,aACA,IACAnD,KAAAoD,cACApD,KAAAqD,gBACArD,KAAAsD,gBACA,KAEAd,EAAA,EAAAA,EAAAQ,MAAAP,OAAAD,IACAO,KAAAC,MAAAR,IACA,OAAAe,KAAAR,OAAA,GAAAA,OACAC,MAAAR,GAAA,IAAAgB,OAAAT,MAGA,OAAAC,OAAAS,KAAA,KAGAC,kBAAA,SAAAC,OACA,GAAAC,IAAA,oDACAC,KAAAD,GAAAE,KAAAH,MACA,KAAAE,KACA,KAAA,IAAAtE,OAAA,wBAAAoE,MAEA,OAAA,IAAA9D,MACAA,KAAAkE,IAAAF,KAAA,GACAA,KAAA,GAAA,EACAA,KAAA,GACAA,KAAA,IAAA,EACAA,KAAA,IAAA,EACAA,KAAA,IAAA;EAMArE,UAAAwE,KAAA,SAAAC,KAAAC,OAAAC,QACAC,KAAAH,KAAAA,KACAG,KAAAF,OAAAA,OACAE,KAAAD,OAAAA,QAGA3E,SAAAwE,KAAAK,WACAtC,SAAA,WACA,MAAAqC,MAAAH,MAEAjC,WAAA,WACA,MAAAoC,MAAAF,QAEAjC,WAAA,WACA,MAAAmC,MAAAD,QAEApD,QAAA,WACA,MAGA,MAHA,GAAAqD,KAAAH,KAAA,GACA,GAAAG,KAAAF,OACAE,KAAAD,SAcA,IAAAG,OAAA,SAAAC,MAAAC,KACA,IAAAC,UAAAhC,SACA+B,IAAAD,MACAA,MAAA,EAGA,KAAA,GADAG,SACAlC,EAAA+B,MAAAC,IAAAhC,EAAAA,IACAkC,KAAAhC,KAAAF,EAEA,OAAAkC,OAEAC,OAAA,SAAAC,MAAAC,OACA,GAAArC,GAAA,EAAAsC,QACA,IAAAF,gBAAAG,OACA,KAAAF,MAAArC,EAAAA,IACAsC,MAAAtC,MAAAwC,OAAAJ,WAGA,MAAAC,MAAArC,EAAAA,IACAsC,MAAAtC,GAAAoC,KAGA,OAAAE,QAmBAG,MAAA,SAAArC,EAAAC,GACA,GAAAqC,GAAAtC,EAAAC,CAEA,OAAA,GAAAqC,EAAArC,EAAAqC,EAAArC,EAAAqC;EAOAC,OAAA,SAAAvC,EAAAC,GACA,OAAAuC,IAAA/E,KAAAgF,MAAAzC,EAAAC,GAAAyC,IAAAL,MAAArC,EAAAC,KAUA0C,IAAA,SAAAC,KACA,MAAAA,eAAAT,QAAA,GAAAS,IAAA/C,QACA,EACAgD,QAAAD,MAOAE,SAAA,SAAAC,IAAAC,KACA,MAAA,IAAAD,IAAAE,QAAAD,MAUAE,YAAAd,OACAL,OAAA,EAAA,IAAAA,OAAA,EAAA,IAAAA,OAAA,EAAA,IACAA,OAAA,EAAA,IAAAA,OAAA,EAAA,IAAAA,OAAA,EAAA,IACAA,OAAA,EAAA,IAAAA,OAAA,EAAA,IAAAA,OAAA,EAAA,IACAA,OAAA,GAAA,IAAAA,OAAA,GAAA,IAAAA,OAAA,GAAA,IACAA,OAAA,EAAA,IAEAoB,YAAAf,OACAL,OAAA,EAAA,IAAAA,OAAA,EAAA,IAAAA,OAAA,EAAA,IACAA,OAAA,EAAA,IAAAA,OAAA,EAAA,IAAAA,OAAA,EAAA,IACAA,OAAA,EAAA,IAAAA,OAAA,EAAA,IAAAA,OAAA,EAAA,IACAA,OAAA,GAAA,IAAAA,OAAA,GAAA,IAAAA,OAAA,GAAA,IACAA,OAAA,EAAA,IAIAqB,IAAA1B,MAAA,EAAA,IACA2B,IAAA3B,MAAA,EAAA,IACA4B,IAAA5B,MAAA,EAAA,IACA6B,IAAA7B,MAAA,EAAA,IACA8B,eAAApB,OACAmB,IAAAF,IAAAE,IACAD,IAAAC,IAAAD,IACAC,IAAAA,IAAAD,IACAC,IAAAD,IAAAC,IACAA,IAAAE,MAAA,EAAA,IAEAC,eAAAtB,OACAmB,IAAAH,IAAAG,IACAD,IAAAC,IAAAD,IACAC,IAAAA,IAAAD,IACAC,IAAAD,IAAAC,IACAA,IAAAE,MAAA,EAAA,GAGAL;IAAA1B,MAAA,IAAA,GACA2B,IAAA3B,MAAA,IAAA,GACA4B,IAAA5B,MAAA,IAAA,GACA6B,IAAA7B,MAAA,IAAA,EACA,IAAAiC,iBAAAvB,OACAmB,IAAAF,IAAAE,IACAD,IAAAC,IAAAD,IACAC,IAAAA,IAAAD,IACAC,IAAAD,IAAAC,IACAA,IAAAE,MAAA,EAAA,IAEAG,gBAAAxB,OACAmB,IAAAH,IAAAG,IACAD,IAAAC,IAAAD,IACAC,IAAAA,IAAAD,IACAC,IAAAD,IAAAC,IACAA,IAAAE,MAAA,EAAA,IAGAI,WAAA,EAAA,GAAA,GAAA,GAAA,IAAA,IAAA,IAAA,IAAA,IAAA,IAAA,IAAA,IAAA,KACAC,WAAA,EAAA,GAAA,GAAA,GAAA,IAAA,IAAA,IAAA,IAAA,IAAA,IAAA,IAAA,IAAA,KAEAC,SAAA,WACA,IAAA,GAAAC,aAAApE,EAAA,EAAA,GAAAA,EAAAA,IACAoE,SAAAA,SAAA5B,OAAAV,MAAA,GAEA,OAAAsC,aAQAC,QAAA,SAAAC,QAAAC,GACA,GAAA,IAAAA,EACA,KAAA,IAAAxH,OAAA,mCAEA6E,MAAA0C,QAAAA,QACA1C,KAAA2C,EAAAA,EAGAF,SAAAxC,WAIA2C,IAAA,SAAAD,GACA,MAAA3C,MAAA2C,GAAAA,EAAA3C,KAAA,GAAAyC,SAAAzC,KAAA0C,QAAAC;EAIAE,OAAA,SAAAC,OACA,MAAA9C,MAAA0C,SAAAI,MAAAJ,SAAA1C,KAAA2C,GAAAG,MAAAH,GAIAI,SAAA,WACA,GAAAC,IAAA,KAAA,KAAA,KAAA,KAAA,KAAA,KAAA,MAAAhD,KAAA0C,QAIA,OAHA1C,MAAA2C,IACAK,GAAAhD,KAAA2C,EAAA,EAAA,IAAA,IAAAvD,OAAAY,KAAA2C,GAAAK,GAEAA,GAGAC,aAAA,WACA,MAAA,IAAAjD,KAAA0C,QAAA,EAAA1C,KAAA0C,QAAA,GAgBA,IAAAQ,OAAA,SAAAC,QAAAC,SAGApD,KAAAqD,QAAA,KAEAF,QAAAA,YAEAnD,KAAAsD,OAAAF,QAAA,MACAG,KAAA,EACAC,UACAC,SACAC,YAIA1D,KAAA2D,cAEA,IAAAC,YACAC,KAAAC,OAAAD,KAAAV,SACAY,YAAAD,OAAAD,KAAAX,MAAAc,gBAQA,IALAH,KAAAI,QAAA,SAAAC,KACAlE,KAAA2D,YAAAO,KAAAf,QAAAe,KACA5C,SAAAyC,YAAAG,MAAAN,QAAAtF,KAAA4F,MACAlE,MAEA4D,QAAAvF,OACA,KAAA,IAAAlD,OAAA,oBAAAyI,QAAAvE,KAAA,MAGA;IAAA6D,MAAAiB,YAAAhB,QAAAiB,OAAA,OAAAjB,QAAAkB,SACA,KAAA,IAAAlJ,OAAA,sBAAAiE,OAAA+D,QAAAiB,MAIAL,aAAAE,QAAA,SAAAC,KACA5C,SAAAuC,KAAAK,OAAAf,QAAAe,KAAAhB,MAAAc,gBAAAE,OAGA,IAAAI,MAAAtE,KAAAmD,QAAAA,OAmBA,IAjBA,OAAAmB,KAAAD,WACAC,KAAAF,KAAAlB,MAAAqB,QAGAD,KAAAE,UACAF,KAAAE,QAAA,GAAA/I,MACA6I,KAAAE,QAAAxG,gBAAA,IAGA,OAAAsG,KAAAG,KACAH,KAAAG,KAAAvB,MAAAwB,GAAAhC,QACA,gBAAA4B,MAAAG,OAGAH,KAAAG,KAAAH,KAAAG,KAAA/B,SAGA,OAAA4B,KAAAK,SAAA,CACA,gBAAAL,MAAAK,WACAL,KAAAK,UAAAL,KAAAK,UAEA,KAAA,GAAAvG,GAAA,EAAAA,EAAAkG,KAAAK,SAAAtG,OAAAD,IAAA,CACA,GAAAwG,GAAAN,KAAAK,SAAAvG,EACA,IAAA,GAAAwG,KAAAA,GAAA,MAAA,KAAAA,GACA,KAAA,IAAAzJ,OACA;EAOA,KAAAgG,IAAAmD,KAAAO,WAAA1D,IAAAmD,KAAAQ,YACA3D,IAAAmD,KAAAS,aAAA,OAAAT,KAAAU,WACA,OAAAV,KAAAD,UAEA,OAAAC,KAAAF,MACA,IAAAlB,OAAAqB,OACAD,KAAAW,UACAX,KAAAW,QAAAX,KAAAE,QAAAzI,WAAA,GAEAuI,KAAAS,WAAAT,KAAAE,QAAAxI,SACA,MACA,KAAAkH,OAAAgC,QACAZ,KAAAS,WAAAT,KAAAE,QAAAxI,SACA,MACA,KAAAkH,OAAAiC,OACAb,KAAAU,UAAA5J,SAAAkC,WACAgH,KAAAE,SAkBA,GAZA,OAAAF,KAAAW,SACAX,KAAAW,kBAAAtE,SACA2D,KAAAW,SAAAX,KAAAW,UAIA,OAAAX,KAAAQ,WACAR,KAAAQ,oBAAAnE,SACA2D,KAAAQ,WAAAR,KAAAQ,YAIA,OAAAR,KAAAS,WACAT,KAAAS,cACAT,KAAAc,mBACA,IAAAd,KAAAS,qBAAApE,OAAA,CACA,GAAAoE,eAAAK,cAEA;IAAAhH,EAAA,EAAAA,EAAAkG,KAAAS,WAAA1G,OAAAD,IAAA,CACA,GAAAwG,GAAAN,KAAAS,WAAA3G,EACAwG,GAAA,EACAG,WAAAzG,KAAAsG,GACA,EAAAA,GACAQ,YAAA9G,KAAAsG,GAGAN,KAAAS,WAAAA,WACAT,KAAAc,YAAAA,gBAEAd,MAAAS,WAAA,GACAT,KAAAc,aAAAd,KAAAS,YACAT,KAAAS,gBAEAT,KAAAc,eACAd,KAAAS,YAAAT,KAAAS,YAWA,IANA,OAAAT,KAAAO,UACAP,KAAAO,mBAAAlE,SACA2D,KAAAO,UAAAP,KAAAO,WAIA,OAAAP,KAAAU,UACAV,KAAAe,WAAA,SACA,IAAA,gBAAAf,MAAAU,UACAV,KAAAU,WAAAV,KAAAU,WACAV,KAAAe,WAAA,SAEA,IAAAf,KAAAU,oBAAAvC,UAEA6B,KAAAU,UAAArC,GAAA2B,KAAAF,KAAAlB,MAAAgC,SACAZ,KAAAU,WAAAV,KAAAU,UAAAtC,SACA4B,KAAAe,WAAA,OAEAf,KAAAe,aACAf,KAAAU,UAAAtC,QACA4B,KAAAU,UAAArC,IAEA2B,KAAAU,UAAA;IAGA,CACA,GAAAA,cAAAK,aAEA,KAAAjH,EAAA,EAAAA,EAAAkG,KAAAU,UAAA3G,OAAAD,IAAA,CACA,GAAAkH,MAAAhB,KAAAU,UAAA5G,EAEA,iBAAAkH,MACAN,UAAA1G,KAAAgH,OACAA,KAAA3C,GAAA2B,KAAAF,KAAAlB,MAAAgC,QACAF,UAAA1G,KAAAgH,KAAA5C,SAEA2C,WAAA/G,MAAAgH,KAAA5C,QAAA4C,KAAA3C,IAGA2B,KAAAU,UAAA7D,IAAA6D,WAAAA,UAAA,KACAV,KAAAe,WAAAlE,IAAAkE,YAAAA,WAAA,KA8BA,GA1BA,OAAAf,KAAAiB,OACAjB,KAAAiB,OAAAjB,KAAAF,KAAAlB,MAAAsC,QACAlB,KAAAE,QAAA7G,YACA,KACA,gBAAA2G,MAAAiB,SACAjB,KAAAiB,QAAAjB,KAAAiB,SAIA,OAAAjB,KAAAmB,SACAnB,KAAAmB,SAAAnB,KAAAF,KAAAlB,MAAAwC,UACApB,KAAAE,QAAA5G,cACA,KACA,gBAAA0G,MAAAmB,WACAnB,KAAAmB,UAAAnB,KAAAmB,WAIA,OAAAnB,KAAAqB,SACArB,KAAAqB,SAAArB,KAAAF,KAAAlB,MAAA0C,UACAtB,KAAAE,QAAA3G,cACA,KACA,gBAAAyG,MAAAqB,WACArB,KAAAqB,UAAArB,KAAAqB,WAGArB,KAAAF,MAAAlB,MAAAsC,OACAxF,KAAA6F,QAAA;IACA,CAEA,IADA7F,KAAA6F,WACAzH,EAAA,EAAAA,EAAAkG,KAAAiB,OAAAlH,OAAAD,IAEA,IAAA,GADAyB,MAAAyE,KAAAiB,OAAAnH,GACA0H,EAAA,EAAAA,EAAAxB,KAAAmB,SAAApH,OAAAyH,IAEA,IAAA,GADAhG,QAAAwE,KAAAmB,SAAAK,GACAC,EAAA,EAAAA,EAAAzB,KAAAqB,SAAAtH,OAAA0H,IAAA,CACA,GAAAhG,QAAAuE,KAAAqB,SAAAI,EAIA/F,MAAA6F,QAAAvH,KAAA,GAAAlD,UAAAwE,KAAAC,KAAAC,OAAAC,SAIA3E,SAAAmD,KAAAyB,KAAA6F,UAQA3C,OAAAiB,aACA,SAAA,UAAA,SAAA,QACA,SAAA,WAAA,YAGAjB,MAAAqB,OAAA,EACArB,MAAAgC,QAAA,EACAhC,MAAAiC,OAAA,EACAjC,MAAA8C,MAAA,EACA9C,MAAAsC,OAAA,EACAtC,MAAAwC,SAAA,EACAxC,MAAA0C,SAAA,EAEA1C,MAAAwB,GAAA,GAAAjC,SAAA,GACAS,MAAA+C,GAAA,GAAAxD,SAAA,GACAS,MAAAgD,GAAA,GAAAzD,SAAA,GACAS,MAAAiD,GAAA,GAAA1D,SAAA,GACAS,MAAAkD,GAAA,GAAA3D,SAAA,GACAS,MAAAmD,GAAA,GAAA5D,SAAA,GACAS,MAAAoD,GAAA,GAAA7D,SAAA,GAEAS,MAAAc,iBACAI,KAAA,KACAI,QAAA,KACA+B,SAAA,EACA9B,KAAAvB,MAAAwB,GACA8B,MAAA,KACAjH,MAAA,KACAoF,SAAA,KACAM,QAAA,KACAF,WAAA,KACAD,UAAA,KACAD,SAAA,KACAG,UAAA,KACAO,OAAA,KACAE,SAAA,KACAE,SAAA,KACAtB,SAAA,MAKAnB,MAAAuD,UAAA,SAAAC,KAAAC,UACA,MAAA3L,UAAAyL,UAAAC,KAAAC;EAGAzD,MAAA0D,SAAA,SAAAF,KAAAC,UACA,MAAA3L,UAAA4L,SAAAF,KAAAC,WAGAzD,MAAA2D,gBAAA,SAAA1D,SACA,GAAAe,KAAAL,KAAAE,YAAAvD,MAAAsG,UAAAC,QAEAlD,MAAAC,OAAAD,KAAAV,SACAY,YAAAD,OAAAD,KAAAX,MAAAc,gBAEA,KAAA,GAAA5F,GAAA,EAAAA,EAAAyF,KAAAxF,OAAAD,IAEA,GAAAkD,SAAAyC,YAAAF,KAAAzF,MAEA8F,IAAAL,KAAAzF,GAAA4I,cACAxG,MAAA2C,QAAAU,KAAAzF,IACA0I,eAEA,OAAAtG,OAAAA,gBAAAG,SAAAH,MAAAnC,SAAA,CAIA,OAAA6F,KACA,IAAA,OACA1D,MAAA0C,MAAAiB,YAAAhB,QAAAiB,KACA,MACA,KAAA,OACA5D,MAAAA,MAAAuC,UACA,MACA,KAAA,YAYAmB,IAAA,QACA1D,gBAAAG,SACAH,OAAAA,OAEA,KAAA,GAAA8E,MAAAQ,EAAA,EAAAA,EAAAtF,MAAAnC,OAAAyH,IACAR,KAAA9E,MAAAsF,GACAR,eAAA7C,WAGA6C,KADAA,eAAA3E,OACA,GAAA8B,SAAA6C,KAAA,GAAAA,KAAA,IAEA,GAAA7C,SAAA6C,OAEAwB,UAAAhB,GAAAR,KAAAvC,UAEAvC;MAAAsG,SACA,MACA,KAAA,UACA,IAAA,QACAtG,MAAApF,SAAAsD,kBAAA8B,MACA,MACA,SACA,GAAAA,gBAAAG,OAAA,CACA,IAAA,GAAAmF,GAAA,EAAAA,EAAAtF,MAAAnC,OAAAyH,IACAgB,UAAAhB,GAAA1G,OAAAoB,MAAAsF,GAEAtF,OAAAsG,cAEAtG,OAAApB,OAAAoB,OAIAuG,MAAAzI,MAAA4F,IAAA1D,QAIA,IAAA,GADAyG,YACA7I,EAAA,EAAAA,EAAA2I,MAAA1I,OAAAD,IAAA,CACA,GAAA8I,MAAAH,MAAA3I,EACA6I,SAAA3I,KAAA4I,KAAA,GAAA,IAAAA,KAAA,GAAAnE,YAEA,MAAAkE,SAAA5H,KAAA,MAIA6D,MAAAjD,WAQAsD,IAAA,SAAA4D,UACA,GAAAA,SACA,MAAAnH,MAAAoH,MAAA,GAAAC,oBAAA,SAAAF,UAEA,IAAAG,QAAAtH,KAAAuH,UAAA,MAKA,OAJAD,WAAA,IACAA,OAAAtH,KAAAoH,MAAA,GAAAI,YAAA,WACAxH,KAAAyH,UAAA,MAAAH,SAEAA,QAWA5D,QAAA,SAAAD,MAAAD,OAAAkE,IAAAP,UACA,GAAAQ,OACAnE,OAAAA,OACAC,MAAAA,MACAiE,IAAAA,IAGA;GAAAP,SACA,MAAAnH,MAAAoH,MACA,GAAAC,oBAAA,UAAAM,KAAAR,UAEA,IAAAG,QAAAtH,KAAAuH,UAAA,UAAAI,KAKA,OAJAL,WAAA,IACAA,OAAAtH,KAAAoH,MAAA,GAAAI,YAAA,UAAAG,OACA3H,KAAAyH,UAAA,UAAAH,OAAAK,OAEAL,QAUA9D,OAAA,SAAAoE,GAAAF,KACA,GAAAC,OACAC,GAAAA,GACAF,IAAAA,KAEAJ,OAAAtH,KAAAuH,UAAA,SAAAI,KAKA,OAJAL,WAAA,IACAA,OAAAtH,KAAAoH,MAAA,GAAAI,YAAA,SAAAG,OACA3H,KAAAyH,UAAA,SAAAH,OAAAK,OAEAL,QASA7D,MAAA,SAAAmE,GAAAF,KACA,GAAAC,OACAC,GAAAA,GACAF,IAAAA,KAEAJ,OAAAtH,KAAAuH,UAAA,QAAAI,KAKA,OAJAL,WAAA,IACAA,OAAAtH,KAAAoH,MAAA,GAAAI,YAAA,QAAAG,OACA3H,KAAAyH,UAAA,QAAAH,OAAAK,OAEAL,QAOAd,MAAA,WACA,MAAAxG,MAAAuD,MAAAlF;EAQA0E,SAAA,WACA,MAAAG,OAAA2D,gBAAA7G,KAAA2D,cAOAkE,OAAA,SAAAC,QAAAnB,UACA,MAAA3L,UAAA6M,OAAA7H,KAAA8H,QAAAnB,WAGAoB,yBAAA,WACA,MAAA/M,UAAAgN,mBAAAhI,OAQAyH,UAAA,SAAAQ,KAAAzH,MAAAmH,MAEA3H,KAAAsD,SAEA9C,QACAA,MAAAA,gBAAA/E,MACAL,SAAA0C,MAAA0C,OACApF,SAAA6C,WAAAuC,QAGA,OAAAyH,KACAjI,KAAAsD,OAAAC,IAAA/C,OAEAmH,KAAAO,OAAA1H,MACAR,KAAAsD,OAAA2E,MAAA3J,KAAAqJ,SAYAJ,UAAA,SAAAU,KAAAN,MAEA,IAAA3H,KAAAsD,OACA,OAAA,CAGA,IAAA6E,SAAA,CAEA,IAAA,OAAAF,KACAE,OAAAnI,KAAAsD,OAAAC,QAIA6E,WACA,IAAA,GAAAC,MAAAjK,EAAA,EAAAA,EAAA4B,KAAAsD,OAAA2E,MAAA5J,OAAAD,IAAA,CACAiK,KAAArI,KAAAsD,OAAA2E,MAAA7J,EACA,KAAA,GAAA2H,KAAA4B,MACA,GAAAA,KAAAW,eAAAvC,IACA3G,OAAAuI,KAAA5B,KAAA3G,OAAAiJ,KAAAtC,IACA,QAAAqC,UAGAD;OAAAE,KAAAH,MACA,OAIA,IAAAC,QAAAnI,KAAAsD,OAAAC,IAAA,CAIA,IAAA,GADAgF,YAAA,GAAAf,YAAAS,KAAAN,MACAvJ,EAAA,EAAAA,EAAA4B,KAAAsD,OAAAC,IAAAlF,QACAkK,WAAAC,OAAAxI,KAAAsD,OAAAC,IAAAnF,IADAA,KAKA+J,OAAAI,WAAAE,WACAzI,KAAAyH,UAAAQ,KAAAE,OAAAR,MAGA,MAAAQ,kBAAAxH,OACAvF,SAAA6C,WAAAkK,QACAA,iBAAA1M,MACAL,SAAA0C,MAAAqK,QACAA,QAOArK,MAAA,WACA,MAAA,IAAAoF,OAAAlD,KAAA2D,cAGAyD,MAAA,SAAAmB,YAOA,GAAA/D,SAAAxE,KAAAmD,QAAAqB,QAGApI,KAAAoI,QAAA1I,cACAuB,MAAAmH,QAAAzI,WAAA,EACA2M,IAAAlE,QAAAxI,UACA6D,KAAA2E,QAAA7G,WACAmC,OAAA0E,QAAA5G,aACAmC,OAAAyE,QAAA3G,aACA6E,QAAAtH,SAAAkC,WAAAkH,SAKAJ,MAJAhJ,SAAAO,WAAA6I,SAIAxE,KAAAmD,QAAAiB,MACAmC,SAAAvG,KAAAmD,QAAAoD,SACA9B,KAAAzE,KAAAmD,QAAAsB,KACAlF,MAAAS,KAAAmD,QAAA5D,MACA0F,QAAAjF,KAAAmD,QAAA8B,QACAJ,SAAA7E,KAAAmD,QAAA0B,SACAC,UAAA9E,KAAAmD,QAAA2B,UACAE,UAAAhF,KAAAmD,QAAA6B,UACAX,SAAArE,KAAAmD,QAAAkB,SACAU,WAAA/E,KAAAmD,QAAA4B,WACAK,YAAApF,KAAAmD,QAAAiC,YACAT,SAAA3E,KAAAmD,QAAAwB,SACAY,OAAAvF,KAAAmD,QAAAoC,OACAE,SAAAzF,KAAAmD,QAAAsC,SACAE,SAAA3F,KAAAmD,QAAAwC,SAEAgD,GAAA,GAAAC,UAAA5I,KACA2I;GAAAE,QAAAzM,KAAAiB,MAEA,IAAAyL,aACAA,WAAA5F,MAAAqB,QAAAoE,GAAAI,QACAD,UAAA5F,MAAAgC,SAAAyD,GAAAK,QACAF,UAAA5F,MAAAiC,QAAAwD,GAAAM,QACAH,UAAA5F,MAAA8C,OAAA2C,GAAAO,QACAJ,UAAA5F,MAAAsC,QAAAmD,GAAAO,QACAJ,UAAA5F,MAAAwC,UAAAiD,GAAAO,QACAJ,UAAA5F,MAAA0C,UAAA+C,GAAAO,QAEAJ,UAAAA,UAAA1E,KAEA,IAAAyB,QACA,IAAAzB,KAAAlB,MAAAsC,OACAK,QAAA7F,KAAA6F,YACA,CACA,GAAAsD,cACAA,YAAAjG,MAAAsC,QAAAmD,GAAAS,SACAD,WAAAjG,MAAAwC,UAAAiD,GAAAU,SACAF,WAAAjG,MAAA0C,UAAA+C,GAAAW,SACAH,WAAAA,WAAA/E,MAKAyB,QAJAzB,MAAAlB,MAAAsC,QAAArE,IAAAoE,UAAAjE,SAAAiE,OAAA1F,OACAuE,MAAAlB,MAAAwC,UAAAvE,IAAAsE,YAAAnE,SAAAmE,SAAA3F,SACAsE,MAAAlB,MAAA0C,UAAAzE,IAAAwE,YAAArE,SAAAqE,SAAA7F,WAIAqJ,WAAAI,KAAAZ,GAAA9I,KAAAC,OAAAC;CAUA,IANA,GAAAyJ,UAIApL,EAAA0H,EAAAC,EAAA0D,GAAAzI,IAAAE,IAAAwI,IAAAC,IAAAC,OAAAzJ,MAAAC,IAAAyJ,OAJAC,MAAA,EAAAtD,MAAAxG,KAAAmD,QAAAqD,QAMA,CAQA,IALAkD,IAAAZ,UAAAS,KAAAZ,GAAAvM,KAAAiB,MAAAqL,KACAkB,OAAAF,IAAA,GAAAvJ,MAAAuJ,IAAA,GAAAtJ,IAAAsJ,IAAA,GAGAF,UAAA,EACA1D,EAAA3F,MAAAC,IAAA0F,EAAAA,IAEA1H,EAAAwL,OAAA9D,IAEA3E,IAAA8D,WAAA3D,SAAA2D,QAAA0D,GAAAoB,MAAA3L,KACA+C,IAAA0D,YAAA8D,GAAAqB,QAAA5L,IACA+C,IAAA6D,aAAA1D,SAAA0D,UAAA2D,GAAAnG,SAAApE,KACA+C,IAAAwH,GAAAsB,aAAAtB,GAAAsB,UAAA7L,IACA,OAAAiG,WAAA/C,SAAAqH,GAAAuB,WAAA9L,KAEA+C,IAAA4D,aAAA5D,IAAAiE,gBACA9D,SAAAyD,WAAA4D,GAAAwB,SAAA/L,MACAkD,SAAA8D,YAAAuD,GAAAyB,UAAAhM,KAIA+C,IAAA2D,aAIA1G,EAAAuK,GAAA0B,UACA/I,SAAAwD,UAAA1G,EAAA,KACAkD,SAAAwD,WAAA6D,GAAA0B,QAAAjM,IAIAA,GAAAuK,GAAA0B,UACA/I,SAAAwD,UAAA1G,EAAA,EAAAuK,GAAA0B,WACA/I,SAAAwD,WAAA6D,GAAA2B,YAAAlM,EAAAuK,GAAA0B,aAMAT,OAAAxL,GAAA,KACAoL,UAAA,EAKA;GAAArI,IAAAwD,WAAAxD,IAAA0E,SAAA,CAEA,GAAA0E,QAAAC,QAAAC,UAEA,KAAA3E,EAAA,EAAAA,EAAAnB,SAAAtG,OAAAyH,IAAA,CACA,GAAA6D,KAAAhF,SAAAmB,EACA,GAAA6D,KACAY,OAAAtO,KAAAgF,MAAA0I,IAAA9D,QAAAxH,QACAmM,QAAA3J,MAAA8I,IAAA9D,QAAAxH,UAEAkM,OAAAtO,KAAAgF,OAAA0I,IAAA,GAAA9D,QAAAxH,QACAmM,QAAA3J,MAAA8I,IAAA,EAAA9D,QAAAxH,QAGA,KAEA,IADAqL,OACA3D,EAAA5F,MAAAC,IAAA2F,EAAAA,IAAA,CACA,GAAAvE,KAAAoI,OAAA7D,EACA,QAAAvE,KAGAkI,IAAApL,KAAAkD,KAIApD,EAFA,EAAAmM,OAEAb,IAAAzH,MAAAsI,QAAA,GAEAb,IAAAa,OAGA,IAAA7M,MAAAmI,QAAA2E,SAEA5O,KAAAR,SAAA6B,YAAA0L,GAAA+B,YAAAtM,GACAuM,IAAAvP,SAAAqC,QAAA7B,KAAA8B,KAGA4D,UAAAmJ,QAAAE,MACAF,QAAAnM,KAAAqM,KAEA,MAAAC,KAKA,IAFAxP,SAAAmD,KAAAkM,SAEA3E,EAAA,EAAAA,EAAA2E,QAAApM,OAAAyH,IAAA,CACA,GAAA6E,KAAAF,QAAA3E,EACA,IAAAvG,OAAAoL,IAAApL,MAEA,MADAS,MAAA6K,KAAAf,MACAvB,WAAAE,UACA;GAAAkC,KAAAnG,QAAA,CAEA,KADAsF,OACAvB,WAAAC,OAAAmC,KACA,MAAApC,YAAAE,UAEA,IAAAjC,UACAA,OACAA,OAEA,MADAxG,MAAA6K,KAAAf,MACAvB,WAAAE,iBAOA,KAAA3C,EAAA3F,MAAAC,IAAA0F,EAAAA,IAEA,GADA1H,EAAAwL,OAAA9D,GACA,OAAA1H,EAAA,CACA,GAAAxC,MAAAR,SAAA6B,YAAA0L,GAAA+B,YAAAtM,EACA,KAAA2H,EAAA,EAAAA,EAAAF,QAAAxH,OAAA0H,IAAA,CACA,GAAArI,MAAAmI,QAAAE,GACA4E,IAAAvP,SAAAqC,QAAA7B,KAAA8B,KACA,IAAA6B,OAAAoL,IAAApL,MAEA,MADAS,MAAA6K,KAAAf,MACAvB,WAAAE,UACA,IAAAkC,KAAAnG,QAAA,CAEA,KADAsF,OACAvB,WAAAC,OAAAmC,KACA,MAAApC,YAAAE,UAEA,IAAAjC,UACAA,OACAA,OAEA,MADAxG,MAAA6K,KAAAf,MACAvB,WAAAE,aAWA,GADAoB,QAAA,EACAzF,MAAAlB,MAAAqB,OAAA,CAEA,GADAnI,MAAAmK,SACAnK,KAAAhB,SAAAG,QAEA,MADAyE,MAAA6K,KAAAf,MACAvB,WAAAE,UAEAE;GAAAE,QAAAzM,KAAAiB,WACA,IAAA+G,MAAAlB,MAAAgC,QAAA,CAEA,GADA7H,OAAAkJ,SACAlJ,MAAA,KACA2D,IAAA/E,KAAAgF,MAAA5D,MAAA,IACA6D,IAAAL,MAAAxD,MAAA,IACAA,MAAA6D,IACA9E,MAAA4E,IACA,GAAA3D,QACAA,MAAA,KACAjB,MAEAA,KAAAhB,SAAAG,SAEA,MADAyE,MAAA6K,KAAAf,MACAvB,WAAAE,UAGAE,IAAAE,QAAAzM,KAAAiB,WACA,IAAA+G,MAAAlB,MAAAiC,OAEAuD,KADAjE,KAAA/B,UACAA,QAAA,GAAA,EAAA+B,OAAA,EAAA8B,WAEA7D,QAAA+B,MAAA,EAAA8B,SAEA7D,QAAA+B,KACAoF,QAAA,MACA,IAAAzF,MAAAlB,MAAA8C,MACA0C,KAAAnC,SACAsD,QAAA,MACA,IAAAzF,MAAAlB,MAAAsC,OAAA,CAKA,IAJAgE,WAEA3J,MAAA5D,KAAAgF,OAAA,GAAApB,MAAA0G,UAAAA,YAYA,GATA1G,MAAA0G,SACAkD,GAAA1I,OAAAlB,KAAA,IACAmB,IAAAyI,GAAAzI,IACAE,IAAAuI,GAAAvI,IACAF,MACAnB,KAAAqB,IACAwH,KAAA1H,IACA6I,QAAA,IAEA1I,IAAAoE,SAAAjE,SAAAiE,OAAA1F,MACA,KAGAgG;QAAAsD,WAAAI,KAAAZ,GAAA9I,KAAAC,OAAAC,YACA,IAAAqE,MAAAlB,MAAAwC,SAAA,CAMA,IALA8D,WAEA1J,QAAA7D,KAAAgF,OACA,MAAA,GAAApB,KAAAC,SAAAyG,UAAAA,YAoBA,GAjBAzG,QAAAyG,SACAkD,GAAA1I,OAAAjB,OAAA,IACAkB,IAAAyI,GAAAzI,IACAE,IAAAuI,GAAAvI,IACAF,MACAlB,OAAAoB,IACArB,MAAAmB,IACAyI,GAAA1I,OAAAlB,KAAA,IACAmB,IAAAyI,GAAAzI,IACAE,IAAAuI,GAAAvI,IACAF,MACAnB,KAAAqB,IACAwH,KAAA1H,IACA6I,QAAA,EACAL,UAAA,MAGArI,IAAAoE,UAAAjE,SAAAiE,OAAA1F,OACAsB,IAAAsE,YAAAnE,SAAAmE,SAAA3F,SACA,KAGA+F,SAAAsD,WAAAI,KAAAZ,GAAA9I,KAAAC,OAAAC,YACA,IAAAqE,MAAAlB,MAAA0C,SAAA,CAOA,IANA4D,WAEAzJ,QAAA9D,KAAAgF,OACA,OAAA,KAAApB,KAAA,GAAAC,OAAAC,SACAwG,UAAAA,YA0BA,GAvBAxG,QAAAwG,SACAkD,GAAA1I,OAAAhB,OAAA,IACAiB,IAAAyI,GAAAzI,IACAE,IAAAuI,GAAAvI,IACAF,MACAjB,OAAAmB,IACApB,QAAAkB,IACAyI,GAAA1I,OAAAjB,OAAA,IACAkB,IAAAyI,GAAAzI,IACAE,IAAAuI,GAAAvI,IACAF,MACAlB,OAAAoB,IACArB,MAAAmB,IACAyI,GAAA1I,OAAAlB,KAAA,IACAmB,IAAAyI,GAAAzI,IACAE,IAAAuI,GAAAvI,IACAF,MACAnB,KAAAqB,IACAwH,KAAA1H,IACA6I,QAAA,OAIA1I,IAAAoE,UAAAjE,SAAAiE,OAAA1F,OACAsB,IAAAsE,YAAAnE,SAAAmE,SAAA3F,SACAqB,IAAAwE,YAAArE,SAAAqE,SAAA5F,SAEA,KAGA8F;QAAAsD,WAAAI,KAAAZ,GAAA9I,KAAAC,OAAAC,QAGA,GAAA8J,QAAAnB,IAAA,GAAA,CACA,GAAAoC,aAAA1P,SAAAgC,WAAAhB,KAAAiB,MAAA,GAAA,EACA,IAAAqL,IAAAoC,YAAA,CACA,KAAApC,IAAAoC,aAAA,CAGA,GAFApC,KAAAoC,cACAzN,MACA,IAAAA,QACAA,MAAA,IACAjB,KACAA,KAAAhB,SAAAG,SAEA,MADAyE,MAAA6K,KAAAf,MACAvB,WAAAE,UAGAqC,aAAA1P,SAAAgC,WAAAhB,KAAAiB,MAAA,GAAA,GAEAsL,GAAAE,QAAAzM,KAAAiB,YASA6F,MAAA6H,YAAA,SAAAC,WAEA,GADAA,UAAAA,UAAAC,QAAA,YAAA,KACAD,UAAA3M,OACA,MAAA,KAGA,IAAAD,GAAA0H,EAAA5B,IAAA1D,MAAA0G,KACAgE,MAAAF,UAAAG,MAAA,KACAhI,UAEA,KAAA/E,EAAA,EAAAA,EAAA8M,MAAA7M,OAAAD,IAIA,OAHA8I,KAAAgE,MAAA9M,GAAA+M,MAAA,KACAjH,IAAAgD,KAAA,GACA1G,MAAA0G,KAAA,GACAhD,KACA,IAAA,OACAf,QAAAiB,KAAAlB,MAAA1C,MACA,MACA;IAAA,OACA2C,QAAAsB,KAAAvB,MAAA1C,MACA,MACA,KAAA,QACA,IAAA,WACA,IAAA,WACA,IAAA,UACA,IAAA,aACA,IAAA,YACA,IAAA,WACA,IAAA,SACA,IAAA,WACA,IAAA,WACA,GAAA,IAAAA,MAAAiB,QAAA,KAEA,IADAjB,MAAAA,MAAA2K,MAAA,KACArF,EAAA,EAAAA,EAAAtF,MAAAnC,OAAAyH,IACA,aAAA3G,KAAAqB,MAAAsF,MACAtF,MAAAsF,GAAAsF,OAAA5K,MAAAsF,SAGA,aAAA3G,KAAAqB,SACAA,MAAA4K,OAAA5K,OAEA0D,KAAAA,IAAAmH,cACAlI,QAAAe,KAAA1D,KACA,MACA,KAAA,QACA,GAAAmC,GAAA2C,KAAAoD,IAAA4C,KAAA9K,MAAA2K,MAAA,IAEA,KADAhI,QAAA6B,aACAc,EAAA,EAAAA,EAAAwF,KAAAjN,OAAAyH,IACA4C,IAAA4C,KAAAxF,GACA,GAAA4C,IAAArK,QACAiH,KAAApC,MAAAwF,KACAvF,QAAA6B,UAAA1G,KAAAgH,QAEAoD,IAAAA,IAAA6C,MAAA,yBACA5I,EAAAyI,OAAA1C,IAAA,IACApD,KAAAoD,IAAA,GACApD,KAAApC,MAAAoC,MAAA5C,QACAS,QAAA6B,UAAA1G,KAAA,GAAAmE,SAAA6C,KAAA3C,IAGA;KACA,KAAA,UACAQ,QAAAqB,QAAApJ,SAAAkE,kBAAAkB,MACA,MACA,KAAA,QACA2C,QAAA5D,MAAAnE,SAAAkE,kBAAAkB,MACA,MACA,KAAA,WACA2C,QAAAkB,SAAA+G,OAAA5K,MACA,MACA,SACA,KAAA,IAAArF,OAAA,2BAAA+I,IAAA,KAGA,MAAAf,UAIAD,MAAAsI,WAAA,SAAAC,QACA,MAAA,IAAAvI,OAAAA,MAAA6H,YAAAU,SAQA,IAAA7C,UAAA,SAAA8C,OACA1L,KAAA0L,MAAAA,MACA1L,KAAA2L,SAAA,KACA3L,KAAA4L,UAAA,KACA5L,KAAAqK,QAAA,KACArK,KAAAsK,YAAA,KACAtK,KAAA0K,YAAA,KACA1K,KAAA6L,YAAA,KACA7L,KAAA+J,MAAA,KACA/J,KAAA8L,OAAA,KACA9L,KAAAmK,SAAA,KACAnK,KAAAoK,UAAA,KACApK,KAAAwC,SAAA,KACAxC,KAAAgK,QAAA,KACAhK,KAAAiK,UAAA,KACAjK,KAAAkK,WAAA;CAGAtB,UAAA3I,UAAA8L,OAAA,SAAAC,EAAAC,QACAA,OAAAA,QAAA,CAEA,IAAAzN,GAAAwN,EAAA,GACAvN,EAAAxC,KAAAgF,MAAA+K,EAAA,KACAE,EAAAF,EAAA,IACAG,EAAAlQ,KAAAgF,MAAAxC,EAAA,GACAmM,EAAAnM,EAAA,EACA2N,EAAAnQ,KAAAgF,OAAAxC,EAAA,GAAA,IACA4N,EAAApQ,KAAAgF,OAAAxC,EAAA2N,EAAA,GAAA,GACAE,EAAArQ,KAAAgF,MAAA,GAAAzC,EAAAC,EAAA0N,EAAAE,EAAA,IAAA,GACAjO,EAAAnC,KAAAgF,MAAAiL,EAAA,GACAnG,EAAAmG,EAAA,EACAK,EAAAtQ,KAAAgF,MAAA,GAAA,EAAA2J,EAAA,EAAAxM,EAAAkO,EAAAvG,GAAA,EACAyG,EAAAvQ,KAAAgF,OAAAzC,EAAA,GAAA8N,EAAA,GAAAC,GAAA,KACAlP,MAAApB,KAAAgF,OAAAqL,EAAAC,EAAA,EAAAC,EAAA,KAAA,IACA9D,KAAA4D,EAAAC,EAAA,EAAAC,EAAA,KAAA,GAAA,EACA5Q,KAAAH,KAAAkE,IAAAqM,EAAA3O,MAAA,EAAAqL,IAAAuD,QACAQ,UAAAhR,KAAAkE,IAAAqM,EAAA,EAAA,EAEA,QAAA/P,KAAAC,MAAAN,KAAA6Q,WAAA,SAGA7D,SAAA3I,UAAA4I,QAAA,SAAAzM,KAAAiB,OAEA,GAAAqP,IAAA1M,KAAA0L,KAEA,IAAAtP,MAAA4D,KAAA2L,SAAA,CAEA3L,KAAAqK,QAAAjP,SAAAe,WAAAC,MAAA,IAAA,IACA4D,KAAAsK,YAAAlP,SAAAe,WAAAC,KAAA,GAAA,IAAA,GACA,IAAAuQ,WAAA,GAAAlR,MAAAW,KAAA,EAAA,EAEA4D;KAAA0K,YAAAtP,SAAA4B,UAAA2P,WACA3M,KAAA6L,YAAAzQ,SAAAkC,WAAAqP,UAEA,IAAArH,MAAAlK,SAAAkC,WAAA,GAAA7B,MAAAW,KAAA,EAAA,GAgBA,IAdA,KAAA4D,KAAAqK,SACArK,KAAA+J,SAAAnJ,OAAAc,UACA1B,KAAAmK,YAAAvJ,OAAAsB,aACAlC,KAAAoK,aAAAxJ,OAAAwB,cACApC,KAAAwC,SAAAD,SAAAN,MAAAqD,MACAtF,KAAA8L,UAAAlL,OAAA0B,aAEAtC,KAAA+J,SAAAnJ,OAAAe,UACA3B,KAAAmK,YAAAvJ,OAAAoB,aACAhC,KAAAoK,aAAAxJ,OAAAuB,cACAnC,KAAAwC,SAAAD,SAAAN,MAAAqD,MACAtF,KAAA8L,UAAAlL,OAAAyB,YAGAlB,IAAAuL,GAAAvJ,QAAA0B,UAEA,CACA7E,KAAAgK,QAAAzJ,OAAA,EAAAP,KAAAqK,QAAA,EACA,IAAAuC,SAAAC,UAAAC,QACAF,SAAAC,UAAAhM,MACA,EAAAb,KAAA6L,YAAAa,GAAAvJ,QAAAsB,KAAA,GACAmI,SAAA,GACAA,QAAA,EAGAE,SAAA9M,KAAAqK,QAAAxJ,MACAb,KAAA6L,YAAAa,GAAAvJ,QAAAsB,KAAA,IAIAqI,SAAA9M,KAAAqK,QAAAuC,OAKA;IAAA,GAAAjK,GAAAvE,EAHA4C,IAAA/E,KAAAgF,MAAA6L,SAAA,GACA5L,IAAAL,MAAAiM,SAAA,GACAC,SAAA9Q,KAAAgF,MAAAD,IAAAE,IAAA,GACA4E,EAAA,EAAAA,EAAA4G,GAAAvJ,QAAA0B,SAAAxG,OAAAyH,IAIA,GAHAnD,EAAA+J,GAAAvJ,QAAA0B,SAAAiB,GACA,EAAAnD,IACAA,GAAAoK,SAAA,GACApK,EAAA,GAAAoK,UAAApK,EAAA,CAEAA,EAAA,GACAvE,EAAAwO,QAAA,GAAAjK,EAAA,GACAiK,SAAAC,YACAzO,GAAA,EAAAyO,YAGAzO,EAAAwO,OAEA,KAAA,GAAA7G,GAAA,EAAA,EAAAA,IACA/F,KAAAgK,QAAA5L,GAAA,EACAA,IACA4B,KAAAwC,SAAApE,IAAAsO,GAAAvJ,QAAAsB,MAHAsB,MASA,GAAAzE,SAAAoL,GAAAvJ,QAAA0B,SAAA,GAAA,CAGA,GAAAzG,GAAAwO,QAAA,EAAAG,QAIA,IAHAH,SAAAC,YACAzO,GAAA,EAAAyO,WAEAzO,EAAA4B,KAAAqK,QAGA,IAAA,GAAAvE,GAAA,EAAA,EAAAA,IACA9F,KAAAgK,QAAA5L,GAAA,EACAA,GAAA,EACA4B,KAAAwC,SAAApE,IAAAsO,GAAAvJ,QAAAsB,MAHAqB,MAUA,GAAA8G,QAAA,CAOA,GAAAI,UACA,IAAA1L,SAAAoL,GAAAvJ,QAAA0B,SAAA,IAmBAmI,UAAA,OAnBA,CACA,GAAAC,cAAA7R,SAAAkC,WACA,GAAA7B,MAAAW,KAAA,EAAA,EAAA,IACA8Q,SAAArM,MACA,EAAAoM,aAAAP,GAAAvJ,QAAAsB,KAAA,GACA0I,SAAA/R,SAAAe,WAAAC,KAAA,GAAA,IAAA,GACA8Q;UAAA,GACAA,SAAA,EACAF,UAAA/Q,KAAAgF,MACA,GACAJ,MACAsM,SAAAtM,MACAoM,aAAAP,GAAAvJ,QAAAsB,KAAA,GAAA,GACA,IAEAuI,UAAA/Q,KAAAgF,MACA,GAAAJ,MAAAb,KAAAqK,QAAAuC,QAAA,GAAA,GAKA,GAAAtL,SAAAoL,GAAAvJ,QAAA0B,SAAAmI,WACA,IAAA,GAAA5O,GAAA,EAAAwO,QAAAxO,EAAAA,IACA4B,KAAAgK,QAAA5L,GAAA,OA9FA4B,MAAAgK,QAAA,KAqGA,GAAA7I,IAAAuL,GAAAvJ,QAAAkC,cACAhI,OAAA2C,KAAA4L,WAAAxP,MAAA4D,KAAA2L,UAAA,CACA,GAAAyB,UACA,IAAAV,GAAAvJ,QAAAiB,MAAAlB,MAAAqB,OACA,GAAApD,IAAAuL,GAAAvJ,QAAA8B,SACA,IAAAa,EAAA,EAAAA,EAAA4G,GAAAvJ,QAAA8B,QAAA5G,OAAAyH,IACAzI,MAAAqP,GAAAvJ,QAAA8B,QAAAa,GACAsH,OAAA9O,KAAA0B,KAAA8L,OAAA7J,MAAA5E,MAAA,EAAAA,MAAA,QAGA+P,UAAA,EAAApN,KAAAqK,cAEAqC,IAAAvJ,QAAAiB,MAAAlB,MAAAgC,UACAkI,QAAApN,KAAA8L,OAAA7J,MAAA5E,MAAA,EAAAA,MAAA,IAEA,IAAA8D,IAAAiM,QAAA,CAGApN,KAAAiK,UAAA1J,OAAA,EAAAP,KAAAqK,QAEA;IAAA,GAAAvE,GAAA,EAAAA,EAAAsH,OAAA/O,OAAAyH,IAAA,CACA,GAAAxF,MAAA8M,OAAAtH,GACAuH,MAAA/M,KAAA,GAAAgN,KAAAhN,KAAA,EACAgN,OAAA,CACA,KAAA,GAAAvH,GAAA,EAAAA,EAAA2G,GAAAvJ,QAAAkC,WAAAhH,OAAA0H,IAAA,CACA,GAAAT,MAAAoH,GAAAvJ,QAAAkC,WAAAU,GAAA,GACApD,EAAA+J,GAAAvJ,QAAAkC,WAAAU,GAAA,EACA,GAAApD,GACAvE,EAAAkP,KAAA,GAAA3K,EAAA,GACAvE,GAAAyC,MAAAb,KAAAwC,SAAApE,GAAAkH,KAAA,KAEAlH,EAAAiP,MAAA,GAAA1K,EAAA,GACAvE,GAAAyC,MAAA,EAAAb,KAAAwC,SAAApE,GAAAkH,KAAA,IAEAlH,GAAAiP,OAAAC,MAAAlP,IACA4B,KAAAiK,UAAA7L,GAAA,KAOA4B,KAAA2L,SAAAvP,KACA4D,KAAA4L,UAAAvO,MAGA,OAAAqP,GAAAvJ,QAAAkB,WACArE,KAAAkK,WAAAlK,KAAA+L,OAAA3P,KAAAsQ,GAAAvJ,QAAAkB,YAIAuE,SAAA3I,UAAA8I,QAAA,WACA,OAAA7I,MAAAF,KAAAqK,SAAA,EAAArK,KAAAqK,UAGAzB,SAAA3I,UAAA+I,QAAA,SAAA5M,KAAAiB,OAIA,IAAA,GAHAkQ,KAAAhN,OAAA,KAAAP,KAAAqK,SACAlK,MAAAH,KAAA8L,OAAAzO,MAAA,GACA+C,IAAAJ,KAAA8L,OAAAzO,OACAe,EAAA+B,MAAAC,IAAAhC,EAAAA,IACAmP,IAAAnP,GAAAA,CAEA;OAAAmP,IAAApN,MAAAC,MAGAwI,SAAA3I,UAAAgJ,QAAA,SAAA7M,KAAAiB,MAAAqL,KAOA,IAAA,GAJA6E,KAAAhN,OAAA,KAAAP,KAAAqK,QAAA,GACAjM,EAAAhD,SAAA4B,UACA,GAAAvB,MAAAW,KAAAiB,MAAA,EAAAqL,MAAA1I,KAAA0K,YACAvK,MAAA/B,EACA0H,EAAA,EAAA,EAAAA,IACAyH,IAAAnP,GAAAA,IACAA,EACA4B,KAAAwC,SAAApE,IAAA4B,KAAA0L,MAAAvI,QAAAsB,MAHAqB,KAOA,OAAAyH,IAAApN,MAAA/B,IAGAwK,SAAA3I,UAAAiJ,QAAA,SAAA9M,KAAAiB,MAAAqL,KACA,GAAA6E,KAAAhN,OAAA,KAAAP,KAAAqK,SACAjM,EAAAhD,SAAA4B,UACA,GAAAvB,MAAAW,KAAAiB,MAAA,EAAAqL,MAAA1I,KAAA0K,WAEA,OADA6C,KAAAnP,GAAAA,GACAmP,IAAAnP,EAAAA,EAAA,IAGAwK,SAAA3I,UAAAmJ,SAAA,SAAAvJ,KAAAC,OAAAC,QAEA,IAAA,GADAwN,QAAAb,GAAA1M,KAAA0L,MACAtN,EAAA,EAAAA,EAAAsO,GAAAvJ,QAAAsC,SAAApH,OAAAD,IAAA,CACA0B,OAAA4M,GAAAvJ,QAAAsC,SAAArH,EACA,KAAA,GAAA0H,GAAA,EAAAA,EAAA4G,GAAAvJ,QAAAwC,SAAAtH,OAAAyH,IACA/F,OAAA2M,GAAAvJ,QAAAwC,SAAAG,GACAyH,IAAAjP,KAAA,GAAAlD,UAAAwE,KAAAC,KAAAC,OAAAC;CAIA,MADA3E,UAAAmD,KAAAgP,KACAA,KAGA3E,SAAA3I,UAAAoJ,SAAA,SAAAxJ,KAAAC,OAAAC,QAEA,IAAA,GADAwN,QAAAb,GAAA1M,KAAA0L,MACA5F,EAAA,EAAAA,EAAA4G,GAAAvJ,QAAAwC,SAAAtH,OAAAyH,IACA/F,OAAA2M,GAAAvJ,QAAAwC,SAAAG,GACAyH,IAAAjP,KAAA,GAAAlD,UAAAwE,KAAAC,KAAAC,OAAAC,QAGA,OADA3E,UAAAmD,KAAAgP,KACAA,KAGA3E,SAAA3I,UAAAqJ,SAAA,SAAAzJ,KAAAC,OAAAC,QACA,OAAA,GAAA3E,UAAAwE,KAAAC,KAAAC,OAAAC,SAWA,IAAAyH,YAAA,SAAAgG,OAAA7F,MACA3H,KAAAyN,KAAAD,OAAA7F,MAGAH,YAAAvH,WAEAwN,KAAA,SAAAD,OAAA7F,MACA3H,KAAAwN,OAAAA,OACAxN,KAAA2H,KAAAA,KAEA3H,KAAA0N,WAEA1N,KAAA2N,QAAA,KACA3N,KAAA4N,QAAA,KAEA,WAAAJ,QACAxN,KAAA4N,QAAAjG,KAAAD,IACAC,KAAAnE,OACA,GAAA/H,MAAAkM,KAAAnE,OAAA7G,UAAA,GACAqD,KAAA2N,QAAAhG,KAAAD,IACAC,KAAAlE,MACA,GAAAhI,MAAAkM,KAAAlE,MAAA9G,UAAA,IACA,UAAA6Q,OACAxN,KAAA4N,QAAAjG,KAAAD,IAAAC,KAAAC,GAAA,GAAAnM,MAAAkM,KAAAC,GAAAjL,UAAA,GACA,SAAA6Q,SACAxN,KAAA2N,QAAAhG,KAAAD,IAAAC,KAAAC,GAAA,GAAAnM,MAAAkM,KAAAC,GAAAjL,UAAA;EAYA6L,OAAA,SAAA5M,MACA,GAAAiS,UAAA7N,KAAA2N,SAAA/R,KAAAoE,KAAA2N,QACAG,QAAA9N,KAAA4N,SAAAhS,KAAAoE,KAAA4N,OAEA,IAAA,WAAA5N,KAAAwN,OAAA,CACA,GAAAK,SACA,OAAA,CACA,IAAAC,QACA,OAAA,MACA,IAAA,UAAA9N,KAAAwN,QACA,GAAAM,QACA,OAAA,MACA,IAAA,SAAA9N,KAAAwN,OACA,MAAAK,WACA,GACA7N,KAAA+N,IAAAnS,OACA,EAGA,OAAAoE,MAAA+N,IAAAnS,OASAmS,IAAA,SAAAnS,MAEA,MADAoE,MAAA0N,QAAApP,KAAA1C,OACA,GAQA6M,SAAA,WACA,OAAAzI,KAAAwN,QACA,IAAA,MACA,IAAA,UACA,MAAAxN,MAAA0N,OACA,KAAA,SACA,IAAA,QACA,MAAA1N,MAAA0N,QAAArP,OACA2B,KAAA0N,QAAA1N,KAAA0N,QAAArP,OAAA,GACA,OAWA,IAAAgJ,oBAAA,SAAAmG,OAAA7F,KAAAR,UACA,GAAA6G,iBAAA,MAAA,UACA,KAAA1M,SAAA0M,eAAAR,QACA,KAAA,IAAArS,OAAA,mBAAAqS,OACA,+CAEAxN;KAAA+N,IAAA,SAAAnS,MACA,MAAAuL,UAAAvL,KAAAoE,KAAA0N,QAAArP,SACA2B,KAAA0N,QAAApP,KAAA1C,OACA,IAEA,GAIAoE,KAAAyN,KAAAD,OAAA7F,MAGAN,oBAAApH,UAAAuH,WAAAvH,UAOApF,aACAC,OAAAC,SACAmI,MAAAA,QAIA,mBAAA+K,SACArT,KAAA,MAAAsI,OAIA,kBAAA/I,SAAAA,OAAA+T,KAEA/T,OAAA,WAAA,WACA,MAAA+I,UAIAlD,MAEA7F,OAAA,sCAAA,cCp2DA,SAAAS,MAGA,GACAsI,OADArI,WAAA,mBAAAC,SAAAA,OAAAC,OAIA,IAAAF,WACAqI,MAAA9I,QAAA,WAAA8I,UACA,IAAAtI,KAAAsI,MACAA,MAAAtI,KAAAsI,UACA,CAAA,GAAA,mBAAA9I,SAGA,KAAA,IAAAe,OAAA,gDAFA+H;QAAAA,MAAA9I,QAAA,UAaA,GAAAkH,UAAA,SAAAC,IAAAC,KACA,MAAA,IAAAD,IAAAE,QAAAD,MAiBA2M,OAAA,SAAAzC,MAAA5D,QAAAnB,UAWA,GATA3G,KAAA8H,QAAAA,SAAA,SAAAsG,IAAA,MAAAA,KACApO,KAAA2G,SAAAA,UAAA0H,QACArO,KAAA0G,KAAA,GAEA1G,KAAA0L,MAAAA,MACA1L,KAAAoE,KAAAsH,MAAAvI,QAAAiB,KACApE,KAAAmD,QAAAuI,MAAAvI,QACAnD,KAAA2D,YAAA+H,MAAA/H,YAEA3D,KAAA2D,YAAAoB,WAAA,CACA,GAAAA,eAAAnE,OAAAZ,KAAAmD,QAAA4B,YACAK,eAAAxE,OAAAZ,KAAAmD,QAAAiC,YACAL,YAAAxG,OACA6G,YAAA7G,OACA6G,YAAAkJ,UAEAtO,KAAA+E,WAAAA,WAAAnE,OAAAwE,aACApF,KAAA+E,WAAA1G,SACA2B,KAAA+E,WAAA,MAIA,GAAA/E,KAAA2D,YAAAqB,UAAA,CACA,GAAAA,WAAAhF,KAAA2D,YAAAqB,oBAAArE,OAEAX,KAAA2D,YAAAqB,WADAhF,KAAA2D,YAAAqB,WAEAsG,KAAAlM,OAAA4F,UACAhF;KAAAgF,WACAuJ,SAAAvJ,UAAAwJ,OAAA,SAAA9L,SACA,OAAArB,QAAAqB,QAAAC,KAEA8L,UAAAzJ,UAAAwJ,OAAA,SAAA9L,SACA,MAAArB,SAAAqB,QAAAC,KAEA+L,WACA,IAAApD,KAAA7J,QAAA,OACA,IAAA6J,KAAA7J,QAAA,OACA,IAAA6J,KAAA7J,QAAA,OACA,IAAA6J,KAAA7J,QAAA,OACA,IAAA6J,KAAA7J,QAAA,OACA,IAAA6J,KAAA7J,QAAA,OACA,IAAA6J,KAAA7J,QAAA,MAKA,IAAAkN,cAAA,SAAAnQ,EAAAC,GACA,MAAAD,GAAAkE,QAAAjE,EAAAiE,QAGA1C,MAAAgF,UAAAuJ,SAAAhQ,KAAAoQ,cACA3O,KAAAgF,UAAAyJ,UAAAlQ,KAAAoQ,cAEA3O,KAAAgF,UAAAuJ,SAAAlQ,SACA2B,KAAAgF,UAAAuJ,SAAA,MAEAvO,KAAAgF,UAAAyJ,UAAApQ,SACA2B,KAAAgF,UAAAyJ,UAAA,UAIAzO,MAAAgF,UAAA,KAMAmJ,QAAAS,cACA,IAAAC,SACA,QAAA,QAAA,WACA,YAAA,aAAA,UAEAV;OAAAS,YAAA1L,MAAA8C,OAAA6I,OACAV,OAAAS,YAAA1L,MAAAiC,QAAA0J,OACAV,OAAAS,YAAA1L,MAAAgC,SAAA2J,OACAV,OAAAS,YAAA1L,MAAAqB,SAAA,WAAA,aAAA3D,OAAAiO,QAOAV,OAAAnG,mBAAA,SAAA0D,OACA,GAAAoD,aAAA,CAEA,MAAApD,MAAAvI,QAAAiB,OAAA+J,QAAAS,aACA,OAAA,CAEA,IAAAlD,MAAA/H,YAAApE,OAAAmM,MAAA/H,YAAA6C,MACA,OAAA,CAEA,KAAA,GAAAtC,OAAAwH,OAAA/H,YAAA,CACA,GAAArC,UAAA,UAAA,OAAA,QAAA4C,KACA,OAAA,CAEA,KAAA5C,SAAA6M,OAAAS,YAAAlD,MAAAvI,QAAAiB,MAAAF,KAEA,MADA4K,aAAA,GACA,EAIA,MAAAA,aAIAX,OAAAlO,WAGA+H,mBAAA,WACA,MAAAmG,QAAAnG,mBAAAhI,KAAA0L,QAUA3I,SAAA,WAEA,GAAA+E,SAAA9H,KAAA8H,OAEA;KAAA9H,KAAAmD,QAAAiB,OAAA+J,QAAAS,aACA,MAAA9G,SACA,0DAOA,IAJA9H,KAAA0G,MAAAoB,QAAA,UAEA9H,KAAAkD,MAAAiB,YAAAnE,KAAAmD,QAAAiB,SAEApE,KAAAmD,QAAA5D,MAAA,CACAS,KAAA+N,IAAAjG,QAAA,SACA,IAAAvI,OAAAS,KAAAmD,QAAA5D,KACAS,MAAA+N,IAAA/N,KAAA2G,SAAAoI,WAAAxP,MAAAxD,aACAgS,IAAAxO,MAAAvD,UAAA,KACA+R,IAAAxO,MAAAzD,mBACAkE,MAAAmD,QAAAqD,OACAxG,KAAA+N,IAAAjG,QAAA,QACAiG,IAAA/N,KAAAmD,QAAAqD,OACAuH,IACAjG,QADA9H,KAAAgP,OAAAhP,KAAAmD,QAAAqD,OACA,QACA,QAMA,OAHAxG,MAAAgI,sBACAhI,KAAA+N,IAAAjG,QAAA,oBAEA9H,KAAA0G,KAAArH,KAAA,KAGA2G,MAAA,WACA,GAAA8B,SAAA9H,KAAA8H,OACA,IAAA9H,KAAAmD,QAAAoD,UACAvG,KAAA+N,IAAA/N,KAAAmD,QAAAoD,UAIAvG,KAAA+N,IADA/N,KAAAgF,WAAAhF,KAAAgF,UAAA0J,WAEA5G,QADA9H,KAAAgP,OAAAhP,KAAAmD,QAAAoD,UACA,WACA,WAGAuB,QADA9H,KAAAgP,OAAAhP,KAAAmD,QAAAoD,UACA,OAAA,QAGAvG,KAAA2D,YAAAsB,UACAjF,KAAA+N,IAAAjG,QAAA,OACA9H,KAAAiP,YAGAjP,KAAA+E,WACA/E,KAAAkP,cACAlP,KAAAgF,WACAhF,KAAAmP;EAKAhK,OAAA,WACA,GAAA2C,SAAA9H,KAAA8H,OACA,IAAA9H,KAAAmD,QAAAoD,UACAvG,KAAA+N,IAAA/N,KAAAmD,QAAAoD,UAAAwH,IAEAjG,QADA9H,KAAAgP,OAAAhP,KAAAmD,QAAAoD,UACA,QACA,SAGAvG,KAAAgF,WAAAhF,KAAAgF,UAAA0J,WAEA,GAAA1O,KAAAmD,QAAAoD,SACAvG,KAAA+N,IACAjG,QADA9H,KAAAgP,OAAAhP,KAAAmD,QAAAoD,UACA,WACA,YAEAvG,KAAA+N,IAAAjG,QAAA,OAAAiG,IAAAjG,QAAA,cAKA,GAAA9H,KAAAmD,QAAAoD,UACAvG,KAAA+N,IAAAjG,QAAA,SAGA9H,KAAA2D,YAAAsB,UACAjF,KAAA+N,IAAAjG,QAAA,OACA9H,KAAAiP,YAGAjP,KAAA+E,WACA/E,KAAAkP,cACAlP,KAAAgF,WACAhF,KAAAmP,eAMAjK,QAAA,WACA,GAAA4C,SAAA9H,KAAA8H,OACA9H,MAAA2D,YAAAsB,SACA,GAAAjF,KAAAmD,QAAAoD,WACAvG,KAAA+N,IAAA/N,KAAAmD,QAAAoD,UAAAwH,IAAAjG,QAAA,WACA9H,KAAAgP,OAAAhP,KAAAmD,QAAAoD,WACAvG,KAAA+N,IAAAjG,QAAA,QAKA9H,KAAAiP,aAEA,GAAAjP,KAAAmD,QAAAoD,UACAvG,KAAA+N,IAAA/N,KAAAmD,QAAAoD,UAEAvG,KAAA+N,IACAjG,QADA9H,KAAAgP,OAAAhP,KAAAmD,QAAAoD,UACA,SACA,WAEAvG,KAAA+E,WACA/E,KAAAkP,cACAlP,KAAAgF,WAAAhF,KAAAgF,UAAA0J,WACA1O,KAAA+N,IAAAjG,QAAA,OAAAiG,IAAAjG,QAAA,aACA9H,KAAAgF,WACAhF,KAAAmP;EAIA5K,OAAA,WACA,GAAAuD,SAAA9H,KAAA8H,OACA9H,MAAA2D,YAAAsB,SACA,GAAAjF,KAAAmD,QAAAoD,WACAvG,KAAA+N,IAAA/N,KAAAmD,QAAAoD,UACAvG,KAAA+N,IAAAjG,QAAA,WAIA9H,KAAAiP,aAEA,GAAAjP,KAAAmD,QAAAoD,UACAvG,KAAA+N,IAAA/N,KAAAmD,QAAAoD,UAEAvG,KAAA+N,IACAjG,QADA9H,KAAAgP,OAAAhP,KAAAmD,QAAAoD,UACA,QACA,UAIAvG,KAAA+E,WACA/E,KAAAkP,cACAlP,KAAAgF,WACAhF,KAAAmP,aAIAnP,KAAAmD,QAAA2B,WACA9E,KAAA+N,IAAAjG,QAAA,WACAiG,IAAA/N,KAAAoP,KAAApP,KAAAmD,QAAA2B,UACA9E,KAAA4C,IAAAkF,QAAA,SACAiG,IAAAjG,QAAA,QAGA9H,KAAAmD,QAAA0B,UACA7E,KAAA+N,IAAAjG,QAAA,OACAiG,IACAjG,QADA9H,KAAAgP,OAAAhP,KAAAmD,QAAA0B,SAAAxG,QACA,QAAA,SACA0P,IAAA/N,KAAAoP,KAAApP,KAAAmD,QAAA0B,SAAA,KAAAiD,QAAA;EAIAoH,YAAA,WACA,GAAApH,SAAA9H,KAAA8H,OACA9H,MAAAgF,WAAAhF,KAAAgF,UAAAuJ,SACAvO,KAAA+N,IAAAjG,QAAA,OACAiG,IAAA/N,KAAAoP,KAAApP,KAAAgF,UAAAuJ,SACAvO,KAAAqP,YAAAvH,QAAA,QACAiG,IAAAjG,QAAA,QACAiG,IAAA/N,KAAAoP,KAAApP,KAAA+E,WAAA/E,KAAA4C,IAAAkF,QAAA,QAEA9H,KAAA+N,IAAAjG,QAAA,WACAiG,IAAA/N,KAAAoP,KAAApP,KAAA+E,WAAA/E,KAAA4C,IAAAkF,QAAA,UAKAqH,WAAA,WACA,GAAArH,SAAA9H,KAAA8H,OACA9H,MAAAgF,UAAAuJ,WAAAvO,KAAAgF,UAAA0J,YACA1O,KAAA+N,IAAAjG,QAAA,OACAiG,IAAA/N,KAAAoP,KAAApP,KAAAgF,UAAAuJ,SAAAvO,KAAAqP,cAGArP,KAAAgF,UAAAyJ,YAEAzO,KAAAgF,UAAAuJ,UACAvO,KAAA+N,IAAAjG,QAAA,QAGA9H,KAAA+N,IAAAjG,QAAA,WACAiG,IAAA/N,KAAAoP,KAAApP,KAAAgF,UAAAyJ,UACAzO,KAAAqP,YACAvH,QAAA;EAIAmH,SAAA,WACAjP,KAAA+N,IAAA/N,KAAAoP,KAAApP,KAAAmD,QAAA8B,QACAjF,KAAAsP,UACAtP,KAAA8H,QAAA,UAGAlF,IAAA,SAAAD,GACA,GAAAC,KAAA2M,KAAAzH,QAAA9H,KAAA8H,OAEA,IAAA,IAAAnF,EACA,MAAAmF,SAAA,OAKA,QAFAyH,KAAAtT,KAAAa,IAAA6F,IAGA,IAAA,GACA,IAAA,IACA,IAAA,IACAC,IAAA2M,KAAAzH,QAAA,KACA,MACA,KAAA,GACA,IAAA,IACAlF,IAAA2M,KAAAzH,QAAA,KACA,MACA,KAAA,GACA,IAAA,IACAlF,IAAA2M,KAAAzH,QAAA,KACA,MACA,SACAlF,IAAA2M,KAAAzH,QAAA,MAGA,MAAA,GAAAnF,EAAAC,IAAA,IAAAkF,QAAA,QAAAlF,KAIA0M,UAAA,SAAA9C,GACA,MAAAxM,MAAA2G,SAAAoI,WAAAvC,EAAA,IAGA6C,YAAA,SAAA/J,MACA,OAAAA,KAAA3C,EAAA3C,KAAA4C,IAAA0C,KAAA3C,GAAA,IAAA,IACA3C,KAAA2G,SAAA6I,SAAAlK,KAAArC,iBAGA+L,OAAA,SAAArM,GACA,MAAAA,GAAA,KAAA,GAGAoL,IAAA,SAAA/K,GAGA,MAFAhD,MAAA0G,KAAApI,KAAA,KACA0B,KAAA0G,KAAApI,KAAA0E,GACAhD;EAGAoP,KAAA,SAAA7N,IAAAkO,SAAAC,WAAAC,OAEA,GAAAC,WAAA,SAAAlP,MAAAmP,UAAAC,gBAEA,IAAA,GADAV,MAAA,GACAhR,EAAA,EAAAA,EAAAsC,MAAArC,OAAAD,IACA,GAAAA,IAEAgR,MADAhR,GAAAsC,MAAArC,OAAA,EACA,IAAAyR,eAAA,IAEAD,UAAA,KAGAT,MAAA1O,MAAAtC,EAEA,OAAAgR,MAGAO,OAAAA,OAAA,IACAF,SAAAA,UAAA,SAAAM,GAAA,MAAAA,GACA,IAAAC,MAAAhQ,KACAiQ,aAAA,SAAAC,KACA,MAAAT,UAAAlG,KAAAyG,KAAAE,KAGA,OAAAR,YACAE,UAAArO,IAAA4O,IAAAF,cAAAN,MAAAD,YAEAnO,IAAA4O,IAAAF,cAAA5Q,KAAAsQ,MAAA,MAiFA,IAAA/I,UAAA,SAAAF,KAAAC,UACA,MAAA,IAAAzD,OAAAuD,UAAAC,KAAAC,YAGAF,UAAA,SAAAC,KAAAC,UAaA,QAAAyJ,KACAC,IAAAC,OAAA,QAGA,IAAA3N,EAIA,KAHAA,EAAA0N,IAAA7H,OAAA,aACArF,QAAAoD,SAAAgK,SAAA5N,EAAA,KAEA0N,IAAAG,SACA,KAAA,IAAArV,OAAA,iBAEA;OAAAkV,IAAAI,QACA,IAAA,SACAtN,QAAAiB,KAAAlB,MAAA8C,MACAqK,IAAAK,eACAC,KACAC,IAEA,MAIA,KAAA,aACAzN,QAAAiB,KAAAlB,MAAAiC,OACAhC,QAAA6B,WACA9B,MAAAwB,GACAxB,MAAA+C,GACA/C,MAAAgD,GACAhD,MAAAiD,GACAjD,MAAAkD,IAEAiK,IAAAK,aACAE,GACA,MAEA,KAAA,UACAzN,QAAAiB,KAAAlB,MAAAiC,OACAkL,IAAAK,eACAC,KACAC,IAEA,MAEA,KAAA,WACAzN,QAAAiB,KAAAlB,MAAAgC,QACAmL,IAAAK,eACAC,KACAC,IAEA,MAEA,KAAA,UACAzN,QAAAiB,KAAAlB,MAAAqB,OACA8L,IAAAK,eACAC,KACAC,IAEA,MAEA,KAAA,SACA,IAAA,UACA,IAAA,YACA,IAAA,WACA,IAAA,SACA,IAAA,WACA,IAAA,SAIA,GAHAzN,QAAAiB,KAAAlB,MAAAiC,OACAhC,QAAA6B,WAAA9B,MAAAmN,IAAAI,OAAAI,OAAA,EAAA,GAAA7J,iBAEAqJ,IAAAK,aACA,MAGA;KAAAL,IAAA7H,OAAA,UAAA,CACA,GAAA6H,IAAAG,SACA,KAAA,IAAArV,OAAA,iBAEA,IAAA2V,IACA,MAAAA,IAAAC,aACA,KAAA,IAAA5V,OAAA,qBAAAkV,IAAAI,OACA,qBAGAtN,SAAA6B,UAAA1G,KAAA4E,MAAA4N,MACAT,IAAAK,aAEAM,QACAJ,GACA,MAEA,KAAA,UACA,IAAA,WACA,IAAA,QACA,IAAA,QACA,IAAA,MACA,IAAA,OACA,IAAA,OACA,IAAA,SACA,IAAA,YACA,IAAA,UACA,IAAA,WACA,IAAA,WAIA,GAHAzN,QAAAiB,KAAAlB,MAAAqB,OACApB,QAAA8B,SAAAgM,YAEAZ,IAAAK,aACA,MAGA,MAAAL,IAAA7H,OAAA,UAAA,CACA,GAAA6H,IAAAG,SACA,KAAA,IAAArV,OAAA,iBAEA,IAAAqR,EACA,MAAAA,EAAAyE,WACA,KAAA,IAAA9V,OAAA,qBAAAkV,IAAAI,OACA,mBAGAtN,SAAA8B,QAAA3G,KAAAkO,GACA6D,IAAAK;CAGAC,KACAC,GACA,MAEA,SACA,KAAA,IAAAzV,OAAA,mBAKA,QAAAwV,MAEA,GAAAO,IAAAb,IAAA7H,OAAA,MACA2I,IAAAd,IAAA7H,OAAA,MACA,IAAA0I,IAAAC,IAIA,EAAA,CAEA,GAAAvO,KAAAkO,IAAAtE,CAGA,IAAA5J,IAAAwO,aAGAN,IAAAC,cACAV,IAAAK,aACAvN,QAAA6B,YACA7B,QAAA6B,cAEA7B,QAAA6B,UAAA1G,KAAA4E,MAAA4N,KAAAlO,IAAAA,QAEAO,QAAA4B,aACA5B,QAAA4B,eAEA5B,QAAA4B,WAAAzG,KAAAsE,KACAyN,IAAA7H,OAAA,eAIA,IAAAsI,IAAAC,YACAV,IAAAK,aACAvN,QAAA6B,YACA7B,QAAA6B,cACA7B,QAAA6B,UAAA1G,KAAA4E,MAAA4N,UACA,IAAA,cAAAT,IAAAI,OACAJ,IAAAK,aACAvN,QAAA6B,YACA7B,QAAA6B,cACA7B,QAAA6B,UAAA1G,KAAA4E,MAAAwB,IACAvB,QAAA6B,UAAA1G,KAAA4E,MAAA+C,IACA9C,QAAA6B,UAAA1G,KAAA4E,MAAAgD,IACA/C,QAAA6B,UAAA1G,KAAA4E,MAAAiD,IACAhD,QAAA6B,UAAA1G,KAAA4E,MAAAkD;IACA,IAAA,WAAAiK,IAAAI,OAAA,CACAJ,IAAAK,YACA,IAAA/N,EACA,MAAAA,EAAA0N,IAAA7H,OAAA,WACA,KAAA,IAAArN,OAAA,qBAAAkV,IAAAI,OACA,yBAGA,KADAtN,QAAA0B,UAAAlC,EAAA,IACA0N,IAAA7H,OAAA,UAAA,CACA,KAAA7F,EAAA0N,IAAA7H,OAAA,WACA,KAAA,IAAArN,OAAA,qBAAAkV,IAAAI,OACA,sBAEAtN,SAAA0B,SAAAvG,KAAAqE,EAAA,SAGA,CAAA,KAAA6J,EAAAyE,WAMA,MALAZ,KAAAK,aACAvN,QAAA8B,UACA9B,QAAA8B,YACA9B,QAAA8B,QAAA3G,KAAAkO,UAKA6D,IAAA7H,OAAA,UAAA6H,IAAA7H,OAAA,QAAA6H,IAAA7H,OAAA,OAGA,QAAAyI,WACA,OAAAZ,IAAAI,QACA,IAAA,UACA,MAAA,EACA,KAAA,WACA,MAAA,EACA,KAAA,QACA,MAAA,EACA,KAAA,QACA,MAAA,EACA,KAAA,MACA,MAAA,EACA,KAAA,OACA,MAAA,EACA;IAAA,OACA,MAAA,EACA,KAAA,SACA,MAAA,EACA,KAAA,YACA,MAAA,EACA,KAAA,UACA,MAAA,GACA,KAAA,WACA,MAAA,GACA,KAAA,WACA,MAAA,GACA,SACA,OAAA,GAIA,QAAAM,aACA,OAAAV,IAAAI,QACA,IAAA,SACA,IAAA,UACA,IAAA,YACA,IAAA,WACA,IAAA,SACA,IAAA,WACA,IAAA,SACA,MAAAJ,KAAAI,OAAAI,OAAA,EAAA,GAAA7J,aAGA,SACA,OAAA,GAIA,QAAAoK,aAEA,OAAAf,IAAAI,QACA,IAAA,OAEA,MADAJ,KAAAK,aACA,EACA,KAAA,QAEA,MADAL,KAAAK,aACA,CACA,KAAA,SAEA,MADAL,KAAAK,aACAL,IAAA7H,OAAA,QAAA,GAAA,CACA,KAAA,QAEA,MADA6H,KAAAK,aACAL,IAAA7H,OAAA,QAAA,GAAA,CACA,KAAA,MACA,GAAA5D,GAAA2L,SAAAF,IAAA7P,MAAA,GACA,IAAA,KAAAoE,GAAAA,EAAA,IACA,KAAA,IAAAzJ,OAAA,qBAAAyJ,EAGA;MADAyL,KAAAK,aACAL,IAAA7H,OAAA,SAAA5D,EAAAA,CAEA,SACA,OAAA,GAIA,QAAAoM,SAEAX,IAAA7H,OAAA,MACA6H,IAAA7H,OAAA,MAEA,IAAA5F,IACA,IAAAA,IAAAwO,YAOA,IAHAjO,QAAA4B,YAAAnC,KACAyN,IAAAK,aAEAL,IAAA7H,OAAA,UAAA,CAEA,KAAA5F,IAAAwO,aACA,KAAA,IAAAjW,OAAA,qBAAAkV,IAAAI,OACA,sBAGAtN,SAAA4B,WAAAzG,KAAAsE,KAEAyN,IAAAK,cAIA,QAAAE,KAEA,GAAA,SAAAP,IAAAI,OAAA,CAEA,GAAA7U,MAAAH,KAAA4V,MAAAhB,IAAA3J,KAEA,KAAA9K,KACA,KAAA,IAAAT,OAAA,2BAAAkV,IAAA3J,KAEAvD,SAAA5D,MAAA,GAAA9D,MAAAG,UACAyU,KAAA7H,OAAA,SAEArF,QAAAqD,MAAA6J,IAAA7P,MAAA,GACA6P,IAAAC,OAAA,WA5UA,GAAAD,KAAA,GAAAiB,SAAA3K,UAAA0H,SAAAkD,OAEA,KAAAlB,IAAAlQ,MAAAuG,MACA,MAAA,KAGA,IAAAvD,WAGA;MADAiN,KACAjN,SA8UAmO,OAAA,SAAAE,OACAxR,KAAAwR,MAAAA,MAGAF,QAAArR,UAAAE,MAAA,SAAAuG,MAGA,MAFA1G,MAAA0G,KAAAA,KACA1G,KAAAyR,MAAA,EACAzR,KAAA0Q,cAGAY,OAAArR,UAAAuQ,OAAA,WACA,MAAAxQ,MAAAyR,MAAA,MAAAzR,KAAAyQ,QAGAa,OAAArR,UAAAyQ,WAAA,WACA,GAAAgB,MAAAC,WAAAC,EAAA5R,IAEAA,MAAAyQ,OAAA,KACAzQ,KAAAQ,MAAA,IACA,GAAA,CACA,GAAAR,KAAAyR,KACA,OAAA,CAGAC,MAAA,IAEA,IAAAnG,OAAAsG,IACA,KAAA,GAAAC,QAAA9R,MAAAwR,MACAK,KAAA7R,KAAAwR,MAAAM,OACAvG,MAAAsG,KAAAnS,KAAAkS,EAAAlL,SACA,MAAAgL,MAAAnG,MAAA,GAAAlN,OAAAqT,KAAA,GAAArT,UACAqT,KAAAnG,MACAoG,WAAAG,KAcA,IARA,MAAAJ,OACA1R,KAAA0G,KAAA1G,KAAA0G,KAAAmK,OAAAa,KAAA,GAAArT,QAEA,IAAA2B,KAAA0G,OACA1G,KAAAyR,MAAA,IAIA,MAAAC,KAIA,MAHA1R,MAAAyR,MAAA,EACAzR,KAAAyQ,OAAA,UACAzQ,KAAAQ,MAAA;OAGA,QAAAmR,WAIA,OAFA3R,MAAAyQ,OAAAkB,WACA3R,KAAAQ,MAAAkR,MACA,GAGAJ,OAAArR,UAAAuI,OAAA,SAAAsJ,MACA,GAAA9R,KAAAyQ,QAAAqB,KAAA,CACA,GAAA9R,KAAAQ,MAAA,CACA,GAAAoE,GAAA5E,KAAAQ,KAEA,OADAR,MAAA0Q,aACA9L,EAIA,MADA5E,MAAA0Q,cACA,EAGA,OAAA,GAGAY,OAAArR,UAAAqQ,OAAA,SAAAwB,MACA,GAAA9R,KAAAwI,OAAAsJ,MACA,OAAA,CAGA,MAAA,IAAA3W,OAAA,YAAA2W,KAAA,cAAA9R,KAAAyQ,QAQA,IAAApC,UACAmB,UACA,SAAA,SAAA,UAAA,YACA,WAAA,SAAA,YAEAT,YACA,UAAA,WAAA,QAAA,QAAA,MACA,OAAA,OAAA,SAAA,YAAA,UACA,WAAA,YAEAwC,QACAQ,KAAA,mBACAC,OAAA,eACAC,aAAA,oBACAC,MAAA,UACAC,SAAA,UACAC,aAAA,cACAC,UAAA,WACAC,WAAA,YACAC,UAAA,WACArB,GAAA,YACAC,IAAA,QACA9D,MAAA,UACAtN,OAAA,WACAyS,MAAA,UACA5P,IAAA,kCACA0K,KAAA,SACAmF,MAAA,QACAC,UAAA,WACAnT,MAAA,aACAoT,OAAA,iBACAC,QAAA,qBACAC,UAAA,uBACAC,SAAA,sBACAC,OAAA,iBACAC,SAAA,mBACAC,OAAA,iBACAC,QAAA,eACAC,SAAA,gBACAC,MAAA,aACAC,MAAA,aACAC,IAAA,QACAC,KAAA,UACAC,KAAA,UACAC,OAAA,cACAC,UAAA,oBACAC,QAAA,eACAC,SAAA,gBACAC,SAAA,gBACAC,MAAA,0BASAC,KACAnN,SAAAA,SACAH,UAAAA,UACAuB,mBAAAmG,OAAAnG,mBACAH,OAAA,SAAA6D,MAAA5D,QAAAnB,UACA,MAAA,IAAAwH,QAAAzC,MAAA5D,QAAAnB,UAAA5D;EAIAlI,YACAC,OAAAC,QAAAgZ,IAEAnZ,KAAA,UAAAmZ,IAGA,kBAAA5Z,SAAAA,OAAA+T,KAEA/T,OAAA,WAAA,WACA,MAAA+I,UAIAlD,MAEA7F,OAAA,oCAAA,cAEAA,OCjjCA,2CAAA,uCAAA,WACAC,SAAA,wCCiBAD,OAAA,6CACA,SACA,SACA,cACA,iBACA,SACA,qBACA,2CACA,SAAA6Z,EAAAC,EAAAC,SAAAC,cAAAC,OAAAC,YAIA,QAAAC,gBACA,GAAAC,MAAAvU,KACAwU,SAAAP,EAAA,kCACAQ,UAAAR,EAAA,yBACAS,KAAAT,EAAAS,KAAAC,UAAAH,SAEA;GAAA,OAAAI,SACA,KAAA,IAAAzZ,OAAA,gFAGA6E,MAAA6U,GAAA,MACA7U,KAAA8U,gBAAA,eAmBA9U,KAAA+U,YAAA,SAAA5R,SACAkR,WAAAlU,QACA8T,EAAAe,MACAC,IAAA,mCACAC,KAAA,OACAC,KAAAhS,QAAAgS,KACAC,QAAA,EACAC,SAAA,OACAC,QAAA,SAAAC,UACAA,SAAAC,KACAjB,KAAAkB,UACAF,SAAAnH,GACA,SAAAsH,WACAjB,UAAAkB,aAAA,cAAAD,WAEAlB,SAAAoB,QAAA,oBACAJ,IAAAD,SAAAC,IACAK,OAAA1S,QAAAgS,KAAAW,SACAC,MAAA5S,QAAAgS,KAAAY,MACAC,SAAA,mBAGA9B,WAAAoB,QAAAC,SAAAU,SAEA,kBAAA9S,SAAAmS,SACAnS,QAAAmS,UAGAjB,WAAA6B;IAKAC,MAAA,SAAAC,KACA,GAAAH,SAAA1B,KAAA8B,uBAAAD,IACAlC,YAAAiC,MAAAF,SAAAK,YAAA,IACA,kBAAAnT,SAAAgT,OACAhT,QAAAgT,QAEA9B,WAAA6B,WAwBAlW,KAAAuW,UAAA,SAAAC,QAAA/G,SAAAgH,eACApC,WAAAlU,OAEA,IAAAgV,OACAY,MAAAW,SAAAF,QAAAT,MAAAS,QAAAG,MAAAH,QAAAT,MACAD,SAAAU,QAAAV,SACA1H,GAAAoI,QAAApI,GACAoH,IAAAgB,QAAAhB,IACArV,MAAAqW,QAAArW,MAAArC,QAAAiQ,IAAAyI,QAAArW,MAAAyW,KAAA,KAAAC,OAAA,oBACAzW,IAAAoW,QAAApW,IAAAtC,QAAAiQ,IAAAyI,QAAApW,IAAAwW,KAAA,KAAAC,OAAA,oBACAC,WAAA,GAWA,IARAN,QAAAO,aACA5B,KAAA4B,WAAAP,QAAAO,WAAA1Y,OAAAmY,QAAAO,WAAA,IAGAP,QAAAQ,eACA7B,KAAA6B,aAAAR,QAAAQ,cAGAR,QAAAM,WAAA,CACA,GACApL,OADAuL,aAAA/T,MAAA6H,YAAAyL,QAAAM,WAIAG;aAAAzS,QADAgS,QAAArW,MAAA+W,WACAV,QAAArW,MAAArC,QAAAiQ,KAAAwG,KAAA4C,qBAAA,KAAAC,SAEAZ,QAAArW,MAAArC,QAAAsZ,SAGA1L,MAAA,GAAAxI,OAAA+T,cACA9B,KAAA2B,WAAApL,MAAA3I,WAGAyT,QAAAa,QAAArD,EAAAsD,QAAAd,QAAAa,UACAlC,KAAAkC,OAAAb,QAAAa,QAEAX,SAAAF,QAAAe,UACApC,KAAAoC,QAAAf,QAAAe,SAGAtD,EAAAe,MACAC,IAAA,mCACAC,KAAA,MACAC,KAAAA,KACAC,QAAA,EACAC,SAAA,OACAC,QAAA,SAAAC,UACAhB,KAAAkB,UAAAe,QAAApI,GAAA,SAAAsH,WACA,GAAA8B,iBAAAjD,KAAAkD,mBAAA/B,WACAgC,kBAAAlB,QAAAmB,qBAEAD,mBAAApZ,KAAAkY,QAAApI,IACAoJ,gBAAAlZ,KAAAoX,WAEAjB,UAAAkB,aAAA,eAAA,SAAAiC,eACA,MAAA,KAAAF,kBAAAjW,QAAAmW,cAAAxJ;GAGAqG,UAAAkB,aAAA,iBAAA6B,iBAEA,kBAAA/H,WACAA,SAAAiG,WAGAxB,WAAAoB,QAAAC,SAAAU,SACA5B,WAAA6B,UAGAC,MAAA,SAAAC,KACA/B,WAAA6B,MACA,IAAAD,SAAA1B,KAAA8B,uBAAAD,IACAlC,YAAA2D,QAAA5B,SAAAK,YAAA,IACA,kBAAAG,gBACAA,oBAUAzW,KAAA8X,YAAA,WACA3D,cAAAzU,KACA,kBACAsU,EAAA+D,OACA5D,cAAA6D,kBACAC,OAAA9D,cAAA+D,MAAA,sBAGAxD,KAAAyD,gBAAAzD,KAAA0D,WAQApY,KAAAqW,uBAAA,SAAAD,KACA,GAAAH,SAAA,EACA,KACA,GAAAoC,cAAApE,EAAAqE,UAAAlC,IAAAmC,aACAF,cAAApC,QACAA,QAAAoC,aAAApC,QACAoC,aAAAG,SAAAxE,EAAAyE,QAAAJ,aAAAG,QACAvE,EAAAyE,KAAAL,aAAAG,OAAA,SAAAtU,IAAA1C,KACAyU,SAAA/R,IAAA,KAAA1C,IAAA;GAGAyU,QAAAG,IAAAmC,aAGA,MAAA3N,GACAqL,QAAAG,IAAAmC,aAGA,MAAAtC,UAUAjW,KAAAyV,UAAA,SAAAkD,QAAAlJ,UACA,GAAAmJ,UAAArE,KAAAsE,kBAEA5E,GAAAe,MACAC,IAAA,wCAAA0D,QAAA,aAAAC,SACA1D,KAAA,MACAE,QAAA,EACAE,QAAA,SAAAH,MACA,kBAAA1F,WACAA,SAAA0F,OAGAgB,MAAA,SAAAC,KACA/B,WAAA6B,MACA,IAAAD,SAAA1B,KAAA8B,uBAAAD,IACAlC,YAAAiC,MAAAF,SAAAK,YAAA,QAUAtW,KAAA8Y,aAAA,SAAA1K,IACA,GAAA2K,QAAAtE,UAAAkB,aAAA,eAAAvH,GACA,OAAA,KAAA2K,OAAA1a,OACA0a,OAAA,GAEAA,QASA/Y,KAAAgZ,gBAAA,SAAA5K,IACA,MAAA6F,GAAA,IAAAM,KAAAO,gBAAA1G,KAQApO,KAAAyX,mBAAA,SAAAwB,OACA,GAAAF,UACA;GAAAE,MAAAnC,WAAA,CACA,GAAAoC,MAAA9E,OAAA6E,MAAA7Y,KAAA8Y,KAAA9E,OAAA6E,MAAA9Y,QACAuL,MAAAxI,MAAAsI,WAAAyN,MAAAnC,YACAqC,KAAA/E,OAAA6E,MAAA9Y,OAAAiZ,YAAAD,OAEAxB,oBAEA1D,GAAAyE,KAAAhN,MAAAnI,MAAA,SAAA8V,UAAAC,YACA,GAAAC,aAAAnF,OAAAkF,YACAE,UAAApF,OAAAkF,YAAAvL,IAAAmL,KAAA,MACAO,OAAAzF,EAAA0F,UAAAT,MAEAQ,QAAAtZ,MAAAoZ,YAAAJ,KAAAA,MAAAtC,OAAA,yBACA4C,OAAAtZ,QAAA8Y,MAAA9Y,QAIAsZ,OAAArZ,IAAAoZ,UAAAL,KAAAA,MAAAtC,OAAA,yBACA4C,OAAArL,GAAA6K,MAAA7K,GAAAiL,UACAI,OAAAE,UAAA,EACAF,OAAAG,YAAAP,UACAI,OAAAI,cAAAZ,MAAA7K,GACAqL,OAAAK,WAAA,aACAL,OAAAM,kBAAA,EAEApC,kBAAArZ,KAAAmb,OAAArL,IACA2K,OAAAza,KAAAmb;GAEAR,MAAAa,WAAA,mBACAb,MAAAtB,kBAAAA,kBAGA,MAAAoB,SASA/Y,KAAAga,eAAA,SAAAxD,QAAAyD,iBACAvD,SAAAuD,kBACAA,iBAAA,GAEAA,iBACAhG,EAAA,yBAAAiG,YAAA,eAEA1D,QAAApI,IACA6F,EAAA,IAAAM,KAAAO,gBAAA0B,QAAApI,IAAA+L,SAAA,gBAQAna,KAAA6Y,iBAAA,WACA,GAAAD,UAAA3E,EAAAmG,KAAAnG,EAAA,sBAAAoG,KAAA,mBAAA3T,OAIA,OAHA,KAAAkS,WACAA,SAAA5Y,KAAA6U,IAAA,OAEA+D,UAQA5Y,KAAAsa,MAAA,SAAA9Z,OACAR,KAAA6U,GAAArU,MACAyT,EAAA,sBAAAoG,KAAA,mBAAA7Z,MAAA,KACA0G,KAAA,WAAA,YACA0O,QAAA,WAOA5V,KAAAmX,mBAAA,WACA,GAAAlL,QAAAsE,SAAA0D,EAAA,sBAAAzS,MAIA;MAHA+Y,OAAAtO,UACAA,OAAA,GAEAA,QAxWA,GAAA2I,UAAA,IAoXA,OARAN,cAAAkG,YAAA,WAKA,MAHA,QAAA5F,WACAA,SAAA,GAAAN,eAEAM,UAGAN,aAAAkG,gBC1YA,SAAAC,SACA,kBAAAtgB,SAAAA,OAAA+T,IACA/T,OAAA,qDAAA,SAAA,UAAAsgB,SAEA,gBAAA1f,SACAD,OAAAC,QAAA0f,QAAArgB,QAAA,UAAAA,QAAA,WAGAqgB,QAAAC,OAAAtG,SAEA,SAAAH,EAAAG,QAmDA,QAAAuG,gBACA,GAEAvc,GAAA0T,KACA8I,YACA9U,EACAtE,IALAqZ,MAAAla,MAAAV,UAAAgC,MAAAsH,KAAAlJ,WACAya,cAOA,KAAA1c,EAAA,EAAAA,EAAA2c,eAAA1c,OAAAD,IAAA,CAIA,IAHA0T,KAAAiJ,eAAA3c,GACAwc,YAAA,KAEA9U,EAAA,EAAAA,EAAA+U,MAAAxc,OAAAyH,IACAtE,IAAAqZ,MAAA/U,GAAAgM,MAEAmC,EAAA+G,cAAAxZ,KACAoZ,YAAA3G,EAAA8D,OAAA6C,gBAAApZ,KAEA,MAAAA,MACAoZ,YAAA,KAKA;OAAAA,cACAE,YAAAhJ,MAAA8I,aAMA,MAFAC,OAAAI,YACAJ,MAAAvc,KAAAwc,aACA7G,EAAA8D,OAAAmD,MAAAjH,EAAA4G,OAMA,QAAAM,kBAAAC,OACA,GACAC,QADAC,WAAAC,MAAAH,MAAAG,UA2CA,OAvCAtH,GAAAyE,KAAA0C,MAAA,SAAAtJ,KAAAtQ,KACA,SAAAsQ,OAIAmC,EAAA+G,cAAAxZ,OACA,6BAAArC,KAAA2S,OACA,IAAAmC,EAAAuH,QAAA1J,KAAAiJ,iBAEAM,OAAA,KAGApH,EAAAyE,KAAAlX,IAAA,SAAAia,QAAAC,QAGA,gEAAAvc,KAAAsc,UACAH,UAAAC,MAAAE,WACAH,UAAAC,MAAAE,aAEAH,UAAAC,MAAAE,SAAA3J,MAAA4J,SAGAL,SACAA,WAEAA,OAAAI,SAAAC,UAIAL,SACAC,UAAAxJ,MAAAuJ,SAIAC,UAAAxJ,MAAAtQ;GAKA8Z,UAqBA,QAAAK,kBAAAC,OAAAC,iBACAA,gBAAAC,MACAF,OAAAG,KACAC,oBAAA,EACAC,cAAAJ,gBAAAC,KAAA,IAGAD,gBAAAK,OACAN,OAAAG,KACAI,qBAAA,EACAC,eAAAP,gBAAAK,MAAA,IAOA,QAAAG,oBAAAT,QACAA,OAAAG,KACAE,cAAA,GACAG,eAAA,GACAJ,oBAAA,GACAG,qBAAA,KAMA,QAAAG,iBACArI,EAAA,QAAAkG,SAAA,kBAKA,QAAAoC,gBACAtI,EAAA,QAAAiG,YAAA,kBAQA,QAAAsC,kBAAAC,IAAAC,gBAAAC,oBAKA,GAAAC,YAAA3gB,KAAAgF,MAAAyb,gBAAAD,IAAApe,QACAwe,WAAA5gB,KAAAgF,MAAAyb,gBAAAE,YAAAH,IAAApe,OAAA,IACAye,WACAC,eACAC,eACAC,WAAA,CAEAC;mBAAAT,KAIAA,IAAA/D,KAAA,SAAAta,EAAA+e,IACA,GAAAC,WAAAhf,IAAAqe,IAAApe,OAAA,EAAAwe,WAAAD,WACAS,cAAApJ,EAAAkJ,IAAAG,aAAA,EAEAF,WAAAC,eACAP,QAAAxe,KAAA6e,IACAJ,YAAAze,KAAA+e,eACAL,YAAA1e,KAAA2V,EAAAkJ,IAAAI,WAIAN,YAAAI,gBAKAV,qBACAD,iBAAAO,WACAL,WAAA3gB,KAAAgF,MAAAyb,gBAAAI,QAAAze,QACAwe,WAAA5gB,KAAAgF,MAAAyb,gBAAAE,YAAAE,QAAAze,OAAA,KAIA4V,EAAA6I,SAAApE,KAAA,SAAAta,EAAA+e,IACA,GAAAC,WAAAhf,IAAA0e,QAAAze,OAAA,EAAAwe,WAAAD,WACAS,cAAAN,YAAA3e,GACAof,cAAAR,YAAA5e,GACAqf,UAAAL,WAAAC,cAAAG,cAEAJ,WAAAC,eACApJ,EAAAkJ,IAAAI,OAAAE;GAOA,QAAAP,oBAAAT,KACAA,IAAAc,OAAA,IAOA,QAAAG,iBAAAjB,KACA,GAAAkB,eAAA,CAaA,OAXAlB,KAAApC,KAAA,OAAA3B,KAAA,SAAAta,EAAAwf,SACA,GAAAC,YAAA5J,EAAA2J,SAAAE,YACAD,YAAAF,gBACAA,cAAAE,cAIAF,gBAEAlB,IAAAsB,MAAAJ,eAEAA,cAOA,QAAAK,sBAAAC,YAAAV,QAIA,MAHAU,aAAAV,OAAAA,QAAApD,SAAA,eAGA8D,YAAA,GAAAC,aAAA,EAAAD,YAAA,GAAAE,cACA,GAGAC,cAAAH,cACA,GAKA,QAAAG,eAAAH,aACAA,YAAAV,OAAA,IAAArD,YAAA,eAaA,QAAAmE,iBAAAlB,IACA,GAAAmB,UAAAnB,GAAApB,IAAA,YACAwC,aAAApB,GAAAqB,UAAAhQ,OAAA,WACA,GAAAqH,QAAA5B,EAAAjU,KACA;MAAA,gBAAAb,KACA0W,OAAAkG,IAAA,YAAAlG,OAAAkG,IAAA,cAAAlG,OAAAkG,IAAA,iBAEA0C,GAAA,EAEA,OAAA,UAAAH,UAAAC,aAAAlgB,OAAAkgB,aAAAtK,EAAAkJ,GAAA,GAAAuB,eAAAC,UAMA,QAAAC,cAAAzB,IACA,GAAAlR,QAAAkR,GAAAlR,QAEA,QACA6P,KAAA7P,OAAA6P,KACAI,MAAAjQ,OAAA6P,KAAAqB,GAAAW,aACAe,IAAA5S,OAAA4S,IACAC,OAAA7S,OAAA4S,IAAA1B,GAAAG,eAQA,QAAAyB,eAAA5B,IACA,GAAAlR,QAAAkR,GAAAlR,SACA4P,gBAAAmD,mBAAA7B,IACArB,KAAA7P,OAAA6P,KAAAmD,YAAA9B,GAAA,qBAAAtB,gBAAAC,KACA+C,IAAA5S,OAAA4S,IAAAI,YAAA9B,GAAA,oBAAAtB,gBAAAgD,GAEA,QACA/C,KAAAA,KACAI,MAAAJ,KAAAqB,GAAA,GAAA+B,YACAL,IAAAA,IACAC,OAAAD,IAAA1B,GAAA,GAAAgB;CAOA,QAAAgB,gBAAAhC,IACA,GAAAlR,QAAAkR,GAAAlR,SACA6P,KAAA7P,OAAA6P,KAAAmD,YAAA9B,GAAA,qBAAA8B,YAAA9B,GAAA,gBACA0B,IAAA5S,OAAA4S,IAAAI,YAAA9B,GAAA,oBAAA8B,YAAA9B,GAAA,cAEA,QACArB,KAAAA,KACAI,MAAAJ,KAAAqB,GAAAY,QACAc,IAAAA,IACAC,OAAAD,IAAA1B,GAAAI,UAOA,QAAAyB,oBAAA7B,IACA,GAAAiC,gBAAAjC,GAAAU,aAAAV,GAAA,GAAA+B,YACAG,QACAvD,KAAA,EACAI,MAAA,EACA2C,IAAA,EACAC,OAAA3B,GAAAmC,cAAAnC,GAAA,GAAAgB,aAUA,OAPAoB,2BAAA,OAAApC,GAAApB,IAAA,aACAsD,OAAAvD,KAAAsD,eAGAC,OAAAnD,MAAAkD,eAGAC,OAQA,QAAAE,0BAIA,MAHA,QAAAC,uBACAA,qBAAAC,8BAEAD;CAGA,QAAAC,8BACA,GAAAtC,IAAAlJ,EAAA,qBACA8H,KACAuC,SAAA,WACAO,IAAA,KACA/C,KAAA,EACA4D,OAAA,EACAC,QAAA,EACAC,SAAA,SACAC,UAAA,QAEAC,SAAA,QACAlC,QAAAT,GAAA4C,WACApV,IAAAiT,QAAA3R,SAAA6P,KAAAqB,GAAAlR,SAAA6P,IAEA,OADAqB,IAAA6C,SACArV,IAMA,QAAAsU,aAAA9B,GAAA8C,MACA,MAAAC,YAAA/C,GAAApB,IAAAkE,QAAA,EAKA,QAAAE,sBAAAC,IACA,MAAA,IAAAA,GAAAC,QAAAD,GAAAE,QASA,QAAAC,gBAAAC,MAAAC,OACA,GAAA9V,MACAmR,KAAA7f,KAAAykB,IAAAF,MAAA1E,KAAA2E,MAAA3E,MACAI,MAAAjgB,KAAA0kB,IAAAH,MAAAtE,MAAAuE,MAAAvE,OACA2C,IAAA5iB,KAAAykB,IAAAF,MAAA3B,IAAA4B,MAAA5B,KACAC,OAAA7iB,KAAA0kB,IAAAH,MAAA1B,OAAA2B,MAAA3B,QAGA,OAAAnU,KAAAmR,KAAAnR,IAAAuR,OAAAvR,IAAAkU,IAAAlU,IAAAmU,OACAnU,KAEA,EAKA,QAAAiW,gBAAAC,MAAAC,MACA,OACAhF,KAAA7f,KAAA0kB,IAAA1kB,KAAAykB,IAAAG,MAAA/E,KAAAgF,KAAAhF,MAAAgF,KAAA5E,OACA2C,IAAA5iB,KAAA0kB,IAAA1kB,KAAAykB,IAAAG,MAAAhC,IAAAiC,KAAAjC,KAAAiC,KAAAhC;CAMA,QAAAiC,eAAAD,MACA,OACAhF,MAAAgF,KAAAhF,KAAAgF,KAAA5E,OAAA,EACA2C,KAAAiC,KAAAjC,IAAAiC,KAAAhC,QAAA,GAMA,QAAAkC,YAAAC,OAAAC,QACA,OACApF,KAAAmF,OAAAnF,KAAAoF,OAAApF,KACA+C,IAAAoC,OAAApC,IAAAqC,OAAArC,KAYA,QAAAsC,mBAAAC,aAAAC,iBACA,GAIAC,UAAAC,OACAC,QAAAC,MALAC,aAAAN,aAAAjhB,MACAwhB,WAAAP,aAAAhhB,IACAwhB,gBAAAP,gBAAAlhB,MACA0hB,cAAAR,gBAAAjhB,GAIA,OAAAuhB,YAAAC,iBAAAC,cAAAH,cAEAA,cAAAE,iBACAN,SAAAI,aAAA5jB,QACA0jB,SAAA,IAGAF,SAAAM,gBAAA9jB,QACA0jB,SAAA,GAGAK,eAAAF,YACAJ,OAAAI,WAAA7jB,QACA2jB,OAAA,IAGAF,OAAAM,cAAA/jB,QACA2jB,OAAA,IAIAthB,MAAAmhB,SACAlhB,IAAAmhB,OACAC,QAAAA,QACAC,MAAAA,QAxBA;CA0CA,QAAAK,aAAAtjB,EAAAC,GACA,MAAA2V,QAAA2N,UACAzW,KAAA9M,EAAAV,QAAAkkB,YAAA9I,KAAAza,EAAAX,QAAAkkB,YAAA,QACAC,GAAAzjB,EAAAd,OAAAe,EAAAf,SAMA,QAAAwkB,SAAA1jB,EAAAC,GACA,MAAA2V,QAAA2N,UACAzW,KAAA9M,EAAAV,QAAAkkB,YAAA9I,KAAAza,EAAAX,QAAAkkB,YAAA,UAMA,QAAAG,YAAA3jB,EAAAC,EAAA2jB,MACA,MAAAhO,QAAA2N,SACA9lB,KAAAc,MAAAyB,EAAA0a,KAAAza,EAAA2jB,MAAA,IACAA,MAQA,QAAAC,qBAAAliB,MAAAC,KACA,GAAAhC,GAAAgkB,KACA5gB,GAEA,KAAApD,EAAA,EAAAA,EAAAkkB,cAAAjkB,SACA+jB,KAAAE,cAAAlkB,GACAoD,IAAA+gB,eAAAH,KAAAjiB,MAAAC,OAEAoB,KAAA,GAAAghB,MAAAhhB,OAJApD,KASA,MAAAgkB,MAQA,QAAAG,gBAAAH,KAAAjiB,MAAAC,KAEA,MAAA,OAAAA,IACAA,IAAA8Y,KAAA/Y,MAAAiiB,MAAA,GAEAhO,OAAAqO,WAAAtiB,OACAA,MAAAuiB,GAAAN,MAGAjiB,MAAAC,IAAA8Y,KAAA/Y,MAAAA,MAAAiiB,MAAA;CAMA,QAAAO,iBAAAC,KACA,MAAAvhB,SAAAuhB,IAAAC,SAAAD,IAAAE,WAAAF,IAAAG,WAAAH,IAAAI,gBAIA,QAAAC,cAAA7H,OACA,MAAA,kBAAAtX,OAAA7D,UAAA8C,SAAAwG,KAAA6R,QAAAA,gBAAA3f,MAKA,QAAAynB,cAAAC,KACA,MAAA,oCAAAhkB,KAAAgkB,KAWA,QAAAC,cAAAC,OACA,GAAAjX,GAAA,YAEA,OADAA,GAAAnM,UAAAojB,MACA,GAAAjX,GAIA,QAAAkX,cAAAC,IAAAC,MACA,IAAA,GAAA1R,QAAAyR,KACAE,WAAAF,IAAAzR,QACA0R,KAAA1R,MAAAyR,IAAAzR,OAQA,QAAA4R,mBAAAH,IAAAC,MACA,GACAplB,GAAA0T,KADA6R,OAAA,cAAA,WAAA,UAGA,KAAAvlB,EAAA,EAAAA,EAAAulB,MAAAtlB,OAAAD,IACA0T,KAAA6R,MAAAvlB,GAEAmlB,IAAAzR,QAAAhO,OAAA7D,UAAA6R,QACA0R,KAAA1R,MAAAyR,IAAAzR;CAMA,QAAA2R,YAAAriB,IAAA0Q,MACA,MAAA8R,kBAAAra,KAAAnI,IAAA0Q,MAKA,QAAA+R,UAAAriB,KACA,MAAA,uCAAArC,KAAA8U,EAAAiB,KAAA1T,MAIA,QAAAsiB,UAAAC,UAAAC,QAAArc,MAIA,GAHAsM,EAAAgQ,WAAAF,aACAA,WAAAA,YAEAA,UAAA,CACA,GAAA3lB,GACA8lB,GACA,KAAA9lB,EAAA,EAAAA,EAAA2lB,UAAA1lB,OAAAD,IACA8lB,IAAAH,UAAA3lB,GAAA8c,MAAA8I,QAAArc,OAAAuc,GAEA,OAAAA,MAKA,QAAAC,gBACA,IAAA,GAAA/lB,GAAA,EAAAA,EAAAiC,UAAAhC,OAAAD,IACA,GAAAsY,SAAArW,UAAAjC,GACA,MAAAiC,WAAAjC,GAMA,QAAAgmB,YAAAphB,GACA,OAAAA,EAAA,IAAAiI,QAAA,KAAA,SACAA,QAAA,KAAA,QACAA,QAAA,KAAA,QACAA,QAAA,KAAA,UACAA,QAAA,KAAA,UACAA,QAAA,MAAA,UAIA,QAAAoZ,mBAAA3d,MACA,MAAAA,MAAAuE,QAAA,SAAA;CAMA,QAAAqZ,UAAAC,UACA,GAAAC,cAQA,OANAvQ,GAAAyE,KAAA6L,SAAA,SAAAzS,KAAAtQ,KACA,MAAAA,KACAgjB,WAAAlmB,KAAAwT,KAAA,IAAAtQ,OAIAgjB,WAAAnlB,KAAA,KAIA,QAAAolB,uBAAAtB,KACA,MAAAA,KAAAuB,OAAA,GAAA1d,cAAAmc,IAAAlhB,MAAA,GAIA,QAAA0iB,gBAAAnmB,EAAAC,GACA,MAAAD,GAAAC,EAIA,QAAA+jB,OAAA7f,GACA,MAAAA,GAAA,IAAA,EAOA,QAAAiiB,OAAAxjB,IAAAyjB,YACA,GAAArX,QAAApM,IAAAyjB,WAEA,OAAA,YACA,MAAArX,QAAA0N,MAAA9Z,IAAAf,YASA,QAAAykB,UAAAC,KAAAC,MACA,GAAAC,WACAtd,KACAud,QACAC,UACAC,MAAA,WACA,GAAA9X,OAAA,GAAA7R,MAAA0pB,SACAH,MAAA1X,MAAAA,KAAA,EACA2X,UAAAI,WAAAD,MAAAJ,KAAA1X,OAGA2X,UAAA,KACAF,KAAA7J,MAAAgK,QAAAvd,MACAsd,YACAC,QAAAvd,KAAA,OAKA,OAAA,YACAud,QAAAllB,KACA2H,KAAAtH,UACA8kB,WAAA,GAAA1pB,MACAwpB,YACAA,UAAAI,WAAAD,MAAAJ;EAoDA,QAAAM,YAAA3d,KAAA4d,WAAAnM,WACA,GAEAoM,aACAC,YACAC,WACAC,IALAvK,MAAAzT,KAAA,GACAie,eAAA,GAAAje,KAAAtJ,QAAA,gBAAA+c,MAgEA,OA1DAhH,QAAAyR,SAAAzK,QACAuK,IAAAvR,OAAA8G,MAAA,KAAAvT,MACAme,eAAA1K,MAAAuK,MAEA1C,aAAA7H,QAAA1E,SAAA0E,MACAuK,IAAAvR,OAAA8G,MAAA,KAAAvT,OAGA6d,aAAA,EACAC,aAAA,EAEAG,eACAG,sBAAA5mB,KAAAic,QAEAA,OAAA,MACAzT,MAAAyT,OACAoK,aAAA,EACAC,aAAA,IAEAC,WAAAM,qBAAAtmB,KAAA0b,UACAoK,aAAAE,WAAA,GACAD,aAAA,GAGAxR,EAAAqD,QAAA8D,SAEAqK,aAAA,GAKAE,IADAJ,YAAAC,YACApR,OAAA6R,IAAA/K,MAAA9G,OAAAzM,MAGAyM,OAAA8G,MAAA,KAAAvT,MAGA6d,aACAG,IAAAO,YAAA,EACAP,IAAAzO,YAAA,GAEAkC,YACAqM,YACAE,IAAAzO,YAAA,EAEA0O,iBACAD,IAAAQ,UACAR,IAAAQ,UAAA/K,OAGAuK,IAAAxM,KAAAiC,UAMAuK,IAAAS,eAAA,EAEAT;CA6SA,QAAAU,mBAAAC,OAAAC,cACA,GAIAnoB,GAAAunB,IAJAa,cAAA,EACAC,cAAA,EACAC,IAAAJ,OAAAjoB,OACAsoB,OAIA,KAAAvoB,EAAA,EAAAsoB,IAAAtoB,EAAAA,IACAunB,IAAAW,OAAAloB,GACAgW,OAAAyR,SAAAF,OACAA,IAAAiB,GAAAxS,OAAAgF,UAAAuM,MAEAa,aAAAA,cAAAb,IAAAO,WACAO,aAAAA,cAAAd,IAAAzO,WACAyP,KAAAroB,KAAAqnB,IAKA,KAAAvnB,EAAA,EAAAsoB,IAAAtoB,EAAAA,IACAunB,IAAAgB,KAAAvoB,GACAmoB,eAAAC,cAAAb,IAAAO,WAGAO,eAAAd,IAAAzO,aACAyP,KAAAvoB,GAAAunB,IAAA7nB,QAAA+oB,aAHAF,KAAAvoB,GAAAunB,IAAA7nB,QAAAkkB,WAOA,OAAA2E,MAKA,QAAAb,gBAAAvC,IAAAC,MACAD,IAAA2C,WACA1C,KAAA0C,YAAA,EAEA1C,KAAA0C,aACA1C,KAAA0C,YAAA,GAGA3C,IAAArM,WACAsM,KAAAtM,YAAA,EAEAsM,KAAAtM,aACAsM,KAAAtM,YAAA,GAOA,QAAA4P,iBAAAnB,IAAAnnB,GACAmnB,IAAAvpB,KAAAoC,EAAA,IAAA,GACAnB,MAAAmB,EAAA,IAAA,GACA5C,KAAA4C,EAAA,IAAA,GACAqkB,MAAArkB,EAAA,IAAA,GACAskB,QAAAtkB,EAAA,IAAA,GACAukB,QAAAvkB,EAAA,IAAA,GACAwkB,aAAAxkB,EAAA,IAAA;CAqCA,QAAAuoB,iBAAApB,IAAAqB,WACA,MAAAC,gBAAApQ,OAAAtN,KAAAoc,IAAAqB,WAMA,QAAAE,YAAAtrB,KAAAorB,WACA,MAAAG,sBAAAvrB,KAAAwrB,sBAAAJ,YAIA,QAAAG,sBAAAvrB,KAAAyrB,QACA,GACAjpB,GADA4E,EAAA,EAGA,KAAA5E,EAAA,EAAAA,EAAAipB,OAAAhpB,OAAAD,IACA4E,GAAAskB,oBAAA1rB,KAAAyrB,OAAAjpB,GAGA,OAAA4E,GAeA,QAAAskB,qBAAA1rB,KAAA2rB,OACA,GAAAC,OACAC,QAEA,OAAA,gBAAAF,OACAA,OAEAC,MAAAD,MAAAC,OACAE,eAAAF,OACAE,eAAAF,OAAA5rB,MAEAmrB,gBAAAnrB,KAAA4rB,OAEAD,MAAAI,QACAF,SAAAN,qBAAAvrB,KAAA2rB,MAAAI,OACAF,SAAAlc,MAAA,UACAkc,SAIA,GAYA,QAAAG,aAAAprB,MAAAC,MAAAuqB,UAAAa,UAAAC,OACA,GAAAC,WAcA;MAZAvrB,OAAAoqB,GAAAxS,OAAAgF,UAAA5c,OACAC,MAAAmqB,GAAAxS,OAAAgF,UAAA3c,OAEAsrB,YAAAvrB,MAAAurB,YAAAvrB,MAAAwrB,MAAAze,KAAA/M,OAGAwqB,UAAAe,WAAAE,eAAAjB,YAAAA,UAIAa,UAAAA,WAAA,MAEAK,sBACA1rB,MACAC,MACA2qB,sBAAAJ,WACAa,UACAC,OAMA,QAAAI,uBAAA1rB,MAAAC,MAAA4qB,OAAAQ,UAAAC,OACA,GAAAK,UACAC,MAEAC,OAEAC,QAHAC,QAAA,GAEAC,SAAA,GAEAC,WAAA,GACAC,WAAA,GACAC,UAAA,EAIA,KAAAP,MAAA,EAAAA,MAAAf,OAAAhpB,SACA8pB,SAAAS,mBAAApsB,MAAAC,MAAA4qB,OAAAe,QACAD,YAAA,GAFAC,QAKAG,SAAAJ,QAIA,KAAAE,OAAAhB,OAAAhpB,OAAA,EAAAgqB,OAAAD,QACAD,SAAAS,mBAAApsB,MAAAC,MAAA4qB,OAAAgB,SACAF,YAAA,GAFAE,SAKAG,SAAAL,SAAAK,QAKA;IAAAF,QAAAF,MAAAC,QAAAC,QAAAA,UACAG,YAAAnB,oBAAA9qB,MAAA6qB,OAAAiB,UACAI,YAAApB,oBAAA7qB,MAAA4qB,OAAAiB,SAYA,QATAG,YAAAC,cAEAC,UADAb,MACAY,WAAAb,UAAAY,WAGAA,WAAAZ,UAAAa,YAIAH,QAAAI,UAAAH,SAwBA,QAAAI,oBAAApsB,MAAAC,MAAA8qB,OACA,GAAAC,OACApF,IAEA,OAAA,gBAAAmF,OACAA,OAEAC,MAAAD,MAAAC,SACApF,KAAAyG,eAAArB,MAAA9C,OAAA,IAEAtC,MAAA5lB,MAAAssB,OAAArsB,MAAA2lB,OACA2E,gBAAAvqB,MAAAgrB,QAKA,EAYA,QAAAJ,uBAAAJ,WACA,MAAAA,aAAA+B,wBACAA,uBAAA/B,WAEA+B,uBAAA/B,WAAAgC,kBAAAhC;CAKA,QAAAgC,mBAAAhC,WAKA,IAJA,GAEAzb,OAFA8b,UACA4B,QAAA,6DAGA1d,MAAA0d,QAAAvpB,KAAAsnB,YACAzb,MAAA,GACA8b,OAAA/oB,KAAAiN,MAAA,IAEAA,MAAA,GACA8b,OAAA/oB,MAAAqpB,MAAAqB,kBAAAzd,MAAA,MAEAA,MAAA,GACA8b,OAAA/oB,MAAAkpB,MAAAjc,MAAA,KAEAA,MAAA,IACA8b,OAAA/oB,KAAAiN,MAAA,GAIA,OAAA8b,QAQA,QAAA6B,UAs6BA,QAAAC,cAAAC,MAAAC,OAEA,MAAAD,QAAAC,MAIAD,OAAAC,MACAD,MAAAE,OAAAD,MAAAC,MACAF,MAAAG,MAAAF,MAAAE,KACAH,MAAAI,MAAAH,MAAAG,KAGA,GATA,EA81DA,QAAAC,WAAAxQ,OACA,GAAAyQ,WAAAC,kBAAA1Q,MACA,OAAA,eAAAyQ,WAAA,uBAAAA,UAIA,QAAAE,kBAAA3Q,OACA,MAAA,uBAAA0Q,kBAAA1Q;CAIA,QAAA0Q,mBAAA1Q,OACA,MAAAkL,eAAAlL,MAAA4Q,YAAAH,UAAAzQ,MAAAyQ,WAIA,QAAAI,iBAAA/Q,QACA,GACA3a,GAAA6a,MADA8Q,aAGA,KAAA3rB,EAAA,EAAAA,EAAA2a,OAAA1a,OAAAD,IACA6a,MAAAF,OAAA3a,IACA2rB,WAAA9Q,MAAA+Q,OAAAD,WAAA9Q,MAAA+Q,UAAA1rB,KAAA2a,MAGA,OAAA8Q,YAKA,QAAAE,qBAAAC,OAAAC,QACA,MAAAD,QAAAE,aAAAD,OAAAC,aAMA,QAAAC,aAAAC,KAAAC,MACA,MAAAD,MAAAF,aAAAG,KAAAH,cACAG,KAAAC,gBAAAF,KAAAE,iBACAD,KAAAtR,MAAAwR,OAAAH,KAAArR,MAAAwR,SACAH,KAAArR,MAAAtC,OAAA,IAAA+T,cAAAH,KAAAtR,MAAAtC,OAgBA,QAAAgU,kBAAAxN,IACA,GACAyN,YACAC,UACA9I,SACA+I,MAJAC,OAAAnE,GAAAoE,cAuCA;MAjCAD,UAAAA,QAAA,KACAH,WAAAzN,GAAAhI,KAAA4V,OAAA,UAAA,KAEAH,aAEAA,WADA,gBAAAA,YACA3W,EAAA8D,UAAA6S,eAOAC,UAAAD,WAAAzqB,MACA,MAAA0qB,YAAAA,UAAAD,WAAAltB,MACAqkB,SAAA6I,WAAA7I,SACA+I,MAAAF,WAAAE,YACAF,YAAAzqB,YACAyqB,YAAAltB,WACAktB,YAAA7I,eACA6I,YAAAE,OAIA,MAAAD,YAAAA,UAAA1N,GAAAhI,KAAA4V,OAAA,UACA,MAAAF,YAAAA,UAAA1N,GAAAhI,KAAA4V,OAAA,SACA,MAAAhJ,WAAAA,SAAA5E,GAAAhI,KAAA4V,OAAA,aACA,MAAAD,QAAAA,MAAA3N,GAAAhI,KAAA4V,OAAA,UAGAF,UAAA,MAAAA,UAAAzW,OAAA2N,SAAA8I,WAAA,KACA9I,SAAA,MAAAA,SAAA3N,OAAA2N,SAAAA,UAAA,KACA+I,MAAAzpB,QAAAypB,QAEAF,WAAAA,WAAAC,UAAAA,UAAA9I,SAAAA,SAAA+I,MAAAA;CAuwBA,QAAAG,mBAAAC,IAAAC,WACA,GAAA/sB,GAAAgtB,QAEA,KAAAhtB,EAAA,EAAAA,EAAA+sB,UAAA9sB,OAAAD,IAGA,GAFAgtB,SAAAD,UAAA/sB,GAGAgtB,SAAAC,SAAAH,IAAAI,UACAF,SAAAE,UAAAJ,IAAAG,QAEA,OAAA,CAIA,QAAA,EAKA,QAAAE,mBAAA/sB,EAAAC,GACA,MAAAD,GAAA6sB,QAAA5sB,EAAA4sB,QA8lCA,QAAAG,eAAAC,MACA,GAAAC,QACAC,OACAvtB,CAMA,IAJAqtB,KAAAltB,KAAA8rB,aACAqB,OAAAE,mBAAAH,MACAI,uBAAAH,QAEAC,OAAAD,OAAA,GAAA,CAEA,IAAAttB,EAAA,EAAAA,EAAAutB,OAAAttB,OAAAD,IACA0tB,wBAAAH,OAAAvtB,GAGA,KAAAA,EAAA,EAAAA,EAAAutB,OAAAttB,OAAAD,IACA2tB,qBAAAJ,OAAAvtB,GAAA,EAAA,IAQA,QAAAwtB,oBAAAH,MACA,GACArtB,GAAA8sB,IACAplB,EAFA4lB,SAIA,KAAAttB,EAAA,EAAAA,EAAAqtB,KAAAptB,OAAAD,IAAA,CAIA,IAHA8sB,IAAAO,KAAArtB,GAGA0H,EAAA,EAAAA,EAAA4lB,OAAArtB,QACA2tB,yBAAAd,IAAAQ,OAAA5lB,IAAAzH,OADAyH,KAMAolB,IAAAe,MAAAnmB,GAEA4lB,OAAA5lB,KAAA4lB,OAAA5lB,QAAAxH,KAAA4sB;CAGA,MAAAQ,QAMA,QAAAG,wBAAAH,QACA,GAAAttB,GAAA6tB,MACAnmB,EAAAolB,IACAnlB,CAEA,KAAA3H,EAAA,EAAAA,EAAAstB,OAAArtB,OAAAD,IAGA,IAFA6tB,MAAAP,OAAAttB,GAEA0H,EAAA,EAAAA,EAAAmmB,MAAA5tB,OAAAyH,IAIA,IAHAolB,IAAAe,MAAAnmB,GAEAolB,IAAAgB,eACAnmB,EAAA3H,EAAA,EAAA2H,EAAA2lB,OAAArtB,OAAA0H,IACAimB,yBAAAd,IAAAQ,OAAA3lB,GAAAmlB,IAAAgB,aASA,QAAAJ,yBAAAZ,KACA,GAEA9sB,GAAA+tB,WAFAD,YAAAhB,IAAAgB,YACAE,gBAAA,CAGA,IAAA1V,SAAAwU,IAAAkB,gBAAA,CAEA,IAAAhuB,EAAA,EAAAA,EAAA8tB,YAAA7tB,OAAAD,IACA+tB,WAAAD,YAAA9tB,GAGA0tB,wBAAAK,YAIAC,gBAAAnwB,KAAAykB,IACA0L,gBACA,EAAAD,WAAAC,gBAIAlB,KAAAkB,gBAAAA,iBAaA,QAAAL,sBAAAb,IAAAmB,uBAAAC,qBACA,GACAluB,GADA8tB,YAAAhB,IAAAgB,WAGA;GAAAxV,SAAAwU,IAAAqB,aAyBA,IAvBAL,YAAA7tB,QAQA6tB,YAAA3tB,KAAAiuB,wBAIAT,qBAAAG,YAAA,GAAAG,uBAAA,EAAAC,qBACApB,IAAAqB,aAAAL,YAAA,GAAAO,eAVAvB,IAAAqB,aAAA,EAcArB,IAAAuB,cAAAvB,IAAAqB,cACArB,IAAAqB,aAAAD,sBACAD,uBAAA,GAIAjuB,EAAA,EAAAA,EAAA8tB,YAAA7tB,OAAAD,IACA2tB,qBAAAG,YAAA9tB,GAAA,EAAA8sB,IAAAqB,cAQA,QAAAP,0BAAAd,IAAAC,UAAAuB,SACAA,QAAAA,WAEA,KAAA,GAAAtuB,GAAA,EAAAA,EAAA+sB,UAAA9sB,OAAAD,IACAuuB,mBAAAzB,IAAAC,UAAA/sB,KACAsuB,QAAApuB,KAAA6sB,UAAA/sB,GAIA,OAAAsuB,SAKA,QAAAC,oBAAArC,KAAAC,MACA,MAAAD,MAAAxL,OAAAyL,KAAA1L,KAAAyL,KAAAzL,IAAA0L,KAAAzL;CAKA,QAAA0N,wBAAAlC,KAAAC,MAEA,MAAAA,MAAA6B,gBAAA9B,KAAA8B,kBAEA9B,KAAAmC,eAAA,IAAAlC,KAAAkC,eAAA,IAEApC,YAAAC,KAAAC,MA0lCA,QAAAqC,sBAAAC,QAAAvR,WA8NA,QAAAwR,UACAC,QAGAC,mBAEAC,WACAC,cALAC,gBAUA,QAAAA,iBACAC,GAAAjqB,QAAAkqB,MAAA,KAAA,KACAR,QAAA1S,SAAA,MAGA0S,QAAA1S,SADAhX,QAAA2kB,MACA,SAGA,UAIA+E,QAAA1S,SADAhX,QAAAkqB,MACA,YAGA,eAGAN,QAAA9Y,EAAA,oCAAAqZ,UAAAT,SAEAU,OAAAC,EAAAD,OAAA,GAAAE,QAAAD,EAAArqB,SACAuqB,cAAAH,OAAAT,SACAY,eACAb,QAAAc,QAAAD,eAGAR,WAAA/pB,QAAAyqB,aAEAzqB,QAAA0qB,qBACAC,kBAAAhJ,SAAAiJ,aAAA5qB,QAAA6qB,mBACA/Z,EAAAga,QAAAC,OAAAJ;CAKA,QAAAK,WAEAC,aACAA,YAAAC,gBAMAd,OAAAY,UACApB,QAAA/M,SACA6M,QAAA3S,YAAA,0CAEA4T,mBACA7Z,EAAAga,QAAAK,OAAA,SAAAR,mBAKA,QAAAd,kBACA,MAAAH,SAAA0B,GAAA,YAWA,QAAArB,YAAAsB,UACAC,qBAGAL,aAAAI,UAAAJ,YAAAlZ,OAAAsZ,WACAjB,OAAAmB,iBAAAN,YAAAlZ,MACAyZ,sBACAP,YAAAC,gBACAD,YAAAZ,EAAAoB,KAAA,OAIAR,aAAAI,WACAJ,YAAAZ,EAAAoB,KACAC,YAAAL,YACAK,YAAAL,UAAAhB,EAAAsB,gBAAAN,WAEAJ,YAAAW,WACA9a,EAAA,0BAAAua,SAAA,aAAA1O,SAAAiN,UAEAQ,OAAAyB,eAAAR,WAGAJ,cAGAxyB,KAAAwyB,YAAAa,mBAAArzB,MAIAwyB,YAAAc,aACAtzB,KAAAuzB,SAAAf,YAAAgB,cAAAhB,YAAAiB,cAEArC,mBAEA2B,sBACAP,YAAAkB,QAAA1zB,MACA2zB,wBAGAC,oBACAC,oBAEAC,uBAKAH,wBACAd;CAsBA,QAAAkB,YAAAC,cACA,MAAA5C,mBAEA4C,cACAC,YAGApB,qBACAL,YAAAuB,YAAA,GACAlB,sBAEA,GAVA,OAeA,QAAAxB,YACAD,kBACA6C,YAKA,QAAAA,aAEAC,oBADA,gBAAA3sB,SAAA4sB,cACA5sB,QAAA4sB,cAEA,gBAAA5sB,SAAAoa,OACApa,QAAAoa,QAAAmQ,cAAAA,cAAApQ,aAAA,GAAA,GAGArhB,KAAAc,MAAAgwB,QAAAhP,QAAA9hB,KAAAykB,IAAAvd,QAAA6sB,YAAA,KAKA,QAAAjC,cAAA3N,KAEAqO,oBACArO,GAAA6P,SAAAhC,QACAG,YAAAjuB,OAEAwvB,YAAA,IACAvB,YAAAxY,QAAA,eAAAsa,UAYA,QAAAC,iBACAC,gBACAC;CAIA,QAAAC,gBACAtD,mBACA2B,sBACAP,YAAAmC,cAAAxX,QACAwW,yBAKA,QAAAa,iBACAzB,sBACAP,YAAAoC,cACAjB,wBAIA,QAAAG,uBACAvsB,QAAAstB,cAAAC,cAAAtC,YAAAjuB,MAAAiuB,YAAAhuB,KACAiwB,uBAGAC,eAKA,QAAAD,wBACAM,YAAAvC,YAAAjuB,MAAAiuB,YAAAhuB,KAOA,QAAAwwB,cAAAC,SACA9X,OAAA8X,QACAP,eAKA,QAAAQ,qBACAR,eASA,QAAAd,qBACAjC,OAAAwD,YAAA3C,YAAAzX,OAIA,QAAA8Y,qBACA,GAAAuB,KAAAxD,EAAAyD,QACAD,KAAA7B,SAAAf,YAAAgB,cAAAhB,YAAAiB,aACA9B,OAAA2D,cAAA,SAGA3D,OAAA4D,aAAA;CAUA,QAAAC,QAAAjxB,MAAAC,KAEAD,MAAAqtB,EAAApZ,OAAAjU,OAEAC,IADAA,IACAotB,EAAApZ,OAAAhU,KAGAD,MAAArC,QAAAiQ,IADA5N,MAAAkxB,UACA7D,EAAA8D,0BAGA9D,EAAA+D,4BAGAnD,YAAAgD,QAAAjxB,MAAAA,MAAAC,IAAAA,MAIA,QAAAoxB,YACApD,aACAA,YAAAoD,WAUA,QAAAC,QACA71B,KAAAwyB,YAAAsD,gBAAA91B,MACAsxB,aAIA,QAAAyE,QACA/1B,KAAAwyB,YAAAwD,gBAAAh2B,MACAsxB,aAIA,QAAA2E,YACAj2B,KAAAmS,IAAA,GAAA,SACAmf,aAIA,QAAA4E,YACAl2B,KAAAmS,IAAA,EAAA,SACAmf,aAIA,QAAA6E,SACAn2B,KAAA4xB,EAAAyD,SACA/D,aAIA,QAAA8E,UAAAC,WACAr2B,KAAA4xB,EAAApZ,OAAA6d,WACA/E,aAIA,QAAAgF,eAAAC,OACAv2B,KAAAmS,IAAAqG,OAAA2N,SAAAoQ,QACAjF;CAMA,QAAAkF,QAAAC,QAAA7D,UACA,GAAA8D,KAEA9D,UAAAA,UAAA,MACA8D,KAAA9E,EAAA+E,YAAA/D,WAAAhB,EAAAgF,gBAAAhE,UAEA5yB,KAAAy2B,QACAnF,WAAAoF,KAAAA,KAAApd,KAAA,MAIA,QAAAlZ,WACA,MAAAJ,MAAAkC,QAUA,QAAA6wB,uBACA5B,QAAAhR,KACAgC,MAAA,OACAR,OAAAwP,QAAAxP,SACAqC,SAAA,WAKA,QAAA2P,yBACAxC,QAAAhR,KACAgC,MAAA,GACAR,OAAA,GACAqC,SAAA,KAUA,QAAA6S,eACA,MAAAjF,GAIA,QAAAkF,WACA,MAAAtE,aAIA,QAAAuE,QAAA7gB,KAAAtR,OACA,MAAAkW,UAAAlW,MACA2C,QAAA2O,YAEA,UAAAA,MAAA,iBAAAA,MAAA,eAAAA,QACA3O,QAAA2O,MAAAtR,MACAmvB,YAAA,KAKA,QAAA/Z,SAAA9D,KAAAkS,SACA,MAAA7gB,SAAA2O,MACA3O,QAAA2O,MAAAoJ,MACA8I,SAAAkM,SACAvvB,MAAAV,UAAAgC,MAAAsH,KAAAlJ,UAAA,IAHA;CAnoBA,GAAAmtB,GAAAxtB,IAGAwtB,GAAAoF,YAAAtX,cACA,IAAAnY,SAAAnD,KAAAmD,OAMAqqB,GAAAV,OAAAA,OACAU,EAAAW,QAAAA,QACAX,EAAA2C,cAAAA,cACA3C,EAAAoD,aAAAA,aACApD,EAAAsD,kBAAAA,kBACAtD,EAAAqF,eAAAvC,aACA9C,EAAAsF,WAAA5F,WACAM,EAAA4D,OAAAA,OACA5D,EAAAgE,SAAAA,SACAhE,EAAAiE,KAAAA,KACAjE,EAAAmE,KAAAA,KACAnE,EAAAqE,SAAAA,SACArE,EAAAsE,SAAAA,SACAtE,EAAAuE,MAAAA,MACAvE,EAAAwE,SAAAA,SACAxE,EAAA0E,cAAAA,cACA1E,EAAA4E,OAAAA,OACA5E,EAAAxxB,QAAAA,QACAwxB,EAAAiF,YAAAA,YACAjF,EAAAkF,QAAAA,QACAlF,EAAAmF,OAAAA,OACAnF,EAAA5X,QAAAA,OASA,IAAAmS,YAAA3E,aACA2P,oBAAA5vB,QAAA6kB,MAeA,IAZA7kB,QAAA4L,aACAgZ,WAAAiL,QAAA7vB,QAAA4L,YAEA5L,QAAA8vB,kBACAlL,WAAAmL,aAAA/vB,QAAA8vB,iBAEA9vB,QAAAqM,WACAuY,WAAAoL,UAAAhwB,QAAAqM,UAEArM,QAAAiwB,gBACArL,WAAAsL,eAAAlwB,QAAAiwB,eAEA,MAAAjwB,QAAAmwB,SAAA,CACA,GAAAC,OAAAnQ,aAAA2E,WAAAwL,MACAA;MAAAC,IAAArwB,QAAAmwB,SACAvL,WAAAwL,MAAAA,MAIAxL,WAAA0L,uBAAA,SAAAC,UACA,MAAA,kBAAAA,UACAA,SAEA,UAAAA,SACAA,SAEA,QAAAA,UAAA,QAAAA,SACA,MADA,QAGAvwB,QAAAwwB,uBAQAnG,EAAA+D,2BAAAnd,OAAA2N,SAAA5e,QAAAouB,4BACA/D,EAAA8D,0BAAAld,OAAA2N,SAAA5e,QAAAmuB,2BAKA9D,EAAApZ,OAAA,WACA,GAAAuR,IAwBA,OAtBA,UAAAxiB,QAAAywB,UACAjO,IAAAiB,GAAAxS,OAAA8G,MAAA,KAAA7a,WAGAslB,IAAA0L,WACA1L,IAAAkO,SAIAlO,IADA,QAAAxiB,QAAAywB,SACAhN,GAAAxS,OAAA6R,IAAA/K,MAAA,KAAA7a,WAGAumB,GAAAxS,OAAAgF,UAAA8B,MAAA,KAAA7a,WAGA,WAAAslB,KACAA,IAAAmO,QAAA/L,WAGApC,IAAAoO,MAAAhM,WAGApC;EAMA6H,EAAAwG,mBAAA,WACA,MAAA,UAAA7wB,QAAAywB,UAAA,QAAAzwB,QAAAywB,UAMApG,EAAAyG,WAAA,SAAAr4B,MACA,MAAA4xB,GAAApZ,OAAAxY,KAAAs4B,YAMA1G,EAAAyD,OAAA,WACA,GAAAD,KAAA7tB,QAAA6tB,GAIA,OAHA,kBAAAA,OACAA,IAAAA,OAEAxD,EAAApZ,OAAA4c,MAKAxD,EAAA2G,YAAA,SAAAlb,OACA,MAAAA,OAAA7Y,IACA6Y,MAAA7Y,IAAAtC,QAGA0vB,EAAA4G,mBAAAnb,MAAAwR,OAAAxR,MAAA9Y,QAMAqtB,EAAA4G,mBAAA,SAAA3J,OAAAtqB,OACA,GAAAC,KAAAD,MAAArC,OAaA,OAXA2sB,QACArqB,IAAA4hB,YAAAjU,IAAAyf,EAAA+D,4BAGAnxB,IAAA2N,IAAAyf,EAAA8D,2BAGA9D,EAAAwG,sBACA5zB,IAAAymB,YAGAzmB,KAMAotB,EAAA6G,iBAAA,SAAAtS,UACA,OAAAA,SAAAuS,QAAAvS,SAAAiG,MAAAze,KAAAwY,SAAA5e,QAAA6kB,MACAuM;EASAC,aAAAjrB,KAAAikB,EAAArqB,QACA,IAUAoqB,QACAG,cACAX,QACAK,GACAgB,YAEA0B,oBACAhC,kBAEAlyB,KAnBA80B,cAAAlD,EAAAkD,cACAC,YAAAnD,EAAAmD,YAQAT,SAAArD,QAAA,GAMAgC,eAGAJ,mBAAA,EAEA1V,SASAnd,MADA,MAAAuH,QAAAsxB,YACAjH,EAAApZ,OAAAjR,QAAAsxB,aAGAjH,EAAAyD,SA4IAzD,EAAAkH,uBAAA,WAIA,MAHAhe,UAAAoZ,qBACA7C,WAEA6C,qBAIAtC,EAAAmH,aAAA,WACA,MAAA,SAAAxxB,QAAA4sB,eAAA,SAAA5sB,QAAAoa,QAmkBA,QAAAqX,mCAAAzxB,SACA8Q,EAAAyE,KAAAmc,0BAAA,SAAA/iB,KAAAiT,MACA,MAAA5hB,QAAA2O,QACA3O,QAAA2O,MAAAiT,KAAA5hB;CAQA,QAAA4vB,qBAAA+B,UACA,GAAA/P,MAAA3Q,OAAA2T,YAAA3T,OAAA2gB,QACA,OAAAhQ,MAAAxb,KAAA6K,OAAA0gB,WACA/P,KAAAxb,KAAA6K,OAAA,MAcA,QAAAqZ,QAAAuH,SAAA7xB,SAmBA,QAAA2pB,UACA,GAAAmI,UAAA9xB,QAAAoqB,MAIA,OAFAH,IAAAjqB,QAAAkqB,MAAA,KAAA,KAEA4H,SACA9X,GAAAlJ,EAAA,6BACAihB,OAAAC,cAAA,SACAD,OAAAC,cAAA,UACAD,OAAAC,cAAA,WACAD,OAAA,2BALA,OAYA,QAAA/G,WACAhR,GAAA6C,SAIA,QAAAmV,eAAA7W,UACA,GAAA8W,WAAAnhB,EAAA,kBAAAqK,SAAA,OACA+W,UAAAlyB,QAAAoqB,OAAAjP,SA6IA,OA3IA+W,YACAphB,EAAAyE,KAAA2c,UAAAlqB,MAAA,KAAA,WACA,GAEAmqB,SAFAC,cAAAthB,IACAuhB,eAAA,CAGAvhB;EAAAyE,KAAA1Y,KAAAmL,MAAA,KAAA,SAAArF,EAAA2vB,YACA,GAAAC,UACAC,YACAC,aACAC,YACAC,UACAC,WACAC,UACAC,QACAC,MAEA,UAAAT,YACAF,cAAAA,cAAAxnB,IAAAkG,EAAA,oBACAuhB,eAAA,IAGAE,SAAAV,SAAAzC,YAAAkD,YAEAC,UACAC,YAAA,WACAX,SAAAlC,WAAA2C,aAEAU,iBAAA73B,KAAAm3B,YACAG,aAAAF,SAAAU,mBACAP,YAAAH,SAAAW,mBAEArB,SAAAS,cACAE,YAAA,WACAX,SAAAS,eAEAG,cAAAZ,SAAA1Z,UAAAgb,gBAAAb,YACAI,YAAA1yB,QAAAmzB,WAAAb,aAGAE,cAEAG,UAAA3yB,QAAAozB,iBAAAd,YACAM,WAAA5yB,QAAAqzB,YAAAf,YAGAO,UADAJ,aACAxR,WAAAwR,cAEAE,WAAA3yB,QAAAkqB,MACA,gCAAAyI,UAAA,YAEAC,aAAA5yB,QAAAkqB,MACA,gCAAA0I,WAAA,YAGA3R,WAAAyR,aAGAI,SACA,MAAAR,WAAA,UACArI,GAAA,UACAA,GAAA,kBAGA8I,OAAAjiB,EACA,gCAAAgiB,QAAA52B,KAAA,KAAA,KACA22B,UACA,aAEAS,MAAA,WAEAP,OAAAQ,SAAAtJ,GAAA,qBAEAuI,eAKAO,OAAAQ,SAAAtJ,GAAA,kBACA8I,OAAAQ,SAAAtJ,GAAA,qBAEA8I,OAAAhc,YAAAkT,GAAA;GAIAuJ,UAAA,WAGAT,OACAU,IAAA,IAAAxJ,GAAA,iBACAwJ,IAAA,IAAAxJ,GAAA,mBACAjT,SAAAiT,GAAA,iBAEAyJ,QAAA,WAEAX,OAAAhc,YAAAkT,GAAA,iBAEA0J,MACA,WAGAZ,OACAU,IAAA,IAAAxJ,GAAA,iBACAwJ,IAAA,IAAAxJ,GAAA,mBACAjT,SAAAiT,GAAA,iBAEA,WAEA8I,OACAhc,YAAAkT,GAAA,gBACAlT,YAAAkT,GAAA,iBAIAmI,cAAAA,cAAAxnB,IAAAmoB,YAKAV,eACAD,cACAloB,QAAA8M,SAAAiT,GAAA,gBAAAhtB,MACAkN,OAAA6M,SAAAiT,GAAA,iBAAAhtB,MAGAm1B,cAAAl3B,OAAA,GACAi3B,QAAArhB,EAAA,UACAuhB,eACAF,QAAAnb,SAAA,mBAEAmb,QAAAJ,OAAAK,eACAH,UAAAF,OAAAI,UAGAF,UAAAF,OAAAK;GAKAH,UAIA,QAAArE,aAAArqB,MACAyW,GAAA9C,KAAA,MAAA3T,KAAAA,MAIA,QAAAsoB,gBAAAyG,YACAtY,GAAA9C,KAAA,OAAAob,WAAA,WACAtb,SAAAiT,GAAA,iBAIA,QAAAsB,kBAAA+G,YACAtY,GAAA9C,KAAA,OAAAob,WAAA,WACAvb,YAAAkT,GAAA,iBAIA,QAAA8D,eAAAuE,YACAtY,GAAA9C,KAAA,OAAAob,WAAA,WACAvuB,KAAA,WAAA,YACAiT,SAAAiT,GAAA,mBAIA,QAAA+D,cAAAsE,YACAtY,GAAA9C,KAAA,OAAAob,WAAA,WACAsB,WAAA,YACA7c,YAAAkT,GAAA,mBAIA,QAAA4J,uBACA,MAAAb,kBA3NA,GAAA3I,GAAAxtB,IAGAwtB,GAAAV,OAAAA,OACAU,EAAAW,QAAAA,QACAX,EAAAuD,YAAAA,YACAvD,EAAAwB,eAAAA,eACAxB,EAAAkB,iBAAAA,iBACAlB,EAAA0D,cAAAA,cACA1D,EAAA2D,aAAAA,aACA3D,EAAAwJ,oBAAAA,mBAGA;GAEA5J,IAFAjQ,GAAAlJ,IACAkiB,oBA+NA,QAAA3B,cAAArxB,SAmDA,QAAAutB,eAAAvwB,MAAAC,KACA,OAAA62B,YAEA92B,MAAArC,QAAA+oB,YAAAoQ,WAAAn5B,QAAA+oB,aACAzmB,IAAAtC,QAAA+oB,YAAAqQ,SAAAp5B,QAAA+oB,YAIA,QAAA8J,aAAAxwB,MAAAC,KACA62B,WAAA92B,MACA+2B,SAAA92B,IACA+2B,QACA,IAAAC,WAAAC,eACA3Q,IAAA4Q,QAAAj5B,MACAk5B,kBAAA7Q,GACA,KAAA,GAAAtoB,GAAA,EAAAsoB,IAAAtoB,EAAAA,IACAo5B,iBAAAF,QAAAl5B,GAAAg5B,SAKA,QAAAI,kBAAA3N,OAAAuN,SACAK,kBAAA5N,OAAA,SAAA6N,aACA,GACAt5B,GAAAu5B,WACAC,cAFAC,cAAA5jB,EAAAqD,QAAAuS,OAAA9Q,OAIA,IAAAqe,SAAAC,eAAA,CAEA,GAAAK,YACA,IAAAt5B,EAAA,EAAAA,EAAAs5B,YAAAr5B,OAAAD,IACAu5B,WAAAD,YAAAt5B,GAGAw5B,cADAC,cACAF,WAGAG,oBAAAH,WAAA9N,QAGA+N,eACAT,MAAA74B,KAAA4c,MACAic,MACAY,YAAAH,eAMAL;mBACAA,kBACA3G,aAAAuG,UAOA,QAAAM,mBAAA5N,OAAApa,UACA,GAAArR,GAEAuM,IADAqtB,SAAApR,GAAAqR,cAGA,KAAA75B,EAAA,EAAAA,EAAA45B,SAAA35B,OAAAD,IAAA,CAUA,GATAuM,IAAAqtB,SAAA55B,GAAAmL,KACAikB,EACA3D,OACAoN,WAAAn5B,QACAo5B,SAAAp5B,QACAqF,QAAAywB,SACAnkB,UAGA9E,OAAA,EAEA,MAEA,IAAA,gBAAAA,KAGA,WADA8sB,mBAAA9sB,IAAA8E,UAKA,GAAAsJ,QAAA8Q,OAAA9Q,MACA,IAAAA,OACA9E,EAAAgQ,WAAAlL,SACAmf,cACAnf,OAAAxP,KACAikB,EACAyJ,WAAAn5B,QACAo5B,SAAAp5B,QACAqF,QAAAywB,SACA,SAAA7a,QACAtJ,SAAAsJ,QACAof,gBAIAlkB,EAAAqD,QAAAyB,QACAtJ,SAAAsJ,QAGAtJ,eAEA,CACA,GAAAwF,KAAA4U,OAAA5U,GACA,IAAAA,IAAA,CACA,GAKAmjB,YALA9iB,QAAAuU,OAAAvU,QACAa,MAAA0T,OAAA1T,MACAkiB,SAAAxO,OAAAwO,QAMAD;WAFAnkB,EAAAgQ,WAAA4F,OAAA1U,MAEA0U,OAAA1U,OAIA0U,OAAA1U,IAKA,IAAAA,MAAAlB,EAAA8D,UAAAqgB,gBAEAE,WAAAnU,aAAA0F,OAAAyO,WAAAn1B,QAAAm1B,YACAC,SAAApU,aAAA0F,OAAA0O,SAAAp1B,QAAAo1B,UACAC,cAAArU,aAAA0F,OAAA2O,cAAAr1B,QAAAq1B,cAEAF,cACAnjB,KAAAmjB,YAAArB,WAAApgB,UAEA0hB,WACApjB,KAAAojB,UAAArB,SAAArgB,UAEA1T,QAAAywB,UAAA,SAAAzwB,QAAAywB,WACAze,KAAAqjB,eAAAr1B,QAAAywB,UAGAsE,cACAjkB,EAAAe,KAAAf,EAAA8D,UAAA0gB,aAAA5O,QACA1U,KAAAA,KACAG,QAAA,SAAAyD,QACAA,OAAAA,UACA,IAAApO,KAAAmZ,SAAAxO,QAAAtV,KAAAK,UACA4T,GAAAqD,QAAA3M,OACAoO,OAAApO,KAEA8E,SAAAsJ,SAEA5C,MAAA,WACA2N,SAAA3N,MAAAnW,KAAAK,WACAoP;EAEA4oB,SAAA,WACAvU,SAAAuU,SAAAr4B,KAAAK,WACA83B,qBAIA1oB,aAWA,QAAAipB,gBAAAC,aACA,GAAA9O,QAAA+O,iBAAAD,YACA9O,UACAyN,QAAAh5B,KAAAurB,QACA0N,mBACAC,iBAAA3N,OAAAwN,iBAKA,QAAAuB,kBAAAD,aACA,GACA9O,QACAzrB,EAFAy6B,YAAAjS,GAAAkS,iBAcA,IAVA7kB,EAAAgQ,WAAA0U,cAAA1kB,EAAAqD,QAAAqhB,aACA9O,QAAA9Q,OAAA4f,aAEA,gBAAAA,aACA9O,QAAA5U,IAAA0jB,aAEA,gBAAAA,eACA9O,OAAA5V,EAAA8D,UAAA4gB,cAGA9O,OAAA,CAqBA,IAlBAA,OAAA/P,UACA,gBAAA+P,QAAA/P,YACA+P,OAAA/P,UAAA+P,OAAA/P,UAAA3O,MAAA,QAKA0e,OAAA/P,aAIA7F,EAAAqD,QAAAuS,OAAA9Q,UACA8Q,OAAAkP,UAAAlP,OAAA9Q,OACA8Q,OAAA9Q,OAAA9E,EAAA9D,IAAA0Z,OAAA9Q,OAAA,SAAA4e,YACA,MAAAG,qBAAAH,WAAA9N;IAIAzrB,EAAA,EAAAA,EAAAy6B,YAAAx6B,OAAAD,IACAy6B,YAAAz6B,GAAAmL,KAAAikB,EAAA3D,OAGA,OAAAA,SAKA,QAAAmP,mBAAAnP,QACAyN,QAAArjB,EAAAglB,KAAA3B,QAAA,SAAA/T,KACA,OAAA2V,eAAA3V,IAAAsG,UAGAsN,MAAAljB,EAAAglB,KAAA9B,MAAA,SAAAvsB,GACA,OAAAsuB,eAAAtuB,EAAAif,OAAAA,UAEA+G,aAAAuG,OAIA,QAAA+B,gBAAAC,QAAAC,SACA,MAAAD,UAAAC,SAAAC,mBAAAF,UAAAE,mBAAAD,SAIA,QAAAC,oBAAAxP,QACA,OACA,gBAAAA,QACAA,OAAAkP,WAAAlP,OAAAyP,kBAAAzP,OAAA5U,KAAA4U,OAAA9Q,OACA,OAEA8Q,OAUA,QAAA0P,aAAAtgB,OAGAA,MAAA9Y,MAAAqtB,EAAApZ,OAAA6E,MAAA9Y,OAEA8Y,MAAA7Y,IADA6Y,MAAA7Y,IACAotB,EAAApZ,OAAA6E,MAAA7Y,KAGA,KAGAo5B,YAAAvgB,MAAAwgB,kBAAAxgB,QACA2X,aAAAuG;CAKA,QAAAsC,mBAAAxgB,OACA,GAAAygB,SAUA,OARAzlB,GAAAyE,KAAAO,MAAA,SAAAnH,KAAAtQ,KACAm4B,oBAAA7nB,OACA4E,SAAAlV,KAAAqiB,SAAAriB,OACAk4B,MAAA5nB,MAAAtQ,OAKAk4B,MAIA,QAAAC,qBAAA7nB,MACA,OAAA,6BAAA3S,KAAA2S,MAKA,QAAA8nB,aAAAjC,WAAA7M,OACA,GACA/R,QACA3a,EAAA6a,MAFA2e,cAAAE,oBAAAH,WAIA,IAAAC,cAAA,CAGA,IAFA7e,OAAAgf,YAAAH,eAEAx5B,EAAA,EAAAA,EAAA2a,OAAA1a,OAAAD,IACA6a,MAAAF,OAAA3a,GAEA6a,MAAA4Q,SACAiB,QACA+O,aAAA9gB,OAAAza,KAAA2a,OACAA,MAAA4Q,OAAAgQ,cAEA1C,MAAA74B,KAAA2a,OAMA,OAFA2X,cAAAuG,OAEApe,OAGA,SAIA,QAAA+gB,cAAAtrB,QACA,GAAAurB,SACA37B,CAkBA,KAhBA,MAAAoQ,OACAA,OAAA,WAAA,OAAA;EAEAyF,EAAAgQ,WAAAzV,UACAurB,QAAAvrB,OAAA,GACAA,OAAA,SAAAyK,OACA,MAAAA,OAAA+Q,KAAA+P,UAKA5C,MAAAljB,EAAAglB,KAAA9B,MAAA3oB,QAAA,GAKApQ,EAAA,EAAAA,EAAAk5B,QAAAj5B,OAAAD,IACA6V,EAAAqD,QAAAggB,QAAAl5B,GAAA2a,UACAue,QAAAl5B,GAAA2a,OAAA9E,EAAAglB,KAAA3B,QAAAl5B,GAAA2a,OAAAvK,QAAA,GAIAoiB,cAAAuG,OAIA,QAAA6C,cAAAxrB,QACA,MAAAyF,GAAAgQ,WAAAzV,QACAyF,EAAAglB,KAAA9B,MAAA3oB,QAEA,MAAAA,QACAA,QAAA,GACAyF,EAAAglB,KAAA9B,MAAA,SAAAvsB,GACA,MAAAA,GAAAof,KAAAxb,UAGA2oB,MASA,QAAAe,eACA+B,gBACArkB,QAAA,UAAA,MAAA,EAAA8c,WAKA,QAAAyF,gBACA8B,cACArkB,QAAA,UAAA,MAAA,EAAA8c,WAcA,QAAAoF,qBAAA1c,MAAAyO,QACA,GACA1pB,OAAAC,IACAqqB,OAFAyP,MA4CA,IAxCA/2B,QAAAg3B,qBACA/e,MAAAjY,QAAAg3B,mBAAA/e,QAEAyO,QAAAA,OAAAsQ,qBACA/e,MAAAyO,OAAAsQ,mBAAA/e,QAKAnH,EAAA8D,OAAAmiB,IAAA9e,OAEAyO,SACAqQ,IAAArQ,OAAAA,QAGAqQ,IAAAlQ,IAAA5O,MAAA4O,MAAAtT,SAAA0E,MAAAhN,GAAA,MAAAgsB,YAAAhf,MAAAhN,GAAA,IAIA8rB,IAAApgB,UAFAsB,MAAAtB,UACA,gBAAAsB,OAAAtB,UACAsB,MAAAtB,UAAA3O,MAAA,OAGAiQ,MAAAtB,aAOA3Z,MAAAib,MAAAjb,OAAAib,MAAAxf,KACAwE,IAAAgb,MAAAhb,IAGA8iB,aAAA/iB,SACAA,MAAAiU,OAAA2N,SAAA5hB,QAEA+iB,aAAA9iB,OACAA,IAAAgU,OAAA2N,SAAA3hB,MAGAgb,MAAAoY,KAAApf,OAAAqO,WAAAtiB,QAAAiU,OAAAqO,WAAAriB,KAGA85B,IAAA/5B,MAAAA,MAAAiU,OAAA2N,SAAA5hB,OAAA,KACA+5B,IAAA95B,IAAAA,IAAAgU,OAAA2N,SAAA3hB,KAAA,KACA85B,IAAAG,YAAA;IAEA,CAEA,GAAAl6B,QACAA,MAAAqtB,EAAApZ,OAAAjU,QACAA,MAAAm6B,WACA,OAAA,CAIAl6B,OACAA,IAAAotB,EAAApZ,OAAAhU,KACAA,IAAAk6B,YACAl6B,IAAA,OAIAqqB,OAAArP,MAAAqP,OACA/T,SAAA+T,SACAA,OAAAtG,aACA0F,OAAAA,OAAA0Q,cAAA7jB,OACAvT,QAAAo3B,gBAKAC,mBAAAr6B,MAAAC,IAAAqqB,OAAAyP,KAGA,MAAAA,KAMA,QAAAM,oBAAAr6B,MAAAC,IAAAqqB,OAAAxR,OACAA,MAAA9Y,MAAAA,MACA8Y,MAAA7Y,IAAAA,IACA6Y,MAAAwR,OAAAA,OACAgQ,oBAAAxhB,OACAyhB,iBAAAzhB,OAMA,QAAAwhB,qBAAAf,OAEAiB,yBAAAjB,OAEAA,MAAAt5B,MAAAs5B,MAAAt5B,IAAAw6B,QAAAlB,MAAAv5B,SACAu5B,MAAAt5B,IAAA,MAGAs5B,MAAAt5B,MAEAs5B,MAAAt5B,IADA+C,QAAA03B,mBACArN,EAAA4G,mBAAAsF,MAAAjP,OAAAiP,MAAAv5B,OAGA;CAOA,QAAAw6B,0BAAAz6B,OACA,MAAAA,MAAAuqB,SACAvqB,MAAAuqB,SAAAvqB,MAAAC,MAAAkxB,WAAAnxB,MAAAE,KAAAF,MAAAE,IAAAixB,YAGAnxB,MAAAuqB,QACAvqB,MAAAC,MAAA6hB,YACA9hB,MAAAE,KAEAF,MAAAE,IAAA4hB,cAIA9hB,MAAAC,MAAAkxB,YACAnxB,MAAAC,MAAAqtB,EAAAyG,WAAA/zB,MAAAC,QAEAD,MAAAE,MAAAF,MAAAE,IAAAixB,YACAnxB,MAAAE,IAAAotB,EAAAyG,WAAA/zB,MAAAE,OASA,QAAA06B,yBAAA56B,OACA,GAAAuqB,OAYA,OAVAvqB,OAAAE,MAEAqqB,OAAAvqB,MAAAuqB,OACA,MAAAA,SACAA,QAAAvqB,MAAAC,MAAAkxB,WAGAnxB,MAAA+T,EAAA8D,UAAA7X,OACAA,MAAAE,IAAAotB,EAAA4G,mBAAA3J,OAAAvqB,MAAAC,QAEAD,MAQA,QAAA63B,aAAAH,cAAAmD,YAAAC,WACA,GACAC,SACAzH,IACAp1B,EACAxC,KACAivB,UAAAqQ,QACA/6B,MAAAC,IACA6Y,MAPAF,SAYA;GAHAgiB,YAAAA,aAAA9D,WACA+D,UAAAA,WAAA9D,SAEAU,cACA,GAAAA,cAAAyC,WAAA,CAGA,GAAA7G,IAAAoE,cAAApE,IAEA,IADAyH,WACA78B,EAAA,EAAAA,EAAAo1B,IAAAn1B,OAAAD,IACA68B,QAAAzH,IAAAp1B,KAAA,CAMA,KADAxC,KAAAm/B,YAAAj9B,QAAAkkB,YACApmB,KAAAu/B,SAAAH,cAEAC,SAAAA,QAAAr/B,KAAA8M,UAEAmiB,UAAA+M,cAAAz3B,MACA+6B,QAAAtD,cAAAx3B,IACAD,MAAAvE,KAAAkC,QACAsC,IAAA,KAEAyqB,YACA1qB,MAAAA,MAAAzC,KAAAmtB,YAEAqQ,UACA96B,IAAAxE,KAAAkC,QAAAJ,KAAAw9B,UAGAjiB,MAAAhF,EAAA8D,UAAA6f,eACA4C,mBACAr6B,MAAAC,KACAyqB,YAAAqQ,QACAjiB,OAEAF,OAAAza,KAAA2a,QAGArd,KAAAmS,IAAA,EAAA,YAIAgL,QAAAza,KAAAs5B,cAIA,OAAA7e,QAgBA,QAAAygB,aAAAvgB,MAAAmiB,SAAAC,WAUA,QAAAC,WAAA9+B,MAAA++B,OACA,MAAAF,WACAlZ,WAAA3lB,MAAA++B,MAAAF,WAEAD,SAAA3Q,OACAvI,QAAA1lB,MAAA++B,OAGAzZ,YAAAtlB,MAAA++B;CAjBA,GACAC,UACAC,SACAC,WACAC,SACAC,cACAC,SANAC,YA8EA,OAzDAV,UAAAA,aAGAA,SAAAj7B,QACAi7B,SAAAj7B,MAAA8Y,MAAA9Y,MAAArC,SAEA4Y,SAAA0kB,SAAAh7B,MACAg7B,SAAAh7B,IAAA6Y,MAAA7Y,IAAA6Y,MAAA7Y,IAAAtC,QAAA,MAEA,MAAAs9B,SAAA3Q,SACA2Q,SAAA3Q,OAAAxR,MAAAwR,QAEAgQ,oBAAAW,UAIAI,UACAr7B,MAAA8Y,MAAA8iB,OAAAj+B,QACAsC,IAAA6Y,MAAA+iB,KAAA/iB,MAAA+iB,KAAAl+B,QAAA0vB,EAAA4G,mBAAAnb,MAAAgjB,QAAAhjB,MAAA8iB,QACAtR,OAAA2Q,SAAA3Q,QAEAgQ,oBAAAe,UAGAC,SAAA,OAAAxiB,MAAA+iB,MAAA,OAAAZ,SAAAh7B,IAGAs7B,WAAAJ,UAAAF,SAAAj7B,MAAAq7B,SAAAr7B,OAGAi7B,SAAAh7B,KACAu7B,SAAAL,UAAAF,SAAAh7B,IAAAo7B,SAAAp7B,KACAw7B,cAAAD,SAAAO,SAAAR,aAGAE,cAAA,KAIA3nB,EAAAyE,KAAA0iB,SAAA,SAAAtpB,KAAAtQ,KACAm4B,oBAAA7nB,OACA4E,SAAAlV,MACAs6B,UAAAhqB,MAAAtQ;GAMAq6B,SAAAM,aACAnC,aAAA/gB,MAAA+Q,KACAyR,SACAL,SAAA3Q,OACAiR,WACAE,cACAE,YAIAM,UAAAV,WACAE,cAAAA,cACAS,KAAAR,UAgBA,QAAAM,cAAApjB,OAAA0iB,SAAAhR,OAAA2R,UAAAR,cAAAE,WACA,GAAAQ,iBAAA9O,EAAAwG,qBACAuI,gBAuEA,OApEAH,aAAAA,UAAAI,YAAAJ,UAAA,MACAR,gBAAAA,cAAAY,YAAAZ,cAAA,MAEA3nB,EAAAyE,KAAAK,OAAA,SAAA3a,EAAA6a,OACA,GAAAuiB,UACAJ,QAIAI,WACAr7B,MAAA8Y,MAAA9Y,MAAArC,QACAsC,IAAA6Y,MAAA7Y,IAAA6Y,MAAA7Y,IAAAtC,QAAA,KACA2sB,OAAAxR,MAAAwR,QAEAxW,EAAAyE,KAAAojB,UAAA,SAAAhqB,MACA0pB,SAAA1pB,MAAAmH,MAAAnH,QAKAspB,UACAj7B,MAAA8Y,MAAA8iB,OACA37B,IAAA6Y,MAAA+iB,KACAvR,OAAAA,QAEAgQ,oBAAAW,UAGAK,SACAL,SAAAh7B,IAAA,KAEAw7B,gBAAAR,SAAAh7B,MACAg7B,SAAAh7B,IAAAotB,EAAA4G,mBAAAgH,SAAA3Q,OAAA2Q,SAAAj7B,QAGAi8B,YACAhB,SAAAj7B,MAAA4N,IAAAquB,WACAhB,SAAAh7B,KACAg7B,SAAAh7B,IAAA2N,IAAAquB,YAIAR,eACAR,SAAAh7B,IAAA2N,IAAA6tB,eAMAU,kBACAlB,SAAA3Q,SACA2R,WAAAR,iBAEAR,SAAAj7B,MAAA0mB,YACAuU,SAAAh7B,KACAg7B,SAAAh7B,IAAAymB,aAIA5S,EAAA8D,OAAAkB,MAAA6iB,UAAAV,UACAV,iBAAAzhB,OAEAsjB,cAAAj+B,KAAA,WACA2V,EAAA8D,OAAAkB,MAAAuiB,UACAd,iBAAAzhB;KAIA,WACA,IAAA,GAAA7a,GAAA,EAAAA,EAAAm+B,cAAAl+B,OAAAD,IACAm+B,cAAAn+B,MAcA,QAAAq+B,wBAAAC,UACA,GASA/E,YATAgF,UAAAx5B,QAAAy5B,cACAC,YACA/iB,UAAA,iBACA3Z,MAAA,QACAC,IAAA,QACAozB,KAAA,EAAA,EAAA,EAAA,EAAA,GACA9J,UAAA,sBAEAkF,KAAApB,EAAAkF,SAWA,OARAiK,aACAhF,WAAA1jB,EAAA8D,UAEA8kB,WACA,gBAAAF,WAAAA,eAIAhF,YAGA+E,WACA/E,WAAAx3B,MAAA,KACAw3B,WAAAv3B,IAAA,MAGA23B,YACAD,oBAAAH,YACA/I,KAAAzuB,MACAyuB,KAAAxuB,SAgBA,QAAA08B,qBAAA58B,MAAA+Y,OACA,GAAA4Q,QAAA5Q,MAAA4Q,WACAkT,WAAA5Y,aACAlL,MAAA8jB,WACAlT,OAAAkT,WACA55B,QAAA65B,iBAEAC,QAAA9Y,aACAlL,MAAAgkB,QACApT,OAAAoT,QACA95B,QAAA+5B,aAKA;MAFAh9B,OAAA46B,wBAAA56B,OAEAi9B,eAAAj9B,MAAA68B,WAAAE,QAAAhkB,OAIA,QAAAmkB,yBAAAl9B,OACA,MAAAi9B,gBAAAj9B,MAAAiD,QAAAk6B,iBAAAl6B,QAAAm6B,eAMA,QAAAC,4BAAAr9B,MAAA0qB,YACA,GAAA+M,YACA1e,KAQA,OALA2R,cACA+M,WAAA1jB,EAAA8D,UAAA6S,WAAA1qB,OACA+Y,MAAA8e,YAAAD,oBAAAH,aAAA,IAGA1e,MACA6jB,oBAAA58B,MAAA+Y,QAIA/Y,MAAA46B,wBAAA56B,OAEAk9B,wBAAAl9B,QAQA,QAAAi9B,gBAAAj9B,MAAA68B,WAAAE,QAAAhkB,OACA,GAAAukB,kBACAC,eACAC,WACAt/B,EAAAu/B,UACAC,WAQA,IALA19B,MAAA+T,EAAA8D,UAAA7X,OACAA,MAAAC,MAAAD,MAAAC,MAAArC,QAAA+oB,YACA3mB,MAAAE,IAAAF,MAAAE,IAAAtC,QAAA+oB,YAGA,MAAAkW,WAAA,CAOA,IAHAS,iBAAAK,mBAAAd,YAEAU,gBAAA,EACAr/B,EAAA,EAAAA,EAAAo/B,iBAAAn/B,OAAAD,IACA,GAAA0/B,mBAAAN,iBAAAp/B,GAAA8B,OAAA,CACAu9B,gBAAA,CACA;MAIA,IAAAA,eACA,OAAA,EAMA,IAFAC,WAAAlQ,EAAAuQ,cAAA9kB,MAAA/Y,OAEA9B,EAAA,EAAAA,EAAAs/B,WAAAr/B,OAAAD,IAIA,GAHAu/B,UAAAD,WAAAt/B,GAGA4/B,qBAAAL,UAAAz9B,OAAA,CAGA,GAAA+8B,WAAA,EACA,OAAA,CAGA,IAAA,kBAAAA,WAAAA,QAAAU,UAAA1kB,OACA,OAAA,CAKA,IAAAA,MAAA,CAMA,GALA2kB,YAAAzZ,aACAwZ,UAAAV,SACAU,UAAA9T,YAAAoT,SAGAW,eAAA,EACA,OAAA,CAGA,IAAA,kBAAAA,eAAAA,YAAA3kB,MAAA0kB,WACA,OAAA,GAMA,OAAA,EAQA,QAAAE,oBAAAI,iBAEA,MAAA,kBAAAA,gBACAxB,yBAGA,gBAAAwB,iBACAlG,YAAAD,oBAAAmG,kBAGAjE,aAAAiE;CAMA,QAAAH,oBAAA7kB,MAAA/Y,OACA,GAAAg+B,YAAAjlB,MAAA9Y,MAAArC,QAAA+oB,YACAsX,SAAA3Q,EAAA2G,YAAAlb,OAAA4N,WAEA,OAAA3mB,OAAAC,OAAA+9B,YAAAh+B,MAAAE,KAAA+9B,SAMA,QAAAH,sBAAA/kB,MAAA/Y,OACA,GAAAg+B,YAAAjlB,MAAA9Y,MAAArC,QAAA+oB,YACAsX,SAAA3Q,EAAA2G,YAAAlb,OAAA4N,WAEA,OAAA3mB,OAAAC,MAAAg+B,UAAAj+B,MAAAE,IAAA89B,WAxjCA,GAAA1Q,GAAAxtB,IAIAwtB,GAAAkD,cAAAA,cACAlD,EAAAmD,YAAAA,YACAnD,EAAAkL,eAAAA,eACAlL,EAAAwL,kBAAAA,kBACAxL,EAAA+L,YAAAA,YACA/L,EAAAoM,YAAAA,YACApM,EAAAsM,aAAAA,aACAtM,EAAAwM,aAAAA,aACAxM,EAAAgM,YAAAA,YACAhM,EAAAiN,oBAAAA,oBACAjN,EAAAmN,yBAAAA,yBACAnN,EAAAsN,wBAAAA,uBAIA;GAQA7D,YAAAC,SARAthB,QAAA4X,EAAA5X,QACA8c,QAAAlF,EAAAkF,QACA9B,aAAApD,EAAAoD,aAIAiJ,cAAA9gB,WACAue,SAAAuC,cAEAxC,eAAA,EACAE,iBAAA,EACA0C,aAAA,EACA9C,QAGAljB,GAAAyE,MACAvV,QAAA4V,QAAA5V,QAAA4V,YAAAnY,OAAAuC,QAAAi7B,kBACA,SAAAhgC,EAAAu6B,aACA,GAAA9O,QAAA+O,iBAAAD,YACA9O,SACAyN,QAAAh5B,KAAAurB,UAg0BA2D,EAAAiP,uBAAAA,uBA+CAjP,EAAAsP,oBAAAA,oBACAtP,EAAA4P,wBAAAA,wBACA5P,EAAA+P,2BAAAA,2BAoKA/P,EAAA6Q,cAAA,WACA,MAAAlH,QA4BA,QAAAuD,kBAAAzhB,OACAA,MAAAgjB,QAAAhjB,MAAAwR,OACAxR,MAAA8iB,OAAA9iB,MAAA9Y,MAAArC,QACAmb,MAAA+iB,KAAA/iB,MAAA7Y,IAAA6Y,MAAA7Y,IAAAtC,QAAA;CA3uTA,GAAA8oB,IAAA3S,EAAA0B,cAAA2oB,QAAA,SACAC,QAAA3X,GAAArL,QAGAtH,GAAAuqB,GAAA7oB,aAAA,SAAAxS,SACA,GAAAwE,MAAAhH,MAAAV,UAAAgC,MAAAsH,KAAAlJ,UAAA,GACAsK,IAAA3K,IA2BA,OAzBAA,MAAA0Y,KAAA,SAAAta,EAAA8xB,UACA,GAEAuO,WAFA5R,QAAA5Y,EAAAic,UACA8E,SAAAnI,QAAA1X,KAAA,eAIA,iBAAAhS,SACA6xB,UAAA/gB,EAAAgQ,WAAA+Q,SAAA7xB,YACAs7B,UAAAzJ,SAAA7xB,SAAA+X,MAAA8Z,SAAArtB,MACAvJ,IACAuM,IAAA8zB,WAEA,YAAAt7B,SACA0pB,QAAA6R,WAAA,iBAKA1J,WACAA,SAAA,GAAApO,IAAA+X,aAAA9R,QAAA1pB,SACA0pB,QAAA1X,KAAA,eAAA6f,UACAA,SAAAlI,YAIAniB,IAIA,IAAAoQ,iBACA,SACA,aACA,cACA,mBA8FA6L,IAAAzF,kBAAAA,kBACAyF,GAAA9C,SAAAA,SACA8C,GAAA9B,SAAAA,SACA8B,GAAApE,MAAAA,MACAoE,GAAAxC,WAAAA,WACAwC,GAAAtC,SAAAA,SACAsC,GAAAhC,MAAAA,MA4JAgC,GAAA7H,cAAAA,cACA6H,GAAAzH,eAAAA,eACAyH,GAAA5H,mBAAAA,kBAyFA;GAAAQ,sBAAA,IAwIAoH,IAAAvE,oBAAAA,oBACAuE,GAAAjE,gBAAAA,eAEA,IAiQAic,wBACAC,aACAC,eAnQAC,QAAA,MAAA,MAAA,MAAA,MAAA,MAAA,MAAA,OACAzc,eAAA,OAAA,QAAA,OAAA,MAAA,OAAA,SAAA,SAAA,eAwFAsB,oBAAAtb,eAmKAyd,sBAAA,kBACAC,qBACA,iGACAgZ,eAAA5qB,OAAAoqB,GACAvX,eAAAhT,EAAA8D,UAAAinB,eAaApY,IAAAxS,OAAA,WACA,MAAAkR,YAAAjlB,YAIAumB,GAAAxS,OAAA6R,IAAA,WACA,GAAAN,KAAAL,WAAAjlB,WAAA,EAQA;MAJAslB,KAAA0L,WACA1L,IAAAM,MAGAN,KAKAiB,GAAAxS,OAAAgF,UAAA,WACA,MAAAkM,YAAAjlB,WAAA,GAAA,IAgFA2+B,eAAAlhC,MAAA,WACA,GAAA6nB,KAAAsB,eAAAnpB,MAAAod,MAAAlb,KAAAK,UAQA,OALAylB,gBAAA9lB,KAAA2lB,KACA3lB,KAAAomB,gBACAT,IAAAS,eAAA,GAGAT,KAUAqZ,eAAAC,KAAAD,eAAAE,MAAA,SAAA9jB,OACA,GAAAsY,WAAA1zB,KAAA8zB,SAAA9zB,KAAA+zB,OACAN,sBAEA,OAAA,OAAArY,OAAA,kBAAAsY,UACAA,SAAA1zB,MAEA,QAAA0zB,SACAzM,eAAAkY,QAAAjkB,MAAAlb,KAAAK,WAGA4mB,eAAAgY,KAAA/jB,MAAAlb,KAAAK,YAcA2+B,eAAAthC,KAAA,SAAAA,MAIA,IAAAsC,KAAAomB,cACA,MAAAa,gBAAAvpB,KAAAwd,MAAAlb,KAAAK,UAGA,IAAA,MAAA3C,KACA,MAAA0W,QAAA2N,UACAc,MAAA7iB,KAAA6iB,QACAC,QAAA9iB,KAAA8iB,UACAC,QAAA/iB,KAAA+iB,UACAC,aAAAhjB,KAAAgjB,gBAKAhjB;KAAAkmB,YAAA,EAEA9R,OAAAqO,WAAA/kB,OAAA0W,OAAAyR,SAAAnoB,QACAA,KAAA0W,OAAA2N,SAAArkB,MAKA,IAAA0hC,UAAA,CAOA,OANAhrB,QAAAqO,WAAA/kB,QACA0hC,SAAA,GAAAnjC,KAAAgF,MAAAvD,KAAA2hC,WAKAr/B,KAAA6iB,MAAAuc,SAAA1hC,KAAAmlB,SACAC,QAAAplB,KAAAolB,WACAC,QAAArlB,KAAAqlB,WACAC,aAAAtlB,KAAAslB,iBAOAgc,eAAAhd,UAAA,WACA,GAAAxjB,EAiBA,OAfAwB,MAAAkmB,aAGA1nB,EAAAwB,KAAAk0B,UAGAl0B,KAAAimB,MACA4Y,aAAA7+B,KAAAxB,EAAAyD,MAAA,EAAA,IAIAjC,KAAAkmB,YAAA,EACAlmB,KAAAkX,YAAA,GAGAlX,MAIAg/B,eAAA3N,QAAA,WACA,OAAArxB,KAAAkmB,YAWA8Y,eAAAnY,UAAA,WACA,GAAAroB,GAAA8gC,YAmBA,OAjBAt/B,MAAAkX,aAGA1Y,EAAAwB,KAAAk0B,UACAoL,aAAAt/B,KAAAkmB,WAEAlmB,KAAAimB,MACA4Y,aAAA7+B,KAAAxB,GAGAwB,KAAAkmB,WAAAoZ,eAAA,EAIAt/B,KAAAkX,YAAA,GAGAlX;EAIAg/B,eAAAO,QAAA,WACA,OAAAv/B,KAAAkX,YAKA8nB,eAAAnL,MAAA,WACA,GAAAr1B,GAAAwB,KAAAk0B,UACAsL,aAAAx/B,KAAAkX,UAgBA,OAdA+P,gBAAA4M,MAAA3Y,MAAAlb,KAAAK,WAIAL,KAAAkmB,YAAA,EACAlmB,KAAAkX,YAAA,EAEAsoB,cAIAV,eAAA9+B,KAAAxB,GAGAwB,MAKAg/B,eAAA/Y,IAAA,WAQA,MAPAgB,gBAAAhB,IAAA/K,MAAAlb,KAAAK,WAIAL,KAAAkmB,YAAA,EACAlmB,KAAAkX,YAAA,EAEAlX,MAMAiU,EAAAyE,MACA,OACA,aACA,SAAAta,EAAA0T,MACAmV,eAAAnV,QAGAktB,eAAAltB,MAAA,SAAA2tB,KASA,MAPA,OAAAA,MAGAz/B,KAAAkmB,YAAA,EACAlmB,KAAAkX,YAAA,GAGA+P,eAAAnV,MAAAoJ,MAAAlb,KAAAK,eASA2+B,eAAAnoB,OAAA,WACA,MAAA7W,MAAAomB,eAAA/lB,UAAA,GACA6mB,WAAAlnB,KAAAK,UAAA,IAEAL,KAAAkmB,WACAa,gBAAA/mB,KAAA,cAEAA,KAAAkX,WACA6P,gBAAA/mB,KAAA,yBAEAinB,eAAApQ,OAAAqE,MAAAlb,KAAAK;EAGA2+B,eAAAU,YAAA,WACA,MAAA1/B,MAAAkmB,WACAa,gBAAA/mB,KAAA,cAEAA,KAAAkX,WACA6P,gBAAA/mB,KAAA,yBAEAinB,eAAAyY,YAAAxkB,MAAAlb,KAAAK,YASA2+B,eAAA7P,SAAA,SAAAhvB,MAAAC,KACA,GAAA5B,GAAA6nB,mBAAArmB,KAAAG,MAAAC,KACA,OAAA5B,GAAA,IAAAA,EAAA,IAAAA,EAAA,GAAAA,EAAA,IAKAwgC,eAAAlW,OAAA,SAAA1N,MAAAukB,OACA,GAAAnhC,EAGA,OAAAwB,MAAAomB,cAIAuZ,OACAnhC,EAAA6nB,mBAAArmB,KAAAob,QAAA,GACA6L,eAAA6B,OAAAvf,KAAA/K,EAAA,GAAAA,EAAA,GAAAmhC,SAGAvkB,MAAAwL,GAAAxS,OAAAgF,UAAAgC,OACA6L,eAAA6B,OAAAvf,KAAAvJ,KAAAob,QACA/Z,QAAArB,KAAAkmB,cAAA7kB,QAAA+Z,MAAA8K,aACA7kB,QAAArB,KAAAkX,cAAA7V,QAAA+Z,MAAAlE,aAXA+P,eAAA6B,OAAA5N,MAAAlb,KAAAK;EAgBA4T,EAAAyE,MACA,WACA,WACA,SAAAta,EAAAymB,YACAma,eAAAna,YAAA,SAAAzJ,MAAAukB,OACA,GAAAnhC,EAGA,OAAAwB,MAAAomB,eAIA5nB,EAAA6nB,mBAAArmB,KAAAob,QACA6L,eAAApC,YAAAtb,KAAA/K,EAAA,GAAAA,EAAA,GAAAmhC,QAJA1Y,eAAApC,YAAA3J,MAAAlb,KAAAK,cAiFAu+B,uBAAA,MAAAxqB,WAAA,gBAAAA,QAIAyqB,aAAAD,uBAAA,SAAAjZ,IAAAnnB,GAEAmnB,IAAAia,GAAAC,QAAApkC,KAAAkE,IAAAub,MAAAzf,KAAA+C,IACA4V,OAAA0rB,aAAAna,KAAA,IACAmB,gBAIAgY,eAAAF,uBAAA,SAAAjZ,IAAAnnB,GAEAmnB,IAAAia,GAAAC,SAAA,GAAApkC,MACA+C,EAAA,IAAA,EACAA,EAAA,IAAA,EACAA,EAAA,IAAA,EACAA,EAAA,IAAA,EACAA,EAAA,IAAA,EACAA,EAAA,IAAA,EACAA,EAAA,IAAA,IAEA4V,OAAA0rB,aAAAna,KAAA,IACAmB,eAkCA,IAAAY,iBACA8F,EAAA,SAAA5xB,MACA,MAAAmrB,iBAAAnrB,KAAA,KAAA8oB,OAAA;EAEAqb,EAAA,SAAAnkC,MACA,MAAAmrB,iBAAAnrB,KAAA,KAAA8oB,OAAA,IA4DAkC,IAAAgB,YAAAA,WAqDA,IAAAiB,iBACAmX,EAAA,OACAC,EAAA,QACAC,EAAA,MACA/zB,EAAA,MAEAg0B,EAAA,SACA3hC,EAAA,SACAuhC,EAAA,SACAvS,EAAA,SACA4S,EAAA,SACA9zB,EAAA,SACAE,EAAA,SACAxJ,EAAA,UAgCA+lB,yBAqCAnC,IAAAsC,MAAAA,MAMAA,MAAAnR,OAAA,SAAAsoB,SACA,GACAC,UADAC,WAAAvgC,IAyBA,OAtBAqgC,SAAAA,YAGA5c,WAAA4c,QAAA,iBACAC,SAAAD,QAAAG,aAEA,kBAAAF,YACAA,SAAAD,QAAAG,YAAA,WACAD,WAAArlB,MAAAlb,KAAAK,aAKAigC,SAAArgC,UAAAmjB,aAAAmd,WAAAtgC,WAGAqjB,aAAA+c,QAAAC,SAAArgC,WACAyjB,kBAAA2c,QAAAC,SAAArgC,WAGAqjB,aAAAid,WAAAD,UAEAA;EAKApX,MAAAuX,MAAA,SAAAJ,SACA/c,aAAA+c,QAAApgC,WAAAogC,QAAArgC,KAAAC,WAkBA,IAAAygC,SAAAxX,MAAAnR,QAEA4oB,UAAA,EACAx9B,QAAA,KACAga,GAAA,KACAyjB,uBAAA,KACAC,OAAA,GAGAL,YAAA,SAAAr9B,SACAnD,KAAAmD,QAAAA,aAKA29B,KAAA,WACA9gC,KAAA2gC,WACA3gC,KAAAmd,IACAnd,KAAA8sB,SAEA9sB,KAAAmd,GAAA2jB,OACA9gC,KAAAse,WACAte,KAAA2gC,UAAA,EACA3gC,KAAA4V,QAAA,UAMAmrB,KAAA,WACA/gC,KAAA2gC,WACA3gC,KAAAmd,GAAA4jB,OACA/gC,KAAA2gC,UAAA,EACA3gC,KAAA4V,QAAA,UAMAkX,OAAA,WACA,GAAAkU,OAAAhhC,KACAmD,QAAAnD,KAAAmD,OAEAnD,MAAAmd,GAAAlJ,EAAA,6BACAkG,SAAAhX,QAAA2W,WAAA,IACAiC,KAEA8C,IAAA,EACA/C,KAAA,IAEAoZ,OAAA/xB,QAAA4pB,SACAjN,SAAA3c,QAAA89B,UAGAjhC,KAAAmd,GAAAjM,GAAA,QAAA,YAAA,WACA8vB,MAAAD;GAGA59B,QAAA+9B,UACAjtB,EAAA0K,UAAAzN,GAAA,YAAAlR,KAAA4gC,uBAAAhc,MAAA5kB,KAAA,uBAMAmhC,kBAAA,SAAA/gB,IAEApgB,KAAAmd,KAAAlJ,EAAAmM,GAAA6P,QAAAmR,QAAAphC,KAAAmd,IAAA9e,QACA2B,KAAA+gC,QAMA5S,QAAA,WACAnuB,KAAA+gC,OAEA/gC,KAAAmd,KACAnd,KAAAmd,GAAA6C,SACAhgB,KAAAmd,GAAA,MAGAlJ,EAAA0K,UAAA0iB,IAAA,YAAArhC,KAAA4gC,yBAKAtiB,SAAA,WACA,GAMAgjB,aACAC,aACAC,eACA3iB,IACA/C,KAVA3Y,QAAAnD,KAAAmD,QACAs+B,OAAAzhC,KAAAmd,GAAAukB,eAAAz1B,SACA8R,MAAA/d,KAAAmd,GAAAW,aACAP,OAAAvd,KAAAmd,GAAAG,cACAqkB,SAAA1tB,EAAAga,QACA2T,WAAAvjB,gBAAAre,KAAAmd,GAQA0B,KAAA1b,QAAA0b,KAAA,EAEA/C,KADApF,SAAAvT,QAAA2Y,KACA3Y,QAAA2Y,KAEApF,SAAAvT,QAAA+Y,MACA/Y,QAAA+Y,MAAA6B,MAGA,EAGA6jB,WAAArT,GAAAN,SAAA2T,WAAArT,GAAA5P,WACAijB,WAAAD,SACAL,YAAA,EACAC,aAAA,IAGAC,eAAAI,WAAA31B,SACAq1B,YAAAE,eAAA3iB,IACA0iB,aAAAC,eAAA1lB,MAIAwlB,aAAAK,SAAAE,YACAN,cAAAI,SAAAG,aAGA3+B,QAAA4+B,qBAAA,IACAljB,IAAA5iB,KAAA0kB,IAAA9B,IAAAyiB,YAAAM,WAAAtkB,cAAAC,OAAAvd,KAAA6gC,QACAhiB,IAAA5iB,KAAAykB,IAAA7B,IAAAyiB,YAAAthC,KAAA6gC,QACA/kB,KAAA7f,KAAA0kB,IAAA7E,KAAAylB,aAAAK,WAAA9jB,aAAAC,MAAA/d,KAAA6gC,QACA/kB,KAAA7f,KAAAykB,IAAA5E,KAAAylB,aAAAvhC,KAAA6gC,SAGA7gC,KAAAmd,GAAApB,KACA8C,IAAAA,IAAA4iB,OAAA5iB,IACA/C,KAAAA,KAAA2lB,OAAA3lB;EAQAlG,QAAA,SAAA9D,MACA9R,KAAAmD,QAAA2O,OACA9R,KAAAmD,QAAA2O,MAAAoJ,MAAAlb,KAAAW,MAAAV,UAAAgC,MAAAsH,KAAAlJ,UAAA,OAsBA2hC,aAAA9Y,MAAAnR,QAEAuR,KAAA,KACA2Y,UAAA,KACAC,UAAA,KAEAjkB,YAAA,KACAkkB,OAAA,KAGA3B,YAAA,SAAAlX,MACAtpB,KAAAspB,KAAAA,MAKA8Y,MAAA,WACApiC,KAAAiiC,UAAAjiC,KAAAspB,KAAA+Y,mBACAriC,KAAAkiC,UAAAliC,KAAAspB,KAAAgZ,mBACAtiC,KAAAuiC,iBAKAC,MAAA,WACAxiC,KAAAiiC,UAAA,KACAjiC,KAAAkiC,UAAA,MAKAO,QAAA,SAAAC,EAAA12B,GACA,GAMA5N,GAAAukC,OACAC,KAPAX,UAAAjiC,KAAAiiC,UACAY,OAAAZ,UAAA5jC,OACA6jC,UAAAliC,KAAAkiC,UACAY,OAAAZ,UAAA7jC,OACA0kC,OAAA,KACAC,OAAA,IAIA,IAAAhjC,KAAAijC,SAAAP,EAAA12B,GAAA,CAEA,IAAA5N,EAAA,EAAAykC,OAAAzkC,EAAAA,IAEA,GADAukC,OAAAV,UAAA7jC,GACA4N,GAAA22B,OAAA9jB,KAAA7S,EAAA22B,OAAA7jB,OAAA,CACAikB,OAAA3kC,CACA;MAIA,IAAAA,EAAA,EAAA0kC,OAAA1kC,EAAAA,IAEA,GADAukC,OAAAT,UAAA9jC,GACAskC,GAAAC,OAAA7mB,MAAA4mB,EAAAC,OAAAzmB,MAAA,CACA8mB,OAAA5kC,CACA,OAIA,GAAA,OAAA2kC,QAAA,OAAAC,OAQA,MANAJ,MAAA5iC,KAAAspB,KAAAmZ,QAAAM,OAAAC,QACAJ,KAAAtZ,KAAAtpB,KAAAspB,KAGArV,EAAA8D,OAAA6qB,KAAAX,UAAAc,QAAAb,UAAAc,SAEAJ,KAIA,MAAA,OAKAL,cAAA,WACAviC,KAAAmiC,OAAAniC,KAAAie,YACAc,cAAA/e,KAAAie,aACA,MAKAglB,SAAA,SAAAP,EAAA12B,GACA,GAAAm2B,QAAAniC,KAAAmiC,MAEA,OAAAA,QACAO,GAAAP,OAAArmB,MAAA4mB,EAAAP,OAAAjmB,OAAAlQ,GAAAm2B,OAAAtjB,KAAA7S,EAAAm2B,OAAArjB,QAGA,KASAokB,cAAAha,MAAAnR,QAEAorB,UAAA,KAGA3C,YAAA,SAAA2C,WACAnjC,KAAAmjC,UAAAA,WAKAf,MAAA,WACA,GACAhkC,GADA+kC,UAAAnjC,KAAAmjC,SAGA,KAAA/kC,EAAA,EAAAA,EAAA+kC,UAAA9kC,OAAAD,IACA+kC,UAAA/kC,GAAAgkC;EAMAK,QAAA,SAAAC,EAAA12B,GACA,GAEA5N,GAFA+kC,UAAAnjC,KAAAmjC,UACAP,KAAA,IAGA,KAAAxkC,EAAA,EAAAA,EAAA+kC,UAAA9kC,SAAAukC,KAAAxkC,IACAwkC,KAAAO,UAAA/kC,GAAAqkC,QAAAC,EAAA12B,EAGA,OAAA42B,OAKAJ,MAAA,WACA,GACApkC,GADA+kC,UAAAnjC,KAAAmjC,SAGA,KAAA/kC,EAAA,EAAAA,EAAA+kC,UAAA9kC,OAAAD,IACA+kC,UAAA/kC,GAAAokC,WAWAY,aAAAxc,GAAAwc,aAAAla,MAAAnR,QAEA5U,QAAA,KAEAkgC,aAAA,EACAC,YAAA,EAGAC,QAAA,KACAC,QAAA,KAGAC,eAAA,KACAC,aAAA,KAGAC,UAAA,KACAC,YAAA,KAEAC,SAAA,KACAC,aAAA,KACAC,aAAA,KACAC,cAAA,KACAC,iBAAA,KACAC,mBAAA,KAEAC,kBAAA,GACAC,YAAA,IACAC,iBAAA,GAGA7D,YAAA,SAAAr9B,SACAA,QAAAA,YACAnD,KAAAmD,QAAAA,QACAnD,KAAA2jC,UAAAxgC,QAAAwgC;EAKAhN,UAAA,SAAAvW,IACAD,qBAAAC,MAEAA,GAAAkkB,iBAEAtkC,KAAAukC,eAAAnkB,IAGApgB,KAAAmD,QAAAqhC,UACAxkC,KAAAykC,UAAArkB,MAOAmkB,eAAA,SAAAnkB,IACA,GAAA7B,aAEAve,MAAAqjC,cAGAjjB,IAAApgB,KAAAmD,QAAAuhC,SACAnmB,aAAAF,gBAAApK,EAAAmM,GAAA6P,SACA1R,aAAAgQ,GAAAN,SAAA1P,aAAAgQ,GAAA5P,YACA3e,KAAA6jC,SAAAtlB,aAGAve,KAAAkkC,mBAAApf,SAAAF,MAAA5kB,KAAA,iBAAA,KACAA,KAAA6jC,SAAA3yB,GAAA,SAAAlR,KAAAkkC,sBAIAjwB,EAAA0K,UACAzN,GAAA,YAAAlR,KAAAyjC,eAAA7e,MAAA5kB,KAAA,cACAkR,GAAA,UAAAlR,KAAA0jC,aAAA9e,MAAA5kB,KAAA,YACAkR,GAAA,cAAAlR,KAAAskC,gBAEAlkB,IACApgB,KAAAujC,QAAAnjB,GAAAukB,MACA3kC,KAAAwjC,QAAApjB,GAAAwkB,QAKA5kC,KAAAujC,QAAA,EACAvjC,KAAAwjC,QAAA,GAGAxjC,KAAAqjC,aAAA,EACArjC,KAAA6kC,YAAAzkB;EAMAykB,YAAA,SAAAzkB,IACApgB,KAAA4V,QAAA,cAAAwK,KAKA0kB,UAAA,SAAA1kB,IACA,GAEA2kB,aACAC,WAHAC,GAAA7kB,GAAAukB,MAAA3kC,KAAAujC,QACA2B,GAAA9kB,GAAAwkB,MAAA5kC,KAAAwjC,OAIAxjC,MAAAsjC,aAEAyB,YAAA/kC,KAAAmD,QAAAqhC,UAAA,EACAQ,WAAAC,GAAAA,GAAAC,GAAAA,GACAF,YAAAD,YAAAA,aACA/kC,KAAAykC,UAAArkB,KAIApgB,KAAAsjC,YACAtjC,KAAAmlC,KAAAF,GAAAC,GAAA9kB,KAOAqkB,UAAA,SAAArkB,IAEApgB,KAAAqjC,aACArjC,KAAAukC,iBAGAvkC,KAAAsjC,aACAtjC,KAAAsjC,YAAA,EACAtjC,KAAAolC,UAAAhlB,MAMAglB,UAAA,SAAAhlB,IACA,GAAAujB,WAAA3jC,KAAA2jC,SAEA3jC,MAAA4V,QAAA,YAAAwK,KAGApgB,KAAA4jC,YAAAD,UAAAA,UAAAz8B,KAAA,QAAA,OACAy8B,UAAA5M,WAAA,SAMAoO,KAAA,SAAAF,GAAAC,GAAA9kB,IACApgB,KAAA4V,QAAA,OAAAqvB,GAAAC,GAAA9kB,IACApgB,KAAAqlC,aAAAjlB;EAKAyW,QAAA,SAAAzW,IACApgB,KAAAslC,cAAAllB,KAMAmlB,SAAA,SAAAnlB,IACApgB,KAAAsjC,aACAtjC,KAAAwlC,gBACAxlC,KAAAylC,SAAArlB,IACApgB,KAAAsjC,YAAA,IAMAmC,SAAA,SAAArlB,IACA,GAAA4gB,OAAAhhC,IAEAA,MAAA4V,QAAA,WAAAwK,IAGAiF,WAAA,WACA2b,MAAA4C,aACA5C,MAAA2C,UAAAz8B,KAAA,OAAA85B,MAAA4C,cAEA,IAKA0B,cAAA,SAAAllB,IACApgB,KAAAulC,SAAAnlB,IAEApgB,KAAAqjC,cAGArjC,KAAA6jC,WACA7jC,KAAA6jC,SAAAxC,IAAA,SAAArhC,KAAAkkC,oBACAlkC,KAAAkkC,mBAAA,MAGAjwB,EAAA0K,UACA0iB,IAAA,YAAArhC,KAAAyjC,gBACApC,IAAA,UAAArhC,KAAA0jC,cACArC,IAAA,cAAArhC,KAAAskC,gBAEAtkC,KAAAyjC,eAAA,KACAzjC,KAAA0jC,aAAA,KAEA1jC,KAAAqjC,aAAA,EACArjC,KAAA0lC,WAAAtlB;EAMAslB,WAAA,SAAAtlB,IACApgB,KAAA4V,QAAA,aAAAwK,KAMAxK,QAAA,SAAA9D,MACA9R,KAAAmD,QAAA2O,OACA9R,KAAAmD,QAAA2O,MAAAoJ,MAAAlb,KAAAW,MAAAV,UAAAgC,MAAAsH,KAAAlJ,UAAA,KAMAikC,eAAA,SAAAlkB,IACAA,GAAAkkB,kBASAqB,oBAAA,WACA,GAAAxoB,IAAAnd,KAAA6jC,QAEA7jC,MAAA8jC,aAAA3mB,GAAAyB,aAAAzB,IAAA,MAMAkoB,aAAA,SAAAjlB,IACA,GAEAwlB,cAAAC,gBACAC,cAAAC,eAHAC,YAAAhmC,KAAAmkC,kBACAhC,OAAAniC,KAAA8jC,aAGAmC,OAAA,EACAC,QAAA,CAEA/D,UAGAyD,cAAAI,aAAA5lB,GAAAwkB,MAAAzC,OAAAtjB,MAAAmnB,YACAH,iBAAAG,aAAA7D,OAAArjB,OAAAsB,GAAAwkB,QAAAoB,YACAF,eAAAE,aAAA5lB,GAAAukB,MAAAxC,OAAArmB,OAAAkqB,YACAD,gBAAAC,aAAA7D,OAAAjmB,MAAAkE,GAAAukB,QAAAqB,YAIAJ,cAAA,GAAA,GAAAA,aACAK,OAAAL,aAAA5lC,KAAAokC,YAAA,GAEAyB,iBAAA,GAAA,GAAAA,kBACAI,OAAAJ,gBAAA7lC,KAAAokC,aAIA0B,eAAA,GAAA,GAAAA,cACAI,QAAAJ,cAAA9lC,KAAAokC,YAAA,GAEA2B,gBAAA,GAAA,GAAAA,iBACAG,QAAAH,eAAA/lC,KAAAokC,cAIApkC,KAAAmmC,aAAAF,OAAAC;EAKAC,aAAA,SAAAF,OAAAC,SAEAlmC,KAAA+jC,aAAAkC,OACAjmC,KAAAgkC,cAAAkC,QAEAlmC,KAAAomC,sBAGApmC,KAAA+jC,eAAA/jC,KAAAgkC,eAAAhkC,KAAAikC,mBACAjkC,KAAAikC,iBAAAoC,YACAzhB,MAAA5kB,KAAA,sBACAA,KAAAqkC,oBAOA+B,mBAAA,WACA,GAAAjpB,IAAAnd,KAAA6jC,QAEA7jC,MAAA+jC,aAAA,EACA5mB,GAAA0kB,aAAA,IACA7hC,KAAA+jC,aAAA,GAGA/jC,KAAA+jC,aAAA,GACA5mB,GAAA0kB,YAAA1kB,GAAA,GAAAgB,cAAAhB,GAAA,GAAAe,eACAle,KAAA+jC,aAAA,GAIA/jC,KAAAgkC,cAAA,EACA7mB,GAAA2kB,cAAA,IACA9hC,KAAAgkC,cAAA,GAGAhkC,KAAAgkC,cAAA,GACA7mB,GAAA2kB,aAAA3kB,GAAA,GAAA+B,aAAA/B,GAAA,GAAAmpB,cACAtmC,KAAAgkC,cAAA,IAOAuC,mBAAA,WACA,GAAAppB,IAAAnd,KAAA6jC,SACA2C,KAAAxmC,KAAAqkC,iBAAA,GAGArkC;KAAA+jC,cACA5mB,GAAA0kB,UAAA1kB,GAAA0kB,YAAA7hC,KAAA+jC,aAAAyC,MAEAxmC,KAAAgkC,eACA7mB,GAAA2kB,WAAA3kB,GAAA2kB,aAAA9hC,KAAAgkC,cAAAwC,MAGAxmC,KAAAomC,qBAGApmC,KAAA+jC,cAAA/jC,KAAAgkC,eACAhkC,KAAAwlC,iBAMAA,cAAA,WACAxlC,KAAAikC,mBACAwC,cAAAzmC,KAAAikC,kBACAjkC,KAAAikC,iBAAA,KAGAjkC,KAAA0mC,eAMAC,cAAA,WAEA3mC,KAAAikC,kBACAjkC,KAAA0mC,cAMAA,WAAA,eAcAE,iBAAAxD,aAAArrB,QAEA8uB,SAAA,KACAC,SAAA,KACAlE,KAAA,KACAmE,YAAA,KAGAvG,YAAA,SAAAqG,SAAA1jC,SACAigC,aAAAnjC,UAAAugC,YAAAj3B,KAAAvJ,KAAAmD,SAEAnD,KAAA6mC,SAAAA;EAMAhC,YAAA,SAAAzkB,IACA,GACA4mB,aACAC,UACApmB,MAHA8iB,UAAA3jC,KAAA2jC,SAKAP,cAAAnjC,UAAA4kC,YAAA3pB,MAAAlb,KAAAK,WAEAL,KAAAknC,gBAEA9mB,IACA6mB,WAAAnrB,KAAAsE,GAAAukB,MAAA9lB,IAAAuB,GAAAwkB,OACA/jB,MAAAomB,UAGAtD,YACAqD,YAAApoB,aAAA+kB,WACA9iB,MAAAD,eAAAC,MAAAmmB,cAGAhnC,KAAA8mC,SAAA9mC,KAAAyiC,QAAA5hB,MAAA/E,KAAA+E,MAAAhC,KAGA8kB,WAAA3jC,KAAAmD,QAAAgkC,gBAGAnnC,KAAA8mC,WACAE,YAAAzmB,eAAAvgB,KAAA8mC,SAAAE,cACAA,aAGAnmB,MAAAE,cAAAimB,cAGAhnC,KAAA+mC,YAAA/lB,WAAAH,MAAAomB,aAGAjnC,KAAA8mC,SAAA,KACA9mC,KAAA+mC,YAAA,OAMAG,cAAA,WACAlnC,KAAA6mC,SAAAzE,QACApiC,KAAA2lC;EAKAP,UAAA,SAAAhlB,IACA,GAAAwiB,KAEAQ,cAAAnjC,UAAAmlC,UAAAlqB,MAAAlb,KAAAK,WAEAuiC,KAAA5iC,KAAAyiC,QAAAriB,GAAAukB,MAAAvkB,GAAAwkB,OAIAhC,MACA5iC,KAAAonC,SAAAxE,OAMAuC,KAAA,SAAAF,GAAAC,GAAA9kB,IACA,GAAAwiB,KAEAQ,cAAAnjC,UAAAklC,KAAAjqB,MAAAlb,KAAAK,WAEAuiC,KAAA5iC,KAAAyiC,QAAAriB,GAAAukB,MAAAvkB,GAAAwkB,OAEAzb,aAAAyZ,KAAA5iC,KAAA4iC,QACA5iC,KAAA4iC,MACA5iC,KAAAqnC,UAEAzE,MACA5iC,KAAAonC,SAAAxE,QAOA6C,SAAA,WACAzlC,KAAAsnC,WACAlE,aAAAnjC,UAAAwlC,SAAAvqB,MAAAlb,KAAAK,YAKA+mC,SAAA,SAAAxE,MACA5iC,KAAA4iC,KAAAA,KACA5iC,KAAA4V,QAAA,WAAAgtB,KAAAzZ,aAAAyZ,KAAA5iC,KAAA8mC,UAAA9mC,KAAA8mC,WAKAO,QAAA,WACArnC,KAAA4iC,OACA5iC,KAAA4V,QAAA,UAAA5V,KAAA4iC,MACA5iC,KAAAsnC,WACAtnC,KAAA4iC,KAAA,OAMA0E,SAAA,WACAtnC,KAAA4iC,MACA5iC,KAAA4V,QAAA,WAAA5V,KAAA4iC;EAMA8C,WAAA,WACAtC,aAAAnjC,UAAAylC,WAAAxqB,MAAAlb,KAAAK,WAEAL,KAAA8mC,SAAA9mC,KAAA4iC,KAAA,KACA5iC,KAAA6mC,SAAArE,SAKAkE,WAAA,WACAtD,aAAAnjC,UAAAymC,WAAAxrB,MAAAlb,KAAAK,WAEAL,KAAAknC,iBAKAzE,QAAA,SAAA3mB,KAAA+C,KAOA,MALA7e,MAAA+mC,cACAjrB,MAAA9b,KAAA+mC,YAAAjrB,KACA+C,KAAA7e,KAAA+mC,YAAAloB,KAGA7e,KAAA6mC,SAAApE,QAAA3mB,KAAA+C,QA6BA0oB,cAAAre,MAAAnR,QAEA5U,QAAA,KAEAqkC,SAAA,KACArqB,GAAA,KACA8jB,SAAA,KAGAwG,KAAA,KACAC,MAAA,KAGAC,QAAA,KACAC,QAAA,KAGAC,SAAA,KACAC,UAAA,KAEArE,eAAA,KAEAsE,aAAA,EACApH,UAAA,EACAqH,aAAA,EAEAxH,YAAA,SAAAgH,SAAArkC,SACAnD,KAAAmD,QAAAA,QAAAA,YACAnD,KAAAwnC,SAAAA,SACAxnC,KAAAihC,SAAA99B,QAAA89B,SAAAhtB,EAAA9Q,QAAA89B,UAAAuG,SAAA3xB;EAKA1V,MAAA,SAAAigB,IACApgB,KAAA+nC,cACA/nC,KAAA+nC,aAAA,EAEA/nC,KAAA2nC,QAAAvnB,GAAAwkB,MACA5kC,KAAA4nC,QAAAxnB,GAAAukB,MACA3kC,KAAA6nC,SAAA,EACA7nC,KAAA8nC,UAAA,EAEA9nC,KAAA2gC,UACA3gC,KAAAioC,iBAGAh0B,EAAA0K,UAAAzN,GAAA,YAAAlR,KAAAyjC,eAAA7e,MAAA5kB,KAAA,gBAOAkW,KAAA,SAAAgyB,aAAAz4B,UAIA,QAAA4oB,YACAr4B,KAAAgoC,aAAA,EACAhH,MAAAmH,YAEAnoC,KAAAynC,KAAAznC,KAAA0nC,MAAA,KAEAj4B,UACAA,WAVA,GAAAuxB,OAAAhhC,KACAooC,eAAApoC,KAAAmD,QAAAilC,cAaApoC,MAAA+nC,cAAA/nC,KAAAgoC,cACAhoC,KAAA+nC,aAAA,EAEA9zB,EAAA0K,UAAA0iB,IAAA,YAAArhC,KAAAyjC,gBAEAyE,cAAAE,iBAAApoC,KAAA2gC,UACA3gC,KAAAgoC,aAAA,EACAhoC,KAAAmd,GAAAkrB,SACAxpB,IAAA7e,KAAAynC,KACA3rB,KAAA9b,KAAA0nC,QAEA3lB,SAAAqmB,eACA/P,SAAAA,YAIAA;EAOAiQ,MAAA,WACA,GAAAnrB,IAAAnd,KAAAmd,EAoBA,OAlBAA,MACAnd,KAAAwnC,SAAAzpB,QACAZ,GAAAnd,KAAAmd,GAAAnd,KAAAwnC,SAAA1pC,QACAie,KACAuC,SAAA,WACAiqB,WAAA,GACAjZ,QAAAtvB,KAAA2gC,SAAA,OAAA,GACAE,OAAA,EACA3kB,MAAA,OACA4C,OAAA,OACAf,MAAA/d,KAAAwnC,SAAAzpB,QACAR,OAAAvd,KAAAwnC,SAAAjqB,SACAirB,QAAAxoC,KAAAmD,QAAAqlC,SAAA,GACAC,OAAAzoC,KAAAmD,QAAAslC,SAEA3oB,SAAA9f,KAAAihC,WAGA9jB,IAKAgrB,UAAA,WACAnoC,KAAAmd,KACAnd,KAAAmd,GAAA6C,SACAhgB,KAAAmd,GAAA,OAMA8qB,eAAA,WACA,GAAAS,cACAjH,MAEAzhC,MAAAsoC,QAGA,OAAAtoC,KAAAynC,OACAznC,KAAAwnC,SAAAzpB,QACA2qB,aAAA1oC,KAAAwnC,SAAAv7B,SACAw1B,OAAAzhC,KAAAmd,GAAAukB,eAAAz1B,SACAjM,KAAAynC,KAAAiB,aAAA7pB,IAAA4iB,OAAA5iB,IACA7e,KAAA0nC,MAAAgB,aAAA5sB,KAAA2lB,OAAA3lB,MAGA9b,KAAAmd,GAAApB,KACA8C,IAAA7e,KAAAynC,KAAAznC,KAAA6nC,SACA/rB,KAAA9b,KAAA0nC,MAAA1nC,KAAA8nC;EAMAhD,UAAA,SAAA1kB,IACApgB,KAAA6nC,SAAAznB,GAAAwkB,MAAA5kC,KAAA2nC,QACA3nC,KAAA8nC,UAAA1nB,GAAAukB,MAAA3kC,KAAA4nC,QAEA5nC,KAAA2gC,UACA3gC,KAAAioC,kBAMAlH,KAAA,WACA/gC,KAAA2gC,WACA3gC,KAAA2gC,UAAA,EACA3gC,KAAAmd,IACAnd,KAAAmd,GAAA4jB,SAOAD,KAAA,WACA9gC,KAAA2gC,WACA3gC,KAAA2gC,UAAA,EACA3gC,KAAAioC,iBACAjoC,KAAAsoC,QAAAxH,WAaA6H,YAAAzf,MAAAnR,QAEA6W,KAAA,KACA9G,MAAA,KACA8gB,SAAA,QAGApI,YAAA,SAAA5R,MACA5uB,KAAA4uB,KAAAA,KACA5uB,KAAA8nB,MAAA8G,KAAAia,IAAA,UAOAC,QAAA,SAAAC,QAAAxf,KACA,GAEAC,KACAoZ,KAHAoG,WAAAhpC,KAAAipC,gBAAA,OAAAF,SACAG,YAAA,EAMA,KAFA3f,IAAAA,KAAA,EAEAC,IAAA,EAAAA,IAAAxpB,KAAA8iC,OAAAtZ,MACAoZ,KAAA5iC,KAAAyiC,QAAAlZ,IAAAC,KACA0f,aAAAF,WAAApG,KAKA,OAFAsG,aAAAlpC,KAAAmpC,aAAAD,YAAAH,QAAAxf,KAEA,OAAA2f,YAAA;EAQAC,aAAA,SAAAC,MAAAL,QAAAxf,KACA,GAAA8f,OAAArpC,KAAAipC,gBAAA,QAAAF,SAAAxf,KAAA,GACA+f,MAAAtpC,KAAAipC,gBAAA,QAAAF,SAAAxf,KAAA,GACAggB,YAAAvpC,KAAA8nB,MAAAwhB,MAAAD,MACAG,WAAAxpC,KAAA8nB,MAAAuhB,MAAAC,KAEA,OAAA,gBAAAF,OACAG,YAAAH,MAAAI,WAGAJ,MAAAzb,QAAA4b,aAAArU,OAAAsU,aASAP,gBAAA,SAAAQ,aAAAV,SACA,GACAW,aACAC,aACAC,SACAC,SAJAjb,KAAA5uB,KAAA4uB,IAwBA,OAlBA8a,aAAAD,aAAA,OACAV,UACAY,aAAAZ,QAAAtkB,sBAAAglB,cAAA,QAGAE,eAAAE,SAAAjb,KAAA+a,eACAC,SAAAhb,KAEA+a,eAAAE,SAAA7pC,KAAA2pC,eACAC,SAAA5pC,MAEA6pC,SAAAjb,KAAA8a,cACAE,SAAAhb,MAEAib,SAAA7pC,KAAA0pC,gBACAE,SAAA5pC,MAGA,kBAAA6pC,UACA,WACA,MAAAA,UAAA3uB,MAAA0uB,SAAAvpC,YAAA;EAKA,WACA,MAAAwpC,WAAA,OAWAC,KAAAljB,GAAAkjB,KAAAnB,YAAA5wB,QAEA5X,MAAA,KACAC,IAAA,KAEAyiC,OAAA,EACAC,OAAA,EACAiH,QAAA,KACAC,QAAA,KAEA7sB,GAAA,KACA0pB,SAAA,KACAoD,UAAA,KAEAC,uBAAA,KAGAC,cAAA,KACAC,gBAAA,KACAC,iBAAA,KACAC,gBAAA,KAIAC,aAAA,KAIAlP,UAAA,KAGAmF,YAAA,WACAmI,YAAAztB,MAAAlb,KAAAK,WAEAL,KAAA6mC,SAAA,GAAA7E,cAAAhiC,MACAA,KAAAiqC,aACAjqC,KAAAkqC,uBAAAtlB,MAAA5kB,KAAA,sBAUAwqC,qBAAA,aAMAC,uBAAA,WACA,MAAAzqC,MAAA4uB,KAAAia,IAAA,oBAMA6B,wBAAA,WACA,OAAA,GAKAC,uBAAA,WACA,OAAA;EASAC,SAAA,SAAA1qC,OACA,GACAmqC,kBACAC,gBAFA1b,KAAA5uB,KAAA4uB,IAIA5uB,MAAAG,MAAAD,MAAAC,MAAArC,QACAkC,KAAAI,IAAAF,MAAAE,IAAAtC,QAEAkC,KAAA+pC,WACA/pC,KAAAgqC,WACAhqC,KAAA6qC,cAGA7qC,KAAAmqC,cAAAvb,KAAAia,IAAA,iBAAA7oC,KAAAwqC,uBAEAxqC,KAAAoqC,gBACAxb,KAAAia,IAAA,oBACAja,KAAAia,IAAA,eACA7oC,KAAAyqC,yBAEAJ,iBAAAzb,KAAAia,IAAA,oBACA,MAAAwB,mBACAA,iBAAArqC,KAAA0qC,2BAGAJ,gBAAA1b,KAAAia,IAAA,mBACA,MAAAyB,kBACAA,gBAAAtqC,KAAA2qC,0BAGA3qC,KAAAqqC,iBAAAA,iBACArqC,KAAAsqC,gBAAAA;EAKAO,YAAA,aAMAC,YAAA,aAMAxP,UAAA,SAAA98B,EAAAC,GACA,MAAAuB,MAAAq7B,UACAlZ,WAAA3jB,EAAAC,EAAAuB,KAAAq7B,WAGAvZ,YAAAtjB,EAAAC,IAYAgkC,QAAA,SAAAlZ,IAAAC,KACA,GAAAoZ,KAkBA,OAhBA,OAAApZ,MACA,gBAAAD,MACAC,IAAAD,IAAAvpB,KAAA8iC,OACAvZ,IAAAttB,KAAAgF,MAAAsoB,IAAAvpB,KAAA8iC,UAGAtZ,IAAAD,IAAAC,IACAD,IAAAA,IAAAA,MAIAqZ,MAAArZ,IAAAA,IAAAC,IAAAA,KAEAvV,EAAA8D,OAAA6qB,KAAA5iC,KAAA+qC,WAAAxhB,KAAAvpB,KAAAgrC,WAAAxhB,MACAvV,EAAA8D,OAAA6qB,KAAA5iC,KAAAirC,iBAAArI,OAEAA,MAOAqI,iBAAA,SAAArI,MACA,GAAAhnC,MAAAoE,KAAAkrC,gBAAAtI,KAEA,QACAziC,MAAAvE,KACAwE,IAAAxE,KAAAkC,QAAAiQ,IAAA/N,KAAAuqC,gBAMAW,gBAAA,aAMAH,WAAA,SAAAxhB,KACA,MAAAvpB,MAAA+pC,QAAAxgB,UAKAyhB,WAAA,SAAAxhB,KACA,MAAAxpB,MAAAgqC,QAAAxgB;EAKA2hB,SAAA,aAMAC,SAAA,aAMAC,aAAA,SAAAzI,MACA,MAAA5iC,MAAAorC,SAAAxI,KAAApZ,MAAAxpB,KAAAmrC,SAAAvI,KAAArZ,MAUA8Y,iBAAA,WACA,GACAjkC,GAAA+e,GACA0B,IAFAysB,QAIA,KAAAltC,EAAA,EAAAA,EAAA4B,KAAA6iC,OAAAzkC,IACA+e,GAAAnd,KAAAmrC,SAAA/sC,GACAygB,IAAA1B,GAAAlR,SAAA4S,IACAysB,MAAAhtC,MACAugB,IAAAA,IACAC,OAAAD,IAAA1B,GAAAG,eAIA,OAAAguB,QAMAhJ,iBAAA,WACA,GACAlkC,GAAA+e,GACArB,KAFAwvB,QAIA,KAAAltC,EAAA,EAAAA,EAAA4B,KAAA8iC,OAAA1kC,IACA+e,GAAAnd,KAAAorC,SAAAhtC,GACA0d,KAAAqB,GAAAlR,SAAA6P,KACAwvB,MAAAhtC,MACAwd,KAAAA,KACAI,MAAAJ,KAAAqB,GAAAW,cAIA,OAAAwtB,QAUAvc,WAAA,SAAA5R,IACA,GAAA6jB,OAAAhhC,IAEAA,MAAAmd,GAAAA,GAIAA,GAAAjM,GAAA,YAAA,SAAAkP,IAEAnM,EAAAmM,GAAA6P,QAAA1B,GAAA,oCACAta,EAAAmM,GAAA6P,QAAAmR,QAAA,eAAA/iC,QAEA2iC,MAAAuK,aAAAnrB;GAMApgB,KAAAwrC,kBAEAxrC,KAAAyrC,sBAMApd,cAAA,WACAruB,KAAA0rC,uBAEA1rC,KAAAmd,GAAA6C,UAOA2rB,eAAA,aAOAC,YAAA,aAMAC,aAAA,aAUAJ,mBAAA,WACAx3B,EAAA0K,UAAAzN,GAAA,sBAAAlR,KAAAkqC,yBAKAwB,qBAAA,WACAz3B,EAAA0K,UAAA0iB,IAAA,sBAAArhC,KAAAkqC,yBAKAqB,aAAA,SAAAnrB,IACA,GAGA0rB,cACAC,eAJA/K,MAAAhhC,KACA4uB,KAAA5uB,KAAA4uB,KACAod,aAAApd,KAAAia,IAAA,cAOAoD,aAAA,GAAArF,kBAAA5mC,KAAA6mC,UAEAnC,OAAA9V,KAAAia,IAAA,cACAzD,UAAA,WACAxW,KAAA4C,YAEA4V,SAAA,SAAAxE,KAAAsJ,OAAApF,UACAA,WACAgF,aAAAI,OAAAtJ,KAAA,KACAoJ,eACAD,eAAA/K,MAAAmL,iBAAArF,SAAAlE,MACAmJ,eACA/K,MAAAoL,gBAAAL,gBAGAzvB;EAKA+qB,QAAA,WACAyE,aAAA,KACAC,eAAA,KACA/K,MAAAqL,mBACA9vB,gBAEAmpB,WAAA,SAAAtlB,IACA0rB,cACAld,KAAAhZ,QAAA,WAAAorB,MAAAqK,aAAAS,cAAAA,aAAA3rC,MAAAigB,IAEA2rB,gBAEAnd,KAAA0d,gBAAAP,eAAA3rB,IAEA7D,iBAIA0vB,cAAAtV,UAAAvW,KAUAmsB,kBAAA,SAAArsC,MAAAssC,WACA,GAAAC,WAAAzsC,KAAA0sC,qBAAAxsC,MAAAssC,UAEAxsC,MAAA2sC,aAAAF,UAAAD,YAOAE,qBAAA,SAAAxsC,MAAAssC,WACA,GAAAC,WAAAD,UAAAppB,aAAAopB,UAAAvzB,SAeA,OAbAwzB,WAAAtsC,MAAAD,MAAAC,MAAArC,QACA2uC,UAAArsC,IAAAF,MAAAE,IAAAF,MAAAE,IAAAtC,QAAA,KACA2uC,UAAAhiB,OAAA,KACAzqB,KAAA4uB,KAAAoG,SAAAyF,oBAAAgS,WAGAA,UAAA3yB,WAAA2yB,UAAA3yB,eAAAlZ,OAAA,aAGA4rC,YACAC,UAAAG,UAAA,GAGAH;EAKAE,aAAA,aAMAE,cAAA,aAUAT,gBAAA,SAAAlsC,OACAF,KAAA8sC,gBAAA5sC,QAKAmsC,iBAAA,WACArsC,KAAA+sC,oBAOAZ,iBAAA,SAAAa,UAAAC,UACA,GAMA/sC,OANAhC,OACA8uC,UAAA7sC,MACA6sC,UAAA5sC,IACA6sC,SAAA9sC,MACA8sC,SAAA7sC,IAWA,OAPAlC,OAAAK,KAAAomB,gBAEAzkB,OACAC,MAAAjC,MAAA,GAAAJ,QACAsC,IAAAlC,MAAA,GAAAJ,SAGAkC,KAAA4uB,KAAAoG,SAAAoI,wBAAAl9B,OAIAA,MAHA,MAYA4sC,gBAAA,SAAA5sC,OACAF,KAAAktC,WAAA,YAAAltC,KAAA8qC,YAAA5qC,SAKA6sC,iBAAA,WACA/sC,KAAAmtC,YAAA,cAKAC,oBAAA,WACA,OAAA,iBAWAF,WAAA,aAMAC,YAAA,SAAAj4B,MACA,GAAAiI,IAAAnd,KAAAiqC,UAAA/0B,KAEAiI;KACAA,GAAA6C,eACAhgB,MAAAiqC,UAAA/0B,QASAm4B,iBAAA,SAAAn4B,KAAAuW,MACA,GAIArtB,GAJA4iC,MAAAhhC,KACAstC,YAAAttC,KAAAkV,KAAA,SACAq4B,KAAA,GACAC,eAGA,IAAA/hB,KAAAptB,OAAA,CAGA,IAAAD,EAAA,EAAAA,EAAAqtB,KAAAptB,OAAAD,IACAmvC,MAAAvtC,KAAAytC,YAAAv4B,KAAAuW,KAAArtB,GAKA6V,GAAAs5B,MAAA70B,KAAA,SAAAta,EAAAsvC,MACA,GAAAxiB,KAAAO,KAAArtB,GACA+e,GAAAlJ,EAAAy5B,KAGAJ,eACAnwB,GAAAmwB,YAAA/jC,KAAAy3B,MAAA9V,IAAA/N,KAGAA,KACAA,GAAAlJ,EAAAkJ,IAGAA,GAAAoR,GAAAyS,MAAA2M,cACAziB,IAAA/N,GAAAA,GACAqwB,aAAAlvC,KAAA4sB,SAMA,MAAAsiB,eAIAG,WAAA,MAIAF,YAAA,SAAAv4B,KAAAgW,KAGA,GAAA0iB,eAAA5tC,KAAAkV,KAAA,cACA24B,UAAA7tC,KAAAkV,KAAA,UAEA+gB,QAAA2X,cAAAA,cAAArkC,KAAAvJ,KAAAkrB,QACAnP,IAAAuI,SAAAupB,UAAAA,UAAAtkC,KAAAvJ,KAAAkrB,QAEA,OAAA,IAAAlrB,KAAA2tC,YACA1X,QAAA53B,OAAA,WAAA43B,QAAA52B,KAAA,KAAA,IAAA,KACA0c,IAAA,WAAAA,IAAA,IAAA,IACA;EAUA+xB,SAAA,WACA,MAAA,sBACA9tC,KAAA4uB,KAAAmf,kBAAA,mBAGA/tC,KAAA8oC,QAAA,QACA,0BAQAkF,aAAA,SAAApL,MACA,GAAAhU,MAAA5uB,KAAA4uB,KACAhzB,KAAAgnC,KAAAziC,KAEA,OAAA,4BACAyuB,KAAAmf,kBAAA,OAAAhP,OAAAnjC,KAAA8M,OAAA,KACA0b,WAAAxoB,KAAAib,OAAA7W,KAAAmqC,gBACA,SAKA8D,WAAA,SAAArL,MACA,GAAAhU,MAAA5uB,KAAA4uB,KACAhzB,KAAAgnC,KAAAziC,MACA81B,QAAAj2B,KAAAkuC,cAAAtyC,KAIA,OAFAq6B,SAAAhb,QAAA,SAAA2T,KAAAuf,oBAEA,cAAAlY,QAAA52B,KAAA,KAAA,gBACAzD,KAAAib,OAAA,cAAA,WAMAq3B,cAAA,SAAAtyC,MACA,GAAAgzB,MAAA5uB,KAAA4uB,KACAmD,MAAAnD,KAAAoG,SAAA/D,SAAAjP,YACAiU,SAAA,MAAA8I,OAAAnjC,KAAA8M,OAsBA;MAnBA,IAAAkmB,KAAAwf,iBAAA1rB,GAAA,WACA9mB,KAAAyB,SAAAuxB,KAAAQ,cAAA/xB,SAEA44B,QAAA33B,KAAA,kBAGA1C,KAAAktB,OAAAiJ,MAAA,OACAkE,QAAA33B,KACA,WACAswB,KAAAyf,qBAIApY,QAAA33B,KADAyzB,MAAAn2B,KACA,UAGA,aAGAq6B,UAUA6T,MAAArJ,OAEA6N,cAAA,KACAC,eAAA,EACAC,eAAA,EACAC,oBAAA,EACAhjB,KAAA,KAIA6E,aAAA,SAAAvX,QACA,GAGA3a,GAAA8sB,IAHAO,KAAAzrB,KAAA0uC,aAAA31B,QACA41B,UACAC,SAGA,KAAAxwC,EAAA,EAAAA,EAAAqtB,KAAAptB,OAAAD,IACA8sB,IAAAO,KAAArtB,GAEAqrB,UAAAyB,IAAAjS,OACA01B,OAAArwC,KAAA4sB,KAGA0jB,OAAAtwC,KAAA4sB,IAMAyjB,QAAA3uC,KAAA6uC,aAAAF,SAAAA,OACAC,OAAA5uC,KAAA8uC,aAAAF,SAAAA,OAEA5uC,KAAAyrB,KAAAkjB,OAAA/tC,OAAAguC,SAKAxe,cAAA,WACApwB,KAAA+uC,qBAEA/uC,KAAAgvC,gBACAhvC,KAAAivC,gBAEAjvC,KAAAyrB,KAAA;EAKAyjB,aAAA,WACA,MAAAlvC,MAAAyrB,UASAqjB,aAAA,aAMAE,cAAA,aAQAG,eAAA,SAAA1jB,KAAA2jB,iBACA,GAGAhxC,GAHAwwB,KAAA5uB,KAAA4uB,KACA2e,KAAA,GACAC,eAGA,IAAA/hB,KAAAptB,OAAA,CAGA,IAAAD,EAAA,EAAAA,EAAAqtB,KAAAptB,OAAAD,IACAmvC,MAAAvtC,KAAAqvC,UAAA5jB,KAAArtB,GAAAgxC,gBAKAn7B,GAAAs5B,MAAA70B,KAAA,SAAAta,EAAAsvC,MACA,GAAAxiB,KAAAO,KAAArtB,GACA+e,GAAAyR,KAAA0gB,eAAApkB,IAAAjS,MAAAhF,EAAAy5B,MAEAvwB,MACAA,GAAAhI,KAAA,SAAA+V,KACAA,IAAA/N,GAAAA,GACAqwB,aAAAlvC,KAAA4sB,QAKA,MAAAsiB,eAKA6B,UAAA,aAWAR,aAAA,SAAApjB,MACA,MAAAzrB,MAAAktC,WAAA,UAAAzhB,OAKAwjB,cAAA,WACAjvC,KAAAmtC,YAAA,YAKAoC,aAAA,SAAArkB,IAAA/N,IACA,MAAAnd,MAAA4uB,KAAA0gB,eAAApkB,IAAAjS,MAAAkE;EAMAqyB,kBAAA,SAAAtkB,KACA,GAAAjS,OAAAiS,IAAAjS,MACA4Q,OAAA5Q,MAAA4Q,UAEA,QAAA,cAAAjpB,OACAqY,MAAAa,UACA+P,OAAA/P,gBAQA21B,cAAA,SAAAvkB,KACA,GAAA0D,MAAA5uB,KAAA4uB,KACA3V,MAAAiS,IAAAjS,MACA4Q,OAAA5Q,MAAA4Q,UAEA,QACA6lB,mBACAz2B,MAAA02B,iBACA12B,MAAA22B,OACA/lB,OAAA8lB,iBACA9lB,OAAA+lB,OACAhhB,KAAAia,IAAA,yBACAja,KAAAia,IAAA,gBAMAgH,wBAAA,WACA,OAAA,iBAAA,eASArE,gBAAA,WACA,GAAAxK,OAAAhhC,KACA4uB,KAAA5uB,KAAA4uB,IAEA3a,GAAAyE,MAEAo3B,WAAA,SAAA5kB,IAAA9K,IACA4gB,MAAA+O,oBAAA7kB,IAAA9K,KAEA4vB,WAAA,SAAA9kB,IAAA9K,IACA4gB,MAAA+N,mBAAA7jB,IAAA9K,KAEAqW,MAAA,SAAAvL,IAAA9K,IACA,MAAAwO,MAAAhZ,QAAA,aAAA5V,KAAAkrB,IAAAjS,MAAAmH;EAEAuW,UAAA,SAAAzL,IAAA9K,IACAnM,EAAAmM,GAAA6P,QAAA1B,GAAA,gBAAAK,KAAAqhB,iBAAA/kB,IAAAjS,OACA+nB,MAAAkP,mBAAAhlB,IAAA9K,GAAAnM,EAAAmM,GAAA6P,QAAA1B,GAAA,sBAEAK,KAAAuhB,iBAAAjlB,IAAAjS,QACA+nB,MAAAoP,iBAAAllB,IAAA9K,MAIA,SAAAtO,KAAAiT,MAEAic,MAAA7jB,GAAAjM,GAAAY,KAAA,0BAAA,SAAAsO,IACA,GAAA8K,KAAAjX,EAAAjU,MAAAmV,KAAA,SAGA,QAAA+V,KAAA8V,MAAAuN,eAAAvN,MAAAwN,cAAA,OACAzpB,KAAAxb,KAAAvJ,KAAAkrB,IAAA9K,SASA2vB,oBAAA,SAAA7kB,IAAA9K,IACApgB,KAAAsuC,gBACAtuC,KAAAsuC,cAAApjB,IACAlrB,KAAA4uB,KAAAhZ,QAAA,iBAAAsV,IAAA/N,GAAA,GAAA+N,IAAAjS,MAAAmH,MAOA2uB,mBAAA,SAAA7jB,IAAA9K,IACAA,GAAAA,OAEApgB,KAAAsuC,gBACApjB,IAAAA,KAAAlrB,KAAAsuC,cACAtuC,KAAAsuC,cAAA,KACAtuC,KAAA4uB,KAAAhZ,QAAA,gBAAAsV,IAAA/N,GAAA,GAAA+N,IAAAjS,MAAAmH;EAWAgwB,iBAAA,SAAAllB,IAAA9K,IACA,GAKAiwB,cALArP,MAAAhhC,KACA4uB,KAAA5uB,KAAA4uB,KACAoG,SAAApG,KAAAoG,SACA7X,GAAA+N,IAAA/N,GACAlE,MAAAiS,IAAAjS,MAIAq3B,cAAA,GAAA/I,eAAArc,IAAA/N,IACA8jB,SAAArS,KAAAzR,GACAqrB,QAAA5Z,KAAAia,IAAA,eACAT,eAAAxZ,KAAAia,IAAA,sBACAJ,OAAA,IAKAwD,aAAA,GAAArF,kBAAAhY,KAAAiY,UACArC,SAAA,EACAE,OAAA9V,KAAAia,IAAA,cACAlF,UAAAxmB,GACAgqB,eAAA,EACAtC,YAAA,SAAAzkB,IACAkwB,cAAAvP,OACAuP,cAAAnwC,MAAAigB,KAEAglB,UAAA,SAAAhlB,IACA4gB,MAAA+N,mBAAA7jB,IAAA9K,IACA4gB,MAAAuP,aAAArlB,IAAA9K,IACAwO,KAAA4hB,UAAAv3B,QAEAmuB,SAAA,SAAAxE,KAAAsJ,OAAApF,UAGA5b,IAAA0X,OACAkE,SAAA5b,IAAA0X,MAGAyN,aAAArP,MAAAyP,iBAAA3J,SAAAlE,KAAA3pB,OAEAo3B,eAAArb,SAAA8H,oBAAAuT,aAAAp3B,SACAqD,gBACA+zB,aAAA,MAIAA,cAAAzhB,KAAA8hB,WAAAL,aAAAnlB,KACAolB,cAAAvP,OAGAuP,cAAAxP,OAGAoL,SACAmE,aAAA;EAGAhJ,QAAA,WACAzY,KAAA+hB,cACAL,cAAAxP,OACAuP,aAAA,MAEA/I,SAAA,WACA/qB,gBAEAkpB,SAAA,SAAArlB,IAEAkwB,cAAAp6B,MAAAm6B,aAAA,WACAzhB,KAAA+hB,cACA/hB,KAAAgiB,UAAA33B,OACA+nB,MAAA6P,YAAA3lB,IAAA9K,IAEAiwB,cACAzhB,KAAAkiB,gBAAA73B,MAAAo3B,aAAArwC,KAAAq7B,UAAAle,GAAAiD,OAIAslB,WAAA,WACA4K,cAAAp6B,SAIA+1B,cAAAtV,UAAAvW,KAKAmwB,aAAA,SAAArlB,IAAA9K,IACApgB,KAAAuuC,eAAA,EACAvuC,KAAA4uB,KAAAhZ,QAAA,iBAAAsV,IAAA/N,GAAA,GAAA+N,IAAAjS,MAAAmH,QAKAywB,YAAA,SAAA3lB,IAAA9K,IACApgB,KAAAuuC,eAAA,EACAvuC,KAAA4uB,KAAAhZ,QAAA,gBAAAsV,IAAA/N,GAAA,GAAA+N,IAAAjS,MAAAmH,QAOAqwB,iBAAA,SAAAM,UAAAC,QAAA/3B,OACA,GAGAkZ,OACAke,aAJArb,SAAAh1B,KAAA4uB,KAAAoG,SACAoQ,UAAA2L,UAAA5wC,MACA8wC,QAAAD,QAAA7wC,KAwCA;MApCAilC,WAAA/T,YAAA4f,QAAA5f,WACAc,MAAAnyB,KAAAs7B,UAAA2V,QAAA7L,WAIAnsB,MAAAwR,QAAA9H,gBAAAwP,QACAke,cACAlwC,MAAA8Y,MAAA9Y,MAAArC,QACAsC,IAAA40B,SAAAb,YAAAlb,OACAwR,QAAA,GAEAuK,SAAA2F,yBAAA0V,eAIAA,cACAlwC,MAAA8Y,MAAA9Y,MAAArC,QACAsC,IAAA6Y,MAAA7Y,IAAA6Y,MAAA7Y,IAAAtC,QAAA,KACA2sB,OAAAxR,MAAAwR,QAIA4lB,aAAAlwC,MAAA4N,IAAAokB,OACAke,aAAAjwC,KACAiwC,aAAAjwC,IAAA2N,IAAAokB,QAKAke,cACAlwC,MAAA8wC,QAAAnzC,QACAsC,IAAA,KACAqqB,QAAAwmB,QAAA5f,WAIAgf,cAKAa,iBAAA,SAAAz0B,KACA,GAAA+rB,SAAAxoC,KAAA4uB,KAAAia,IAAA,cAEA,OAAAL,SACA/rB,IAAA/D,KAAA,SAAAta,EAAAsvC,MAGAA,KAAAyD,MAAA3I,QAAAA,WAWA4I,kBAAA,SAAAhxB,GAAAixB,IACA,GACAl0B,IACA3U,OAFAomB,KAAA5uB,KAAA4uB,IAIAA;KAAAia,IAAA,eACA1rB,GAAAlJ,GAAAo9B,GAAAA,GAAAhpC,KAAA,OAAA+X,GAAA6P,QAIAznB,OAAAomB,KAAAia,IAAA,eACA50B,EAAAgQ,WAAAzb,QAAAA,OAAAe,KAAA4T,GAAA,GAAAA,IAAAA,GAAAoR,GAAA/lB,WACAxI,KAAAyuC,oBACAzuC,KAAAsxC,qBAAAn0B,GAAAiD,GAAAixB,OAQAC,qBAAA,SAAAn0B,GAAAiD,GAAAixB,IACA,GAEApF,cACAoE,aAHArP,MAAAhhC,KACAuxC,KAAA5mB,iBAAAxN,GAKA8uB,cAAA,GAAArF,kBAAA5mC,KAAA6mC,UACAhC,YAAA,WACA7D,MAAAyN,oBAAA,GAEArH,SAAA,SAAAxE,MACAyN,aAAArP,MAAAwQ,oBAAA5O,KAAA2O,MACAlB,aACArP,MAAA0P,WAAAL,cAGA/zB,iBAGA+qB,QAAA,WACAgJ,aAAA,KACArP,MAAA2P,cACAp0B,gBAEAkpB,SAAA,WACAzE,MAAA2P,cACAp0B,eAEA8zB,cACArP,MAAApS,KAAA6iB,mBAAAF,KAAAlB,aAAAlzB,GAAAiD,GAAAixB;EAGA3L,WAAA,WACA1E,MAAAyN,oBAAA,KAIAxC,aAAAxH,UAAArkB,KAOAoxB,oBAAA,SAAA5O,KAAA2O,MACA,GAAAlB,eACAlwC,MAAAyiC,KAAAziC,MAAArC,QACAsC,IAAA,KAYA,OARAmxC,MAAA1mB,YAAAwlB,aAAAlwC,MAAAkxB,WACAgf,aAAAlwC,MAAAzC,KAAA6zC,KAAA1mB,WAGA0mB,KAAAxvB,WACAsuB,aAAAjwC,IAAAiwC,aAAAlwC,MAAArC,QAAAiQ,IAAAwjC,KAAAxvB,WAGA/hB,KAAA4uB,KAAAoG,SAAAuI,2BAAA8S,aAAAkB,KAAA3mB,YAIAylB,aAHA,MAgBAK,WAAA,aAMAC,YAAA,aAWAT,mBAAA,SAAAhlB,IAAA9K,GAAAoB,SACA,GAMAyqB,cACAyF,eAPA1Q,MAAAhhC,KACA4uB,KAAA5uB,KAAA4uB,KACAoG,SAAApG,KAAAoG,SACA7X,GAAA+N,IAAA/N,GACAlE,MAAAiS,IAAAjS,MACAklB,SAAAnJ,SAAAb,YAAAlb,MAKAgzB;aAAA,GAAArF,kBAAA5mC,KAAA6mC,UACArC,SAAA,EACAE,OAAA9V,KAAAia,IAAA,cACAlF,UAAAxmB,GACAioB,UAAA,SAAAhlB,IACA4gB,MAAA+N,mBAAA7jB,IAAA9K,IACA4gB,MAAA2Q,eAAAzmB,IAAA9K,KAEAgnB,SAAA,SAAAxE,KAAAsJ,OAAApF,UACA4K,eAAAlwB,QACAwf,MAAA4Q,wBAAA9K,SAAAlE,KAAA3pB,OACA+nB,MAAA6Q,sBAAA/K,SAAAlE,KAAA3pB,OAEAy4B,iBACA1c,SAAA8H,oBAAA4U,eAAAz4B,OAKAy4B,eAAAvxC,MAAA2oB,OAAA7P,MAAA9Y,QAAAuxC,eAAAtxC,IAAA0oB,OAAAqV,YACAuT,eAAA,OALAp1B,gBACAo1B,eAAA,OAQAA,iBACA9iB,KAAA4hB,UAAAv3B,OACA+nB,MAAA8Q,kBAAAJ,eAAAxmB,OAGAmc,QAAA,WACAqK,eAAA;EAEApK,SAAA,WACAtG,MAAA+Q,qBACAnjB,KAAAgiB,UAAA33B,OACAsD,gBAEAkpB,SAAA,SAAArlB,IACA4gB,MAAAgR,cAAA9mB,IAAA9K,IAEAsxB,gBACA9iB,KAAAqjB,kBAAAh5B,MAAAy4B,eAAA1xC,KAAAq7B,UAAAle,GAAAiD,OAKA6rB,aAAAtV,UAAAvW,KAKAuxB,eAAA,SAAAzmB,IAAA9K,IACApgB,KAAAwuC,eAAA,EACAxuC,KAAA4uB,KAAAhZ,QAAA,mBAAAsV,IAAA/N,GAAA,GAAA+N,IAAAjS,MAAAmH,QAKA4xB,cAAA,SAAA9mB,IAAA9K,IACApgB,KAAAwuC,eAAA,EACAxuC,KAAA4uB,KAAAhZ,QAAA,kBAAAsV,IAAA/N,GAAA,GAAA+N,IAAAjS,MAAAmH,QAKAwxB,wBAAA,SAAAb,UAAAC,QAAA/3B,OACA,MAAAjZ,MAAAkyC,mBAAA,QAAAnB,UAAAC,QAAA/3B,QAKA44B,sBAAA,SAAAd,UAAAC,QAAA/3B,OACA,MAAAjZ,MAAAkyC,mBAAA,MAAAnB,UAAAC,QAAA/3B;EAMAi5B,mBAAA,SAAAh9B,KAAA67B,UAAAC,QAAA/3B,OACA,GAEA/Y,OACAiyC,gBAHAnd,SAAAh1B,KAAA4uB,KAAAoG,SACA7C,MAAAnyB,KAAAs7B,UAAA0V,QAAA97B,MAAA67B,UAAA77B,MAwCA,OAnCAhV,QACAC,MAAA8Y,MAAA9Y,MAAArC,QACAsC,IAAA40B,SAAAb,YAAAlb,OACAwR,OAAAxR,MAAAwR,QAIAvqB,MAAAuqB,QAAA9H,gBAAAwP,SACAjyB,MAAAuqB,QAAA,EACAuK,SAAA2F,yBAAAz6B,QAGAA,MAAAgV,MAAAnH,IAAAokB,OAGAjyB,MAAAC,MAAAg7B,SAAAj7B,MAAAE,OAEA+xC,gBAAAl5B,MAAAwR,OACAuK,SAAAzD,2BACAyD,SAAA1D,0BAIAtxB,KAAAuqC,cAAAvqC,KAAAuqC,aAAA4H,kBACAA,gBAAAnyC,KAAAuqC,cAGA,SAAAr1B,KACAhV,MAAAC,MAAAD,MAAAE,IAAAtC,QAAAo+B,SAAAiW,iBAGAjyC,MAAAE,IAAAF,MAAAC,MAAArC,QAAAiQ,IAAAokC,kBAIAjyC;EAMA4xC,kBAAA,aAMAC,mBAAA,aAcAK,iBAAA,SAAAlyC,MAAA8mB,UAAAqrB,YAUA,MARA,OAAArrB,YACAA,UAAAhnB,KAAAoqC,iBAGA,MAAAiI,aACAA,WAAAryC,KAAAsqC,iBAGAtqC,KAAAqqC,kBAAAnqC,MAAAC,MAAAkxB,UACAghB,YAAAnyC,MAAAE,IACAJ,KAAA4uB,KAAAhH,YAAA1nB,MAAA8mB,WAGA9mB,MAAAC,MAAA0W,OAAAmQ,WAIA,IAKAsrB,cAAA,SAAApnB,IAAAqnB,YAAAC,aACA,GAAAv5B,OAAAiS,IAAAjS,MACAgd,SACA,WACA/K,IAAA1J,QAAA,WAAA,eACA0J,IAAAzJ,MAAA,SAAA,cACA7gB,OACAqY,MAAAa,UACAb,MAAA4Q,OAAA5Q,MAAA4Q,OAAA/P,aAUA,OAPAy4B,cACAtc,QAAA33B,KAAA,gBAEAk0C,aACAvc,QAAA33B,KAAA,gBAGA23B;EAKAwc,gBAAA,SAAAx5B,OACA,GAAA2V,MAAA5uB,KAAA4uB,KACA/E,OAAA5Q,MAAA4Q,WACA6oB,WAAAz5B,MAAA22B,MACA+C,YAAA9oB,OAAA+lB,MACAgD,YAAAhkB,KAAAia,IAAA,aAEA,QACA6G,mBACAz2B,MAAA02B,iBACA+C,YACA7oB,OAAA8lB,iBACAgD,aACA/jB,KAAAia,IAAA,yBACA+J,YACAC,eACA55B,MAAA65B,aACAJ,YACA7oB,OAAAipB,aACAH,aACA/jB,KAAAia,IAAA,qBACA+J,YACAhD,MACA32B,MAAA85B,WACAlpB,OAAAkpB,WACAnkB,KAAAia,IAAA,oBAYA6F,aAAA,SAAA31B,OAAAi6B,iBACA,GAEA50C,GAFA60C,YAAAjzC,KAAAkzC,eAAAn6B,QACA0S,OAGA,KAAArtB,EAAA,EAAAA,EAAA60C,YAAA50C,OAAAD,IACAqtB,KAAAntB,KAAA4c,MACAuQ,KACAzrB,KAAAmzC,iBAAAF,YAAA70C,GAAA40C,iBAIA;MAAAvnB,OASAynB,eAAA,SAAAn6B,QACA,GAAAioB,OAAAhhC,KACA+pB,WAAAD,gBAAA/Q,QACA3L,SAcA,OAXA6G,GAAAyE,KAAAqR,WAAA,SAAA3b,GAAAglC,YACAA,WAAA/0C,QACA+O,OAAA9O,KAAA4c,MACA9N,OACAwc,iBAAAwpB,WAAA,IACApS,MAAAqS,sBAAAD,YACApS,MAAAsS,qBAAAF,eAKAhmC,QAKAkmC,qBAAA,SAAAv6B,QACA,GAEA3a,GAAA6a,MACAilB,WAAAC,SAHAnJ,SAAAh1B,KAAA4uB,KAAAoG,SACA5nB,SAIA,KAAAhP,EAAA,EAAAA,EAAA2a,OAAA1a,OAAAD,IACA6a,MAAAF,OAAA3a,GAGA8/B,WAAAjlB,MAAA9Y,MAAArC,QAAA+oB,YACAsX,SAAAnJ,SAAAb,YAAAlb,OAAA4N,YAEAzZ,OAAA9O,MACA2a,MAAAA,MACA9Y,MAAA+9B,WACA99B,IAAA+9B,SACA/T,cAAA8T,WACA1T,gBAAA2T,SAAAD,YAIA;MAAA9wB,SAMAimC,sBAAA,SAAAt6B,QACA,GAOA3a,GAAAm1C,YAPA3kB,KAAA5uB,KAAA4uB,KACA4kB,UAAA5kB,KAAAzuB,MAAArC,QAAA+oB,YACA4sB,QAAA7kB,KAAAxuB,IAAAtC,QAAA+oB,YACA6sB,aAAA1zC,KAAAszC,qBAAAv6B,QACA46B,iBACAC,OAAA76B,OAAA,GACA5Y,MAAAqzC,SAMA,KAFAE,aAAAn1C,KAAA0rB,qBAEA7rB,EAAA,EAAAA,EAAAs1C,aAAAr1C,OAAAD,IACAm1C,YAAAG,aAAAt1C,GAGAm1C,YAAApzC,MAAAA,OACAwzC,cAAAr1C,MACA2a,MAAA26B,OACAzzC,MAAAA,MACAC,IAAAmzC,YAAApzC,QAIAA,MAAAozC,YAAAnzC,GAYA,OARAqzC,SAAAtzC,OACAwzC,cAAAr1C,MACA2a,MAAA26B,OACAzzC,MAAAA,MACAC,IAAAqzC,UAIAE,eAMAR,iBAAA,SAAAU,WAAAb,iBACA,GAAAvnB,MACArtB,EAAA8sB,GASA,KANAO,KADAunB,gBACAA,gBAAAa,YAGA7zC,KAAA8qC,YAAA+I,YAGAz1C,EAAA,EAAAA,EAAAqtB,KAAAptB,OAAAD,IACA8sB,IAAAO,KAAArtB,GACA8sB,IAAAjS,MAAA46B,WAAA56B,MACAiS,IAAAd,aAAAypB,WAAAzpB,aACAc,IAAAV,gBAAAqpB,WAAArpB,eAGA;MAAAiB,SAsDA7E,GAAAyD,YAAAA,YAQAzD,GAAAoE,eAAA,EAsDA,IAAA8oB,SAAAhK,KAAA/xB,QAEAg8B,gBAAA,EACAC,mBAAA,EACAC,aAAA,KAEAC,UAAA,KACAC,iBAAA,KAEAv4B,OAAA,KACAw4B,OAAA,KACAC,UAAA,KAGA7T,YAAA,WACAsJ,KAAA5uB,MAAAlb,KAAAK,WAEAL,KAAAuqC,aAAAn2B,OAAA2N,SAAA,EAAA,QAOA6pB,YAAA,SAAA0I,SACA,GAKA/qB,KACAnrB,EAAAwkC,KANAhU,KAAA5uB,KAAA4uB,KACAiU,OAAA7iC,KAAA6iC,OACAC,OAAA9iC,KAAA8iC,OACAyR,QAAA1R,OAAAC,OACAyK,KAAA,EAIA,KAAAhkB,IAAA,EAAAsZ,OAAAtZ,IAAAA,MACAgkB,MAAAvtC,KAAAw0C,WAAAjrB,IAAA+qB,QAQA,KANAt0C,KAAAmd,GAAAowB,KAAAA,MAEAvtC,KAAA4b,OAAA5b,KAAAmd,GAAA9C,KAAA,WACAra,KAAAo0C,OAAAp0C,KAAAmd,GAAA9C,KAAA,WAGAjc,EAAA,EAAAm2C,QAAAn2C,EAAAA,IACAwkC,KAAA5iC,KAAAyiC,QAAArkC,GACAwwB,KAAAhZ,QAAA,YAAA,KAAAgtB,KAAAziC,MAAAH,KAAAo0C,OAAA31B,GAAArgB;EAKAytC,aAAA,WACA7rC,KAAAy0C,qBAIAC,oBAAA,WACA,GAAA37B,QAAA/Y,KAAA4uB,KAAAoG,SAAAyH,wBAAA,GACAhR,KAAAzrB,KAAA0uC,aAAA31B,OAEA/Y,MAAAktC,WAAA,gBAAAzhB,KAAA,YAKA+oB,WAAA,SAAAjrB,IAAA+qB,SACA,GAAA1lB,MAAA5uB,KAAA4uB,KACAqH,SAAA,SAAA,UAAArH,KAAAuf,mBAMA,OAJAmG,UACAre,QAAA33B,KAAA,YAGA,eACA23B,QAAA52B,KAAA,KAAA,+BAGAW,KAAA8oC,QAAA,MAAAvf,KACA,0DAIAvpB,KAAA+zC,eACA,UACA/zC,KAAA8oC,QAAA,SAAAvf,KACA,WACA,IAEA,wBASAorB,YAAA,SAAA/R,MACA,MAAA5iC,MAAAiuC,WAAArL,OASA4H,qBAAA,WACA,MAAAxqC,MAAA6iC,OAAA,EACA,MAEA7iC,KAAA8iC,OAAA,EACA9iC,KAAA4uB,KAAAia,IAAA,oBAGA;EAMA4B,uBAAA,WACA,MAAAzqC,MAAA4uB,KAAAia,IAAA,yBAKA8B,uBAAA,WACA,MAAA,IAAA3qC,KAAA8iC,QASA+H,YAAA,WACA,GAAAqJ,WACA5gB,SACAuP,OACAC,MAKA,IAHA9iC,KAAA40C,kBACAV,UAAAl0C,KAAAk0C,UAEAl0C,KAAAi0C,aAAA,CAGA,IADA3gB,SAAA4gB,UAAA,GAAAxrC,MACAo6B,OAAA,EAAAA,OAAAoR,UAAA71C,QACA61C,UAAApR,QAAAp6B,OAAA4qB,SADAwP,UAKAD,OAAA5mC,KAAAC,KAAAg4C,UAAA71C,OAAAykC,YAGAD,QAAA,EACAC,OAAAoR,UAAA71C,MAGA2B,MAAA6iC,OAAAA,OACA7iC,KAAA8iC,OAAAA,QAKA8R,gBAAA,WAOA,IANA,GAAAhmB,MAAA5uB,KAAA4uB,KACAhzB,KAAAoE,KAAAG,MAAArC,QACAI,SACA+N,OAAA,GACA4oC,WAEAj5C,KAAAu/B,SAAAn7B,KAAAI,MACAwuB,KAAAkmB,YAAAl5C,MACAi5C,QAAAv2C,KAAA2N,OAAA,KAGAA,SACA4oC,QAAAv2C,KAAA2N,QACA/N,MAAAI,KAAA1C,KAAAkC,UAEAlC,KAAAmS,IAAA,EAAA,OAGA/N;KAAAk0C,UAAAh2C,MACA8B,KAAAm0C,iBAAAU,SAKA3J,gBAAA,SAAAtI,MACA,GAAAE,QAAA9iC,KAAA8iC,OACAnoC,MAAAioC,KAAArZ,IAAAuZ,QAAA9iC,KAAA8nB,MAAAgb,OAAAF,KAAApZ,IAAA,EAAAoZ,KAAApZ,IAEA,OAAAxpB,MAAAk0C,UAAAv5C,OAAAmD,SAKAqtC,SAAA,SAAA5hB,KACA,MAAAvpB,MAAA4b,OAAA6C,GAAA8K,MAKA6hB,SAAA,SAAA5hB,KACA,MAAAxpB,MAAAo0C,OAAA31B,GAAA+K,MAKA6hB,aAAA,SAAAzI,MACA,MAAA5iC,MAAAo0C,OAAA31B,GAAAmkB,KAAArZ,IAAAvpB,KAAA8iC,OAAAF,KAAApZ,MAKA6Y,iBAAA,WACA,GAAAJ,WAAA6H,KAAA7pC,UAAAoiC,iBAAA94B,KAAAvJ,KAKA,OAFAiiC,WAAAA,UAAA5jC,OAAA,GAAAygB,QAAA9e,KAAAg0C,mBAEA/R,WASA6I,YAAA,SAAA5qC,OACA,GAIAmN,OAAAC,KACAic,IACAwrB,SAAAC,QACAxzB,QAAAC,MACAwzB,SAAAC,QACAhqB,IATApD,MAAA9nB,KAAA8nB,MACA+a,OAAA7iC,KAAA6iC,OACAC,OAAA9iC,KAAA8iC,OACArX,OAYA;IAJAvrB,MAAAF,KAAA4uB,KAAAumB,gBAAAj1C,OACAmN,MAAArN,KAAAo1C,iBAAAl1C,MAAAC,OACAmN,KAAAtN,KAAAo1C,iBAAAl1C,MAAAE,IAAA87B,SAAA,EAAA,SAEA3S,IAAA,EAAAsZ,OAAAtZ,IAAAA,MACAwrB,SAAAxrB,IAAAuZ,OACAkS,QAAAD,SAAAjS,OAAA,EAGAmS,SAAAh5C,KAAAykB,IAAAq0B,SAAA1nC,OACA6nC,QAAAj5C,KAAA0kB,IAAAq0B,QAAA1nC,MAGA2nC,SAAAh5C,KAAAC,KAAA+4C,UACAC,QAAAj5C,KAAAgF,MAAAi0C,SAEAA,SAAAD,WAGAzzB,QAAAyzB,WAAA5nC,MACAoU,MAAAyzB,UAAA5nC,KAGA2nC,UAAAF,SACAG,SAAAH,SAEA7pB,KAAA3B,IAAAA,IAAA/H,QAAAA,QAAAC,MAAAA,OACAqG,OACAoD,IAAAG,QAAAyX,OAAAoS,QAAA,EACAhqB,IAAAI,SAAAwX,OAAAmS,SAAA,IAGA/pB,IAAAG,QAAA4pB,SACA/pB,IAAAI,SAAA4pB,SAEAzpB,KAAAntB,KAAA4sB,KAIA,OAAAO,OASA2pB,iBAAA,SAAAx5C,MACA,GAAAi5C,SAAA70C,KAAAm0C,iBACAzrC,IAAA9M,KAAAsd,KAAAlZ,KAAAG,MAAA,OAEA;MAAA,GAAAuI,IACAmsC,QAAA,GAAA,EAEAnsC,KAAAmsC,QAAAx2C,OACAw2C,QAAAA,QAAAx2C,OAAA,GAAA,EAGAw2C,QAAAnsC,MAYAgoC,WAAA,SAAAL,aAAAnlB,KAQA,MALAlrB,MAAA8sC,gBACA9sC,KAAA4uB,KAAAoG,SAAA8F,wBAAAuV,eAIAnlB,MAAAA,IAAA/N,GAAAikB,QAAAphC,KAAAmd,IAAA9e,QAEA2B,KAAAusC,kBAAA8D,aAAAnlB,KACAlrB,KAAAkxC,iBAAAlxC,KAAAq0C,YAEA,GALA,QAWA1D,YAAA,WACA3wC,KAAA+sC,mBACA/sC,KAAA6sC,iBASAiF,kBAAA,SAAA5xC,MAAAgrB,KACAlrB,KAAA8sC,gBAAA5sC,OACAF,KAAAusC,kBAAArsC,MAAAgrB,MAKA6mB,mBAAA,WACA/xC,KAAA+sC,mBACA/sC,KAAA6sC,iBASAF,aAAA,SAAA1zB,MAAAuzB,WACA,GAEA6I,YAFAC,eACA7pB,KAAAzrB,KAAA0uC,cAAAz1B,OAGAwS;KAAAzrB,KAAAmvC,eAAA1jB,MACA4pB,WAAAr1C,KAAAu1C,cAAA9pB,MAGAzrB,KAAA4b,OAAAlD,KAAA,SAAA6Q,IAAAisB,SACA,GAEAC,aAFAC,MAAAzhC,EAAAuhC,SACAG,WAAA1hC,EAAA,iDAKAwhC,aADAjJ,WAAAA,UAAAjjB,MAAAA,IACAijB,UAAArvB,GAAAmB,WAAAO,IAGA62B,MAAAr7B,KAAA,8BAAAiE,WAAAO,IAGA82B,WAAA55B,IAAA,MAAA05B,aACAp7B,KAAA,SACA6a,OAAAmgB,WAAA9rB,KAAAqsB,SAEAF,MAAAxgB,OAAAygB,YACAL,YAAAh3C,KAAAq3C,WAAA,MAGA31C,KAAAq0C,UAAApgC,EAAAqhC,cAKAzI,cAAA,WACA7sC,KAAAq0C,YACAr0C,KAAAq0C,UAAAr0B,SACAhgB,KAAAq0C,UAAA,OASA1G,WAAA,KAKAT,WAAA,SAAAh4B,KAAAuW,KAAA3R,WACA,GACA1b,GAAA8sB,IACAyqB,WAFAE,QAMA;IAFApqB,KAAAzrB,KAAAqtC,iBAAAn4B,KAAAuW,MAEArtB,EAAA,EAAAA,EAAAqtB,KAAAptB,OAAAD,IACA8sB,IAAAO,KAAArtB,GACAu3C,WAAA31C,KAAA81C,cAAA5gC,KAAAgW,IAAApR,WACA9Z,KAAA4b,OAAA6C,GAAAyM,IAAA3B,KAAA2L,OAAAygB,YACAE,MAAAv3C,KAAAq3C,WAAA,GAKA,OAFA31C,MAAAiqC,UAAA/0B,MAAAjB,EAAA4hC,OAEApqB,MAKAqqB,cAAA,SAAA5gC,KAAAgW,IAAApR,WACA,GAGA67B,YACAI,KAJAjT,OAAA9iC,KAAA8iC,OACAkT,SAAA9qB,IAAAG,QACA4qB,OAAA/qB,IAAAI,SAAA,CA2BA,OAvBAxR,WAAAA,WAAA5E,KAAA7J,cAEAsqC,WAAA1hC,EACA,kBAAA6F,UAAA,yCAIAi8B,KAAAJ,WAAAt7B,KAAA,MAEA27B,SAAA,GACAD,KAAA7gB,OAAA,gBAAA8gB,SAAA,OAGAD,KAAA7gB,OACAhK,IAAA/N,GAAAjW,KAAA,UAAA+uC,OAAAD,WAGAlT,OAAAmT,QACAF,KAAA7gB,OAAA,iBAAA4N,OAAAmT,QAAA,OAGAj2C,KAAAmpC,aAAA4M,KAAA7gC,MAEAygC;GAUA7B,SAAArT,OAEA4U,WAAA,KAIAjlB,cAAA,WACApwB,KAAAy0C,oBACA3K,KAAA7pC,UAAAmwB,cAAAlV,MAAAlb,KAAAK,YAKA6uC,aAAA,WACA,MAAApF,MAAA7pC,UAAAivC,aAAA3lC,KAAAvJ,MACAY,OAAAZ,KAAAk2C,kBAKArH,aAAA,SAAApjB,MAGA,GAAA0qB,YAAAliC,EAAAglB,KAAAxN,KAAA,SAAAP,KACA,MAAAA,KAAAjS,MAAAwR,QAGA,OAAAqf,MAAA7pC,UAAA4uC,aAAAtlC,KAAAvJ,KAAAm2C,aAKArH,aAAA,SAAArjB,MACA,GAAA4pB,WAeA,OAXA5pB,MAAAzrB,KAAAmvC,eAAA1jB,MAEA4pB,WAAAr1C,KAAAq1C,WAAAr1C,KAAAu1C,cAAA9pB,MAGAzrB,KAAA4b,OAAAlD,KAAA,SAAAta,EAAAo3C,SACAvhC,EAAAuhC,SAAAn7B,KAAA,gCAAA6a,OACAmgB,WAAAj3C,GAAAw3C,WAIAnqB,MAKAujB,cAAA,WAIA,IAHA,GACAoH,WADAf,WAAAr1C,KAAAq1C,eAGAe,UAAAf,WAAAgB,OACAD,UAAAR,QAAA51B,QAGAhgB;KAAAq1C,WAAA,MAOAE,cAAA,SAAA9pB,MACA,GACA6qB,SACA/sB,IAFA8rB,aAOA,KAHAiB,QAAAt2C,KAAAu2C,aAAA9qB,MAGAlC,IAAA,EAAAA,IAAA+sB,QAAAj4C,OAAAkrB,MACA8rB,WAAA/2C,KACA0B,KAAAw2C,aAAAjtB,IAAA+sB,QAAA/sB,MAIA,OAAA8rB,aAKAhG,UAAA,SAAAnkB,IAAAkkB,iBACA,GAUAqH,UACAC,UAXA9nB,KAAA5uB,KAAA4uB,KACA3V,MAAAiS,IAAAjS,MACAs5B,YAAA3jB,KAAAuhB,iBAAAl3B,OACA09B,sBAAAvH,iBAAAn2B,MAAAwR,QACAS,IAAA1J,SAAAoN,KAAAgoB,0BAAA39B,OACA49B,oBAAAzH,iBAAAn2B,MAAAwR,QACAS,IAAAzJ,OAAAmN,KAAAkoB,wBAAA79B,OACAgd,QAAAj2B,KAAAsyC,cAAApnB,IAAAqnB,YAAAoE,sBAAAE,oBACAE,QAAAzyB,SAAAtkB,KAAAyyC,gBAAAx5B,QACA+9B,SAAA,EAmBA;MAfA/gB,SAAAhb,QAAA,oBAAA,cAGAiQ,IAAA1J,UACAi1B,SAAAz2C,KAAAoyC,iBAAAn5B,OACAw9B,WACAO,SAAA,yBAAA5yB,WAAAqyB,UAAA,YAIAC,UACA,2BACAtyB,WAAAnL,MAAAtC,OAAA,KAAA,UACA,UAEA,aAAAsf,QAAA52B,KAAA,KAAA,KACA4Z,MAAAhE,IACA,UAAAmP,WAAAnL,MAAAhE,KAAA,IACA,KAEA8hC,QACA,WAAAA,QAAA,IACA,IAEA,6BAEA/2C,KAAA8nB,MACA4uB,UAAA,IAAAM,SACAA,SAAA,IAAAN,WAEA,UACAC,qBACA,8CACA,KAEAE,mBACA,4CACA,IAEA,QAOAL,aAAA,SAAAjtB,IAAA0tB,SAeA,QAAAC,iBAAAjB,QACA,KAAAA,OAAAzsB,KAEA2tB,IAAAC,eAAAh5C,EAAA,QAAAorB,KACA2tB,GACAA,GAAAjwC,KACA,UACAqJ,SAAA4mC,GAAAjwC,KAAA,YAAA,EAAA,IAAA,IAIAiwC,GAAAljC,EAAA,SACAojC,GAAAniB,OAAAiiB,KAEAG,WAAAl5C,GAAAorB,KAAA2tB,GACAC,eAAAh5C,GAAAorB,KAAA2tB,GACA3tB;CA9BA,GAOAprB,GAAAm5C,UACA/tB,IACA6tB,GACAvxC,EAAAolB,IACAisB,GAXArU,OAAA9iC,KAAA8iC,OACA0U,UAAAx3C,KAAAy3C,eAAAR,SACAS,SAAAz7C,KAAAykB,IAAA,EAAA82B,UAAAn5C,QACAs5C,MAAA1jC,EAAA,YACA2jC,aACAN,cACAF,iBA4BA,KAAAh5C,EAAA,EAAAs5C,SAAAt5C,EAAAA,IAAA,CAWA,GAVAm5C,UAAAC,UAAAp5C,GACAorB,IAAA,EACA6tB,GAAApjC,EAAA,SAEA2jC,UAAAt5C,SACAg5C,WAAAh5C,SACA84C,eAAA94C,SAIAi5C,UACA,IAAAzxC,EAAA,EAAAA,EAAAyxC,UAAAl5C,OAAAyH,IAAA,CAcA,IAbAolB,IAAAqsB,UAAAzxC,GAEAoxC,gBAAAhsB,IAAAG,SAGA8rB,GAAAljC,EAAA,oCAAAihB,OAAAhK,IAAA/N,IACA+N,IAAAG,SAAAH,IAAAI,SACA6rB,GAAAjwC,KAAA,UAAAgkB,IAAAI,SAAAJ,IAAAG,QAAA,GAGA+rB,eAAAh5C,GAAAorB,KAAA2tB,GAGA3tB,KAAA0B,IAAAI,UACAgsB,WAAAl5C,GAAAorB,KAAA2tB,GACAS,UAAAx5C,GAAAorB,KAAA0B,IACA1B,KAGA6tB,IAAAniB,OAAAiiB,IAIAD,gBAAApU,QACA9iC,KAAAmpC,aAAAkO,GAAA,iBACAM,MAAAziB,OAAAmiB;CAGA,OACA9tB,IAAAA,IACAqsB,QAAA+B,MACAL,WAAAA,WACAM,UAAAA,UACAJ,UAAAA,UACA/rB,KAAAwrB,UAOAQ,eAAA,SAAAhsB,MACA,GACArtB,GAAA8sB,IACAplB,EAFA4lB,SAQA,KAFAD,KAAAltB,KAAA8rB,aAEAjsB,EAAA,EAAAA,EAAAqtB,KAAAptB,OAAAD,IAAA,CAIA,IAHA8sB,IAAAO,KAAArtB,GAGA0H,EAAA,EAAAA,EAAA4lB,OAAArtB,QACA4sB,kBAAAC,IAAAQ,OAAA5lB,IADAA,KAMAolB,IAAAe,MAAAnmB,GAGA4lB,OAAA5lB,KAAA4lB,OAAA5lB,QAAAxH,KAAA4sB,KAIA,IAAAplB,EAAA,EAAAA,EAAA4lB,OAAArtB,OAAAyH,IACA4lB,OAAA5lB,GAAAvH,KAAAgtB,kBAGA,OAAAG,SAKA6qB,aAAA,SAAA9qB,MACA,GACArtB,GADAk4C,UAGA,KAAAl4C,EAAA,EAAAA,EAAA4B,KAAA6iC,OAAAzkC,IACAk4C,QAAAh4C,QAGA,KAAAF,EAAA,EAAAA,EAAAqtB,KAAAptB,OAAAD,IACAk4C,QAAA7qB,KAAArtB,GAAAmrB,KAAAjrB,KAAAmtB,KAAArtB,GAGA,OAAAk4C,YAoCAxC,QAAArT,OAEAoX,WAAA,KACA3B,YAAA,KAGAzB,kBAAA,WACAz0C,KAAA63C,YACA73C,KAAA63C,WAAA9W;EAOA+W,UAAA,SAAAC,YACA,GACAxuB,KACAyuB,cAFA3C,WAAAr1C,KAAAq1C,cAIA,KAAA9rB,IAAA,EAAAA,IAAA8rB,WAAAh3C,OAAAkrB,MACAvpB,KAAAi4C,WAAA1uB,KAMAyuB,cAJAD,WAGA,gBAAAA,YACAA,WAGA/3C,KAAAk4C,qBAAA3uB,MANA,EASAyuB,iBAAA,GACAh4C,KAAAm4C,SAAA5uB,IAAAyuB,gBASAE,qBAAA,SAAA3uB,KAOA,QAAA6uB,kBAAAh6C,EAAAi6C,WACAC,SAAAr8C,KAAAykB,IAAA43B,SAAArkC,EAAAokC,WAAA/6B,eAPA,GAGAlf,GAAA23C,KACAuC,SAJA5C,MAAA11C,KAAA4b,OAAA6C,GAAA8K,KACAgvB,UAAA7C,MAAAn4B,SACAi7B,MAAAx4C,KAAAq1C,WAAA9rB,KAAAqsB,QAAA71B,UASA,KAAA3hB,EAAA,EAAAA,EAAAo6C,MAAAn6C,OAAAD,IAQA,GAPA23C,KAAAyC,MAAA/5B,GAAArgB,GAAA8b,YAAA,cAIAo+B,SAAA,EACAvC,KAAA17B,KAAA,uBAAA3B,KAAA0/B,kBAEArC,KAAAz3B,WAAAO,IAAAy5B,SAAAC,UACA,MAAAn6C,EAIA;OAAA,GAOA+5C,SAAA,SAAA5uB,IAAAwuB,YAmBA,QAAAb,iBAAAjB,QACA,KAAAA,OAAAzsB,KACAoZ,KAAA5B,MAAAyB,QAAAlZ,IAAAC,KACAivB,UAAAzX,MAAA0X,YAAA9V,KAAAmV,YACAU,UAAAp6C,SACA84C,GAAAG,WAAAS,WAAA,GAAAvuB,KACAmvB,SAAA3X,MAAA4X,eAAAhW,KAAA6V,WACAI,SAAA5kC,EAAA,UAAAihB,OAAAyjB,UACAxB,GAAAjiB,OAAA2jB,UACAC,UAAAx6C,KAAAu6C,SAAA,KAEArvB,MA7BA,GAIAoZ,MACA2U,UACAD,WACAyB,aACA36C,EAAA8sB,IACAutB,UACAO,eACAC,aACA9B,GAAA+B,QACAC,aACArzC,EACAszC,OAAAP,SAAAF,SAfA3X,MAAAhhC,KACAo2C,UAAAp2C,KAAAq1C,WAAA9rB,KACAuvB,aACAtvB,IAAA,CA8BA,IAAAuuB,YAAAA,WAAA3B,UAAAoB,UAAAn5C,OAAA,CAQA,IAPAk5C,UAAAnB,UAAAoB,UAAAO,WAAA,GACAT,WAAAlB,UAAAkB,WAEAyB,aAAA3C,UAAAR,QAAA71B,WAAA9d,MAAA81C,YACA59B,SAAA,cAAAk/B,MAGAj7C,EAAA,EAAAA,EAAAm5C,UAAAl5C,OAAAD,IAAA,CAOA,IANA8sB,IAAAqsB,UAAAn5C,GACA84C,gBAAAhsB,IAAAG,SAGA4tB,gBACAD,eAAA,EACAxvB,KAAA0B,IAAAI,UACAsX,KAAA5iC,KAAAyiC,QAAAlZ,IAAAC,KACAivB,UAAAz4C,KAAA04C,YAAA9V,KAAAmV,YACAkB,aAAA36C,KAAAm6C,WACAO,gBAAAP,UAAAp6C,OACAmrB,KAGA;GAAAwvB,eAAA,CAMA,IALA7B,GAAAG,WAAAS,WAAA,GAAA7sB,IAAAG,SACA6tB,QAAA/B,GAAAjwC,KAAA,YAAA,EACAiyC,gBAGArzC,EAAA,EAAAA,EAAAmzC,aAAA56C,OAAAyH,IACAszC,OAAAnlC,EAAA,8BAAA/M,KAAA,UAAAgyC,SACAT,UAAAQ,aAAAnzC,GACA88B,KAAA5iC,KAAAyiC,QAAAlZ,IAAA2B,IAAAG,QAAAvlB,GACA6yC,SAAA34C,KAAA44C,eAAAhW,MAAA1X,KAAAtqB,OAAA63C,YACAI,SAAA5kC,EAAA,UAAAihB,OAAAyjB,UACAS,OAAAlkB,OAAA2jB,UACAM,aAAA76C,KAAA86C,OAAA,IACAN,UAAAx6C,KAAA86C,OAAA,GAGAjC,IAAAh9B,SAAA,cAAA1W,MAAAwQ,EAAAklC,eACAJ,aAAAz6C,KAAA64C,GAAA,KAIAD,gBAAAl3C,KAAA8iC,QACAsT,UAAAkD,QAAArlC,EAAA6kC,WACA1C,UAAAmD,WAAAtlC,EAAA8kC,gBAOAd,WAAA,SAAA1uB,KACA,GAAA6sB,WAAAp2C,KAAAq1C,WAAA9rB,IAEA6sB;UAAAkD,UACAlD,UAAAkD,QAAAt5B,SACAo2B,UAAAkD,QAAA,MAGAlD,UAAAmD,aACAnD,UAAAmD,WAAAr/B,YAAA,cACAk8B,UAAAmD,WAAA,OAOAX,eAAA,SAAAhW,KAAA4W,YACA,GAAAxY,OAAAhhC,KACA4uB,KAAA5uB,KAAA4uB,IAEA,OAAA3a,GAAA,wBACAvN,KACA1G,KAAAy5C,gBAAAD,WAAAn7C,SAEA6S,GAAA,QAAA,SAAAkP,IACA,GAAAs5B,aAAA9qB,KAAAia,IAAA,mBACAjtC,KAAAgnC,KAAAziC,MACAw5C,OAAA1lC,EAAAjU,MACA45C,MAAA5Y,MAAAqK,aAAAzI,MACAiX,QAAA7Y,MAAA0X,YAAA9V,MAGAkX,gBAAA9Y,MAAA+Y,eAAAF,QAAAj+C,MACAo+C,mBAAAhZ,MAAA+Y,eAAAP,WAAA59C,KAEA,mBAAA89C,eAEAA,YAAA9qB,KAAAhZ,QAAA,kBAAA,MACAha,KAAAA,KACAg+C,MAAAA,MACAD,OAAAA,OACAluB,KAAAquB,gBACAN,WAAAQ,oBACA55B,KAGA,YAAAs5B,YACA1Y,MAAAiZ,eAAArX,KAAA+W,OAAAG,iBAEA,gBAAAJ,cACA9qB,KAAAoG,SAAA5C,OAAAx2B,KAAA89C;IAOAO,eAAA,SAAArX,KAAA+V,SAAAltB,MACA,GAGAyuB,OACA/2C,QAJA69B,MAAAhhC,KACA4uB,KAAA5uB,KAAA4uB,KACAiqB,SAAAF,SAAA9iC,QAKAqkC,OADA,GAAAl6C,KAAA6iC,OACAjU,KAAAzR,GAGAnd,KAAA4b,OAAA6C,GAAAmkB,KAAArZ,KAGApmB,SACA2W,UAAA,kBACAiT,QAAA/sB,KAAAm6C,wBAAAvX,KAAAnX,MACAwV,SAAAjhC,KAAAmd,GACA0B,IAAAq7B,MAAAjuC,SAAA4S,IACAqiB,UAAA,EACAa,kBAAAnT,KAAAia,IAAA,4BACA9H,KAAA,WAEAC,MAAA6W,WAAA1pB,UACA6S,MAAA6W,WAAA,KACA7W,MAAAkV,YAAA,OAMAl2C,KAAA8nB,MACA3kB,QAAA+Y,MAAA28B,SAAA5sC,SAAA6P,KAAA+8B,SAAA/6B,aAAA,EAGA3a,QAAA2Y,KAAA+8B,SAAA5sC,SAAA6P,KAAA,EAGA9b,KAAA63C,WAAA,GAAAnX,SAAAv9B,SACAnD,KAAA63C,WAAA/W,QAKAqZ,wBAAA,SAAAvX,KAAAnX,MACA,GAkBArtB,GAlBAwwB,KAAA5uB,KAAA4uB,KACAwrB,QAAAxrB,KAAAia,IAAA,SACAlyB,MAAAisB,KAAAziC,MAAA0W,OAAA+X,KAAAia,IAAA,qBACA9b,QAAA9Y,EACA,yBAAA2a,KAAAmf,kBAAA,4BAEAqM,QAAA,6BAAA,qBACA,mCAEAh2B,WAAAzN,OACA,2DAGAiY,KAAAuf,mBAAA,kDAIAkM,aAAAttB,QAAA1S,KAAA,sBAOA;IAHAoR,KAAAzrB,KAAAmvC,eAAA1jB,MAAA,GACAzrB,KAAAk2C,YAAAzqB,KAEArtB,EAAA,EAAAA,EAAAqtB,KAAAptB,OAAAD,IAIAqtB,KAAArtB,GAAAwkC,KAAAA,KAEAyX,aAAAnlB,OAAAzJ,KAAArtB,GAAA+e,GAGA,OAAA4P,UAKAgtB,eAAA,SAAAtuB,KAAA6uB,SAGA,GAAAvhC,QAAA9E,EAAA9D,IAAAsb,KAAA,SAAAP,KACA,MAAAA,KAAAjS,QAGAshC,SAAAD,QAAAx8C,QAAAkkB,YACAw4B,OAAAD,SAAAz8C,QAAAiQ,IAAA,EAAA,QACA0sC,UAAAt6C,MAAAo6C,SAAAn6C,IAAAo6C,OAcA,OAXA/uB,MAAAzrB,KAAA0uC,aACA31B,OACA,SAAA7Y,OACA,GAAAgrB,KAAA/J,kBAAAjhB,MAAAu6C,SACA,OAAAvvB,MAAAA,UAKAO,KAAAltB,KAAA8rB,aAEAoB,MAKAguB,gBAAA,SAAAiB,KACA,GAAA7R,KAAA7oC,KAAA4uB,KAAAia,IAAA,iBAEA,OAAA,kBAAAA,KACAA,IAAA6R,KAGA,IAAAA,IAAA,IAAA7R,KAOA6P,YAAA,SAAA9V,KAAA+X,YAMA,IALA,GAGAzvB,KAHA0sB,UAAA53C,KAAAq1C,WAAAzS,KAAArZ,KAAAquB,UACA3rB,MAAA0uB,YAAA,EACAlvB,QAGAQ,MAAA2rB,UAAAv5C,QACA6sB,IAAA0sB,UAAA3rB,OAAA2W,KAAApZ,KACA0B,KACAO,KAAAntB,KAAA4sB,KAEAe,OAGA;MAAAR,QAUA,IAAAmvB,UAAA9Q,KAAA/xB,QAEA8iC,aAAA,KACAC,aAAA,KAEAC,QAAA,KACAC,QAAA,KAEAC,WAAA,KAEA7G,OAAA,KACA8G,QAAA,KAEAC,SAAA,KAEAC,SAAA,KAEAC,iBAAA,KAGA7a,YAAA,WACAsJ,KAAA5uB,MAAAlb,KAAAK,WACAL,KAAAs7C,kBAMA1P,YAAA,WACA5rC,KAAAmd,GAAAowB,KAAAvtC,KAAAu7C,cACAv7C,KAAAo0C,OAAAp0C,KAAAmd,GAAA9C,KAAA,WACAra,KAAAk7C,QAAAl7C,KAAAmd,GAAA9C,KAAA,iBAIAq6B,oBAAA,WACA,GAAA37B,QAAA/Y,KAAA4uB,KAAAoG,SAAAyH,wBACAz8B,MAAAq7C,iBAAAr7C,KAAAktC,WAAA,gBAAAltC,KAAA0uC,aAAA31B,QAAA,YAKAwiC,WAAA,WACA,MAAA,6BAGAv7C,KAAA8oC,QAAA,UACA,8CAIA9oC,KAAAw7C,cACA;EAOAC,eAAA,SAAA7Y,MACA,MAAA5iC,MAAAiuC,WAAArL,OAKA4Y,YAAA,WAWA,IAVA,GAKAE,UACA54B,QACA64B,SAPA/sB,KAAA5uB,KAAA4uB,KACA9G,MAAA9nB,KAAA8nB,MACAylB,KAAA,GACAqO,WAAA57C,KAAA66C,aAAAgB,YAAA,KAAA,EACAC,SAAA1nC,OAAA2N,UAAA/hB,KAAA+6C,SAMAe,SAAA97C,KAAAg7C,SACAU,SAAA17C,KAAAG,MAAArC,QAAAJ,KAAAo+C,UACAh5B,QAAA44B,SAAA54B,UAEA64B,SACA,8BAAA/sB,KAAAuf,mBAAA,KAAAvf,KAAAmtB,gBAAA,KACAH,YAAA94B,QAIA,GAHA,SACAsB,WAAAs3B,SAAA7kC,OAAA7W,KAAAi7C,aACA,WAGA,QAEA1N,MACA,QAAAzqB,QAAA,mBAAA,IAAA,KACAgF,MAAA,GAAA6zB,UACA,cAAA/sB,KAAAuf,mBAAA,OACArmB,MAAA6zB,SAAA,IACA,QAEAG,SAAA/tC,IAAA/N,KAAA66C,aAGA;MAAAtN,OASA+N,eAAA,WACA,GAAA1sB,MAAA5uB,KAAA4uB,KACAisB,aAAAjsB,KAAAia,IAAA,gBACAiS,aAAAlsB,KAAAia,IAAA,eAEAgS,cAAAzmC,OAAA2N,SAAA84B,cACAC,aAAAA,aAAA1mC,OAAA2N,SAAA+4B,cAAAD,aAEA76C,KAAA66C,aAAAA,aACA76C,KAAA86C,aAAAA,aACA96C,KAAAuqC,aAAAuQ,aAEA96C,KAAA+6C,QAAA3mC,OAAA2N,SAAA6M,KAAAia,IAAA,YACA7oC,KAAAg7C,QAAA5mC,OAAA2N,SAAA6M,KAAAia,IAAA,YAEA7oC,KAAAi7C,WAAArsB,KAAAia,IAAA,eAAAja,KAAAia,IAAA,oBAKA2B,qBAAA,WACA,MAAAxqC,MAAA8iC,OAAA,EACA9iC,KAAA4uB,KAAAia,IAAA,oBAGA,QAMA4B,uBAAA,WACA,MAAAzqC,MAAA4uB,KAAAia,IAAA;EAKA8B,uBAAA,WACA,OAAA,GASAE,YAAA,WACA,GAEAjvC,MAFAgzB,KAAA5uB,KAAA4uB,KACAob,UAIA,KADApuC,KAAAoE,KAAAG,MAAArC,QACAlC,KAAAu/B,SAAAn7B,KAAAI,MACA4pC,QAAA1rC,MACAoK,IAAA9M,KAAAkC,UAEAlC,KAAAmS,IAAA,EAAA,OACAnS,KAAAgzB,KAAAotB,eAAApgD,KAGAoE,MAAA8nB,OACAkiB,QAAA17B,UAGAtO,KAAAgqC,QAAAA,QACAhqC,KAAA8iC,OAAAkH,QAAA3rC,OACA2B,KAAA6iC,OAAA5mC,KAAAC,MAAA8D,KAAAg7C,QAAAh7C,KAAA+6C,SAAA/6C,KAAA86C,eAKA5P,gBAAA,SAAAtI,MACA,GAAAllC,MAAAsC,KAAAi8C,gBAAArZ,KAAArZ,IAEA,OAAAvpB,MAAA4uB,KAAAoG,SAAAf,WAAA2O,KAAAl6B,KAAAhL,KAAAA,OAKA0tC,SAAA,SAAA5hB,KACA,MAAAxpB,MAAAo0C,OAAA31B,GAAA+K,MASAyyB,gBAAA,SAAA1yB,KACA,MAAAnV,QAAA2N,SAAA/hB,KAAA+6C,QAAA/6C,KAAA86C,aAAAvxB,MAKAuhB,YAAA,SAAA5qC,OACA,GAEAgrB,KACA1B,IACA0yB,QACAC,SALArZ,OAAA9iC,KAAA8iC,OACArX,OAYA;IALAvrB,OACAC,MAAAD,MAAAC,MAAArC,QAAA+oB,YACAzmB,IAAAF,MAAAE,IAAAtC,QAAA+oB,aAGA2C,IAAA,EAAAsZ,OAAAtZ,IAAAA,MACA0yB,QAAAl8C,KAAAgqC,QAAAxgB,KAAA9gB,IACAyzC,UACAh8C,MAAA+7C,QAAAp+C,QAAAJ,KAAAsC,KAAA+6C,SACA36C,IAAA87C,QAAAp+C,QAAAJ,KAAAsC,KAAAg7C,UAEA9vB,IAAA/J,kBAAAjhB,MAAAi8C,UACAjxB,MACAA,IAAA1B,IAAAA,IACAiC,KAAAntB,KAAA4sB,KAIA,OAAAO,OAQAkE,WAAA,SAAAysB,UACAp8C,KAAAq8C,kBAEAD,UACAp8C,KAAAs8C,sBAMAja,iBAAA,WACA,GAEAjkC,GACAiK,KAHAk0C,UAAAv8C,KAAAmd,GAAAlR,SAAA4S,IACAysB,QAIA,KAAAltC,EAAA,EAAAA,EAAA4B,KAAA6iC,OAAAzkC,IACAiK,MACAwW,IAAA09B,UAAAv8C,KAAAw8C,eAAAx8C,KAAAi8C,gBAAA79C,KAEAA,EAAA,IACAktC,MAAAltC,EAAA,GAAA0gB,OAAAzW,KAAAwW,KAEAysB,MAAAhtC,KAAA+J,KAIA,OAFAA,MAAAyW,OAAAzW,KAAAwW,IAAA7e,KAAAw8C,eAAAx8C,KAAAi8C,gBAAA79C,IAEAktC;EAMAmR,eAAA,SAAA7gD,KAAA8gD,gBACA,MAAA18C,MAAAw8C,eACApoC,OAAA2N,SACAnmB,KAAAkC,QAAA+oB,YAAA61B,eAAA5+C,QAAAkkB,eAOAw6B,eAAA,SAAA9+C,MACA,GACAi/C,WACAC,cACAC,QACAC,WAJAC,cAAAr/C,KAAAsC,KAAA+6C,SAAA/6C,KAAA66C,YAcA,OAPAkC,cAAA9gD,KAAAykB,IAAA,EAAAq8B,cACAA,aAAA9gD,KAAA0kB,IAAA3gB,KAAAk7C,QAAA78C,OAAA0+C,cAEAJ,UAAA1gD,KAAAgF,MAAA87C,cACAH,cAAAG,aAAAJ,UACAE,QAAA78C,KAAAm7C,SAAAwB,WAEAC,eACAE,WAAA98C,KAAAm7C,SAAAwB,UAAA,GACAE,SAAAC,WAAAD,SAAAD,eAGAC,SAOAR,gBAAA,WACA,GACAx9B,KADAm+B,OAGAh9C,MAAAk7C,QAAAxiC,KAAA,SAAAta,EAAAsvC,MACA7uB,IAAA5K,EAAAy5B,MAAApvB,WAAAO,IACAm+B,KAAA1+C,KAAAugB;GAGAm+B,KAAA1+C,KAAAugB,IAAA7e,KAAAk7C,QAAA5tC,OAAAgQ,eAEAtd,KAAAm7C,SAAA6B,MAWAtM,WAAA,SAAAL,aAAAnlB,KAEA,MAAAA,MACAlrB,KAAAusC,kBAAA8D,aAAAnlB,KACAlrB,KAAAkxC,iBAAAlxC,KAAAo7C,WAEA,OAIAp7C,MAAA8sC,gBACA9sC,KAAA4uB,KAAAoG,SAAA8F,wBAAAuV,gBAOAM,YAAA,WACA3wC,KAAA6sC,gBACA7sC,KAAA+sC,oBASA+E,kBAAA,SAAA5xC,MAAAgrB,KACAlrB,KAAAusC,kBAAArsC,MAAAgrB,MAKA6mB,mBAAA,WACA/xC,KAAA6sC,iBASAF,aAAA,SAAA1zB,MAAAuzB,WACA,GACAyQ,SACA7+C,EAAA8sB,IACAsc,SAHA/b,KAAAzrB,KAAA0uC,cAAAz1B,OASA,KAJAwS,KAAAzrB,KAAAmvC,eAAA1jB,MACAwxB,QAAAj9C,KAAAk9C,eAAAzxB,MAGArtB,EAAA,EAAAA,EAAAqtB,KAAAptB,OAAAD,IACA8sB,IAAAO,KAAArtB,GACAouC,WAAAA,UAAAhjB,MAAA0B,IAAA1B,MACAge,SAAAgF,UAAArvB,GACA+N,IAAA/N,GAAApB,KACAD,KAAA0rB,SAAAzrB,IAAA,QACAG,MAAAsrB,SAAAzrB,IAAA,SACAE,cAAAurB,SAAAzrB,IAAA,eACAK,eAAAorB,SAAAzrB,IAAA,kBAKA/b;KAAAo7C,SAAAnnC,EAAA,qCACAihB,OAAA+nB,SACAn9B,SAAA9f,KAAAmd,KAKA0vB,cAAA,WACA7sC,KAAAo7C,WACAp7C,KAAAo7C,SAAAp7B,SACAhgB,KAAAo7C,SAAA,OAUAhP,gBAAA,SAAAlsC,OACAF,KAAA4uB,KAAAia,IAAA,gBACA7oC,KAAAusC,kBAAArsC,OAGAF,KAAA8sC,gBAAA5sC,QAMAmsC,iBAAA,WACArsC,KAAA6sC,gBACA7sC,KAAA+sC,oBAUAG,WAAA,SAAAh4B,KAAAuW,KAAA3R,WACA,GAAAqjC,SACAxH,WACAI,KACAvsB,IAAA4zB,QACAC,KACAp/B,YACAq8B,QACAl8C,EAAA8sB,GAEA,IAAAO,KAAAptB,OAAA,CAaA,IAXAotB,KAAAzrB,KAAAqtC,iBAAAn4B,KAAAuW,MACA0xB,QAAAn9C,KAAAs9C,aAAA7xB,MAEA3R,UAAAA,WAAA5E,KAAA7J,cACAsqC,WAAA1hC,EACA,kBAAA6F,UAAA,yCAIAi8B,KAAAJ,WAAAt7B,KAAA,MAEAmP,IAAA,EAAAA,IAAA2zB,QAAA9+C,OAAAmrB,MAIA,GAHA4zB,QAAAD,QAAA3zB,KACA6zB,KAAAppC,EAAA,SAAA6L,SAAAi2B,MAEAqH,QAAA/+C,OAIA,IAHA4f,YAAAhK,EAAA,kBAAA6F,UAAA,iBAAAgG,SAAAu9B,MACA/C,QAAAt6C,KAAAgqC,QAAAxgB,KAAA9gB,IAEAtK,EAAA,EAAAA,EAAAg/C,QAAA/+C,OAAAD,IACA8sB,IAAAkyB,QAAAh/C,GACA6f,YAAAiX,OACAhK,IAAA/N,GAAApB,KACA8C,IAAA7e,KAAAy8C,eAAAvxB,IAAA/qB,MAAAm6C,SACAx7B,QAAA9e,KAAAy8C,eAAAvxB,IAAA9qB,IAAAk6C,WAOAt6C;KAAAmpC,aAAA4M,KAAA7gC,MAEAlV,KAAAmd,GAAA+X,OAAAygB,YACA31C,KAAAiqC,UAAA/0B,MAAAygC,WAGA,MAAAlqB,QAUAmvB,UAAAna,OAEA8c,gBAAA,KAIAzO,aAAA,SAAArjB,MAQA,MAPAA,MAAAzrB,KAAAmvC,eAAA1jB,MAEAzrB,KAAAmd,GAAA+X,OACAl1B,KAAAu9C,gBAAAtpC,EAAA,sCACAihB,OAAAl1B,KAAAk9C,eAAAzxB,QAGAA,MAKAujB,cAAA,WACAhvC,KAAAu9C,kBACAv9C,KAAAu9C,gBAAAv9B,SACAhgB,KAAAu9C,gBAAA,OAOAL,eAAA,SAAAzxB,MACA,GAEA0xB,SACA/+C,EAAA8sB,IACA1B,IAAA4zB,QACAn/B,YALAg/B,QAAAhpC,EAAA,wBACA8hC,KAAAkH,QAAA5iC,KAAA,KAUA,KAJA8iC,QAAAn9C,KAAAs9C,aAAA7xB,MAEAzrB,KAAAw9C,oBAAA/xB,MAEAjC,IAAA,EAAAA,IAAA2zB,QAAA9+C,OAAAmrB,MAAA,CAOA,IANA4zB,QAAAD,QAAA3zB,KACAgC,cAAA4xB,SAEAn/B,YAAAhK,EAAA,qCAGA7V,EAAA,EAAAA,EAAAg/C,QAAA/+C,OAAAD,IACA8sB,IAAAkyB,QAAAh/C,GACA8sB,IAAA/N,GAAApB,IAAA/b,KAAAy9C,uBAAAvyB,MAGAA,IAAApM,OAAAoM,IAAArM,IAAA,IACAqM,IAAA/N,GAAAhD,SAAA,YAGA8D,YAAAiX,OAAAhK,IAAA/N,GAGA44B;KAAA7gB,OAAAjhB,EAAA,SAAAihB,OAAAjX,cAKA,MAFAje,MAAAmpC,aAAA4M,KAAA,iBAEAkH,SAMAX,mBAAA,WACA,GACAl+C,GADAy7C,SAAA75C,KAAAyrB,UAAA7qB,OAAAZ,KAAAq7C,qBAKA,KAFAr7C,KAAAw9C,oBAAA3D,SAEAz7C,EAAA,EAAAA,EAAAy7C,QAAAx7C,OAAAD,IACAy7C,QAAAz7C,GAAA+e,GAAApB,IACA/b,KAAA09C,uBAAA7D,QAAAz7C,MAOAo/C,oBAAA,SAAA/xB,MACA,GAAArtB,GAAA8sB,GAEA,KAAA9sB,EAAA,EAAAA,EAAAqtB,KAAAptB,OAAAD,IACA8sB,IAAAO,KAAArtB,GACA8sB,IAAArM,IAAA7e,KAAAy8C,eAAAvxB,IAAA/qB,MAAA+qB,IAAA/qB,OACA+qB,IAAApM,OAAA9e,KAAAy8C,eAAAvxB,IAAA9qB,IAAA8qB,IAAA/qB,QAMAkvC,UAAA,SAAAnkB,IAAAkkB,iBACA,GAOAqH,UACAkH,aACAC,cATAhvB,KAAA5uB,KAAA4uB,KACA3V,MAAAiS,IAAAjS,MACAs5B,YAAA3jB,KAAAuhB,iBAAAl3B,OACA09B,sBAAAvH,iBAAAlkB,IAAA1J,SAAAoN,KAAAgoB,0BAAA39B,OACA49B,oBAAAzH,iBAAAlkB,IAAAzJ,OAAAmN,KAAAkoB,wBAAA79B,OACAgd,QAAAj2B,KAAAsyC,cAAApnB,IAAAqnB,YAAAoE,sBAAAE,oBACAE,QAAAzyB,SAAAtkB,KAAAyyC,gBAAAx5B,OAuBA;MAlBAgd,SAAAhb,QAAA,qBAAA,cAEA2T,KAAAivB,gBAAA5kC,QAIAiS,IAAA1J,SAAA0J,IAAAzJ,SACAg1B,SAAAz2C,KAAAoyC,iBAAAlnB,KACAyyB,aAAA39C,KAAAoyC,iBAAAlnB,IAAA,MACA0yB,cAAA59C,KAAAoyC,iBAAAlnB,IAAA,MAAA,KAIAurB,SAAAz2C,KAAAoyC,iBAAAn5B,OACA0kC,aAAA39C,KAAAoyC,iBAAAn5B,MAAA,MACA2kC,cAAA59C,KAAAoyC,iBAAAn5B,MAAA,MAAA,IAGA,aAAAgd,QAAA52B,KAAA,KAAA,KACA4Z,MAAAhE,IACA,UAAAmP,WAAAnL,MAAAhE,KAAA,IACA,KAEA8hC,QACA,WAAAA,QAAA,IACA,IAEA,6BAEAN,SACA,oCACAryB,WAAAw5B,eAAA,gBACAx5B,WAAAu5B,cAAA,WAEAv5B,WAAAqyB,UAAA,gBAEA,KAEAx9B,MAAAtC,MACA,yBACAyN,WAAAnL,MAAAtC,OACA,SACA,IAEA,8BAQAkgC,mBACA,4CACA,IAEA;EAMA4G,uBAAA,SAAAvyB,KACA,GAIApP,MACAI,MALA4hC,cAAA99C,KAAA4uB,KAAAia,IAAA,oBACApc,cAAAvB,IAAAuB,cACAF,aAAArB,IAAAqB,aACAmN,MAAA15B,KAAA09C,uBAAAxyB,IA2BA,OAvBA4yB,iBAEAvxB,aAAAtwB,KAAA0kB,IAAA,EAAA8L,cAAA,GAAAF,aAAAE,iBAGAzsB,KAAA8nB,OACAhM,KAAA,EAAAyQ,aACArQ,MAAAuQ,gBAGA3Q,KAAA2Q,cACAvQ,MAAA,EAAAqQ,cAGAmN,MAAA+O,OAAAvd,IAAAe,MAAA,EACAyN,MAAA5d,KAAA,IAAAA,KAAA,IACA4d,MAAAxd,MAAA,IAAAA,MAAA,IAEA4hC,eAAA5yB,IAAAkB,kBAEAsN,MAAA15B,KAAA8nB,MAAA,aAAA,eAAA,IAGA4R,OAKAgkB,uBAAA,SAAAxyB,KACA,OACArM,IAAAqM,IAAArM,IACAC,QAAAoM,IAAApM,SAMAw+B,aAAA,SAAA7xB,MACA,GACArtB,GADA++C,UAGA;IAAA/+C,EAAA,EAAAA,EAAA4B,KAAA8iC,OAAA1kC,IACA++C,QAAA7+C,QAGA,KAAAF,EAAA,EAAAA,EAAAqtB,KAAAptB,OAAAD,IACA++C,QAAA1xB,KAAArtB,GAAAorB,KAAAlrB,KAAAmtB,KAAArtB,GAGA,OAAA++C,WA0LA,IAAAY,MAAAn3B,GAAAm3B,KAAA70B,MAAAnR,QAEA7C,KAAA,KACApD,KAAA,KACA6E,MAAA,KAEAqe,SAAA,KACA7xB,QAAA,KACA0jC,SAAA,KACA1pB,GAAA,KAEA+R,aAAA,EACA8uB,oBAAA,EACAC,kBAAA,EAGA99C,MAAA,KACAC,IAAA,KAIAgvB,cAAA,KACAC,YAAA,KACA+e,iBAAA,KACA8P,aAAA,KAEAC,YAAA,EAGAC,WAAA,KACAvc,UAAA,KAGAkM,kBAAA,KACAI,mBAAA,KACAE,oBAAA,KAGAgQ,iBAAA,KACAC,gBAAA,KAGA1d,uBAAA,KAGAJ,YAAA,SAAAxL,SAAA9f,KAAA/R,QAAAirC,kBAEApuC,KAAAg1B,SAAAA,SACAh1B,KAAAkV,KAAAlV,KAAA8R,KAAAoD,KACAlV,KAAAmD,QAAAA,QACAnD,KAAAouC,iBAAAA,kBAAAh6B,OAAA2N,SAAA,EAAA,OAEA/hB,KAAAq+C,iBAAAjqC,OAAA2N,SAAA/hB,KAAA6oC,IAAA,qBACA7oC,KAAAu+C,mBACAv+C,KAAAw+C,iBAEAx+C,KAAA4gC,uBAAAhc,MAAA5kB,KAAA,qBAEAA,KAAAy+C;EAKAA,WAAA,aAMA5V,IAAA,SAAA/2B,MACA,MAAA9R,MAAAmD,QAAA2O,OAKA8D,QAAA,SAAA9D,KAAAkS,SACA,GAAAgR,UAAAh1B,KAAAg1B,QAEA,OAAAA,UAAApf,QAAAsF,MACA8Z,UACAljB,KAAAkS,SAAAhkB,MAAAY,OACAD,MAAAV,UAAAgC,MAAAsH,KAAAlJ,UAAA,IACAL,SAWA0+C,QAAA,SAAA9iD,MACAoE,KAAA4qC,SAAA5qC,KAAA2+C,aAAA/iD,QAMAgvC,SAAA,SAAA1qC,OACA+T,EAAA8D,OAAA/X,KAAAE,OACAF,KAAA+wB,eAMA4tB,aAAA,SAAA/iD,MACA,GAGAuE,OAAAC,IAHA89C,aAAA77B,oBAAAriB,KAAAouC,kBACAhf,cAAAxzB,KAAAkC,QAAA8gD,QAAAV,cACA7uB,YAAAD,cAAAtxB,QAAAiQ,IAAA/N,KAAAouC,iBAsBA,OAlBA,sBAAAjvC,KAAA++C,eACA9uB,cAAApN,YACAqN,YAAArN,cAGAoN,cAAAiC,YACAjC,cAAApvB,KAAAg1B,SAAAf,WAAA7E,gBAEAC,YAAAgC,YACAhC,YAAArvB,KAAAg1B,SAAAf,WAAA5E,eAIAlvB,MAAAivB,cAAAtxB,QACAqC,MAAAH,KAAAg8C,eAAA77C,OACAC,IAAAivB,YAAAvxB,QACAsC,IAAAJ,KAAAg8C,eAAA57C,IAAA,IAAA,IAGA89C,aAAAA,aACA9uB,cAAAA,cACAC,YAAAA,YACAlvB,MAAAA,MACAC,IAAAA;EAMAsxB,gBAAA,SAAA91B,MACA,MAAAoE,MAAAivB,mBACArzB,KAAAkC,QAAA8gD,QAAA5+C,KAAAk+C,cAAAhiB,SAAAl8B,KAAAouC,kBAAA,KAMAxc,gBAAA,SAAAh2B,MACA,MAAAoE,MAAAivB,mBACArzB,KAAAkC,QAAA8gD,QAAA5+C,KAAAk+C,cAAAnwC,IAAA/N,KAAAouC,oBAQAnf,mBAAA,SAAArzB,KAAAikB,WAQA,MAPA7f,MAAAouC,iBAAA1rB,GAAA,SAAA,GACA1iB,KAAA80C,YAAAl5C,QACAA,KAAAoE,KAAAg8C,eAAApgD,KAAAikB,WACAjkB,KAAAgjD,QAAA,QAIAhjD,MASAm1B,YAAA,WACA/wB,KAAA2W,MAAA3W,KAAA6+C,gBAKAA,aAAA,WACA,MAAA7+C,MAAA4nB,aACAznB,MAAAH,KAAAovB,cAAAhvB,IAAAJ,KAAAqvB,aACArvB,KAAA6oC,IAAA,gBAAA7oC,KAAA8+C,qBACA9+C,KAAA6oC,IAAA;EAOAiW,mBAAA,WACA,MAAA,QAAA9+C,KAAAk+C,aACA,OAEA,SAAAl+C,KAAAk+C,aACAl+C,KAAA6oC,IAAA,mBAEA7oC,KAAAouC,iBAAA1rB,GAAA,QAAA,EACA,KAGA,MAOAkF,YAAA,SAAA1nB,MAAA8mB,UAAAa,WACA,GAAAznB,KAAAF,MAAAE,GAMA,OAJAA,KAAAixB,YACAjxB,IAAAA,IAAAtC,QAAAo+B,SAAA,IAGAtU,YAAA1nB,MAAAC,MAAAC,IAAA4mB,UAAAa,UAAA7nB,KAAA6oC,IAAA,WAUA9Z,WAAA,SAAA5R,IACAnd,KAAAmd,GAAAA,GACAnd,KAAAyrC,sBAMApd,cAAA,WACAruB,KAAAwiC,QAGAxiC,KAAAg+C,qBACAh+C,KAAA++C,kBACA/+C,KAAAg+C,oBAAA,GAGAh+C,KAAA0rC,uBAEA1rC,KAAAmd,GAAA6C,UASAsP,QAAA,SAAA1zB,MACA,GAAAojD,aAAA,IAEAh/C,MAAAkvB,cACA8vB,YAAAh/C,KAAAi/C,eAGAj/C,KAAAwiC,QACAxiC,KAAA0+C,QAAA9iD,MACAoE,KAAA8sB,SACA9sB,KAAA2vB,aACA3vB,KAAA00C,sBACA10C,KAAAkvB,aAAA,EAEA8vB,YAAAh/C,KAAAk/C,qBAAAF,aACAh/C,KAAAm/C,YAAAH,aAEAh/C,KAAAo/C;EAMA5c,MAAA,WACAxiC,KAAAkvB,cACAlvB,KAAAwxB,WACAxxB,KAAAwwB,cACAxwB,KAAAq/C,iBACAr/C,KAAAs/C,uBACAt/C,KAAAmuB,UACAnuB,KAAAkvB,aAAA,IAMApC,OAAA,WACA9sB,KAAAg+C,qBACAh+C,KAAA2rC,iBACA3rC,KAAAg+C,oBAAA,GAEAh+C,KAAA4rC,eAOAzd,QAAA,WACAnuB,KAAA6rC,gBAKAF,eAAA,aAMAoT,gBAAA,aAOAnT,YAAA,aAMAC,aAAA,aAMA6I,oBAAA,aAMA4K,qBAAA,aAMAF,cAAA,WACAp/C,KAAA4V,QAAA,aAAA5V,KAAAA,KAAAA,KAAAmd,KAKAkiC,eAAA,WACAr/C,KAAA4V,QAAA,cAAA5V,KAAAA,KAAAA,KAAAmd,KAKAsuB,mBAAA,WACAx3B,EAAA0K,UAAAzN,GAAA,YAAAlR,KAAA4gC;EAKA8K,qBAAA,WACAz3B,EAAA0K,UAAA0iB,IAAA,YAAArhC,KAAA4gC,yBAKA2d,iBAAA,WACA,GAAAnxB,IAAAptB,KAAA6oC,IAAA,SAAA,KAAA,IAEA7oC,MAAA+tC,kBAAA3gB,GAAA,iBACAptB,KAAAmuC,mBAAA/gB,GAAA,kBACAptB,KAAAquC,oBAAAjhB,GAAA,oBASAuC,WAAA,SAAAysB,UACA,GAAA4C,YAEA5C,YACA4C,YAAAh/C,KAAAi/C,eAGAj/C,KAAAu/C,eACAv/C,KAAAw/C,cAEApD,UACAp8C,KAAAy/C,UAAAT,cAMAQ,YAAA,aAMAD,aAAA,WACA,GAAAvqB,UAAAh1B,KAAAg1B,QAEAh1B,MAAA0/C,UACA1qB,SAAAN,yBACAM,SAAAL,iBAOA+qB,UAAA,aAWAC,sBAAA,SAAAC,aACA,GACAC,MACAC,YAFA1B,WAAAp+C,KAAAo+C,UAcA;MAVAyB,MAAA7/C,KAAAmd,GAAApP,IAAAqwC,YAGAyB,KAAA9jC,KACAuC,SAAA,WACAxC,KAAA,KAEAgkC,YAAA9/C,KAAAmd,GAAAG,cAAA8gC,WAAA7gC,SACAsiC,KAAA9jC,KAAAuC,SAAA,GAAAxC,KAAA,KAEA8jC,YAAAE,aAMAZ,qBAAA,WACA,MAAA,IAKAD,YAAA,WACA,MAAAj/C,MAAAo+C,WACAp+C,KAAAo+C,WAAAvc,YADA,QAOA4d,UAAA,SAAAT,aACA,MAAAh/C,MAAAo+C,WACAp+C,KAAAo+C,WAAAvc,UAAAmd,aADA,QAOAG,YAAA,SAAAH,aACA,GAAAhe,OAAAhhC,IAEAA,MAAAy/C,UAAAT,aACA35B,WAAA,WACA2b,MAAAye,UAAAT,cACA,IASAzuB,cAAA,SAAAxX,QACA,GAAAimC,aAAAh/C,KAAAi/C,aAEAj/C,MAAAwwB,cACAxwB,KAAAswB,aAAAvX,QACA/Y,KAAAi+C,kBAAA,EACAj+C,KAAAy/C,UAAAT,aACAh/C,KAAA+/C;EAKAvvB,YAAA,WACAxwB,KAAAi+C,mBACAj+C,KAAAggD,sBACAhgD,KAAAowB,gBACApwB,KAAAi+C,kBAAA,IAMA3tB,aAAA,aAMAF,cAAA,aAMA2vB,mBAAA,WACA//C,KAAAigD,qBAAA,SAAA/0B,KACAlrB,KAAA4V,QAAA,mBAAAsV,IAAAjS,MAAAiS,IAAAjS,MAAAiS,IAAA/N,MAEAnd,KAAA4V,QAAA,wBAKAoqC,oBAAA,WACAhgD,KAAAigD,qBAAA,SAAA/0B,KACAlrB,KAAA4V,QAAA,eAAAsV,IAAAjS,MAAAiS,IAAAjS,MAAAiS,IAAA/N,OAOAmyB,eAAA,SAAAr2B,MAAAkE,IACA,GAAA+iC,QAAAlgD,KAAA4V,QAAA,cAAAqD,MAAAA,MAAAkE,GASA,OAPA+iC,WAAA,EACA/iC,GAAA,KAEA+iC,QAAAA,UAAA,IACA/iC,GAAAlJ,EAAAisC,SAGA/iC,IAKAyzB,UAAA,SAAA33B,OACAjZ,KAAAigD,qBAAA,SAAA/0B,KACAA,IAAA/N,GAAApB,IAAA,aAAA;EACA9C,QAKAu3B,UAAA,SAAAv3B,OACAjZ,KAAAigD,qBAAA,SAAA/0B,KACAA,IAAA/N,GAAApB,IAAA,aAAA,WACA9C,QAOAgnC,qBAAA,SAAAl7B,KAAA9L,OACA,GACA7a,GADAqtB,KAAAzrB,KAAAkvC,cAGA,KAAA9wC,EAAA,EAAAA,EAAAqtB,KAAAptB,OAAAD,IACA6a,OAAAwS,KAAArtB,GAAA6a,MAAA+Q,MAAA/Q,MAAA+Q,KACAyB,KAAArtB,GAAA+e,IACA4H,KAAAxb,KAAAvJ,KAAAyrB,KAAArtB,KAQA8wC,aAAA,WAEA,UASAiB,iBAAA,SAAAl3B,OACA,GAAA4Q,QAAA5Q,MAAA4Q,UAEA,OAAA1F,cACAlL,MAAAknC,cACAt2B,OAAAs2B,cACAngD,KAAA6oC,IAAA,sBACA5vB,MAAA2zB,SACA/iB,OAAA+iB,SACA5sC,KAAA6oC,IAAA,cAOAiI,gBAAA,SAAA73B,MAAAo3B,aAAAhV,UAAAle,GAAAiD,IACA,GAAA4U,UAAAh1B,KAAAg1B,SACAorB,aAAAprB,SAAAwE,YAAAvgB,MAAAo3B,aAAAhV,WACAQ,SAAA,WACAukB,aAAA/jB,OACArH,SAAAlE;CAGA9wB,MAAAqgD,iBAAApnC,MAAAmnC,aAAAhkB,UAAAP,SAAA1e,GAAAiD,IACA4U,SAAAlE,qBAKAuvB,iBAAA,SAAApnC,MAAAmjB,UAAAP,SAAA1e,GAAAiD,IACApgB,KAAA4V,QAAA,YAAAuH,GAAA,GAAAlE,MAAAmjB,UAAAP,SAAAzb,QAWAqxB,mBAAA,SAAAF,KAAAlB,aAAAlzB,GAAAiD,GAAAixB,IACA,GACA1Z,YACA1e,MAFA2R,WAAA2mB,KAAA3mB,UAKAA,cACA+M,WAAA1jB,EAAA8D,UAAA6S,WAAAylB,cACAp3B,MAAAjZ,KAAAg1B,SAAA4E,YAAAjC,WAAA4Z,KAAAzmB,OAAA,IAGA9qB,KAAAsgD,oBAAArnC,MAAAo3B,aAAAlzB,GAAAiD,GAAAixB,KAKAiP,oBAAA,SAAArnC,MAAAo3B,aAAAlzB,GAAAiD,GAAAixB,IAGArxC,KAAA4V,QAAA,OAAAuH,GAAA,GAAAkzB,aAAAlwC,MAAAigB,GAAAixB,IAEAp4B,OACAjZ,KAAA4V,QAAA,eAAA,KAAAqD,QAWAy3B,WAAA,aAMAC,YAAA,aAUAiG,0BAAA,SAAA39B,OACA,MAAAjZ,MAAA6oC,IAAA,4BAAA7oC,KAAAiwC,iBAAAh3B;EAKA69B,wBAAA,SAAA79B,OACA,MAAAjZ,MAAAiwC,iBAAAh3B,QAKAg3B,iBAAA,SAAAh3B,OACA,GAAA4Q,QAAA5Q,MAAA4Q,UAEA,OAAA1F,cACAlL,MAAAc,iBACA8P,OAAA9P,iBACA/Z,KAAA6oC,IAAA,yBACA5vB,MAAA2zB,SACA/iB,OAAA+iB,SACA5sC,KAAA6oC,IAAA,cAMAoJ,kBAAA,SAAAh5B,MAAAy4B,eAAArW,UAAAle,GAAAiD,IACA,GAAA4U,UAAAh1B,KAAAg1B,SACAorB,aAAAprB,SAAAwE,YAAAvgB,MAAAy4B,eAAArW,WACAQ,SAAA,WACAukB,aAAA/jB,OACArH,SAAAlE,oBAGA9wB,MAAAugD,mBAAAtnC,MAAAmnC,aAAAxkB,cAAAC,SAAA1e,GAAAiD,IACA4U,SAAAlE,qBAKAyvB,mBAAA,SAAAtnC,MAAA2iB,cAAAC,SAAA1e,GAAAiD,IACApgB,KAAA4V,QAAA,cAAAuH,GAAA,GAAAlE,MAAA2iB,cAAAC,SAAAzb;EAUAgR,OAAA,SAAAlxB,MAAAkgB,IACApgB,KAAAwxB,SAAApR,IACApgB,KAAAosC,gBAAAlsC,OACAF,KAAAssC,gBAAApsC,MAAAkgB,KAKAgsB,gBAAA,aAMAE,gBAAA,SAAApsC,MAAAkgB,IACApgB,KAAAm+C,YAAA,EACAn+C,KAAA4V,QAAA,SAAA,KAAA1V,MAAAC,MAAAD,MAAAE,IAAAggB,KAMAoR,SAAA,SAAApR,IACApgB,KAAAm+C,aACAn+C,KAAAm+C,YAAA,EACAn+C,KAAAqsC,mBACArsC,KAAA4V,QAAA,WAAA,KAAAwK,MAMAisB,iBAAA,aAMAlL,kBAAA,SAAA/gB,IACA,GAAAogC,OAGAxgD,MAAAm+C,YAAAn+C,KAAA6oC,IAAA,iBAAA1oB,qBAAAC,MAGAogC,OAAAxgD,KAAA6oC,IAAA,kBACA2X,QAAAvsC,EAAAmM,GAAA6P,QAAAmR,QAAAof,QAAAniD,QACA2B,KAAAwxB,SAAApR,MAWAo+B,eAAA,WACA,GAGApgD,GAHAqiD,WAAAzgD,KAAA6oC,IAAA,kBACAyV,mBACAoC,OAAA,CAOA;IAJA1gD,KAAA6oC,IAAA,eAAA,GACA4X,WAAAniD,KAAA,EAAA,GAGAF,EAAA,EAAA,EAAAA,EAAAA,KAEAkgD,gBAAAlgD,GAAA,KAAA6V,EAAAuH,QAAApd,EAAAqiD,cAEAC,QAIA,KAAAA,OACA,KAAA,oBAGA1gD,MAAAs+C,gBAAAA,iBAMAxJ,YAAA,SAAApsC,KAIA,MAHA0L,QAAAyR,SAAAnd,OACAA,IAAAA,IAAAA,OAEA1I,KAAAs+C,gBAAA51C,MAQAszC,eAAA,SAAApgD,KAAA8L,IAAAi5C,aACA,GAAAzmB,KAAAt+B,KAAAkC,OAEA,KADA4J,IAAAA,KAAA,EAEA1H,KAAAs+C,iBAAApkB,IAAAxxB,OAAAi4C,YAAAj5C,IAAA,GAAA,GAAA,IAEAwyB,IAAAnsB,IAAArG,IAAA,OAEA,OAAAwyB,MAMAib,gBAAA,SAAAj1C,OACA,GAGA0gD,WAHAC,SAAA3gD,MAAAC,MAAArC,QAAAkkB,YACA5hB,IAAAF,MAAAE,IACA0gD,OAAA,IAqBA,OAlBA1gD,OACA0gD,OAAA1gD,IAAAtC,QAAAkkB,YACA4+B,WAAAxgD,IAAA1C,OAKAkjD,WAAAA,WAAA5gD,KAAAq+C,kBACAyC,OAAA/yC,IAAA,EAAA,WAMA3N,KAAAygD,UAAAC,UACAA,OAAAD,SAAA/iD,QAAAiQ,IAAA,EAAA,UAGA5N,MAAA0gD,SAAAzgD,IAAA0gD;EAKAjD,gBAAA,SAAA5kC,OACA,GAAA/Y,OAAAF,KAAAm1C,gBAAAl8B,MAEA,OAAA/Y,OAAAE,IAAA8Y,KAAAhZ,MAAAC,MAAA,QAAA,KAOA4gD,SAAAn6B,GAAAm6B,SAAAn6B,GAAA+X,aAAAzV,MAAAnR,QAEAipC,YAAA,KACAC,aAAA,KACA3lC,UAAA,KACAnY,QAAA,KACA+9C,cAAA,KACAtyB,KAAA,KACArB,OAAA,KAKAiT,YAAA5T,qBAIAgG,YAAA,SAAAtX,WACA,GAAA0M,MAAAi5B,aACAn5B,MAAAk5B,WAIA1lC,WAAAH,iBAAAG,WAEA0M,KAAA1M,UAAA0M,KACAi5B,aAAAE,eAAAn5B,MACAi5B,eACAj5B,KAAA+4B,SAAAK,SAAAp5B,KACAi5B,aAAAE,eAAAn5B,WAGAF,MAAA3D,aACA7I,UAAAwM,MACAm5B,aAAAn5B,MACAi5B,SAAAK,SAAAt5B,OAEAk5B,YAAAl5B,MAAAi5B,SAAAM,eAEArhD,KAAAghD,YAAAA,YACAhhD,KAAAihD,aAAAA,aACAjhD,KAAAsb,UAAAA,UACAtb,KAAAmD,QAAAwX,aACAomC,SAAAK,SACAJ,YACAC,aACA3lC,WAEAsZ,kCAAA50B,KAAAmD,SAEAnD,KAAAkhD;EAKA3uB,YAAA,SAAA/D,UACA,GAAA2I,OAAAn3B,KAAAkhD,aAEA,OAAA/pB,OAAA3I,YAAA2I,MAAA3I,UAAAxuB,KAAAshD,cAAA9yB,YAMAgE,gBAAA,SAAApQ,MACA,GAAAm/B,WACAnjD,EACAk0B,IAEA,IAAA,IAAAre,EAAAuH,QAAA4G,KAAAE,eAQA,IALAi/B,UAAAvhD,KAAAutB,OAAAyJ,sBACA/iB,EAAAyE,KAAAkO,GAAArL,MAAA,SAAAiT,UACA+yB,UAAAjjD,KAAAkwB,YAGApwB,EAAA,EAAAA,EAAAmjD,UAAAljD,OAAAD,IAEA,GADAk0B,KAAAtyB,KAAAuyB,YAAAgvB,UAAAnjD,IACAk0B,MACAA,KAAAkvB,YAAAp/B,KACA,MAAAkQ,OASAgvB,cAAA,SAAAG,mBAaA,IAZA,GAIAC,WACAN,SACA9lC,UACAyG,SACAK,KACAkQ,KATAqvB,cAAA3hD,KAAAsb,UAAAC,UACAqmC,iBACAC,kBACArzB,SAAAizB,kBASAjzB,WAAAkzB,WACAN,SAAA7iB,QAAA/P,cACAlT,UAAAqmC,cAAAnzB,cACAzM,SAAAA,UAAAzG,UAAAyG,UAAAq/B,SAAAr/B,SACAyM,SAAAlT,UAAApG,MAAAksC,SAAAlsC,KAEA,kBAAAksC,WACAM,UAAAN,SACAQ,cAAA3mC,QAAAymC,UAAAN,eAGAQ,cAAA3mC,QAAAmmC,UAEAS,eAAA5mC,QAAAK,UAGA;MAAAomC,YACApvB,MAAAwvB,QAAAJ,UAAAxsC,KAAAusC,mBAEA1/B,WACAA,SAAA3N,OAAA2N,SAAAA,UACAA,SAAAya,YACAza,SAAA,OAGAA,WACAuQ,KAAAvQ,SAAAA,SACAK,KAAAC,oBAAAN,UAIA,IAAAA,SAAAW,GAAAN,QACAkQ,KAAAkvB,WAAAp/B,KACAy/B,eAAA5mC,QAAA0mC,cAAAv/B,aAKAkQ,KAAA8uB,SAAAzmC,aAAAO,MAAA,KAAA0mC,eACAtvB,KAAAhX,UAAAX,aAAAO,MAAA,KAAA2mC,gBAEA7hD,KAAA+hD,qBAAAzvB,MACAtyB,KAAAgiD,wBAAA1vB,KAAAmvB,mBAEAnvB,MA5BA,QAkCAyvB,qBAAA,SAAAzvB,MACAA,KAAAnvB,QAAAwX,aACAomC,SAAAK,SACA9uB,KAAA8uB,SACAphD,KAAAghD,YACAhhD,KAAAihD,aACAjhD,KAAAsb,UACAgX,KAAAhX,WAEAsZ,kCAAAtC,KAAAnvB;EAKA6+C,wBAAA,SAAA1vB,KAAAmvB,mBAIA,QAAAQ,iBAAA9+C,SACA,GAAAmzB,YAAAnzB,QAAAmzB,cACA,OAAAA,YAAAmrB,qBACAnvB,KAAAkvB,WAAAlrB,WAAAhE,KAAAkvB,YAAA,MAIAlvB,KAAA8D,mBACA6rB,gBAAAjiD,KAAAsb,YACAgX,KAAAhX,UAAAgb,WAGAhE,KAAA+D,kBACA4rB,gBAAAjiD,KAAAihD,eACAgB,gBAAAjiD,KAAAghD,cACA1uB,KAAA8uB,SAAA9qB,YACA2rB,gBAAAlB,SAAAK,YACA9uB,KAAAvQ,SAAA/hB,KAAAq0B,iBAAA/B,KAAAvQ,UAAA,OACA0/B,mBAKA3yB,gBAAA,SAAAN,UACA,GAAA8D,MAAAtyB,KAAAuyB,YAAA/D,SAEA,OAAA,IAAA8D,MAAA,SAAAtyB,KAAAwuB,SAAA8D,KAAAnvB,QAAAmvB,KAAAvQ;EAKAmgC,gBAAA,SAAA1zB,UACA,MAAAntB,SAAArB,KAAAuyB,YAAA/D,aAspBAuyB,UAAAK,UAEAe,oBAAA,MACAC,gBAAA,YAEA9wB,0BAAA,WACAC,4BAAAjmB,KAAA,GACAuvB,oBAAA,EACAwjB,iBAAA,WAGAzwB,YAAA,QACAoC,YAAA,KACAzC,QACAzR,KAAA,QACAumC,OAAA,GACAnmC,MAAA,mBAEAomC,UAAA,EACAC,aAAA,EAEAC,gBAAA,IACA7uB,sBAAA,QAKAlD,cAAA,EACA6H,WAAA,QACAC,SAAA,MACAC,cAAA,WAEA5E,UAAA,EAKA9L,OAAA,EACAwO,YACA7E,KAAA,OACAE,KAAA,OACAE,SAAA,YACAC,SAAA,YACA11B,KAAA,OACA21B,MAAA,QACA10B,MAAA,QACA4hC,KAAA,OACAv2B,IAAA,OAGA8tB,aACA/E,KAAA,oBACAE,KAAA,qBACAE,SAAA,oBACAC,SAAA,sBAIAzE,OAAA,EACAkJ,kBACA9E,KAAA,oBACAE,KAAA,oBACAE,SAAA,YACAC,SAAA,aAIA2wB,YAAA,IACAC,mBAAA,IACAC,YAAA,EAGAC,cAAA,EAEAC,WAAA,IAEAC,YAAA,EACAC,eAAA,OACAC,gBAAA,UACAC,iBAAA,KAEAp1B,oBAAA,EACAG,kBAAA,KAKA+yB,SAAAmC,iBACAD,iBAAA,gBAIAlC,SAAAM,aACA9zB,QACAzR,KAAA,kBACAumC,OAAA,GACAnmC,MAAA,SAEAsa,aACA/E,KAAA,qBACAE,KAAA,oBACAE,SAAA,qBACAC,SAAA,qBAEAyE,kBACA9E,KAAA,oBACAE,KAAA,oBACAG,SAAA,YACAD,SAAA,aAMA;GAAAsvB,gBAAAv6B,GAAAu8B,QASAv8B,IAAAw8B,eAAA,SAAAtuB,SAAAuuB,WAAAC,WAGA,GAAAC,WAAApC,eAAArsB,YAAAqsB,eAAArsB,aAGAyuB,WAAAz7B,MAAAw7B,UAAAx7B,MACAy7B,UAAAf,gBAAAc,UAAAE,WAGAvvC,EAAAyE,KAAA+qC,oBAAA,SAAA3xC,KAAAiT,MACAw+B,UAAAzxC,MAAAiT,KAAAu+B,aAIArvC,EAAAyvC,aAMAzvC,EAAAyvC,WAAAC,SAAAN,YACApvC,EAAAyvC,WAAAC,SAAA7uB,UACAwuB,UAGArvC,EAAAyvC,WAAAC,SAAAC,GAAA3vC,EAAAyvC,WAAAC,SAAA,IAGA1vC,EAAAyvC,WAAAG,YAAAP,aAMA18B,GAAAoB,KAAA,SAAA8M,SAAAgvB,cACA,GAAAP,WACAQ,UAGAR,WAAApC,eAAArsB,YAAAqsB,eAAArsB,cAGAgvB,eACAP,UAAApC,eAAArsB,UAAAna,aAAA4oC,UAAAO,eAMAC,WAAAhxB,oBAAA+B,UACA7gB,EAAAyE,KAAAsrC,qBAAA,SAAAlyC,KAAAiT,MACA,MAAAw+B,UAAAzxC,QACAyxC,UAAAzxC,MAAAiT,KAAAg/B,WAAAR;GAKAxC,SAAAK,SAAAp5B,KAAA8M,SAMA,IAAA2uB,sBAEAntB,WAAA,SAAAgtB,WACA,OAEA7xB,KAAApN,kBAAAi/B,UAAAW,UACAtyB,KAAAtN,kBAAAi/B,UAAAY,UACAnyB,MAAA1N,kBAAAi/B,UAAAa,eAKA/B,gBAAA,SAAAkB,WACA,MAAAA,WAAAc,mBACA,QAAAd,UAAAe,WAAA,SACA,aAAAf,UAAAe,WAAA,MAKAL,sBAGAM,iBAAA,SAAAP,WAAAR,WACA,GAAA1sC,QAAAktC,WAAA97B,eAAA,IAWA,OARApR,QAAAA,OAAA5L,QAAA,2BAAA,IAEAs4C,UAAAz7B,MACAjR,QAAA,OAGAA,OAAA,OAAAA,OAEAA,QAIA0tC,iBAAA,SAAAR,YACA,MAAAA,YAAA97B,eAAA,MACAhd,QAAA,SAAA;EAIAu5C,gBAAA,SAAAT,YACA,MAAAA,YAAA97B,eAAA,MACAhd,QAAA,MAAA,SACAA,QAAA,UAAA,QACAA,QAAA,SAAA,MAIAw5C,qBAAA,SAAAV,YACA,MAAAA,YAAA97B,eAAA,MACAhd,QAAA,MAAA,SACAA,QAAA,UAAA,QACAA,QAAA,SAAA,MAIAy5C,WAAA,SAAAX,YACA,MAAAA,YAAA97B,eAAA,MACAhd,QAAA,MAAA,IACAA,QAAA,UAAA,IACAA,QAAA,SAAA,MAIA05C,qBAAA,SAAAZ,YACA,MAAAA,YAAA97B,eAAA,MACAhd,QAAA,SAAA,MAOA4pB,2BAGA+vB,mBAAA,SAAAzhD,SACA,MAAAA,SAAA2kB,MACA,OACA,QAIA+8B,WAAA,SAAA1hD,SACA,MAAAA,SAAA2kB,MACA,MAAA3kB,QAAAq/C,gBAAA,IACA,IAAAr/C,QAAAq/C,gBAAA;EAIAsC,gBAAA,SAAA3hD,SACA,MAAAA,SAAA2kB,MACA,KAAA3kB,QAAAq/C,gBAAA,IACA,IAAAr/C,QAAAq/C,gBAAA,MAyBA57B,IAAAoB,KAAA,KAAA+4B,SAAAmC,iBA2OAt8B,GAAAkS,qBACAlS,GAAAqR,iBAEA,IAAAQ,eACApjB,SAAA,OACA8hB,OAAA,GAGAiD,UAAA,CAykCA2mB,UAAA9gD,UAAA89B,cAAA,SAAA9kB,OACA,GAEA7a,GAAA2mD,WAFA5tB,MAAAn3B,KAAAq+B,gBACAX,aAGA,KAAAt/B,EAAA,EAAAA,EAAA+4B,MAAA94B,OAAAD,IACA2mD,WAAA5tB,MAAA/4B,GAEA6a,OACAA,MAAA+Q,MAAA+6B,WAAA/6B,KAEA0T,WAAAp/B,KAAAymD,WAIA,OAAArnB,YAkBA,IAAAsnB,WAAAzmB,QAAA0mB,MAAAlH,KAAAhmC,QAEAmtC,QAAA,KAEAC,mBAAA,EACAC,oBAAA,EAEAC,gBAAA,KAEAC,UAAA,KAGA7G,WAAA,WACAz+C,KAAAklD,QAAA,GAAApR,SAAA9zC,MACAA,KAAA6mC,SAAA7mC,KAAAklD,QAAAre;EAKA+D,SAAA,SAAA1qC,OACA69C,KAAA99C,UAAA2qC,SAAArhC,KAAAvJ,KAAAE,OAEAF,KAAAklD,QAAAjR,aAAA,kBAAA90C,KAAAa,KAAAk+C,cACAl+C,KAAAklD,QAAAta,SAAA1qC,QAKAy+C,aAAA,SAAA/iD,MACA,GAAAsE,OAAA69C,KAAA99C,UAAA0+C,aAAAp1C,KAAAvJ,KAAApE,KAcA,OAXA,aAAAuD,KAAAe,MAAAg+C,gBACAh+C,MAAAC,MAAAy+C,QAAA,QACA1+C,MAAAC,MAAAH,KAAAg8C,eAAA97C,MAAAC,OAGAD,MAAAE,IAAAsC,YACAxC,MAAAE,IAAA2N,IAAA,EAAA,QAAA6wC,QAAA,QACA1+C,MAAAE,IAAAJ,KAAAg8C,eAAA97C,MAAAE,IAAA,IAAA,KAIAF,OAKA4sB,OAAA,WAEA9sB,KAAAmlD,kBAAAnlD,KAAAklD,QAAAriB,OAAA,EACA7iC,KAAAolD,mBAAAplD,KAAA6oC,IAAA,eACA7oC,KAAAklD,QAAAnR,eAAA/zC,KAAAmlD,mBAAAnlD,KAAAolD,mBAEAplD,KAAAmd,GAAAhD,SAAA,iBAAAozB,KAAAvtC,KAAAu7C,cAEAv7C,KAAAslD,UAAAtlD,KAAAmd,GAAA9C,KAAA,iBAEAra,KAAAo+C,WAAAp+C,KAAAmd,GAAA9C,KAAA,0BACAra,KAAAklD,QAAAre,SAAA5oB,YAAAje,KAAAo+C,WAEAp+C,KAAAklD,QAAAn2B,WAAA/uB,KAAAmd,GAAA9C,KAAA,iBACAra,KAAAklD,QAAAtZ,YAAA5rC,KAAAulD;EAMAp3B,QAAA,WACAnuB,KAAAklD,QAAArZ,eACA7rC,KAAAklD,QAAA72B,iBAIAqmB,oBAAA,WACA10C,KAAAklD,QAAAxQ,uBAMA6G,WAAA,WACA,MAAA,gDAIAv7C,KAAA+tC,kBAAA,KACA/tC,KAAAklD,QAAApX,WACA,2DAKA9tC,KAAAmuC,mBAAA,mGAaAqX,cAAA,WACA,MAAAxlD,MAAAolD,mBACA,6BACAplD,KAAA+tC,kBAAA,KAAA/tC,KAAAylD,sBAAA,UAEArhC,WAAApkB,KAAA6oC,IAAA,oBACA,eALA;EAaA6c,gBAAA,SAAAn8B,KACA,MAAAvpB,MAAAolD,mBACA,8BACAplD,KAAAylD,sBAAA,UAEAzlD,KAAAklD,QAAAziB,QAAAlZ,IAAA,GAAAppB,MAAA0W,OAAA,KACA,eALA,QAaA8uC,aAAA,WACA,MAAA3lD,MAAAolD,mBACA,6BAAAplD,KAAAmuC,mBAAA,KACAnuC,KAAAylD,sBAAA,SAFA,QASAG,UAAA,WACA,MAAA5lD,MAAAolD,mBACA,8BAAAplD,KAAAylD,sBAAA,SADA,QAQAI,eAAA,SAAAjjB,MACA,GACA3M,SADAr6B,KAAAgnC,KAAAziC,KAGA,OAAAH,MAAAmlD,mBAIAlvB,QAAAj2B,KAAAklD,QAAAhX,cAAAtyC,MACAq6B,QAAAhb,QAAA,iBAEA,cACAgb,QAAA52B,KAAA,KAAA,gBAAAzD,KAAAib,SAAA,KACAjb,KAAAA,OACA,SATA;EAcA6pD,oBAAA,WACA,MAAA,QAAAzlD,KAAAqlD,gBACA,gBAAArlD,KAAAqlD,gBAAA,MAEA,IAKAE,aAAA,WACA,GAAAzC,YAAA9iD,KAAA6oC,IAAA,aACA,OAAAia,aAAA,gBAAAA,aASAtD,YAAA,WACAx/C,KAAAolD,qBAGAplD,KAAAqlD,gBAAA3nC,gBACA1d,KAAAmd,GAAA9C,KAAA,sBAOAqlC,UAAA,SAAAE,YAAAkG,QACA,GACAC,gBADAjD,WAAA9iD,KAAA6oC,IAAA,aAIAzqB,eAAApe,KAAAo+C,YACA/hC,mBAAArc,KAAAslD,WAEAtlD,KAAAklD,QAAAzQ,oBAGAqO,YAAA,gBAAAA,aACA9iD,KAAAklD,QAAApN,UAAAgL,YAGAiD,eAAA/lD,KAAA2/C,sBAAAC,aACA5/C,KAAAgmD,cAAAD,eAAAD,QAGAhD,YAAA,gBAAAA,aACA9iD,KAAAklD,QAAApN,UAAAgL,aAGAgD,QAAA9nC,qBAAAhe,KAAAo+C,WAAA2H,kBAEApqC,iBAAA3b,KAAAslD,UAAAtmC,mBAAAhf,KAAAo+C,aAGA2H,eAAA/lD,KAAA2/C,sBAAAC,aACA5/C,KAAAo+C,WAAA7gC,OAAAwoC;EAMAC,cAAA,SAAAzoC,OAAAuoC,QACAA,OACA5oC,mBAAAld,KAAAklD,QAAAtpC,QAGAY,iBAAAxc,KAAAklD,QAAAtpC,OAAA2B,QAAA,IAUA+S,aAAA,SAAAvX,QACA/Y,KAAAklD,QAAA50B,aAAAvX,QAEA/Y,KAAAu/C,gBAKArQ,aAAA,WACA,MAAAlvC,MAAAklD,QAAAhW,gBAKA9e,cAAA,WACApwB,KAAAklD,QAAA90B,iBAaAsgB,WAAA,SAAAL,aAAAnlB,KACA,MAAAlrB,MAAAklD,QAAAxU,WAAAL,aAAAnlB,MAIAylB,YAAA,WACA3wC,KAAAklD,QAAAvU,eASAvE,gBAAA,SAAAlsC,OACAF,KAAAklD,QAAA9Y,gBAAAlsC,QAKAmsC,iBAAA,WACArsC,KAAAklD,QAAA7Y,sBAUA4Z,UAAA1nB,QAAAlhC,MAAA2nD,UAAAjtC,QAGA4mC,aAAA,SAAA/iD,MACA,GACAinC,QADA3iC,MAAA8kD,UAAA/kD,UAAA0+C,aAAAp1C,KAAAvJ,KAAApE,KASA;MALAoE,MAAAkmD,iBACArjB,OAAA5mC,KAAAC,KAAAgE,MAAAE,IAAA8Y,KAAAhZ,MAAAC,MAAA,SAAA,IACAD,MAAAE,IAAA2N,IAAA,EAAA80B,OAAA,UAGA3iC,OAKA8lD,cAAA,SAAAzoC,OAAAuoC,QAEAA,OAAAA,QAAA,aAAA9lD,KAAA6oC,IAAA,YAGAid,SACAvoC,QAAAvd,KAAA6iC,OAAA,GAGArmB,iBAAAxc,KAAAklD,QAAAtpC,OAAA2B,QAAAuoC,SAIAI,aAAA,WACA,GAAAC,UAAAnmD,KAAA6oC,IAAA,WACA,OAAAsd,UACA,UAAAA,SAGAnmD,KAAA6oC,IAAA,oBAKAod,WAAAlkC,UAAAqkC,OAAA,GAEAH,UAAA7E,UACAiF,gBAAA,GAOA9nB,QAAA+nB,WACApxC,KAAA,QACA6M,UAAAmd,MAAA,IAOAX,QAAAgoB,UACArxC,KAAA,QACA6M,UAAAzW,KAAA,GASA,IAAAk7C,kBACAC,YAAA,EACAC,WAAA,UACAC,WAAA,WACA9L,aAAA,WACAE,QAAA,WACAC,QAAA,WACA4L,kBAAA,GAGAC,2BAAA,EAEAC,WAAAvoB,QAAAwoB,OAAAhJ,KAAAhmC,QAEAivC,SAAA,KACA9B,QAAA,KAEA+B,UAAA,KAEAC,eAAA,KAGAC,aAAA,KACAC,iBAAA,KAGA3I,WAAA,WACAz+C,KAAAgnD,SAAA,GAAApM,UAAA56C,MAEAA,KAAA6oC,IAAA,eACA7oC,KAAAklD,QAAA,GAAApR,SAAA9zC,MAGAA,KAAA6mC,SAAA,GAAA3D,gBACAljC,KAAAklD,QAAAre,SACA7mC,KAAAgnD,SAAAngB,YAIA7mC,KAAA6mC,SAAA7mC,KAAAgnD,SAAAngB;EAUA+D,SAAA,SAAA1qC,OACA69C,KAAA99C,UAAA2qC,SAAArhC,KAAAvJ,KAAAE,OAEAF,KAAAgnD,SAAApc,SAAA1qC,OACAF,KAAAklD,SACAllD,KAAAklD,QAAAta,SAAA1qC,QAMA4sB,OAAA,WAEA9sB,KAAAmd,GAAAhD,SAAA,kBAAAozB,KAAAvtC,KAAAu7C,cAGAv7C,KAAAo+C,WAAAp+C,KAAAmd,GAAA9C,KAAA,2BACAra,KAAAgnD,SAAAngB,SAAA5oB,YAAAje,KAAAo+C,WAEAp+C,KAAAgnD,SAAAj4B,WAAA/uB,KAAAmd,GAAA9C,KAAA,kBACAra,KAAAgnD,SAAApb,cAGA5rC,KAAAmnD,aAAAlzC,EAAA,yBAAAjU,KAAA+tC,kBAAA,OACAjuB,SAAA9f,KAAAgnD,SAAA7pC,IAEAnd,KAAAklD,UACAllD,KAAAklD,QAAAn2B,WAAA/uB,KAAAmd,GAAA9C,KAAA,iBACAra,KAAAklD,QAAAtZ,cAGA5rC,KAAAklD,QAAAlR,mBAAAh0C,KAAAklD,QAAA/nC,GAAAwU,KAAA,MAAArU,eAGAtd,KAAAknD,eAAAlnD,KAAAmd,GAAA9C,KAAA;EAMA8T,QAAA,WACAnuB,KAAAgnD,SAAAnb,eACA7rC,KAAAgnD,SAAA34B,gBAEAruB,KAAAklD,UACAllD,KAAAklD,QAAArZ,eACA7rC,KAAAklD,QAAA72B,kBAKAqmB,oBAAA,WACA10C,KAAAgnD,SAAAtS,sBAEA10C,KAAAklD,SACAllD,KAAAklD,QAAAxQ,uBAOA6G,WAAA,WACA,MAAA,gDAIAv7C,KAAA+tC,kBAAA,KACA/tC,KAAAgnD,SAAAlZ,WACA,2DAKA9tC,KAAAmuC,mBAAA,MACAnuC,KAAAklD,QACA,mDACAllD,KAAA+tC,kBAAA,MACA,IAEA;EAYAyX,cAAA,WACA,GAAA5pD,MACAyrD,QAEA,OAAArnD,MAAA6oC,IAAA,gBACAjtC,KAAAoE,KAAAgnD,SAAAvkB,QAAA,GAAAtiC,MACAknD,SAAAzrD,KAAAib,OAAA7W,KAAA6oC,IAAA,oBAEA,qCACA7oC,KAAA+tC,kBAAA,KAAA/tC,KAAA+7C,gBAAA,UAEA33B,WAAAijC,UACA,gBAIA,sBAAArnD,KAAA+tC,kBAAA,KAAA/tC,KAAA+7C,gBAAA,UAOA4J,aAAA,WACA,MAAA,sBACA3lD,KAAAmuC,mBAAA,KAAAnuC,KAAA+7C,gBAAA,WAEA/7C,KAAA6oC,IAAA,eAAAzkB,WAAApkB,KAAA6oC,IAAA,gBACA,gBAMAye,gBAAA,WACA,MAAA,sBAAAtnD,KAAAmuC,mBAAA,KAAAnuC,KAAA+7C,gBAAA;EAOA6J,UAAA,WACA,MAAA,uBAAA5lD,KAAA+7C,gBAAA,UAKAA,cAAA,WACA,MAAA,QAAA/7C,KAAAinD,UACA,gBAAAjnD,KAAAinD,UAAA,MAEA,IAQAt3B,WAAA,SAAAysB,UACAp8C,KAAAgnD,SAAAr3B,WAAAysB,UAEA2B,KAAA99C,UAAA0vB,WAAApmB,KAAAvJ,KAAAo8C,WAKAoD,YAAA,WAEAx/C,KAAAinD,UAAAvpC,gBAAA1d,KAAAmd,GAAA9C,KAAA,cAKAqlC,UAAA,SAAAE,YAAAkG,QACA,GAAAhD,YACAiD,cAEA,QAAA/lD,KAAAonD,mBAEApnD,KAAAonD,iBAAApnD,KAAAmnD,aAAA7pC,eAEAtd,KAAAmnD,aAAApmB,OAGA/gC,KAAAo+C,WAAAriC,IAAA,WAAA,IACAqC,cAAApe,KAAAo+C,YACA/hC,mBAAArc,KAAAknD,gBAGAlnD,KAAAklD,UACAllD,KAAAklD,QAAAzQ,oBAEAqO,WAAA9iD,KAAA6oC,IAAA,cACAia,YAAA,gBAAAA,cACAA,WAAA+D,4BAEA/D,YACA9iD,KAAAklD,QAAApN,UAAAgL,aAIAgD,SAEAC,eAAA/lD,KAAA2/C,sBAAAC,aACA5hC,qBAAAhe,KAAAo+C,WAAA2H,iBAGApqC,iBAAA3b,KAAAknD,eAAAloC,mBAAAhf,KAAAo+C,aAIA2H,eAAA/lD,KAAA2/C,sBAAAC,aACA5/C,KAAAo+C,WAAA7gC,OAAAwoC,kBAIA/lD,KAAAo+C,WAAA7gC,OAAAwoC,gBAAAhqC,IAAA,WAAA,UACA/b,KAAAmnD,aAAArmB;EAOAoe,qBAAA,WACA,GAAAyH,YAAAvyC,OAAA2N,SAAA/hB,KAAA6oC,IAAA,eACAhqB,IAAA7e,KAAAgnD,SAAAxK,eAAAmK,WASA,OANA9nC,KAAA5iB,KAAAC,KAAA2iB,KAEAA,KACAA,MAGAA,KASAyR,aAAA,SAAAvX,QACA,GAGAwuC,WACAnpD,EAJAopD,aACAC,eACAC,UAKA,KAAAtpD,EAAA,EAAAA,EAAA2a,OAAA1a,OAAAD,IACA2a,OAAA3a,GAAAqsB,OACA+8B,UAAAlpD,KAAAya,OAAA3a,IAGAqpD,YAAAnpD,KAAAya,OAAA3a,GAKAmpD,WAAAvnD,KAAAgnD,SAAA12B,aAAAm3B,aACAznD,KAAAklD,UACAwC,QAAA1nD,KAAAklD,QAAA50B,aAAAk3B,YAIAxnD,KAAAu/C,gBAKArQ,aAAA,WACA,MAAAlvC,MAAAgnD,SAAA9X,eAAAtuC,OACAZ,KAAAklD,QAAAllD,KAAAklD,QAAAhW,oBAMA9e,cAAA,WAGApwB,KAAAgnD,SAAA52B,gBACApwB,KAAAklD,SACAllD,KAAAklD,QAAA90B;EAcAsgB,WAAA,SAAAL,aAAAnlB,KACA,MAAAmlB,cAAAlwC,MAAAkxB,UACArxB,KAAAgnD,SAAAtW,WAAAL,aAAAnlB,KAEAlrB,KAAAklD,QACAllD,KAAAklD,QAAAxU,WAAAL,aAAAnlB,KADA,QAMAylB,YAAA,WACA3wC,KAAAgnD,SAAArW,cACA3wC,KAAAklD,SACAllD,KAAAklD,QAAAvU,eAUAvE,gBAAA,SAAAlsC,OACAA,MAAAC,MAAAkxB,WAAAnxB,MAAAE,IAAAixB,UACArxB,KAAAgnD,SAAA5a,gBAAAlsC,OAEAF,KAAAklD,SACAllD,KAAAklD,QAAA9Y,gBAAAlsC,QAMAmsC,iBAAA,WACArsC,KAAAgnD,SAAA3a,mBACArsC,KAAAklD,SACAllD,KAAAklD,QAAA7Y,qBA4BA,OAtBAya,YAAA1F,SAAAoF,gBAOAjoB,QAAAopB,YACAzyC,KAAA,SACA6M,UAAAmd,MAAA,IAOAX,QAAAqpB,WACA1yC,KAAA,SACA6M,UAAAzW,KAAA,IAIAsb;GCniVAzsB,OACA,yDACA,oDACA,WAEA,cCaAA,OAAA,yCACA,SACA,SACA,OACA,4CACA,cACA,UACA,yDACA,SAAA6Z,EAAAC,EAAA4zC,GAAAC,aAAA5zC,SAAAgR,SASA,QAAA6iC,mBAAAC,eACA,GAAAzqC,OAGA,OAFAyqC,eAAAA,cAAAA,cAAA/zC,EAAA,kBACAsJ,OAAAtJ,EAAA,iBAAAhI,SAAA4S,IAAAmpC,cAAA/7C,SAAA4S,IACAtB,OAAAhN,SAAAy3C,cAAAjsC,IAAA,gBAAAxL,SAAAy3C,cAAAjsC,IAAA;CAWA,MAAA,UAAA5Y,SACA,KAAAA,QAAA8kD,qBAAAh0C,IAAAA,EAAA3S,SAAAqd,SAAAxb,QAAA8kD,WAAA,KACA,KAAA,IAAAC,WAAA,qEAEA,IAAAC,gBACA5zC,KAAAvU,IACAA,MAAAooD,gBAAAn0C,EAAAo0C,WAEAroD,KAAAyN,KAAA,WACA06C,gBACAngC,KAAA9C,QAAAojC,UACA7zB,YAAA,GAAAh5B,MACAmxC,UAAA,EACA2b,YAAA,EACAC,cAAA,EACA5F,cAAA,EACArlC,OAAAwqC,oBACAjF,YAAA,EACA1xB,OAAApd,EAAAy0C,KAEAC,WAAA,OACAzN,WAAA,QACA0N,QAAA,SAAAA,SACAA,QACAp0C,KAAA6zC,gBAAAn0C,EAAAo0C,WAEA9zC,KAAA6zC,gBAAAQ,WAGAC,YAAA,SAAAryC,QAAAsyC,UAIAA,SAAA3uC,SAAA2tC,aAAAhzC,gBAAA0B,QAAApI,IACAoI,QAAAmB,mBACAmxC,SAAA5zB,OAAA,0CAEA1e,QAAAmD,UAAAnD,QAAAoD,aACAkvC,SAAA5zB,OAAA,kCAAA1e,QAAAoD,YAAA,GAAA;EAGAmvC,UAAA,SAAAvyC,QAAA5L,EAAAo+C,YACAxyC,QAAAmD,UACAqvC,aACA90C,WAAA2D,QAAAgwC,GAAA,qCAEAC,aAAAvxC,UAAAC,QAAAxC,EAAAy0C,KAAA,WAAAO,gBAGAC,YAAA,SAAAzyC,QAAA5L,EAAAo+C,YACAxyC,QAAAmD,UACAqvC,aACA90C,WAAA2D,QAAAgwC,GAAA,qCAEAC,aAAAvxC,UAAAC,QAAAxC,EAAAy0C,KAAA,WAAAO,gBAGAjwC,OAAA,SAAA5Y,MAAAC,IAAAwzB,SAAAnkB,UACAwE,EAAAe,MACAC,IAAA,6CAAA6yC,aAAAjvC,mBACAxD,SAAA,OACAF,MACAhV,MAAAA,MAAA+oD,OACA9oD,IAAAA,IAAA8oD,QAEA5zC,QAAA,SAAAC,UACA,GAAAwD,UAEAxE,MAAA7U,KAAA,gBACAuU,EAAAyE,KAAAnD,SAAA,SAAArR,IAAA+U,OACA,GAAAkwC,iBAAArB,aAAArwC,mBAAAwB,MACAF;OAAAza,KAAA2a,OACAhF,EAAAyE,KAAAywC,gBAAA,SAAA9vC,UAAA+vC,WACArwC,OAAAza,KAAA8qD,eAIA35C,SAAAsJ,aAMA5V,QAAA6Q,EAAAq1C,OAAAlB,eAAAhlD,SACAA,QAAA8kD,WAAAtyC,aAAAxS,UAIAnD,KAAAN,KAAA,WACA,MAAAyD,SAAA8kD,WAAAtyC,aAAAuF,MAAA/X,QAAA8kD,WAAA5nD,YAUAL,KAAAspD,SAAA,SAAA5zC,WACAnB,KAAA7U,KAAA,cAAAgW,WAAA,IASA1V,KAAAupD,SAAA,SAAA5wC,SACA,GAAA6wC,UAAAv1C,EAAAo0C,WACA7xC,QAAAjC,KAAA7U,KAAA,eAAAiZ,QAWA,OATA,KAAAnC,QAAAnY,OACAmY,QAAAsxC,aAAAryC,UAAAkD,QAAA,SAAAjD,WACAnB,KAAA7U,KAAA,cAAAgW,UACA,IAAAc,SAAAjC,KAAA7U,KAAA,eAAAiZ,QACA6wC,UAAAZ,QAAApyC,QAAA;GAGAgzC,SAAAZ,QAAApyC,QAAA,IAEAgzC,SAAAC,WAUAzpD,KAAA0pD,UAAA,SAAA/wC,SACA,GAAA6wC,UAAAv1C,EAAAo0C,UAmBA,OAlBA9zC,MAAAg1C,SAAA5wC,SAAAlH,KAAA,SAAA+E,SACAsxC,aAAA9uC,gBAAAxC,QAAApI,IAAA/P,QACAkW,KAAA7U,KAAA,WAAA8W,QAAArW,OAEAoU,KAAA6zC,gBAAA32C,KAAA,WACA,GAEA9H,KAFAggD,cAAA7B,aAAA9uC,gBAAAxC,QAAApI,IACAw7C,UAAAzmD,QAAA8kD,WAAA5tC,KAAA,eAGAuvC,WAAAvrD,SACAsL,IAAAggD,cAAA19C,SAAA4S,IAAA+qC,UAAA39C,SAAA4S,IAAA+qC,UAAA/nB,YACA+nB,UAAA/nB,UAAAl4B,MAGA6/C,SAAAZ,QAAApyC,aAIAgzC,SAAAC,WAGA,OAAAvkC,QAAAojC,UACAluD,SAAA,6CAAA8qB,QAAAojC,WAAA,WACA/zC,KAAA9G;EACA,WACA8G,KAAA9G,SAGA8G,KAAA9G,UCrMA,SAAAwgB,OAAAtP,SAAAjI,YAGA,SAAA+D,SAEA,kBAAAtgB,SAAAA,OAAA+T,IACA/T,OAAA,4CAAA,UAAAsgB,SAEAC,SAAAA,OAAA8jB,GAAAqrB,MACApvC,QAAAC,SAGA,SAAAzG,GAqEA,QAAA61C,MAAA75B,OAAA9sB,QAAAiL,GAAAlH,MAEAlH,KAAAoO,GAAAA,GACApO,KAAAiwB,OAAAA,OACAjwB,KAAA+pD,QAAAC,KACAhqD,KAAAiqD,UAAAh6B,OAAAA,QAGAjwB,KAAAgqB,IAAAkgC,UAAA,IAAA97C,GACApO,KAAAmqD,QAAAC,QACApqD,KAAAmD,QAAAA,QACAnD,KAAAqqD,WAGArqD,KAAAm3B,OACAle,SACAgX,OAAAhc,IACAq2C,SAAAC,MACArjD,KAAAA,KACAsjD,UAAAD,MACAE,UAAA,IAIAzqD,KAAA0qD,SAAA1qD,KAAA2qD,UAAA3qD,KAAAsqD,SAAAtqD,KAAA4qD,QACA5qD,KAAA6qD,iBAAA7qD,KAAA8qD,YAAA9qD,KAAA+qD,WAAAR,MAoLA,QAAAS,YAAAxsD,GACA,MAAAA,KAAAwrD,MAAA,WAAA/1C,EAAAiB,KAAA1W;CAGA,QAAAysD,gBAAA/+C,GACA,QAAA+H,EAAAgQ,WAAA/X,IAAAA,GAAAA,EAAAhF,MAAAgF,EAAA7N,QAAA,WAAA4V,EAAAiB,KAAAhJ,KAAAA,EAAAg/C,QAAAh/C,EAAAi/C,OAIA,QAAAC,iBAAA9mD,MACA,GAAAyoB,SAAArmB,KAAAsO,KAAAq2C,IAEA,OAAAL,YAAA1mD,MAAAimD,OAEAS,WAAA1mD,KAAAgnD,YACAhnD,KAAAgnD,UAAAp2C,KAAA5Q,KAAAgnD,WAGA,WAAAhnD,QACAyoB,QAAAzoB,KAAAyoB,QAEAi+B,WAAAj+B,UAAAA,QAAAm+B,QAAAn+B,QAAAtb,KACAsb,QAAAzoB,KAAAyoB,SACArmB,KAAAA,KAAAukD,eAAAl+B,SAAAw9B,MAAAx9B,SAGArmB,KAAAqmB,QAAArmB,KAIA,QAAAqmB,WACA/X,KAAA+X,QAAA/X,KACAq2C,KAAAr2C,MAAAA,KAAAq2C,OAAAd,YACAx9B,SAAA/X,KAEA+X,QAAArmB,KAAA,SAAAuS,MAAAsyC,KACA,GAAA5C,SAAAjiD,MAAAuN,EAAAjU,MAAAkH,KAAAqkD,IAAApoD,QAAA4pB,QAAA7lB,OAAA,aAEAsiD,SAAAv1C,EAAAe,KACAf,EAAA8D,UAAA/C,MAAAkQ,QAAAqmC,OAEAJ,KAAAn2C,KAAAM,QAAA00C,KAAAh1C,KAAAmB,OACAg1C,KAAA,SAAAp+B,SAEA,MADAA,UAAAs+B,MAAAE,IAAAh+C,IAAA,eAAAwf,SACAA;EAEA,SAAA3W,IAAAo1C,OAAAr1C,OACAo1C,IAAAZ,WAAA,IAAAv0C,IAAAo1C,QACAD,IAAAh+C,IAAA,eAAAi+C,OAAA,KAAAr1C,QAGA,OAAAk1C,MAAA1C,SAAA4C,IAAAh+C,IAAA,eAAAo7C,SAAAa,YAIA,SAAAz8B,WACA9Y,EAAA+G,cAAA+R,QAAApW,SACAoW,QAAAmJ,OAAAnJ,QAAApW,MAAAuf,OACAnJ,QAAApW,MAAAoW,QAAApW,MAAAjQ,MAGAukD,eAAAl+B,QAAApW,OAAA4zC,SACAx9B,QAAApW,MAAA4zC,SAKA,YAAAjmD,OAAA0mD,WAAA1mD,KAAAga,YACAha,KAAAga,UAAAmtC,GAAAnnD,KAAAga,SAAAotC,GAAApnD,KAAAga,WAGA,QAAAha,OAAA0mD,WAAA1mD,KAAAw8B,QACAx8B,KAAAw8B,KAAAx8B,KAAAw8B,KAAAoqB,QAAAj7B,OAAA3rB,KAAAw8B,MACAx8B,KAAAw8B,OAAA6qB,MAAAC,MAAAD,OAAA1yC,MAAA3U,KAAAw8B,OAGA,QAAAx8B,OAAA0mD,WAAA1mD,KAAAy8B,QACAz8B,KAAAy8B,KAAAz8B,KAAAy8B,KAAAmqB,QAAAj7B,OAAA3rB,KAAAy8B,OAAA9nB,MAAA3U,KAAAy8B,OAGA,SAAAz8B,OAAA0mD,WAAA1mD,KAAA6sC,SACA7sC,KAAA6sC,OAAAlb,QAAA3xB,KAAA6sC,QAIAl9B,EAAAyE,KAAAmzC,QAAA,WACA7rD,KAAA8rD,UAAA9rD,KAAA8rD,SAAAxnD;GAGAA,MAkGA,QAAAynD,iBAAA5oD,QAAA6oD,UAOA,IANA,GAAA5qD,KAAAhD,EAAA,EAAAu0B,OAAAxvB,QAGAuoB,OAAAsgC,SAAA7gD,MAAA,KAGAwnB,OAAAA,OAAAjH,OAAAttB,OACAA,EAAAstB,OAAArtB,SAAA+C,IAAAuxB,OAGA,QAAAvxB,KAAA+B,QAAAuoB,OAAA2qB,OAYA,QAAA4V,aAAAD,SAAArkD,MACA,GAAAukD,UAAAr6C,KAAAtG,KAEA,KAAA2gD,WAAAlsD,MAAAmsD,OACA,IAAAt6C,OAAA7R,MAAAmsD,OAAAD,WACA3gD,MAAA,GAAA6gD,QAAAv6C,KAAA,KAAAnS,KAAAssD,aACArkD,KAAArJ,KAAAiN,QAEA,YAAA2gD,UAAAlsD,KAAAqqD,QAAA6B,YACAlsD,KAAAmsD,OAAAD,UAAAr6C,MAAAqJ,MACAlb,KAAAqqD,QAAA6B,WAAAlsD,KAAA2H,OAkuBA,QAAA0kD,mBAAAC,KACA,MAAAC,QAAA3rD,OAAA,IAAAvB,KAAAitD,IAAA,IAAAA,IAAA,IAAA,KA2BA,QAAAE,OAAA/8C,SAAAsS,UAEA,MAAAA,UAAA,EACAsD,WACApR,EAAA2Q,MAAAnV,SAAAzP,MAAA+hB,cAGAtS,UAAAlG,KAAAvJ;CAGA,QAAAysD,YAAAxzC,OACAjZ,KAAA+pD,QAAArzB,SAAAg2B,kBAGAC,aAAA3sD,KAAAmqD,OAAArpB,MACA6rB,aAAA3sD,KAAAmqD,OAAAppB,MAGA/gC,KAAAmqD,OAAArpB,KAAA0rB,MAAAjjD,KAAAvJ,KACA,WAAAA,KAAA4sD,OAAAjB,KAAA1yC,QACAjZ,KAAAmD,QAAA29B,KAAA0rB,QAIA,QAAAK,YAAA5zC,OACA,IAAAjZ,KAAA+pD,QAAArzB,SAAAg2B,kBAAA1sD,KAAA2qD,UAAA,CAGA,GAAAmC,eAAA74C,EAAAgF,MAAA6zC,eACAC,YAAAD,cAAA1rB,QAAA4rB,UAAA,KAAAhtD,KAAA+pD,QAAA,GACAkD,WAAAH,cAAA,KAAA9sD,KAAAmD,QAAA29B,KAAA7Q,OAAA,EAQA,IALA08B,aAAA3sD,KAAAmqD,OAAArpB,MACA6rB,aAAA3sD,KAAAmqD,OAAAppB,MAIA/gC,OAAA8sD,cAAA,IACA,UAAA9sD,KAAAmD,QAAAmb,SAAA2R,QAAA88B,aACA/sD,KAAAmD,QAAA49B,KAAAmsB,OACA,wBAAA/tD,KAAA8Z,MAAA/D,QAAA63C,aAAAE,YAGA,IACAh0C,MAAAqrB,iBACArrB,MAAAk0C;CACA,MAAAviD,QAMA5K,MAAAmqD,OAAAppB,KAAAyrB,MAAAjjD,KAAAvJ,KACA,WAAAA,KAAA4sD,OAAArC,MAAAtxC,QACAjZ,KAAAmD,QAAA49B,KAAAyrB,MACAxsD,OAIA,QAAAotD,gBAAAn0C,QACAjZ,KAAA+pD,QAAArzB,SAAAg2B,iBAAA1sD,KAAAmD,QAAA49B,KAAAssB,WAGAV,aAAA3sD,KAAAmqD,OAAAkD,UAEArtD,KAAAmqD,OAAAkD,SAAAb,MAAAjjD,KAAAvJ,KACA,WAAAA,KAAA+gC,KAAA9nB,QACAjZ,KAAAmD,QAAA49B,KAAAssB,WAIA,QAAAC,kBAAAr0C,OACAjZ,KAAA0qD,UAAA1qD,KAAA+pD,QAAA,GAAAwD,YAAA,GAAAvtD,KAAAwtD,WAAAv0C,OAyBA,QAAAw0C,UAAAC,SAAA30C,OAAAvL,QACAyG,EAAA0K,SAAAgvC,MAAAF,SAAAC,UACA30C,OAAA5N,MAAA4N,OAAAA,OAAA1Z,KAAA,IAAA6qD,UAAA,MAAA,IAAAA,UACA,WACA,GAAAqB,KAAAqC,KAAArC,IAAAt3C,EAAA/M,KAAAlH,KAAA6tD,SACAtC,OAAAA,IAAAjB,UAAA98C,OAAA0N,MAAAqwC,IAAAlrD;GA6SA,QAAAoN,MAAAqgD,KAAA1/C,GAAA9J,MACA,GAAAlD,KAAA2sD,WAAA7mD,KAAA7M,OAAAsc,MAGAq3C,QAAA/5C,EAAA0K,SAAAgvC,MAGAM,UAAAH,KAAA,KAAAnvC,SAAAqvC,QAAAF,KAGAxC,SAAAwC,KAAA,SAAAA,KAAAxC,SAAAhnD,KAAAgnD,UAAAtB,KAGAkE,UAAA,UAAA5pD,KAAAgnD,SAAAp2C,MAAAo2C,SAAAA,SAAAhnD,KAAAgnD,SAAAx5C,MAAAk4C,KAGAmE,MAAAL,KAAA34C,KAAA7Q,KAAAgnD,SAAAx5C,MAAA,WAGA,KAAAq8C,MAAA,gBAAAA,OAAAl6C,EAAAqE,UAAA61C,OAAAA,MAAA,MAAAvjD,IAYA,GATAvQ,OAAA4Z,EAAA8D,OAAA4zC,QAAAiC,KAAAxM,SAAA98C,KACA,gBAAA6pD,OAAA/C,gBAAA+C,OAAAnE,KACAoB,gBAAA8C,WAAA5C,WAGAyC,WAAA1zD,OAAAikB,SACAjkB,OAAA+T,GAAAA,GAGA,iBAAA/T,QAAA0yB,QAAArmB,KAAA,CAIA,GAHAQ,KAAA4mD,KAAA5mD,KAAA7M,OAAA0yB,QAAA7lB,MAGA7M,OAAA0yB,QAAA7lB,OAAAqjD,QAAArjD,KAGA,MAAAqjD,MAHAlwD;OAAA0yB,QAAArmB,KAAAQ,KAsBA,GAfA6mD,WAAAK,UAAA/vD,SAAA0vD,WAAAK,UAAAJ,SACAD,WAAA99B,SAAAs6B,QAAAwD,WAAA99B,OAAAg+B,WACA5zD,OAAAymC,KAAA7Q,SAAAs6B,QAAAlwD,OAAAymC,KAAA7Q,OAAAg+B,WACA5zD,OAAAymC,KAAAutB,OAAA1C,OAAAtxD,OAAAymC,KAAAutB,KAAAN,WAAAK,UAAAhtB,QAAA,SACA/mC,OAAA0mC,KAAA9Q,SAAAs6B,QAAAlwD,OAAA0mC,KAAA9Q,OAAAg+B,WACA5zD,OAAAikB,SAAAgwC,WAAA3C,OAAAtxD,OAAAikB,SAAAgwC,SAAAP,WAAAK,WAGAL,WAAAK,UAAAL,WAAAK,UAAA3vC,GAAA,GAGAsvC,WAAArC,GAAA,GAAA6C,QAAAR,WAAArC,GAAAC,MACAoC,WAAAtC,GAAA,GAAA8C,QAAAR,WAAAtC,IAGAqC,KAAA34C,KAAA+0C,WACA,GAAA7vD,OAAAm0D,UACAV,KAAAjE,KAAA,WAAA,OAEA,IAAAxvD,OAAAm0D,YAAAjE,MACA,MAAAA,MAiBA;MAZAuD,MAAA5mD,KAAAunD,SAAArgD,IAGA/T,OAAAq0D,WAAA/3C,MAAAm3C,KAAA5mD,KAAA,WAEA4mD,KAAA/2B,WAAA,SAAA7vB,KAAAynD,SAAAh4C,OAAAzP,KAAA,QAAA,IAIA9F,IAAA,GAAA0oD,MAAAgE,KAAAzzD,OAAA+T,KAAAlH,MACA4mD,KAAA34C,KAAA+0C,UAAA9oD,KAEAA,IA0PA,QAAAwtD,OAAA5rD,GAAA,MAAAA,GAAA0hB,OAAA,GAAA1d,cAAAhE,EAAAf,MAAA,GAOA,QAAA4sD,WAAAf,KAAA7tC,MACA,GAEA6uC,KAAAttD,IAFAutD,OAAA9uC,KAAAyE,OAAA,GAAA1d,cAAAiZ,KAAAhe,MAAA,GACAy3B,OAAAzZ,KAAA,IAAA+uC,YAAA3vD,KAAA0vD,OAAA,KAAAA,QAAA5jD,MAAA,KACA/M,EAAA,CAGA,IAAAmmB,SAAAtE,MAAA,MAAA6tC,MAAA/xC,IAAAwI,SAAAtE,MAEA,MAAA6uC,IAAAp1B,MAAAt7B,MACA,IAAAoD,IAAAssD,KAAA/xC,IAAA+yC,QAAAp4C,UACA,MAAA6N,UAAAtE,MAAA6uC,IAAAttD,IAMA,QAAAytD,QAAAnB,KAAA7tC,MACA,MAAAhkB,MAAAC,KAAAgkB,WAAA2uC,UAAAf,KAAA7tC,QAwBA,QAAAivC,KAAArF,KAAA1mD,SACAnD,KAAAmvD,IAAA,MACAnvD,KAAAmD,QAAAA,QACAnD,KAAAiM,OAAA9I,QAAA8I,OACAjM,KAAAovD,MAAAjsD,QAAA4a,MAAA5a,QAAAoa,QAGAvd,KAAAyN,KAAAzN,KAAA6pD,KAAAA;CAguBA,QAAAwF,OAAA9D,IAAApoD,SACAnD,KAAAmD,QAAAA,QACAnD,KAAAmvD,IAAA,SAEAnvD,KAAAyN,KAAAzN,KAAA6pD,KAAA0B,KAyfA,QAAA+D,KAAA/D,KACAvrD,KAAAmvD,IAAA,MACAnvD,KAAAyN,KAAAzN,KAAA6pD,KAAA0B,KA5tGA,GAsBAqC,MAAA2B,UAAAhB,OAAAiB,OAiBAC,cAvCA9D,MAAA,EACApB,OAAA,EACAP,KAAA,KAGA0F,EAAA,IAAA1vB,EAAA,IACA2vB,MAAA,QACAC,OAAA,SAGAC,IAAA,MACAC,KAAA,OACAC,OAAA,SACAC,MAAA,QACAC,OAAA,SAIAC,WAAA,aACAC,MAAA,QAIAtE,WACA3B,UAAA,OACAuE,SAAA,eACAZ,QAAA,eACAtB,QAAA,YAAA,cACAS,SAAA,IAAA9C,UACAkG,gBAAA,mEAAAjlD,MAAA,KAEAklD,YAAAnG,UAAA,SACAoG,cAAApG,UAAA,WACAqG,YAAArG,UAAA,SACAsG,YAAAtG,UAAA,SACAwC,eAAAxC,UAAA,YAEAuG,cAAA,kBACA9B,SAAA,WAIA+B,SAOAC,GAAA,WACA,IACA,GAAA/rD,GAAA,EAAAxG,EAAAugB,SAAAiyC,cAAA,QACAxyD,EAAAyyD,UAAA,iBAAAjsD,EAAA,0BAAAxG,EAAA0yD,qBAAA,KAAA,GACAlsD,GAAA,GAEA,MAAAA,GAAA,EAAAA,EAAAmsD;IAMAC,IAAA9wC,YACA,IAAA,yDAAAxgB,KAAAuxD,UAAAC,aAAA,EAAA,KAAA,IACAjmD,QAAA,YAAA,OAAAA,QAAA,IAAA,KAAAA,QAAA,IAAA,MACAs/C,MA6BAgF,WAAAzF,KAAA7pD,UAEAsvD,UAAA4B,MAAA,SAAAC,WACA,MAAAn9C,GAAAo9C,KAAAn2C,MAAAjH,EAAAm9C,YAGA7B,UAAAziC,OAAA,SAAAgU,MACA,GAAA9gC,KAAA0qD,UAAA1qD,KAAA2qD,UAAA,MAAA3qD,KAEA,IAUA+pD,SAVA/5C,KAAAhQ,KACAmD,QAAAnD,KAAAmD,QACAg0B,MAAAn3B,KAAAm3B,MACA8yB,SAAAjqD,KAAAiqD,SACAvjD,KAAAvD,QAAA4pB,QAAArmB,KACAiQ,MAAAxT,QAAA4pB,QAAApW,MACAuf,OAAA/yB,QAAA4pB,QAAAmJ,OACA63B,WAAA5qD,QAAAmb,SAEA8yC,WADA,IAAApxD,KAAAgqB,IAAA,OAgGA,OA3FA/V,GAAA/M,KAAAlH,KAAAiwB,OAAA,GAAA,mBAAAjwB,KAAAgqB,KAGAmN,MAAAm6B,SAAAtxD,KAAAuxD,iBACAvxD,KAAAse,UAAAmtC,GAAAsC,WAAAtC,GAAAC,GAAAqC,WAAArC,KAAAD,IAIAzrD,KAAA+pD,QAAAE,SAAAF,QAAAA,QAAA91C,EAAA,UACA7F,GAAApO,KAAAgqB,IACA83B,SAAAoI,UAAAoG,cAAAntD,QAAAguC,MAAAlb,QAAAkB,MAAAm6B,UAAAjyD,KAAA,KACA0e,MAAA5a,QAAAguC,MAAApzB,OAAA,GACAR,OAAApa,QAAAguC,MAAA5zB,QAAA,GACAi0C,SAAA,UAAAzD,WAAA99B,QAAA89B,WAAA0D,OAAAC,MAGAC,KAAA,QACAC,YAAA,SACAC,cAAAtH,MACAuH,mBAAA9xD,KAAAgqB,IAAA,WACA+nC,cAAApG,OAEAqG,YAAAtF,eAAA1sD,KAAAsqD,UACApjD,KAAA2mD,QAAA7tD,KAAAoO,IACA+G,KAAA+0C,UAAAlqD,MACA8f,SAAAiuC,WAAAK,WACAl5B,OAEA+0B,SAAAl9B,QAAA9Y,EAAA,WACA6tC,QAAAoI,UAAA,WACA97C,GAAApO,KAAAgqB,IAAA,WACA6nC,cAAAlG,QAKA3rD,KAAA0qD,SAAA,GACA1qD,KAAA8qD,YAAAa,KAGAh1C,QACA3W,KAAAiyD,eAGAh+C,EAAAgQ,WAAAtN,QACAy6C,UAAA9yD,KAAA0B,KAAAkyD,aAAAv7C,MAAA4zC,SAKAr0B,QAAAl2B,KAAAmyD,gBAGAl+C,EAAAgQ,WAAAvd,OACA0qD,UAAA9yD,KAAA0B,KAAAoyD,eAAA1rD,KAAA6jD,QAEAvqD,KAAA0qD,SAAAiB,KAGA3rD,KAAAqyD,aAGAp+C,EAAAyE,KAAAmzC,QAAA,SAAA/5C,MACA,GAAA8C,SACA;WAAA5U,KAAAy+C,aAAA7pC,SAAA5U,KAAAgQ,SACAA,KAAAq6C,QAAAv4C,MAAA8C,YAKA5U,KAAAsyD,kBACAtyD,KAAAuyD,gBAGAvyD,KAAAmxD,MAAAC,WAAAjG,KAAA,WAEAn7C,KAAAwiD,SAAA,UAGAxiD,KAAA86C,YAAAP,MAGAv6C,KAAA66C,mBAAA1nD,QAAA29B,KAAA8qB,QAAA9qB,MACA9wB,KAAA48C,OAAAjB,KAAAx0B,MAAAle,MAAAsxC,OAEAv6C,KAAA66C,iBAAAN,QAIAqD,KAAArC,IAAAvrD,KAAAoO,IAAApO,KAEAA,MAGAuvD,UAAAphC,QAAA,SAAAskC,WAKA,QAAAC,WACA,IAAA1yD,KAAA2qD,UAAA,CACA3qD,KAAA2qD,UAAAgB,IAEA,IAEAgH,OAFA1iC,OAAAjwB,KAAAiwB,OACAtZ,MAAAsZ,OAAA/oB,KAAAynD,SAIA3uD,MAAA0qD,UACA1qD,KAAA+pD,QAAA7zC,KAAA,EAAA,GAAAmE,KAAA,KAAA2F,SAAA5f,MAAA4f,SAIA/L,EAAAyE,KAAA1Y,KAAAqqD,QAAA,WACArqD,KAAAmuB,SAAAnuB,KAAAmuB,WAIA,KAAAwkC,QAAA3yD,MAAAmqD,OACAwC,aAAA3sD,KAAAmqD,OAAAwI,OAIA1iC;OAAAyO,WAAAwrB,WACAnzB,WAAA82B,SACA92B,WAAA03B,UACA13B,WAAA,oBAGA/2B,KAAAmD,QAAAurD,UAAA/3C,OACAsZ,OAAA/oB,KAAA,QAAAyP,OAAAogB,WAAA43B,UAIA3uD,KAAAsyD,kBAIAtyD,KAAAmD,QAAAnD,KAAAiqD,SAAAjqD,KAAAm3B,MAAAn3B,KAAAmqD,OACAnqD,KAAAqqD,QAAArqD,KAAA0xD,MAAA1H,WAGA4D,MAAArC,IAAAvrD,KAAAoO,KA7CA,MAAApO,MAAA2qD,UAAA3qD,KAAAiwB,QAiDAwiC,YAAA9G,MAAA,SAAA3rD,KAAA+qD,aAAA/qD,KAAA0qD,SAMAgI,QAAAnpD,KAAAvJ,OALAA,KAAA+pD,QAAA6I,IAAA,gBAAA3+C,EAAA2Q,MAAA8tC,QAAA1yD,QACAA,KAAA+qD,YAAA/qD,KAAA+gC,QAMA/gC,KAAAiwB,SA+FAu/B,OAAAD,UAAApD,QACA0G,SAEAC,OAAA,SAAA1xD,IAAA2O,EAAAnL,EAAA6sB,MACA,GAAArjB,IAAAxJ,IAAA+mD,KAAAiC,KAAAmF,OAAAnuD,EACAouD,OAAA9I,UAAA,IAAA97C,EAEAA,MAAAm8C,OAAAn8C,GAAA/P,OAAA,IAAA4V,EAAA,IAAA++C,QAAA30D,QACA2B,KAAAgqB,IAAAgpC,OAEAhzD,KAAA0qD,WACA1qD,KAAA+pD,QAAA,GAAA37C,GAAApO,KAAAgqB,IACAhqB,KAAAiqD,SAAAl9B,QAAA,GAAA3e,GAAApO,KAAAgqB,IAAA,WACAhqB,KAAAiqD,SAAAtzC,MAAA,GAAAvI,GAAApO,KAAAgqB,IAAA,WAGA5oB,IAAA2O,GAAA0hB;EAEAwhC,aAAA,SAAA7xD,IAAA2O,EAAAnL,GACAA,IAAA5E,KAAA0qD,UAAA1qD,KAAA8sB,OAAA9sB,KAAAmD,QAAA29B,KAAA8qB,QAIAsH,iBAAA,SAAA9xD,IAAA2O,EAAAnL,GACA5E,KAAAoyD,eAAAxtD,IAEAuuD,iBAAA,SAAA/xD,IAAA2O,EAAAnL,EAAA6sB,MACAzxB,KAAAmD,QAAA4pB,QAAArmB,OAAA1G,KAAAiwB,OAAA/oB,KAAAuqB,OACAzxB,KAAAoyD,eAAApyD,KAAAiwB,OAAA/oB,KAAAtC,KAGAwuD,kBAAA,SAAAhyD,IAAA2O,EAAAnL,GAEA,MAAAA,IAGAA,IAAA5E,KAAAiqD,SAAAtzC,OAAA3W,KAAAiyD,mBACAjyD,MAAAkyD,aAAAttD,IAJA5E,KAAAqzD,gBAMAC,mBAAA,SAAAlyD,IAAA2O,EAAAnL,GACA5E,KAAAuzD,cAAA3uD,IAEA4uD,gCAAA,SAAApyD,IAAA2O,EAAAnL,GACA5E,KAAAuN,IAAA,WAAAwC,EAAAnL,IAIA6uD,qBAAA,SAAAryD,IAAA2O,EAAAnL,GACA,gBAAAA,KAAA5E,KAAAse,SAAAvO,GAAA3O,IAAA2O,GAAA,GAAAw+C,QAAA3pD,EAAA,OAAAmL,KAEA2jD,uBAAA,SAAAtyD,IAAA2O,EAAAnL,GACA5E,KAAA0qD,UAAA1qD,KAAA+pD,QAAAjqC,SAAAlb;EAIA+uD,eAAA,SAAAvyD,IAAA2O,EAAAnL,GACAA,KAAA5E,KAAA0qD,UAAA1qD,KAAA8sB,OAAA6+B,OAAA3rD,KAAA4sD,OAAAjB,QAIAiI,kBAAA,SAAAxyD,IAAA2O,EAAAnL,EAAAgN,GACA5R,KAAA0qD,UAAA1qD,KAAA+pD,QAAA7vC,YAAAtI,GAAAuI,SAAAvV,IAEAivD,wBAAA,SAAAzyD,IAAA2O,EAAAnL,GACA5E,KAAA0qD,UAAA1qD,KAAA+pD,QAAAhuC,IAAAhM,EAAAnL,IAEAkvD,8BAAA,WACA9zD,KAAA0qD,UAAA1qD,KAAAqyD,cAEA0B,aAAA,SAAA3yD,IAAA2O,EAAAnL,GACA5E,KAAA0qD,UAAA1qD,KAAA+pD,QAAAiI,YAAA1B,gBAAA1rD,IAIAovD,8CAAA,SAAA5yD,IAAA2O,EAAAnL,GACA5E,KAAA0qD,UAAA1qD,KAAA+pD,SAAA91C,EAAAgQ,WAAArf,GAAA,GAAA,MAAA,QAAA,UAAAmL,EAAAnL,IAIAqvD,qFAAA,WACA,GAAAj0D,KAAA0qD,SAAA,CAGA,GAAAqD,YAAA/tD,KAAAmD,QAAAmb,QACAte;KAAA+pD,QAAA7iD,KAAA,WAAA,UAAA6mD,WAAA99B,QAAA89B,WAAA0D,OAAAC,OAGA1xD,KAAAsyD,kBACAtyD,KAAAuyD,oBAoBAhD,UAAAlW,IAAA,SAAA2S,UACA,GAAAhsD,KAAA2qD,UAAA,MAAA3qD,KAEA,IAAA+P,GAAAg8C,gBAAA/rD,KAAAmD,QAAA6oD,SAAA3gD,eACA/D,OAAAyI,EAAA,GAAAA,EAAA,GAEA,OAAAzI,QAAA4sD,WAAA5sD,OAAAmE,SAAAnE,OAqBA,IAAA6sD,OAAA,iFACAC,QAAA,yBAEA7E,WAAAhiD,IAAA,SAAAolB,OAAAnyB,OACA,GAAAR,KAAA2qD,UAAA,MAAA3qD,KAEA,EAAA,GAIA8R,MAJA44C,SAAA1qD,KAAA0qD,SACA8C,WAAAjD,MACApnD,QAAAnD,KAAAmD,OACAnD,MAAAmsD,OA2CA,MAvCA,gBAAAx5B,SACA7gB,KAAA6gB,OAAAA,UAAAA,OAAA7gB,MAAAtR,OAEAmyB,OAAA1e,EAAA8D,UAAA4a,QAGA1e,EAAAyE,KAAAia,OAAA,SAAAq5B,SAAAxrD,OACA,GAAAkqD,UAAA0J,QAAAj1D,KAAA6sD,UACA,kBAAAr5B,QAAAq5B,SAIA;GAAAqI,UAAAjzD,IAAA2qD,gBAAA5oD,QAAA6oD,SAAA3gD,cACAgpD,UAAAjzD,IAAA,GAAAA,IAAA,IACAA,IAAA,GAAAA,IAAA,IAAAZ,OAAAA,MAAA8zD,SAAArgD,EAAAzT,OAAAA,MAGAgtD,WAAA2G,MAAAh1D,KAAA6sD,WAAAwB,WAGA76B,OAAAq5B,WAAA5qD,IAAA,GAAAA,IAAA,GAAAZ,MAAA6zD,YAIAjJ,gBAAAjoD,SAMAnD,KAAA8qD,YAAAa,KACA13C,EAAAyE,KAAAia,OAAA1e,EAAA2Q,MAAAqnC,YAAAjsD,OACAA,KAAA8qD,YAAAP,MAGAvqD,KAAA0qD,UAAA1qD,KAAA+pD,QAAA,GAAAwD,YAAA,GAAAC,YACAxtD,KAAAwtD,WAAA,UAAArqD,QAAAmb,SAAA2R,OAAA+5B,KAAAhqD,KAAAm3B,MAAAle,OAGAjZ,MAEAuvD,UAAAgF,QAAA,SAAAxnC,QAAAF,SACA,GAAA7c,MAAAhQ,KACAm3B,MAAAn3B,KAAAm3B,KAGA,OAAAn3B,MAAA0qD,UAAA39B,SAGA9Y,EAAAgQ,WAAA8I,WACAA,QAAAA,QAAAxjB,KAAAvJ,KAAAiqD,SAAAh6B,OAAAkH,MAAAle,MAAAjZ,OAAA,IAIAiU,EAAAgQ,WAAA8I,QAAAo+B,OACAh0B,MAAAyzB,QAAAe,KACA5+B,QAAAo+B,KAAA,SAAAj/C,GAEA,MADAirB,OAAAyzB,QAAAL,MACAv6C,KAAAukD,QAAAroD,EAAA2gB;EACAm9B,KAAA,SAAAp/C,GACA,MAAAoF,MAAAukD,QAAA3pD,EAAAiiB,YAKAE,UAAAw9B,QAAAx9B,SAAA,KAAAA,QAAAw9B,OAGAx9B,QAAAm+B,QAAAn+B,QAAA1uB,OAAA,EACAwuB,QAAA2nC,QAAAt/B,OACAnI,QAAAhR,KAAAuT,QAAA,QAAAiZ,WAAA,aAKA1b,QAAA0gB,KAAAxgB,SAGA/sB,KAAAy0D,gBAAA5nC,SAAAs+B,KAAA,SAAAuJ,QACA1kD,KAAA06C,UAAA16C,KAAA+5C,QAAA,GAAAwD,YAAA,GACAv9C,KAAAw9C,WAAAr2B,MAAAle,OAAAy7C,OAAAr2D,YAlCAksD,OAuCAgF,UAAAkF,gBAAA,SAAA5nC,SACA,GAAAsK,OAAAn3B,KAAAm3B,KAMA,OAHAA,OAAAyzB,QAAAe,MAGA13C,EAAAuqB,GAAAm2B,aAAA9nC,QAAA8nC,eAAA1gD,EAAAo0C,WAAAO,aACAn3C,KAAA,WAAA0lB,MAAAyzB,QAAAL,QACAd,WAGA8F,UAAA6C,eAAA,SAAArlC,QAAAygC,YACAxtD,KAAAu0D,QAAAxnC,QAAA/sB,KAAAiqD,SAAAl9B,QAAAygC;EAGA+B,UAAA2C,aAAA,SAAAnlC,QAAAygC,YACAxtD,KAAAu0D,QAAAxnC,QAAA/sB,KAAAiqD,SAAAtzC,MAAA62C,cAAAjD,OACAvqD,KAAAqzD,aAAA9I,QAIAgF,UAAA0C,aAAA,WAEA,GAAAhI,UAAAjqD,KAAAiqD,SACA77C,GAAApO,KAAAgqB,IAAA,QAGAigC,UAAA2K,UAAA50D,KAAAqzD,eAGApJ,SAAA2K,SAAA3gD,EAAA,WACA6tC,QAAAoI,UAAA,cAAAlqD,KAAAmD,QAAAguC,MAAA0jB,OAAAxI,kBAAA,UAAA,MAEAn3B,OACA+0B,SAAAtzC,MAAA1C,EAAA,WACA7F,GAAAA,GACA0zC,QAAAoI,UAAA,SACA2H,cAAAlG,QAGAmJ,aAAA7K,SAAAl9B,SAGA0gC,SAAA,cAAA,2CAAA,SAAAx0C,OACAhF,EAAAjU,MAAAgyD,YAAA,iCAAA,SAAA/4C,MAAA/D,KAAArE,OAAA;GAEA48C,SAAA,cAAA,qBAAA,SAAAx0C,OACAhF,EAAAjU,MAAAgyD,YAAA,iBAAA,cAAA/4C,MAAA/D,QAIAlV,KAAAmD,QAAA4pB,QAAAmJ,QAAAl2B,KAAAmyD,iBAGA5C,UAAA8D,aAAA,SAAA7F,YAEA,GAAAvD,UAAAjqD,KAAAiqD,QAEAA,UAAAtzC,QACAszC,SAAA2K,SAAA50C,SACAiqC,SAAA2K,SAAA3K,SAAAtzC,MAAAszC,SAAA/zB,OAAA8zB,KAGAwD,aAAAjD,OAAAvqD,KAAAwtD,eAGA+B,UAAAgC,gBAAA,SAAA9F,IACA,MAAAvB,WAAA,SAAAuB,IAAAzrD,KAAAmD,QAAAmb,SAAAmtC,IAAAsJ,UAGAxF,UAAA/B,WAAA,SAAAv0C,MAAA+7C,QACA,IAAAh1D,KAAA0qD,UAAA1qD,KAAA8qD,aAAA9qD,KAAA2qD,UAAA,MAAA3qD,KAGAA,MAAA8qD,YAAAa,IAEA,IAqBAsJ,oBAAAhpD,OAAAipD,SAAAC,SArBAh+B,MAAAn3B,KAAAm3B,MACA4yB,QAAA/pD,KAAA+pD,QACAgE,WAAA/tD,KAAAmD,QAAAmb,SACA2R,OAAA89B,WAAA99B,OACAw7B,GAAAsC,WAAAtC,GACAC,GAAAqC,WAAArC,GACA4C,SAAAP,WAAAO,SACAF,UAAAL,WAAAK,UACAqD,OAAA1D,WAAA0D,OACAjkD,OAAAikD,OAAAjkD,OAAArC,MAAA,KACAiqD,aAAArL,QAAAjsC,WAAAysC,OACA8K,cAAAtL,QAAAzsC,YAAAitC,OACA+K,YAAA,EACAC,aAAA,EACArgD,KAAA60C,QAAAhuC,IAAA,YACAuC,UAAAxC,KAAA,EAAA+C,IAAA,GACA22C,QAAAzL,QAAA,GAAAwD,YAAA,EACAkI,SAAAx8C,OAAA,WAAAA,MAAA/D,KACAwgD,IAAAzhD,EAAAga,QACA0nC,IAAAvH,UAAA,GAAA1vC,cACAgzC,MAAA1xD,KAAA0xD,KAIA;GAAAz9C,EAAAqD,QAAA2Y,SAAA,IAAAA,OAAA5xB,OAEAqtD,IAAAhpB,EAAAotB,KAAA9jD,EAAA6jD,KACAvxC,UAAAxC,KAAAmU,OAAA,GAAApR,IAAAoR,OAAA,QAIA,IAAA,UAAAA,OAEAy7B,IAAAhpB,EAAAotB,KAAA9jD,EAAA6jD,OAGA4B,OAAAC,OAAA1xD,KAAAmD,QAAA49B,KAAAyD,WAAArN,MAAAsK,QAAAtK,MAAAsK,OAAAkD,MACA1rB,MAAAke,MAAAsK,QAIAxoB,OAAAA,QAAA,WAAAA,MAAA/D,MAAA,WAAA+D,MAAA/D,MACA+D,MAAAke,MAAAle,MAIAy4C,OAAAA,MAAA/sB,QACA1rB,MAAAy4C,OAIA,WAAAx8C,OAAAoJ,SAAA8vC,UAAAniD,UACA0pD,IAAAhI,KAAAJ,eAAAt/B,OAAApQ,YAAA83C,IAAAC,gBAAA12C,eACAjT,OAAAgI,EAAA0K,SAAAgvC,MAAA1hD,UAIAqS,UACAxC,KAAA7C,MAAA0rB,MAAArmB,SAAAxC,MAAA7P,QAAAA,OAAA6P,MAAA,GACA+C,IAAA5F,MAAA2rB,MAAAtmB,SAAAO,KAAA5S,QAAAA,OAAA4S,KAAA,IAIA4yC,OAAAC,OAAA+D,UAAA/D,QACApzC,SAAAxC,OAAA41C,MAAAmE,SAAA,GAAAH,IAAA5zB,aACAxjB,SAAAO,MAAA6yC,MAAAoE,SAAA,GAAAJ,IAAA7zB;IAKA,CAiBA,GAfA,UAAA5R,OACAhX,OAAAA,MAAAgX,QAAA,WAAAhX,MAAA/D,MAAA,WAAA+D,MAAA/D,KACAiiB,MAAAlH,OAAAhc,EAAAgF,MAAAgX,QAEAhX,MAAAgX,SACAkH,MAAAlH,OAAAjwB,KAAAiqD,SAAAh6B,QAGA,UAAAA,SACAkH,MAAAlH,OAAAhc,EAAAgc,OAAAi7B,OAAAj7B,OAAAjwB,KAAAiqD,SAAAh6B,SAEAA,OAAAkH,MAAAlH,OAGAA,OAAAhc,EAAAgc,QAAAxR,GAAA,GACA,IAAAwR,OAAA5xB,OAAA,MAAA2B,KAGAiwB,QAAA,KAAAtR,UAAAsR,OAAA,KAAAhC,QACAqnC,YAAA5E,QAAAM,IAAA/iC,OAAApQ,WAAAoS,OAAAlS,QACAw3C,aAAA7E,QAAAM,IAAA/iC,OAAA3O,YAAA2Q,OAAA1S,SAEA0S,OAAA,KAAAhC,SACA3P,UACAO,KAAAyvC,UAAAr+B,QAAA4R,YACA/lB,MAAAwyC,UAAAr+B,QAAA6R,gBAMA+pB,QAAAkK,UAAA9lC,OAAA1B,GAAA,QACA0mC,mBAAApJ,QAAAkK,SAAA/1D,KAAAiwB,OAAAy7B,GAAAG,QAAAyC,SAAA9gD,OAAA+8C,OAIAsB,QAAAmK,KAAA/lC,QAAAA,OAAA,GAAAgmC,gBACAhB,mBAAApJ,QAAAmK,IAAAh2D,KAAAiwB,OAAAy7B,GAAAG,QAAAyC,SAAA9gD,OAAA+8C,QAKA+K,YAAArlC,OAAAnS,WAAAysC,OACAgL,aAAAtlC,OAAA3S,YAAAitC,OACAjsC,SAAA2R,OAAAhkB,UAIAgpD,qBACAK,YAAAL,mBAAAl3C,MACAw3C,aAAAN,mBAAA13C,OACAtR,OAAAgpD,mBAAAhpD,OACAqS,SAAA22C,mBAAA32C,UAIAA,SAAAte,KAAAwtD,WAAAvhD,OAAAgkB,OAAA3R,SAAA8vC,YAGAsC,QAAAM,IAAA,KAAAN,QAAAM,IAAA,KACAN,QAAAM,KAAA,KAAAN,QAAAM,IAAA,OACAN,QAAAM,KAAA,UAAA97C,QAEAoJ,SAAAxC,MAAA45C,IAAA5zB,aACAxjB,SAAAO,KAAA62C,IAAA7zB,eAIAozB,oBAAAA,oBAAAA,mBAAAiB,aAAA3L,SACAjsC,SAAAxC,MAAA4vC,GAAAhpB,IAAAstB,MAAAsF,YAAA5J,GAAAhpB,IAAAutB,OAAAqF,YAAA,EAAA,EACAh3C,SAAAO,KAAA6sC,GAAA1/C,IAAA+jD,OAAAwF,aAAA7J,GAAA1/C,IAAAikD,OAAAsF,aAAA,EAAA;CA+BA,MA1BAj3C,UAAAxC,MAAA21C,OAAA/uB,GAAA+oB,GAAA/oB,IAAAstB,OAAAoF,aAAA3J,GAAA/oB,IAAAutB,QAAAmF,aAAA,EAAA,GACA92C,SAAAO,KAAA4yC,OAAAzlD,GAAAy/C,GAAAz/C,IAAA+jD,QAAAsF,cAAA5J,GAAAz/C,IAAAikD,QAAAoF,cAAA,EAAA,GAGAxJ,QAAAyC,UACA4G,SAAA52C,SAAA42C,SAAArJ,QAAAyC,SACAtuD,KAAAse,SAAAyvC,WAAAuH,YAAAC,aAAAH,aAAAC,eAIAppD,QAAAipD,SAAAp5C,OAAAwC,SAAAxC,MAAA7P,OAAA6P,MACA7P,QAAAipD,SAAAr2C,MAAAP,SAAAO,KAAA5S,OAAA4S,KAGAq2C,SAAAzJ,KAAAzrD,KAAAse,SAAAmtC,GAAAyJ,SAAAzJ,KAIAntC,SAAA42C,UAAAp5C,KAAA,EAAA+C,IAAA,GAGAsY,MAAAm6B,YAAA6D,SAAAn1D,KAAAuxD,gBAAAvxD,KAAAse,SAAAmtC,MACA1B,QAAA7vC,YAAAid,MAAAm6B,UAAAn3C,SAAAgd,MAAAm6B,SAAA6D,UAIAn1D,KAAAwyD,SAAA,QAAAl0C,SAAAgwC,SAAAR,MAAAQ,UAAAr1C,cACAqF,UAAA42C,SAGAF,SAAAzK,QAAAiL,SAAAj7C,MAAA+D,SAAAxC,OAAAvB,MAAA+D,SAAAO,MAAA,UAAAoR,SAAAhc,EAAAgQ,WAAA8pC,WAAAiH,QACAjL,QAAAhuC,IAAAuC,UAIArK,EAAAgQ,WAAA8pC,WAAAiH,UACAjH,WAAAiH,OAAAzrD,KAAAwgD,QAAA/pD,KAAAiU,EAAA8D,UAAAuG,WACAyrC,QAAAoM,MAAA,SAAAxkC,MAEA1d,EAAAjU,MAAA+b,KAAAysB,QAAA,GAAAjrB,OAAA,KACAmzC,QAAAC,IAAA3wD,KAAAmxC,MAAAilB,gBAAA,UAEAzkC;IAKA3xB,KAAA8qD,YAAAP,MAEAvqD,MAvBAA,MA2BAuvD,UAAA/B,WAAAvhD,OAAA,SAAA6hD,KAAAnkD,IAAAykD,WAQA,QAAA1pB,QAAA95B,EAAAxM,GACAuL,IAAAmS,MAAA1d,EAAAwM,EAAAk3B,aACAn4B,IAAAkV,KAAAzgB,EAAAwM,EAAAi3B,YATA,IAAAusB,UAAA,GAAA,MAAAzkD,IAEA,IAGA0sD,UAAA/3C,SAAAg4C,aAAA12C,SAHAlB,cAAAzK,EAAA65C,KAAA,GAAApvC,eACA63C,SAAA7F,QAAAC,IAAA,eAAAhyC,SAAA63C,WACA3gD,OAAAu4C,UAAA,EASA,GACA,YAAA9vC,SAAArK,EAAA8H,IAAAlG,OAAA,eACA,UAAAyI,UACAg4C,aAAAzgD,OAAA4gD,wBACA/xB,OAAAhmB,cAAA,MAGA43C,aAAAriD,EAAA4B,QAAAyI,WACAg4C,aAAAx6C,MAAAoE,WAAAjM,EAAA8H,IAAAlG,OAAA,qBAAA,EACAygD,aAAAz3C,KAAAqB,WAAAjM,EAAA8H,IAAAlG,OAAA,oBAAA,GAGAlM,IAAAmS,MAAAw6C,aAAAx6C,MAAAoE,WAAAjM,EAAA8H,IAAAlG,OAAA,gBAAA,GACAlM,IAAAkV,KAAAy3C,aAAAz3C,KAAAqB,WAAAjM,EAAA8H,IAAAlG,OAAA,eAAA,GAGAwgD,UAAA,YAAAz2C,SAAA3L,EAAA8H,IAAAlG,OAAA,cAAA,YAAA+J,WAAAy2C,SAAApiD,EAAA4B;MAGAA,OAAAA,OAAA6rB,aAOA,OAJA20B,YAAAA,SAAA,KAAA33C,cAAA,IAAA63C,SACA7xB,OAAA2xB,SAAA,GAGA1sD,IAIA,IAAA+sD,IAAAnI,OAAAgB,UAAA/B,WAAAmJ,OAAA,SAAAC,OAAAC,QACAD,QAAA,GAAAA,QAAA3rD,QAAA,UAAA,OAAAA,QAAA,WAAAglD,QAAA5kD,cACArL,KAAA0iC,GAAAk0B,OAAArrD,MAAA,gBAAAqrD,OAAArrD,MAAA,YAAA,YAAA,GAAAF,cACArL,KAAAgM,GAAA4qD,OAAArrD,MAAA,wBAAA,YAAA,GAAAF,cACArL,KAAA62D,SAAAA,MAEA,IAAAzqD,GAAAwqD,OAAAlyC,OAAA,EACA1kB,MAAAk0D,WAAA,MAAA9nD,GAAA,MAAAA,EAAA4zB,EAAA0vB,IACAzvD,SAEAy2D,GAAAI,OAAA,SAAAC,EAAA1U,QACAriD,KAAA+2D,GAAA/2D,KAAA+2D,KAAAjH,KAAAE,MAAAhwD,KAAA+2D,KAAA/G,MAAAF,KAAAzN,QAAAriD,KAAA+2D,IAGAL,EAAAjrD,OAAA,SAAApM,MACA,GAAAqjC,GAAA1iC,KAAA0iC,EAAA12B,EAAAhM,KAAAgM,EAEA1E,OAAAo7B,IAAA12B,EACA,WAAA02B,GAAA,WAAA12B,IAAAhM,KAAAk0D,aAAAl0B,GAAAhgC,KAAA62D,SACA7qD,EAAA02B,IAAAA,EAAA12B,IAEA02B,EAEA;MAAArjC,SAAA,EAAAiI,OAAAjI,KAAA,KAAAiI,QAGAovD,EAAA3B,OAAA,WACA,GAAAztD,QAAAtH,KAAAyL,QAAA,EACA,OAAAnE,QAAA,GAAAod,OAAA,IAAApd,OAAA,IAAAA,OAAA,GAAAod,OAAA,IAAA,KAGAgyC,EAAA54D,MAAA,WACA,MAAA,IAAAywD,QAAAvuD,KAAAyL,SAAAzL,KAAA62D,SAIAtH,UAAA3C,OAAA,SAAAoK,MAAA/9C,OACA,GAAAke,OAAAn3B,KAAAm3B,MACAh0B,QAAAnD,KAAAmD,QACA4mD,QAAA/pD,KAAA+pD,OAGA,IAAA9wC,MAAA,CACA,GAAA,aAAA9Z,KAAA8Z,MAAA/D,OAAAiiB,MAAAle,OAAA,YAAA9Z,KAAAg4B,MAAAle,MAAA/D,OACA/R,QAAA29B,KAAA7Q,OAAAliB,IAAAkL,MAAAgX,QAAA5xB,SAAA8E,QAAA29B,KAAA7Q,OAAA5xB,QACA0rD,QAAAkN,IAAAh+C,MAAA6zC,eAAAzuD,OACA,MAAA2B,KAIAm3B,OAAAle,MAAAhF,EAAAgF,MAAAi+C,IAAAj+C,OAOA,GAHAjZ,KAAA4qD,UAAAoM,QAAAh3D,KAAA6qD,iBAAAc,OAGA3rD,KAAA0qD,SAAA,MAAAsM,OAAAh3D,KAAA8sB,OAAA,GAAA9sB,IACA;GAAAA,KAAA2qD,WAAA3qD,KAAAsqD,SAAA,MAAAtqD,KAEA,IASAm3D,gBAAAC,MAAA3zD,MATAyR,KAAA8hD,MAAA,OAAA,OACA1yD,KAAAtE,KAAAmD,QAAA+R,MAEA64C,YADA/tD,KAAAmD,QAAA6zD,MAAA,OAAA,QACAh3D,KAAAmD,QAAAmb,UACA+4C,eAAAr3D,KAAAmD,QAAA4pB,QACAhP,MAAA/d,KAAA+pD,QAAAhuC,IAAA,SACAy5C,QAAAx1D,KAAA+pD,QAAAx7B,GAAA,YACA8Z,QAAA2uB,OAAA,IAAA1yD,KAAA2rB,OAAA5xB,OACAi5D,YAAAr+C,OAAA3U,KAAA2rB,OAAA5xB,OAAA,GAAA84B,MAAAlH,OAAA,KAAAhX,MAAAgX,MAaA,cATA+mC,QAAAO,OAAA,oBAAAP,OAAAxB,SAGA2B,gBAAApN,QAAAx7B,GAAA,cAAAinC,UAAAwB,OAAAM,WAGAF,MAAAD,eAAAnN,OAAAhqD,KAAAwyD,SAAAt9C,MAAA,KAGAlV,KAAA2qD,UAAA3qD,MAGAo3D,QAAA7M,OAAAyM,OAAAh3D,KAAAw3D,MAAAv+C,QAGAm+C,OAAAD,eAAAn3D,MAGAiU,EAAA/M,KAAA6iD,QAAA,GAAA,eAAAiN,OAGAA,OAEAh3D,KAAA0xD,QAAAv6B,MAAAsK,OAAAxtB,EAAAgF,MAAAi+C,IAAAl3D,KAAA0xD,QAGAz9C,EAAAgQ,WAAAozC,eAAA3wD,OAAA1G,KAAAoyD,eAAAiF,eAAA3wD,KAAA6jD,OACAt2C,EAAAgQ,WAAAozC,eAAA1gD,QAAA3W,KAAAkyD,aAAAmF,eAAA1gD,MAAA4zC,QAGAkF,eAAA,UAAA1B,WAAA99B,QAAA89B,WAAA0D,OAAAC,QACAz9C,EAAA0K,UAAA84C,KAAA,aAAAvN,UAAAlqD,KAAA03D,aACAjI,cAAA9D,MAIA5tC,OAAAgsC,QAAAhuC,IAAA,QAAAguC,QAAAjsC,WAAAysC,QACAvqD,KAAAwtD,WAAAv0C,MAAA5Y,UAAA,IACA0d,OAAAgsC,QAAAhuC,IAAA,QAAA,IAGAzX,KAAA+pD,OACA,gBAAA/pD,MAAA+pD,KAAAp6C,EAAA3P,KAAA+pD,MAAAp6C,EAAA+4C,SAAA1oD,KAAA+pD,OACAz3B,IAAAmzB,SAAAnzB,IAAAtyB,KAAA2rB,QAAA45B,KAAA,OAAA51C,EAAA0jD,MAAA,kBAKAhL,aAAA3sD,KAAAmqD,OAAArpB,YAGA3J,OAAAsK,OAGAguB,gBAAAx7C,EAAA+4C,SAAA,4BAAA1oD,KAAA+pD,MAAAz3B,IAAAmzB,SAAA1rD,SACA4V,EAAA0K,UAAA2P,OAAA,aAAA47B,WACAuF,cAAAlF,OAIAvqD,KAAA43D,KAAA3+C,QAIAxV,MAAAwQ,EAAA2Q,MAAA,WACAoyC,OAEAtG,QAAAC,IAAA5G,QAAA,GAAA5Y,MAAAilB,gBAAA,UAGArM,QAAAhuC,IAAA,WAAA,IAGA,gBAAAzX,MAAAuzD,WACA5jD,EAAAjU,KAAAmD,QAAA29B,KAAA+2B,UAAA9N,SAAAyN,QAIAx3D,KAAAmD,QAAA29B,KAAA7Q,OAAAra,QAAA,QAAA5V,KAAAoO,GAAA,cAIA27C,QAAAhuC,KACAuT,QAAA,GACAiZ,WAAA,GACAC,QAAA,GACA1sB,KAAA,GACA+C,IAAA,KAKA7e,KAAAwyD,SAAAwE,MAAA,UAAA;EACAh3D,MAGAsE,KAAA0wD,SAAAzK,OAAAliB,UAAAkiB,OACAR,QAAA70C,QACAzR,SAIAwQ,EAAAgQ,WAAA3f,KAAA0wD,SACAjL,QAAA7zC,KAAA,EAAA,GACA5R,KAAA0wD,OAAAzrD,KAAAwgD,QAAA/pD,MACA+pD,QAAAoM,MAAA,KAAA,SAAAxzD,GACAc,QAAAd,OAKAonD,QAAA+N,OAAA,GAAAd,MAAA,EAAA,EAAAvzD,OAGAuzD,OAAA1yD,KAAA2rB,OAAAra,QAAA,QAAA5V,KAAAoO,GAAA,aAEApO,QAGAuvD,UAAAzuB,KAAA,SAAA7nB,OAAA,MAAAjZ,MAAA4sD,OAAAjB,KAAA1yC,QAEAs2C,UAAAxuB,KAAA,SAAA9nB,OAAA,MAAAjZ,MAAA4sD,OAAArC,MAAAtxC,QACAs2C,UAAAiI,MAAA,SAAAv+C,OACA,IAAAjZ,KAAA0qD,UAAA1qD,KAAA2qD,UAAA,MAAA3qD,KAEA,IAAA+3D,OAAA9jD,EAAA+4C,UACAjD,QAAA/pD,KAAA+pD,QACAiO,SAAAznD,SAAAw5C,QAAA,GAAA5Y,MAAA1I,OAAA,IACAwvB,SAAArK,KAAAsK,OAAAH,MAAA15D,MAyBA,OArBA0rD,SAAArzB,SAAA65B,cAEAvwD,KAAAwyD,SAAA,SAAAyF,UAAAh/C,SAEA++C,WAAAC,WAEAF,MAAAr/C,KAAA,WACA1Y,KAAAmxC,MAAA1I,OAAAuvB,WACAh4D,KAAAmxC,MAAA1I,OAAAzoC,KAAAmxC,MAAA1I,OAAA;GAKAsvB,MAAAvpD,OAAA,IAAA+hD,aAAA1G,KAAA,OAAA5wC,QAIA8wC,QAAA5vC,SAAAo2C,aAAA,GAAApf,MAAA1I,OAAAwvB,UAIAj4D,MAGAuvD,UAAAqI,KAAA,SAAA3+C,OACA,OAAAjZ,KAAA0qD,UAAA1qD,KAAA2qD,UAAA3qD,MAGAA,KAAA+pD,QAAA7vC,YAAAq2C,aAGAvwD,KAAAwyD,SAAA,QAAAxyD,KAAA+pD,QAAAhuC,IAAA,WAAA9C,OAEAjZ,OAEAuvD,UAAA4I,QAAA,SAAAnB,OACA,MAAAh3D,MAAA2qD,UAAA3qD,MAGA,WAAAg3D,MACAA,QAAAh3D,KAAA0qD,SAAA1qD,KAAA+pD,QAAArzB,SAAAg2B,gBAAA1sD,KAAAsqD,UAIA,iBAAA0M,SACAA,MAAArL,MAGA3rD,KAAA0qD,UACA1qD,KAAA+pD,QAAAiI,YAAAtF,eAAAsK,OACA9vD,KAAA,gBAAA8vD,OAGAh3D,KAAAsqD,WAAA0M,MAEAh3D,OAGAuvD,UAAA6I,OAAA,WAAA,MAAAp4D,MAAAm4D,QAAA5N,QACAgF,UAAA4C,cAAA,WAEA,GAAAniD,MAAAhQ,KACAiqD,SAAAjqD,KAAAiqD,SACAF,QAAAE,SAAAF,QACA7zB,OAAAl2B,KAAAmD,QAAA4pB,QAAAmJ,OACAmiC,SAAA,gBAAAniC,QACAoiC,MAAAD,SAAAniC,OAAA,eAEA+zB;SAAA/zB,QAAA+zB,SAAA/zB,OAAAlW,SAIAiqC,SAAA/zB,OADAA,OAAAg1B,OACAh1B,OAGAjiB,EAAA,SACA6tC,QAAA,eAAA9hD,KAAAmD,QAAAguC,MAAA0jB,OAAA,GAAA3K,UAAA,SACAvzC,MAAA2hD,MACAC,aAAAD,QAEA3qC,QACA1Z,EAAA,YACA6tC,QAAA,wBACAvU,KAAA,aAMA0c,SAAA/zB,OAAApW,SAAAmqC,SAAA2K,UAAA7K,SACA7iD,KAAA,OAAA,UACAuvB,MAAA,SAAAxd,OAEA,MADA8wC,SAAArzB,SAAAg2B,iBAAA18C,KAAA+wB,KAAA9nB,OACAsxC,SAIAgF,UAAAgE,cAAA,SAAAr9B,QAGA,IAAAl2B,KAAA0qD,SAAA,MAAAH,MAEA,IAAAuD,MAAA9tD,KAAAiqD,SAAA/zB,MACAA,QAAAl2B,KAAAmyD,gBACArE,KAAA9tC,UAQAuvC,UAAA8C,WAAA,WAEA,GAAAnhD,IAAAlR,KAAAmD,QAAAguC,MAAA0jB,OACA5K,SAAAjqD,KAAAiqD,SACAF,QAAAE,SAAAF,QACAO,SAAAP,QAAArzB,SAAAg2B,eAEA3C;QAAA7vC,YAAAwyC,gBACAA,eAAAx7C,GAAA,oBAAA,gBACA64C,QAAAiI,YAAAtF,eAAApC,UAEAP,QAAAiI,YAAA,mBAAA3F,oBAAAn7C,IAAA8gD,YAAA1B,cAAAtwD,KAAAmD,QAAAguC,MAAAqnB,MAAAtnD,IAEA+4C,SAAAl9B,SACAk9B,SAAAl9B,QAAAilC,YAAA3F,kBAAA,WAAAn7C,IAEA+4C,SAAA2K,UACA3K,SAAA2K,SAAA5C,YAAA3F,kBAAA,UAAAn7C,IAEA+4C,SAAA/zB,QACA+zB,SAAA/zB,OAAA87B,YAAA9H,UAAA,SAAAh5C,KAgFAq+C,UAAAmI,YAAA,SAAAz+C,OAEA,OADAjZ,KAAA0xD,MAAAz9C,EAAAgF,MAAAi+C,IAAAj+C,QAAA/D,KAAA,YACAlV,MAIAuvD,UAAAkJ,MAAA,SAAAC,QAAA3/C,OAAAvL,OAAAmrD,OAAAzzC,SACA,GAAAwzC,SAAAlrD,QAAAuL,OAAA1a,OAAA,CACA,GAAAu6D,IAAA,IAAA54D,KAAAgqB,KAAA2uC,OAAA,IAAAA,OAAA,GAKA;MAJA1kD,GAAAykD,SAAAjB,MACA1+C,OAAA5N,MAAA4N,OAAAA,OAAA1Z,KAAAu5D,GAAA,MAAAA,GACA3kD,EAAA2Q,MAAApX,OAAA0X,SAAAllB,OAEAA,OAEAuvD,UAAAsJ,QAAA,SAAAH,QAAAC,QAEA,MADAD,UAAAzkD,EAAAykD,SAAApqC,OAAA,IAAAtuB,KAAAgqB,KAAA2uC,OAAA,IAAAA,OAAA,KACA34D,MAcAuvD,UAAAiD,SAAA,SAAAt9C,KAAAvN,KAAAsR,OACA,GAAAxJ,UAAAwE,EAAA0jD,MAAA,UAAAziD,KAOA,OANAzF,UAAAqpD,cAAA7/C,OAAAhF,EAAA8D,UAAAkB,QAAAjZ,KAAAm3B,MAAAle,OAAA+wC,KAEAhqD,KAAA+qD,WAAA71C,KACAlV,KAAA+pD,QAAAn0C,QAAAnG,UAAAzP,MAAAY,OAAA+G,WACA3H,KAAA+qD,WAAAR,OAEA96C,SAAAspD,sBAGAxJ,UAAAyJ,YAAA,SAAAC,WAAAC,WAAAC,YAAAC,YAAA3M,WAAAI,YAEA,GAAAwM,gBAAAF,YAAA3qD,OAAA4qD,aAAArrD,IAAAqrD,YAAA5qD,OAAA2qD,cACAG,eAGAD;eAAAh7D,SAGA4V,EAAAyE,KAAAwgD,WAAA,SAAA96D,EAAA8W,MACA,GAAAqkD,WAAAtlD,EAAAuH,QAAAtG,KAAA+jD,WAIAM,WAAA,IAAAD,aAAAh7D,KAAA26D,WAAAO,OAAAD,UAAA,GAAA,MAIAD,aAAAj7D,SAEA2B,KAAAy4D,MAAAY,eAAAC,aAAA,SAAArgD,OACA,GAAA+9C,OAAAh3D,KAAA0qD,SAAA1qD,KAAA+pD,QAAA,GAAAwD,YAAA,GAAA,GACAyJ,MAAAnK,WAAAJ,YAAAljD,KAAAvJ,KAAAiZ,SAIAkgD,YAAAA,YAAAviC,IAAAyiC,gBACAD,YAAAA,YAAAxiC,IAAAyiC,kBAKAr5D,KAAAy4D,MAAAU,YAAAF,WAAAxM,YACAzsD,KAAAy4D,MAAAW,YAAAF,WAAArM,aAGA0C,UAAAkK,qBAAA,SAAAxgD,OA+BA,QAAAygD,aAAAzgD,OAEA,MAAAjZ,MAAAsqD,UAAAtqD,KAAA2qD,UAAAJ,OAGAvqD,KAAAm3B,MAAAle,MAAAA,OAAAhF,EAAAgF,MAAAi+C,IAAAj+C,OACAjZ,KAAAm3B,MAAAlH,OAAAhX,OAAAhF,EAAAgF,MAAAgX,QAGA08B,aAAA3sD,KAAAmqD,OAAArpB,WACA9gC,KAAAmqD,OAAArpB,KAAA0rB,MAAAjjD,KAAAvJ,KACA,WAAAA,KAAA8sB,OAAA,gBAAA7T,QAAA9V,QAAA29B,KAAA8qB;EACAzoD,QAAAw2D,UAAA,EAAAx2D,QAAA29B,KAAA0rB,SA1CA,GAAArpD,SAAAnD,KAAAmD,QACAy2D,WAAAz2D,QAAA29B,KAAA7Q,OACA4pC,WAAA12D,QAAA49B,KAAA9Q,OACAgpC,WAAA91D,QAAA29B,KAAA7nB,MAAAhF,EAAAmG,KAAA,GAAAjX,QAAA29B,KAAA7nB,OAAA9N,MAAA,QACA+tD,WAAA/1D,QAAA49B,KAAA9nB,MAAAhF,EAAAmG,KAAA,GAAAjX,QAAA49B,KAAA9nB,OAAA9N,MAAA,OAGAnL,MAAAy4D,MAAAz4D,KAAAiqD,SAAAh6B,QAAA,SAAA,cAAA,WACAjwB,KAAAmuB,SAAA,IACA,WAMA,qBAAAhvB,KAAAgE,QAAA29B,KAAA7nB,SAAA,oBAAA9Z,KAAAgE,QAAA49B,KAAA9nB,QACAigD,WAAA56D,KAAA,cAQA0B,KAAAy4D,MAAAmB,WAAA,YAAA,SAAA3gD,OACAjZ,KAAA03D,YAAAz+C,OACAjZ,KAAAm3B,MAAA2iC,SAAAnO,OAqBA3rD,KAAAg5D,YAAAC,WAAAC,WAAAU,WAAAC,WAAAH,YAAA,WACA,MAAA15D,MAAAmqD,WACAwC,cAAA3sD,KAAAmqD,OAAArpB,MADAypB;IAKApnD,QAAA29B,KAAA8qB,OAAAzoD,QAAAw2D,YAAAD,YAAAnwD,KAAAvJ,KAAAiZ,QAIAs2C,UAAAgD,cAAA,WACA,GAAAviD,MAAAhQ,KACAmD,QAAAnD,KAAAmD,QACA4qD,WAAA5qD,QAAAmb,SAEAyrC,QAAA/pD,KAAA+pD,QACA6P,WAAAz2D,QAAA29B,KAAA7Q,OACA4pC,WAAA12D,QAAA49B,KAAA9Q,OACA8pC,gBAAAhM,WAAAK,UACA4L,eAAAjM,WAAAO,SACA2L,eAAAhmD,EAAA0K,UAEAu7C,cADAjmD,EAAA0K,SAAAgvC,MACA15C,EAAAga,SAEAgrC,WAAA91D,QAAA29B,KAAA7nB,MAAAhF,EAAAmG,KAAA,GAAAjX,QAAA29B,KAAA7nB,OAAA9N,MAAA,QACA+tD,WAAA/1D,QAAA49B,KAAA9nB,MAAAhF,EAAAmG,KAAA,GAAAjX,QAAA49B,KAAA9nB,OAAA9N,MAAA,OAIA8I,GAAAyE,KAAAvV,QAAA4V,OAAA,SAAAjH,KAAArC,UACAO,KAAAyoD,MAAA1O,QAAA,WAAAj4C,MAAA,cAAA,gBAAA,UAAAA,MAAArC,SAAA,KAAAs6C;GAIA,oBAAA5qD,KAAAgE,QAAA49B,KAAA9nB,QAAA,WAAA9V,QAAA49B,KAAAo5B,OACAn6D,KAAAy4D,MAAAwB,gBAAA,WAAA,QAAA,SAAAhhD,OACA,gBAAA9Z,KAAA8Z,MAAAgX,OAAAmqC,WAAAnhD,MAAA6zC,eACA9sD,KAAA+gC,KAAA9nB,SAMA9V,QAAA49B,KAAAmsB,MACA2M,WAAAA,WAAA9rD,IAAAg8C,QAAA5vC,SAAAk2C,cAOA,qBAAAlxD,KAAAgE,QAAA29B,KAAA7nB,QACAjZ,KAAAy4D,MAAAoB,WAAA,aAAA,WACAlN,aAAA3sD,KAAAmqD,OAAArpB,SAKA,GAAA39B,QAAA49B,KAAA9nB,OAAAxX,QAAA,WAAA,IACAzB,KAAAy4D,MAAAsB,gBAAA34B,QAAA,SAAA,YAAA,cAAA,SAAAnoB,OACA,GAAA60C,MAAA75C,EAAAgF,MAAAgX,QACAoqC,QAAAr6D,KAAA0qD,WAAA1qD,KAAA+pD,QAAArzB,SAAAg2B,iBAAA1sD,KAAA+pD,QAAA,GAAAwD,YAAA,EACA+M,WAAAxM,KAAAtvC,QAAAwuC,UAAAx+C,OAAAxO,KAAA+pD,QAAA,IAAA1rD,OAAA,CAEAyvD;KAAA,KAAA9tD,KAAAiwB,OAAA,IAAA69B,KAAA,KAAA9tD,KAAA+pD,QAAA,IAAAuQ,YACAt6D,KAAAiwB,OAAAgnC,IAAAnJ,KAAA,IAAAzvD,SAAAg8D,SAEAr6D,KAAA+gC,KAAA9nB,SAMA,gBAAA9V,SAAA49B,KAAAssB,WAEArtD,KAAAy4D,MAAAmB,WAAA,QAAA55D,KAAAoO,GAAA,YAAAg/C,eAAA,YAGAptD,KAAAy4D,MAAAoB,WAAA9rD,IAAAg8C,SAAA6D,KAAA2M,eAAAnN,iBAIAptD,KAAAg5D,YAAAC,WAAAC,WAAAU,WAAAC,WAAApN,WAAAI,YAGA7sD,KAAAy4D,MAAAmB,WAAA7rD,IAAAg8C,SAAA,YAAA,SAAA9wC,OAEA,GAAA,gBAAA9V,SAAA49B,KAAAyD,SAAA,CACA,GAAA/C,QAAAzhC,KAAAm3B,MAAAsK,WACA+4B,MAAAx6D,KAAAmD,QAAA49B,KAAAyD,SACA1nC,IAAAb,KAAAa,KAGAA,IAAAmc,MAAA0rB,MAAAlD,OAAAkD,QAAA61B,OAAA19D,IAAAmc,MAAA2rB,MAAAnD,OAAAmD,QAAA41B,QACAx6D,KAAA+gC,KAAA9nB;CAKAjZ,KAAA03D,YAAAz+C,SAIA,UAAA80C,WAAA99B,QAEA89B,WAAA0D,OAAAC,QAEAvuD,QAAA49B,KAAA9nB,OAEAjZ,KAAAy4D,MAAAmB,YAAA,aAAA,cAAA,SAAA3gD,OACA,MAAAjZ,MAAAm3B,WACAn3B,KAAAm3B,MAAA2iC,SAAA,eAAA7gD,MAAA/D,MADAq1C,QAMAvqD,KAAAy4D,MAAAwB,eAAA,YAAA,SAAAhhD,OAEAjZ,KAAA0qD,UAAA1qD,KAAAm3B,MAAA2iC,WAAA95D,KAAA+pD,QAAArzB,SAAAg2B,iBAAA1sD,KAAA+pD,QAAA,GAAAwD,YAAA,GACAvtD,KAAAwtD,WAAAv0C,WAOA80C,WAAA0D,OAAAvjC,QAAA8rC,eAAA37D,SACA2B,KAAAy4D,MAAAxkD,EAAAgF,MAAAwhD,QAAAvsC,OAAA8rC,eAAAE,aAAA,SAAA5M,kBAIAS,WAAA0D,OAAA/sB,QACA1kC,KAAAy4D,MAAAyB,aAAAnsD,IAAAggD,WAAAK,WAAA,SAAAd;EAKAiC,UAAA+C,gBAAA,WACA,GAAAnvD,SAAAnD,KAAAmD,QACAg2D,YAAAh2D,QAAA29B,KAAA7Q,OACAmpC,YAAAj2D,QAAA49B,KAAA9Q,OACAyoC,QAAAzkD,EAAAglB,MACAj5B,KAAAiqD,SAAAh6B,OAAA,GACAjwB,KAAA0qD,UAAA1qD,KAAA+pD,QAAA,GACA5mD,QAAAmb,SAAA8vC,UAAA,GACAjrD,QAAAmb,SAAAgwC,SAAA,GACAnrD,QAAAmb,SAAA8vC,UAAAhtB,QAAA,QAAA,GACAnT,OACAtP,UACA,SAAAvgB,GACA,MAAA,gBAAAA,IAIA+6D,cAAAA,YAAAjlC,UACAwkC,QAAAA,QAAA93D,OAAAu4D,YAAAjlC,YAEAklC,aAAAA,YAAAllC,UACAwkC,QAAAA,QAAA93D,OAAAw4D,YAAAllC,YAIAl0B,KAAA64D,QAAAH,SACAG,QAAAH,QAAA,WACAG,QAAAH,QAAA,aAIAzkD,EAAA,WACAw5C,SAAAT,UAAA,aAAA,cAAA,SAAA/zC,OACA,GAAA+9C,OAAA,eAAA/9C,MAAA/D,KACA60C,QAAA91C,EAAAgF,MAAAyhD,eACAzqC,OAAAhc,EAAAgF,MAAA6zC,eAAA7zC,MAAAgX,QACA9sB,QAAAnD,KAAAmD,OAGA6zD;OAEAh3D,KAAAw3D,MAAAv+C,OAGA8wC,QAAArzB,SAAA25B,eAAAtG,QAAArzB,SAAAg2B,iBAAAC,aAAA3sD,KAAAmqD,OAAAppB,OAMA,UAAA59B,QAAAmb,SAAA2R,QAAA9sB,QAAAmb,SAAAmzC,OAAAC,OACAvuD,QAAA49B,KAAA9nB,OAAA9V,QAAA29B,KAAA7Q,SAAAA,OAAAmR,QAAAj+B,QAAA29B,KAAA7Q,OAAA,IAAA5xB,QACA2B,KAAA+gC,KAAA9nB,OAKA8wC,QAAAiI,YAAAxB,YAAAwG,SAIAvJ,SAAA,IAAAI,QAAA,IAAAuC,gBAAAhD,kBAsFAQ,KAAA35C,EAAAuqB,GAAAqrB,KAAA,SAAA1mD,QAAA6oD,SAAA2O,UAEA,GAAAC,UAAA,GAAAz3D,SAAAkI,cACAwvD,SAAA7Q,KACAriD,KAAAsM,EAAA6mD,UAAAz6D,WAAA4B,MAAA,GACAgX,MAAAtR,KAAAA,KAAAtJ,OAAA,GACAiG,KAAAtE,KAAA,GAAAiU,EAAAkB,KAAAnV,KAAA,GAAAkqD,WAAAF,IAGA,QAAA3pD,UAAAhC,QAAAiG,MAAA,QAAAs2D,QACAt2D,KAIA,gBAAAnB,UACAnD,KAAA0Y,KAAA,WACA,GAAA6yC,KAAAt3C,EAAAkB,KAAAnV,KAAAkqD,UACA;IAAAqB,IAAA,MAAAI,KAMA,IAHA1yC,OAAAA,MAAA8hD,YAAAxP,IAAAp0B,MAAAle,MAAAA,QAGA+yC,UAAA,WAAA4O,SAAA,YAAAA,QAWArP,IAAAqP,UACArP,IAAAqP,SAAA1/C,MAAAqwC,IAAA5jD,UAZA,CACA,GAAAgzD,WAAAjkD,YAAAzC,EAAA+G,cAAAgxC,UAKA,MADA6O,UAAAtP,IAAAlS,IAAA2S,UACAzB,KAJAgB,KAAAh+C,IAAAy+C,SAAA2O,aAcAE,WAAA7Q,KAAA6Q,SAAA76D,MAIA,gBAAAmD,UAAA9C,UAAAhC,OAAA,QAEAiG,KAAA8mD,gBAAAn3C,EAAA8D,OAAA4zC,QAAAxoD,UAEAnD,KAAA0Y,KAAA,SAAAta,GACA,GAAAmtD,KAAAn9C,EAQA,OALAA,IAAA6F,EAAAqD,QAAAhT,KAAA8J,IAAA9J,KAAA8J,GAAAhQ,GAAAkG,KAAA8J,GACAA,IAAAA,IAAAA,KAAAm8C,OAAAn8C,GAAA/P,OAAA,GAAAuvD,KAAArC,IAAAn9C,IAAAw/C,KAAAmF,SAAA3kD,GAGAm9C,IAAA99C,KAAAwG,EAAAjU,MAAAoO,GAAA9J,MACAinD,MAAAhB,MAAAoB,MACAiC,KAAArC,IAAAn9C,IAAAm9C,IAGAt3C,EAAAyE,KAAAmzC,QAAA,WACA,eAAA7rD,KAAAy+C,YAAAz+C,KAAAurD;OAIAA,KAAAkO,qBAAAxgD,YAMAhF,EAAA41C,KAAAC,KAGA8D,KAAArC,OACAt3C,EAAAyE,MAEAxR,KAAA,SAAAA,KAAA1F,KACA,GAAAxB,KAAA3B,OAAA,CACA,GAAA2R,MAAAhQ,KAAA,GACA2W,MAAA,QACA40C,IAAAt3C,EAAAkB,KAAAnF,KAAA,OAEA,IAAA9I,OAAAyP,OAAA40C,KAAA,gBAAAA,MAAAA,IAAApoD,QAAAurD,SACA,MAAAruD,WAAAhC,OAAA,EACA4V,EAAA/M,KAAA8I,KAAA2+C,WAIApD,KAAAA,IAAApoD,QAAA4pB,QAAA7lB,OAAAyP,OAAA40C,IAAAp0B,MAAAjwB,MACAqkD,IAAAh+C,IAAA,eAAA/L,KAIAxB,KAAAkH,KAAAynD,SAAAntD,MAIA,MAAAyS,GAAAuqB,GAAA,OAAAiyB,eAAAv1C,MAAAlb,KAAAK,YAIAvC,MAAA,SAAAk9D,UACA,GAGAC,QAHAhnD,MAGAA,EAAAuqB,GAAA,QAAAiyB,eAAAv1C,MAAAlb,KAAAK,WAUA,OAPA26D,WACAC,MAAAzsD,OAAA,IAAAmgD,SAAA,KAAAznD,KAAA,QAAA,WACA,MAAA+M,GAAA/M,KAAAlH,KAAA2uD,YAEA53B,WAAA43B,UAGAsM;GAEA,SAAAnpD,KAAAiT,MACA,IAAAA,MAAA9Q,EAAAuqB,GAAA1sB,KAAA2+C,eAAA,MAAA9E,KAEA,IAAAuP,KAAAjnD,EAAAuqB,GAAA1sB,KAAA2+C,eAAAx8C,EAAAuqB,GAAA1sB,KACAmC,GAAAuqB,GAAA1sB,MAAA,WACA,MAAAiT,MAAA7J,MAAAlb,KAAAK,YAAA66D,IAAAhgD,MAAAlb,KAAAK,cAQA4T,EAAAo9B,KACAp9B,EAAA,YAAAw8C,eAAAx8C,EAAAknD,UACAlnD,EAAAknD,UAAA,SAAAF,OACA,IAAA,GAAAnN,MAAA1vD,EAAA,GAAA0vD,KAAA75C,EAAAgnD,MAAA78D,KAAAC,OAAAD,IACA,GAAA0vD,KAAA5mD,KAAAunD,UACA,IAAAX,KAAAsN,eAAA,cACA,MAAAxwD,IAGAqJ,EAAA,YAAAw8C,eAAAv1C,MAAAlb,KAAAK,aAIAutD,KAAAtvB,QAAA,QAGAsvB,KAAAmF,OAAA,EAGAnF,KAAA2M,eAAAnK,gBAGAxC,KAAAsK,OAAA,KAGAtK,KAAAxM,UACAuY,UAAApP,MACAn8C,GAAAm8C,MACAiE,UAAA7C,KACA+C,SAAA/C,KACA5+B,SACArmB,KAAAilD,KACAzkD,KAAA,QACAyP,MAAA4zC,MACAr0B,OAAAq0B,OAEAjsC,UACAmtC,GAAA,WACAC,GAAA,eACAz7B,OAAAs6B,MACA6D,UAAA7D,MACA+D,SAAA/D,MACAkH,QACA/uB,EAAA,EAAA12B,EAAA,EACA0lD,MAAA/F,KACAjnB,OAAAinB,KACAz9B,OAAAy9B,KACAn+C,OAAA,yBAEAwnD,OAAA,SAAAzJ,IAAA5hD,KACAsK,EAAAjU,MAAAqoC,QAAA1+B,KACAoY,SAAA,IACAo0C,MAAA5L;GAIAzpB,MACA7Q,OAAAs6B,MACAtxC,MAAA,aACA+7C,OAAArJ,KACAa,MAAA,GACA6B,KAAA9D,MACAqB,MAAArB,MACAsN,UAAAtN,OAEAxpB,MACA9Q,OAAAs6B,MACAtxC,MAAA,aACA+7C,OAAArJ,KACAa,MAAA,EACAU,MAAA3C,MACA8C,SAAA9C,MACA4P,MAAA,SACA31B,SAAA+lB,OAEApZ,OACAlb,QAAA,GACA4+B,OAAAtK,MACAxsC,MAAAwsC,MACAhtC,OAAAgtC,MACAiO,IAAA7M,MAEA5yC,QACA+T,OAAAk9B,KACAqR,KAAArR,KACAlpB,KAAAkpB,KACAjpB,KAAAipB,KACA4C,OAAA5C,KACAwL,QAAAxL,KACAsR,OAAAtR,KACAwN,MAAAxN,KACA4N,KAAA5N,MAGA,IAAAuR,KAMAC,OAAA,SACAC,OAAA,SACAC,MAAA,QACAC,SAAA,mBACAC,YAAA,cACAC,UAAA,cAGAC,YAAAn9C,SAAAiyC,cAAA,UAAAmL,WAGAC,QAAA,8CAUAz3C,YAAAyqC,aAAA,SAAA,IAAA,MAAA,KAuBA;GAAA8M,UASA,GAAAG,aAAAhuC,OAAAiuC,kBAAA,EACAC,oBAAA,WACA,GAAAj3C,SAAAvG,SAAAiyC,cAAA,UAAAmL,WAAA,KACA,OAAA72C,SAAAk3C,wBAAAl3C,QAAAm3C,8BAAAn3C,QAAAo3C,2BACAp3C,QAAAq3C,0BAAAr3C,QAAAs3C,yBAAA,KAEAC,MAAAR,YAAAE,wBAdA,IAAAO,WAAA,SAAAC,IAAAjjC,MAAAyX,OACA,MAAA,YAAAwrB,IAAA,4DAAAjjC,OAAA,IACA,yCAAAyX,OAAA,IAAA,OA0BAl9B,GAAA8D,OAAAm3C,IAAAjvD,WACAwN,KAAA,SAAAo8C,MACA,GAAA3kC,SAAA03C,GAGAA,KAAA58D,KAAA6sB,QAAAg9B,KAAAI,SAAA2S,IAAA3oD,EAAA,WAAA6tC,QAAAoI,UAAA,SAAA58B,UAAAu8B,KAAAE,SAGA+R,WAEA52C,QAAAjR,EAAA,cAAA6L,SAAA9f,KAAA6sB,SAAA,GAAAkvC,WAAA,MAGA72C,QAAA23C,SAAA,QACA33C,QAAA43C,WAAA,IACA53C,QAAA63C,SAGA73C,QAAAw3C,UAAA,QAAA,oBAAA,sBACA18D,KAAA6sB,QAAA0gB,KAAAroB,QAAAA,SAGA2kC,KAAA4O,MAAAxkD,EAAA,IAAA2oD,KAAA7uD,IAAA6uD,MAAA,QAAA,aAAA,SAAA3jD,OAAAA,MAAA+jD;EAAAh9D,KAAAmvD,MAIAtF,KAAA4O,MAAA5O,KAAAE,QAAA,cAAA/pD,KAAAwtD,WAAAxtD,KAAAmvD,IAAAnvD,MAGAA,KAAAi9D,UAGAC,gBAAA,WACAl9D,KAAAovD,KAAA,GAAApvD,KAAAmD,QAAAoa,OACAvd,KAAAovD,KAAA,GAAApvD,KAAAmD,QAAA4a,OAEAo/C,iBAAA,WACAn9D,KAAAovD,KAAA,GAAApvD,KAAAmD,QAAA4a,MACA/d,KAAAovD,KAAA,GAAApvD,KAAAmD,QAAAoa,QAGA6/C,UAAA,SAAAxG,QACA,GAAAhC,UAAA50D,KAAA6pD,KAAAI,SAAA2K,QACA,OAAAA,YACAgC,OAAA5qD,IAAA6jD,KAAA+G,OAAA5qD,IAAAikD,QAAAjwD,KAAA6sB,QAAAvO,WAAAO,IAAA7e,KAAAovD,KAAA,GAAA,EAAApvD,KAAAmD,QAAA8I,OAAA2oD,SAAAt3C,YAAAquC,QAIA0R,aAAA,SAAAzG,QACA,GAAAnL,IAAAzrD,KAAA6pD,KAAA1mD,QAAAmb,SAAAmtC,EAcA,OAXAmL,UAAArM,OAAAkB,KAAAlB,MACAqM,OAAArM,MAEAqM,SAAAjL,KACAiL,OAAA,GAAArI,QAAA9C,GAAAhgD,UAEAmrD,OAAAnrD,SACAmrD,OAAA,GAAArI,QAAAqI,QACAA,OAAA1J,MAAAvB,MAGAiL;EAGA0G,YAAA,SAAA1G,OAAA2G,KAAAC,KACA,GAAAvT,UAAAjqD,KAAA6pD,KAAAI,SACAhqC,KAAAw7C,OAAA7M,MAAA2O,MAAA,OAEA,QAAAC,IAAAvO,OAAAuO,IAAAv9C,MACAgvC,OAAAhF,SAAAl9B,QAAA9M,OACAgvC,OAAAjvD,KAAAo9D,UAAAxG,SAAA3M,SAAA2K,UAAA3K,SAAAl9B,QAAA9M,OACAgvC,OAAAhF,SAAAF,QAAA9pC,QACA,GAGAw9C,aAAA,SAAA7G,QACA,GAAA3M,UAAAjqD,KAAA6pD,KAAAI,SACAhqC,KAAAw7C,OAAA7M,MAAAgI,OAAA5qD,GAAA4iD,MAAAgI,OAAAl0B,GAAA,QAEA,OAAAguB,SAAAC,GAAA,EAAA,EACA1B,OAAAjvD,KAAAo9D,UAAAxG,SAAA3M,SAAA2K,UAAA3K,SAAAl9B,QAAA9M,OACAgvC,OAAAhF,SAAAF,QAAA9pC,OAAA,GAGAy9C,eAAA,SAAA5P,KAAA7tC,KAAA09C,SACA,GAAAn8D,KAAAssD,KAAA/xC,IAAAkE,KACA,QAAAze,KAAAm8D,SAAAn8D,MAAAssD,KAAA/xC,IAAA4hD,UAAA3B,QAAA78D,KAAAqC,KAAA+oD,MAAA/oD,KAGAo8D,cAAA,SAAAhH,QACA,GAAA3M,UAAAjqD,KAAA6pD,KAAAI,SACA2S,IAAA58D,KAAA6sB,QAAA9Q,IAAA,UAAA,IACA8hD,WAAApC,OAAA7M,MAAAgI,OAAAA,OAAA1C,aAAAtF,MAAA8M,OACAoC,UAAA99D,KAAAo9D,UAAAxG,SAAA3M,SAAA2K,UAAA3K,SAAAl9B,QACAhR,IAAA/b,KAAA09D,eAAA9tB,QAaA;MAVAA,OAAA,GAAA7zB,IAAA6gD,IAAAjB,WAAA5/C,IAAA+hD,UAAAnC,WAAA5/C,IAAAkuC,SAAAl9B,QAAA4uC,WACA5/C,IAAAkuC,SAAAF,QAAA4R,WAAAiB,IAAA7gD,IAAA4/C,UAGA/rB,MAAA,GAAA7zB,IAAA6gD,IAAAiB,WAAAnC,QAAA3/C,IAAA+hD,UAAAD,WAAAnC,QACA3/C,IAAAkuC,SAAAl9B,QAAA8wC,WAAAnC,QAAA3/C,IAAAkuC,SAAAF,QAAA8T,WAAAnC,QAAAzR,SAAAF,QAAAhuC,IAAA8hD,YAGA5pD,EAAA,IAAA2oD,KAAA7uD,IAAA6uD,KAAA7gD,IAAA,UAAA4/C,SAAA,IAAAC,YAAAC,UAAA,IAAAJ,OAAA,KAAAI,UAAA,KAEAjsB,OAGAmuB,eAAA,SAAAnH,QACA,GAOAoH,QAAAC,MAAA32D,OAPA0E,EAAA4qD,OAAA1C,aAAAl0B,EACAjiB,MAAA/d,KAAAmD,QAAA,MACAoa,OAAAvd,KAAAmD,QAAA,OACA+6D,SAAA,MAAAtH,OAAA7B,SACAoJ,MAAAnyD,EAAA+R,MAAAR,SAAA2gD,SAAA,GAAA,GACAE,IAAAniE,KAAAmiE,IACArhE,MAAAd,KAAAc,MAGAshE,SAAApiE,KAAAqiE,KAAAF,IAAAD,KAAA,GAAAC,IAAA7gD,OAAA,IACAghD,KAAAv+D,KAAA0f,OAAAy+C,KAAAE,SAAAr+D,KAAA0f,OAAAnC,OAAA8gD,SASA;MAPAE,KAAA,GAAAtiE,KAAAqiE,KAAAF,IAAAG,IAAA,GAAA,GAAAH,IAAAp+D,KAAA0f,OAAA,IACA6+C,IAAA,GAAAtiE,KAAAqiE,KAAAF,IAAAG,IAAA,GAAA,GAAAH,IAAAp+D,KAAA0f,OAAA,IAEAs+C,OAAAK,SAAAE,IAAA,GAAAA,IAAA,IAAAL,SAAA,EAAAK,IAAA,IACAN,MAAAD,OAAAK,SAEA/2D,QAAAvK,MAAAkhE,MAAAlgD,OAAAhhB,MAAAkhE,MAAA1gD,SACAvR,EAAA1E,OAAAA,OAAAgH,WAIAkwD,cAAA,SAAA5H,OAAAxH,KAAAqP,OACAA,MAAAA,OAAA,EACArP,KAAAA,MAAApvD,KAAAovD,IAEA,IAAArxC,OAAAqxC,KAAA,GAAAqP,MACAlhD,OAAA6xC,KAAA,GAAAqP,MACAC,OAAAziE,KAAAC,KAAA6hB,MAAA,GAAA4gD,QAAA1iE,KAAAC,KAAAqhB,OAAA,GAGAqhD,MACAC,IAAA,EAAA,EAAA9gD,MAAAR,OAAAQ,MAAA,GACA+gD,IAAA,EAAA,EAAA/gD,MAAA,EAAA,EAAAR,QACA85B,IAAA,EAAA95B,OAAAQ,MAAA,EAAAA,MAAAR,QACAwhD,IAAA,EAAA,EAAA,EAAAxhD,OAAAQ,MAAAR,QACAyhD,IAAA,EAAAzhD,OAAAmhD,OAAA,EAAA3gD,MAAAR,QACA0hD,IAAA,EAAA,EAAAlhD,MAAA,EAAA2gD,OAAAnhD,QACA2hD,IAAA,EAAA,EAAAnhD,MAAA4gD,QAAA,EAAAphD,QACA4hD,IAAAphD,MAAA,EAAAA,MAAAR,OAAA,EAAAohD,SAOA;MAHAC,MAAAQ,GAAAR,KAAAC,GAAAD,KAAAS,GAAAT,KAAAE,GACAF,KAAAU,GAAAV,KAAAvnB,GAAAunB,KAAAW,GAAAX,KAAAG,GAEAH,KAAAhI,OAAA7B,WAIAyK,YAAA,SAAAt6C,QAAAyd,QACAzd,QAAAu6C,YACAv6C,QAAAw6C,OAAA/8B,OAAA,GAAAA,OAAA,IACAzd,QAAAy6C,OAAAh9B,OAAA,GAAAA,OAAA,IACAzd,QAAAy6C,OAAAh9B,OAAA,GAAAA,OAAA,IACAzd,QAAA06C,aAGA3C,OAAA,WAEA,GAAA/wD,GAAAlM,KAAA42D,QAAAkF,WAAApL,QAAAC,KAAA3wD,KAAAq9D,aAAAr9D,KAAAmD,QAAAyzD,OAcA,QAXA52D,KAAAq6D,UAAAr6D,KAAA42D,QAAA,MAAA52D,KAAA42D,OAAA7B,YAEA/0D,KAAA6pD,KAAA1yB,MAAAy/B,OAAA1qD,EAAApO,QAGAkC,KAAA6/D,UAIA7/D,KAAA6sB,QAAA+/B,OAAA5sD,KAAAq6D,SAEAr6D,KAAA42D,QAGAiJ,OAAA,SAAAjJ,OAAAt4C,UACA,IAAAte,KAAAq6D,QAAA,MAAAr6D,KAEA,IAOA4vC,OAAAskB,WAAAhvC,QACAyd,OAAAm9B,UAAAC,UAAAC,QAAAtgD,OARAuqC,SAAAjqD,KAAA6pD,KAAAI,SACA2S,IAAA58D,KAAA6sB,QACAozC,MAAArD,IAAA78C,WACA5c,QAAAnD,KAAAmD,QACA+8D,QAAAlgE,KAAAovD,KACA+Q,MAAAh9D,QAAAg9D,MACApjE,MAAAd,KAAAc,KAKA65D;SAAAA,OAAA52D,KAAA6pD,KAAA1yB,MAAAy/B,QAAA52D,KAAA42D,QAGAuJ,QAAA5V,MAAA4V,MAAAvJ,QAIAuJ,MAAA,GAAA5R,QAAA4R,OACAA,MAAAjM,WAAA0C,OAAA1C,WAEA,YAAAiM,MAAAz9B,EAAAy9B,MAAAz9B,EAAAk0B,OAAAl0B,EACA,YAAAy9B,MAAAn0D,EAAAm0D,MAAAn0D,EAAA4qD,OAAA5qD,EACAm0D,MAAAz9B,IAAAy9B,MAAAn0D,IACAm0D,MAAAvJ,OAAA1C,YAAA0C,OAAAA,OAAA1C,cAGAA,WAAAiM,MAAAjM,WAGA0C,OAAA1C,aAAAxE,EAAA1vD,KAAAk9D,kBACAl9D,KAAAm9D,mBAGAvtB,MAAA5vC,KAAA4vC,MAAA5vC,KAAA49D,cAAAhH,QAGAhnB,MAAA,KAAAgsB,aAEAl8C,OAAA1f,KAAA0f,OAAA1f,KAAAs9D,YAAA1G,OAAAA,OAAAA,OAAA1C,aAGA/wD,QAAAuc,QAAA,EAAAA,SAAAs8C,QAAA78D,KAAAywC,MAAA,MAAAA,MAAA,GAAAA,MAAA,IAGA5vC,KAAA0f,OAAAA,OAAAvc,QAAAuc,SAAAisC,KAAAxoD,QAAAuc,OAAAA,QAIA1f,KAAA0f,OAAAA,OAAA,EAGAsgD,QAAAhgE,KAAAovD,KAAApvD,KAAA+9D,eAAAnH,QACAgG,IAAA7gD,KACAgC,MAAAiiD,QAAA,GACAziD,OAAAyiD,QAAA,GACAI,WAAAJ,QAAA,GAAA,OAKAD,UADAnJ,OAAA1C,aAAAl0B,GAEAjjC,MAAAojE,MAAAz9B,IAAAotB,KAAApwC,OAAAygD,MAAAz9B,IAAAstB,MAAAgQ,QAAA,GAAAE,QAAA,GAAAxgD,QAAAsgD,QAAA,GAAAE,QAAA,IAAA,GACAnjE,MAAAojE,MAAAn0D,IAAA6jD,IAAAmQ,QAAA,GAAAE,QAAA,GAAA,KAKAnjE,MAAAojE,MAAAz9B,IAAAotB,KAAAkQ,QAAA,GAAAE,QAAA,GAAA,GACAnjE,MAAAojE,MAAAn0D,IAAA6jD,IAAAnwC,OAAAygD,MAAAn0D,IAAA+jD,OAAAiQ,QAAA,GAAAE,QAAA,GAAAxgD,QAAAsgD,QAAA,GAAAE,QAAA,IAAA,IAKApE,WAEA52C,QAAA+6C,MAAA,GAAAlE,WAAA,MACA72C,QAAAm7C,UAAAn7C,QAAA63C,OACA73C,QAAAo7C,UAAA,EAAA,EAAA,IAAA,KAGA39B,OAAA3iC,KAAAw+D,cAAA2B,MAAAD,QAAAzD,OACAqD,UAAA9/D,KAAAw+D,cAAA2B,MAAAngE,KAAAovD,KAAAqN,OAGAwD,MAAA/4D,KAAAyoD,MAAAqQ,QAAA,GAAAvD,OAAAv1D,KAAA0oD,OAAAoQ,QAAA,GAAAvD,OACAwD,MAAAlkD,IAAA4zC,MAAAqQ,QAAA,IAAAjkD,IAAA6zC,OAAAoQ,QAAA,IAGAhgE,KAAAw/D,YAAAt6C,QAAA46C,WACA56C,QAAAq7C,UAAA3wB,MAAA,GACA1qB,QAAAs7C,OAGAt7C,QAAA66C,UAAAA,UAAA,GAAAtD,MAAAsD,UAAA,GAAAtD,OACAz8D,KAAAw/D,YAAAt6C,QAAAyd,QACAzd,QAAAq7C,UAAA3wB,MAAA,GACA1qB,QAAAs7C,SAMA79B,OAAA3iC,KAAAw+D,cAAA2B,OAGAx9B,OAAA,IAAAA,OAAA,GAAA,IAAAA,OAAA,GAAA,KAAAA,OAAA,GACA,IAAAA,OAAA,GAAA,IAAAA,OAAA,GAAA,IAAAA,OAAA,GAAA,MAGAo9B,UAAA,GAAArgD,QAAA,UAAAvgB,KAAAy3D,OAAAnrD,UACA,IAAAilD,QAAAC,GAAA,EAAA,EAAA,EAGAsP,MAAAlkD,KACA0kD,UAAAT,QAAA,GAAAtgD,OAAA,KAAAsgD,QAAA,GAAAtgD,QACAghD,UAAA,IAAAP,MAAA10D,SAAAhK,QAAAwuD,QAAA,IACAn0C,KAAAikD,UAAA,GAAAA,UAAA,GAAA30D,OAAA8oD,aAAAxE,GACA7wC,IAAAkhD,UAAA,GAAAA,UAAA,GAAA30D,OAAA8oD,aAAAl0B,GACAjiB,MAAAiiD,QAAA,GAAAtgD,OACAnC,OAAAyiD,QAAA,GAAAtgD,SAEAhH,KAAA,SAAAta,GACA,GAAAuiE,OAAA1sD,EAAAjU,KAGA2gE;MAAAA,MAAA1gD,KAAA,OAAA,SACAwgD,UAAAT,QAAA,GAAAtgD,OAAA,KAAAsgD,QAAA,GAAAtgD,QACAkhD,KAAAj+B,OACAk+B,UAAAjxB,MAAA,GACAkxB,SAAA1iE,EACA2iE,SAAA3iE,IAEAwuD,UAAAltC,SAAAthB,KAGAA,GAAAuiE,MAAApzB,KAAAmvB,UACA,SAAA,WAAA,EAAAh9C,OAAA,cAAAkwB,MAAA,GAAA,6CAOA3hB,OAAA+yC,OAAA37C,WAAA,WACA4kC,SAAA2S,IAAA7gD,KACAuT,QAAA,eACAiZ,WAAA,aAEA,GAGAjqB,WAAAisC,OAAAvqD,KAAAihE,UAAArK,OAAAoJ,UAGAiB,UAAA,SAAArK,OAAAxH,MACA,IAAApvD,KAAAq6D,QAAA,MAAA9P,MAEA,IAMA2J,YAAAgN,QANAlxD,KAAAhQ,KACAiqD,SAAAjqD,KAAA6pD,KAAAI,SACA2S,IAAA58D,KAAA6sB,QACAs0C,WAAAnhE,KAAAmD,QAAA8I,OAEAqS,UADA2rC,SAAAF,QAAArzB,SAAA,gBAsCA,OAjCAkgC,QAAAA,QAAA52D,KAAA42D,OACA1C,WAAA0C,OAAA1C,WAGA9E,KAAAA,MAAApvD,KAAA+9D,eAAAnH,QAGAsK,SAAAtK,OAAAl0B,EAAAk0B,OAAA5qD,GACAkoD,aAAAxE,GAAAwR,QAAA5yD,UAGA2F,EAAAyE,KAAAwoD,QAAA,SAAA9iE,EAAAm/D,MACA,GAAA9+D,GAAAwgE,GAAAJ,EAEAtB;OAAAtN,QACAxxD,EAAAy1D,aAAAl0B,EAAA8vB,KAAAD,IACAvxC,SAAA7f,GAAA,MACA6f,SAAAk9C,OAAA,IAAA/8D,IAAAxC,KAAAc,MAAAqyD,KAAA8E,aAAAl0B,EAAA,EAAA,GAAA,GAAAmhC,aAGA1iE,EAAAuR,KAAAstD,YAAA1G,OAAA2G,KAAAtT,SAAAF,SACAkV,GAAAjvD,KAAAstD,YAAA1G,OAAA2G,KAAAtT,SAAAl9B,SACA8xC,GAAA7uD,KAAAytD,aAAA7G,QAEAt4C,SAAAi/C,MAAAthE,KAAAykB,KAAA1Q,KAAA0P,OAAAthB,EAAA6gE,GAAAkC,YAAAtC,GAAApgE,EAAAogE,IAAApgE,OAKA6f,SAAAs4C,OAAA1C,cAAA9E,KAAA8E,aAAAxE,EAAA,EAAA,GAGAkN,IAAA7gD,KAAA8kB,OAAA,GAAAhiB,IAAA,GAAAC,OAAA,GAAAhD,KAAA,GAAAI,MAAA,KAAAH,IAAAuC,UACAA,UAGAkvC,WAAA,SAAAv0C,MAAAsyC,IAAA5hD,KAYA,QAAAy3D,WAAAvhD,UAAAq0C,WAAAmN,UAAA9D,KAAA+D,UAEAzhD,YAAAswC,OAAAoR,UAAArN,aAAAA,YAAAzC,OAAA8L,OAAAgE,UAAAF,aAAApR,OACAsR,UAAArN,WAAAqN,UAAArN,aAAAxE,EAAA1vB,EAAA0vB,EAEA7vC,YAAAswC,OAAAsB,OAAA8L,QACAgE,UAAArN,YAAAqN,UAAArN,cAAAjE,OACAwB,OAAA8L,MAAA,EAAAA,KAAA+D,SAAAC,UAAArN,cAAAqJ,KAAA+D,SAAA/D;CAIA,QAAAiE,WAAAC,GAAAlE,KAAA+D,UACAC,UAAAE,MAAAxR,OACAl0C,IAAAy/C,OAAA,IAAA+B,MAAAmE,MAAAD,IAAAx1D,OAAAuvD,OAAA,IAAA+B,MAAA9L,OAAA8L,OAGA7jC,MAAAztB,OAAAq1D,YAAA5qD,WACA+6C,OAAA8L,OAAAtxD,OAAAsxD,SAAA9L,OAAA8L,MAAAtxD,OAAAsxD,QAEAmE,MAAAD,IAAAxlE,KAAAykB,IAAAgZ,MAAA,GAAAA,MAAA,KAAAA,MAAA,KACA/vB,IAAA4zD,OAAA9L,OAAA8L,MACAmE,MAAAnE,MAAAhT,OAGAxuC,IAAA9P,OAAAq1D,YAAA5qD,UAAA4qD,SAAA/D,MAAAmE,MAAAD,KAnCA,GAAAzhE,KAAAq6D,QAAA,CAEA,GAOApuD,QAAAytB,MAPAvC,MAAAo0B,IAAAp0B,MACAoqC,UAAAvhE,KAAA42D,OAAA94D,QACA2zD,OAAA9nD,IAAAurD,SACA1nD,OAAA+9C,IAAApoD,QAAAmb,SAAAmzC,OAAAjkD,OAAArC,MAAA,KACAw2D,WAAAn0D,OAAA,GACAo0D,SAAAp0D,OAAA,IAAAA,OAAA,GACAk0D,OAAA5lD,KAAAyuC,MAAA1rC,IAAA0rC,MAAA7nB,EAAA,EAAA12B,EAAA,GACA+P,MA+BA/b,MAAA42D,OAAA1J,QAAAvB,OAEAyV,UAAAO,WAAAjS,EAAA1vB,EAAA8vB,KAAAE,OACAoR,UAAAQ,SAAA5hC,EAAA0vB,EAAAG,IAAAE,SAGAwR,UAAA91D,WAAA0rB,MAAAy/B,OAAAnrD,UAAA0rB,MAAA0qC,YAAApQ,OAAA5yC,KAAAsY,MAAA2qC,aAAArQ,OAAA31C,OACA9b,KAAA6/D,OAAA0B,UAAAhX,QAKAt+C,OAAAjM,KAAAihE,UAAAM,WAGAt1D,OAAAiQ,QAAAxF,YAAAzK,OAAA6P,MAAA7P,OAAAiQ,OACAjQ,OAAA6S,SAAApI,YAAAzK,OAAA4S,KAAA5S,OAAA6S,QACA7S,OAAA81D,KAAA/hE,KAAAiM,QAGAy1D,MAAA5lD,KAAA6lD,aAAAxR,SAAAsB,OAAA31C,OAAA0lD,UAAA9R,EAAAI,KAAAE,QACA0R,MAAA7iD,IAAA+iD,WAAAzR,SAAAsB,OAAA5yC,MAAA2iD,UAAAxhC,EAAA6vB,IAAAE,QAOA/vD,KAAA6sB,QAAA9Q,IAAAA,KAAA6wC,SACA8U,MAAAh/B,GAAAg/B,MAAA11D,GAAAu1D,UAAA7+B,IAAAutB,QAAAyR,MAAA11D,GAAAu1D,UAAAv1D,IAAAikD,QAAAyR,MAAAh/B,IAIA/4B,IAAAmS,MAAA7P,OAAA6P,KAAA4I,OAAAzY,OAAA81D,KACAJ,aAAAxR,OAAAuR,MAAA7iD,MAAA6iD,MAAA5lD,OAAA4lD,MAAA7iD,IAAA5S,OAAA6P,KAAA9b,KAAA0f,OAAA,EACA/V,IAAAkV,KAAA5S,OAAA4S,IAAA6F,OAAAzY,OAAA81D,KACAH,WAAAzR,OAAAuR,MAAA5lD,OAAA4lD,MAAA5lD,OAAA4lD,MAAA7iD,IAAA5S,OAAA4S,IAAA7e,KAAA0f,OAAA,EAGAyX,MAAA2qC,WAAArQ,OAAA31C,KAAAqb,MAAA0qC,UAAApQ,OAAA5yC,IACAsY,MAAAy/B,OAAA2K,UAAAzjE;GAGAqwB,QAAA,WAEAnuB,KAAA6pD,KAAAgP,QAAA74D,KAAA6pD,KAAAE,QAAA/pD,KAAAmvD,KAGAnvD,KAAA6pD,KAAAI,SAAA2S,KACA58D,KAAA6pD,KAAAI,SAAA2S,IAAAviD,KAAA,KACA2F,SAAA5f,MAAA4f,YAKAu7C,IAAA1P,QAAA+Q,IAAA,SAAArR,KACA,MAAA,IAAA2D,KAAA3D,IAAAA,IAAApoD,QAAAguC,MAAAyrB,MAIArB,IAAA9c,WAAA,SAGA8c,IAAAzP,SAAA,SAAA3oD,SACA,GAAAA,QAAAguC,OAAA,OAAAhuC,SAAAguC,MAAA,CACA,GAAA7sC,MAAAnB,QAAAguC,MAAAyrB,GACA,iBAAAt4D,QAAAA,KAAAnB,QAAAguC,MAAAyrB,KAAAhG,OAAAtyD,OACA,kBAAAnF,WAAAmF,MAAAsyD,UAAAtyD,KAAAsyD,OAAAjL,QAKA6D,OAAAoN,KACAoF,gDAAA,WAEAhiE,KAAAi9D,SAGAj9D,KAAA6pD,KAAA2D,cAEAyU,6BAAA,SAAA7gE,KAEApB,KAAAovD,MAAAhuD,IAAA2c,MAAA3c,IAAAmc,QACAvd,KAAA6/D,SAGA7/D,KAAA6pD,KAAA2D;EAEA0U,yCAAA,WACAliE,KAAA6/D,WAKA5rD,EAAA8D,OAAA4zC,KAAAiC,KAAAxM,UACAjQ,OACAyrB,KACAhG,OAAAjL,KACAwU,MAAA5V,MACAxsC,MAAA,EACAR,OAAA,EACAmC,OAAAisC,KACA1/C,OAAA,KAIA,IAAAk2D,OAAAC,QACAC,WAAA,aACAC,cAAA,IAAAD,UAEAD,SAAA,WASA,QAAAG,WAAA11C,SAEA,GAAA5Y,EAAAuuD,KAAA,KAAAD,UAAA,MAAAtuD,GAAAuuD,KAAA,KAAAD,SAEA,IAEApyD,KAAAsyD,QAAArY,IAFAsY,kBAAAnoD,MAAAtG,EAAA/M,KAAA2lB,QAAA,aACAutC,SAAAvtC,QAAAutC,UAAAvtC,QAAAutC,SAAA/uD,aAGA,OAAA,SAAA+uD,UACAjqD,IAAA0c,QAAA81C,WACAF,QAAAtyD,IAAA2B,KACA+a,QAAA+1C,MAAAH,SAAA,QAAAtyD,IAAAiqD,SAAA/uD,eAGA++C,IAAAn2C,EAAA,eAAAwuD,QAAA,KAAA,KACArY,KAAAA,IAAA77B,GAAA,cAHA,GAKA,sCAAApvB,KAAAi7D,WACAvtC,QAAAy9B,SACA,MAAA8P,SACAvtC,QAAA+1C,MAAAF,iBACAA;CAKA,QAAAG,aAAAC,WAEAC,eAAA1kE,OAAA,GAAAykE,UAAAzkE,OAAAykE,UAAAlsC,IAAA,QAAAghC,OAGAmL,eAAA11D,QAAAmqD,QAIA,QAAAwL,YAAA/pD,OACA,GAAA60C,KAAAv/B,GAAA,YAAA,CAEA,GAGA00C,aAHAhzC,OAAAhc,EAAAgF,MAAAgX,QACA85B,QAAAmZ,QAAAnZ,QACAqE,UAAAn+B,OAAAmR,QAAA4rB,SAIAiW,aAAA7U,UAAA/vD,OAAA,EAAAksD,MACAh6C,SAAA69C,UAAA,GAAAjd,MAAA1I,OAAA,IAAAl4B,SAAAw5C,QAAA,GAAA5Y,MAAA1I,OAAA,IAKAw6B,aAAAhzC,OAAAmR,QAAA4rB,UAAA,KAAAjD,QAAA,IACA8Y,YAAA5yC,QAIAkzC,OAAAlqD,MAAAgX,SAAA8yC,eAAAA,eAAA1kE,OAAA,IA9DA,GAEA6kE,SAAAC,OACAC,UAAAtV,KAHA99C,KAAAhQ,KACA+iE,iBAgEA9uD,GAAA8D,OAAA/H,MACAvC,KAAA,WA0BA,MAxBAqgD,MAAA99C,KAAA89C,KAAA75C,EAAA,WACA7F,GAAA,eACAm/B,KAAA,cACA5W,UAAA,WAAA,MAAA4zB;IAEAxpB,OAGA9sB,EAAA0K,SAAAgvC,MAAA8J,KAAA,UAAA6K,cAAAU,YAGA/uD,EAAA0K,UAAA84C,KAAA,UAAA6K,cAAA,SAAArpD,OACAiqD,SAAAA,QAAA//D,QAAA29B,KAAAuiC,MAAAC,QAAA,KAAArqD,MAAAsqD,SACAL,QAAAniC,KAAA9nB,SAKA60C,KAAA2J,KAAA,QAAA6K,cAAA,SAAArpD,OACAiqD,SAAAA,QAAA//D,QAAA29B,KAAAuiC,MAAAzL,MACAsL,QAAAniC,KAAA9nB,SAIAjJ,MAGA6vD,OAAA,SAAAtU,KAEA2X,QAAA3X,IAIAwX,eADAxX,IAAApoD,QAAA29B,KAAAuiC,MAAAG,aAAAjZ,MACAgB,IAAAxB,QAAA1vC,KAAA,KAAA7L,OAAA,WACA,MAAA+zD,WAAAviE,YAMA4sD,OAAA,SAAArB,IAAAyL,MAAAj1C,UACA,GACAgoC,UADA91C,EAAA0K,SAAAgvC,MACApC,IAAAxB,SACA5mD,QAAAooD,IAAApoD,QAAA29B,KAAAuiC,MACArO,OAAA7xD,QAAA6xD,OACA9/C,KAAA8hD,MAAA,OAAA,OACAxB,QAAA1H,KAAAv/B,GAAA,YACAk1C,cAAAxvD,EAAAquD,eAAA9zD,OAAA,2BAAAooB,IAAAmzB,QAqBA;MAjBA/5C,MAAA6vD,OAAAtU,KAIAyL,OAAA7zD,QAAAqgE,aAAAjZ,OACAsY,YAAA5uD,EAAA,WAIA65C,KAAAkE,YAAA,QAAA7uD,QAAAy0D,MAGAZ,OACAlJ,KAAAhuC,SAAAnB,SAAAgvC,MAIAG,KAAAv/B,GAAA,cAAAinC,UAAAwB,OAAAoM,YAAA7Y,QAAAyM,OAAAyM,cAAAplE,OACA2R,MAIA89C,KAAA53C,KAAAy1C,KAAApB,OAGAt2C,EAAAgQ,WAAA+wC,QACAA,OAAAzrD,KAAAukD,KAAAkJ,OAIAhC,SAAAzK,MACAuD,KAAA54C,QAKA44C,KAAAgK,OAAAvnD,SAAAwR,SAAA,KAAA,GAAAi1C,MAAA,EAAA,EAAA,WACAA,OAAAlJ,KAAA/sB,SAKAi2B,OACAlJ,KAAAqI,MAAA,SAAAxkC,MACAm8B,KAAA/xC,KAAAD,KAAA,GAAA+C,IAAA,KACA5K,EAAAquD,eAAAjkE,QAAAyvD,KAAA4V,SACA/xC,SAKAyxC,UAAApM,MAGAkM,QAAAvY,YAAAuY,QAAAlZ,MAEAh6C,SAIAA,KAAAvC,QAEA20D,QAAA,GAAAA,SASAnuD,EAAA8D,OAAAs3C,MAAApvD,WACAwN,KAAA,SAAAo8C,MACA,GAAAE,SAAAF,KAAAE,OAGA;MAAA/pD,MAAAmD,QAAA+N,IAGA24C,KAAAI,SAAA0Z,QAAAvB,QAAAtU,KAGA/D,QAAA5vC,SAAAkoD,YAAAtmD,IAAA,UAAA6xC,KAAAgW,aAAA3vD,EAAAquD,eAAAjkE,QAGAwrD,KAAA4O,MAAA1O,SAAA,cAAA,eAAA,SAAA9wC,MAAAsyC,IAAAxpC,UACA,GAAA8hD,QAAA5qD,MAAA6/C,aAGA,IAAA7/C,MAAAgX,SAAA85B,QAAA,GACA,GAAA8Z,QAAA,gBAAA5qD,MAAA/D,MAAA,qBAAA/V,KAAA0kE,OAAA3uD,OAAAjB,EAAA4vD,OAAA/W,eAAA1rB,QAAAghC,QAAAtU,KAAA,IAAAzvD,OACA,IAAA4a,MAAAqrB,iBAAA,MAAA15B,UAEAi5D,QAAAA,QAAA,gBAAAA,OAAA3uD,OACAlV,KAAA4sD,OAAA3zC,MAAA,gBAAAA,MAAA/D,KAAA6M,WAGA/hB,KAAAmvD,IAAAnvD,MAGA6pD,KAAA4O,MAAA1O,QAAA,eAAA,SAAA9wC,MAAAsyC,KAEA,IAAAtyC,MAAA8/C,sBAAA9/C,MAAAgX,SAAA85B,QAAA,GAAA,CAEA,GAAAgO,OAAA9jD,EAAAquD,eAGArK,SAAArK,KAAAgW,aAAA7L,MAAA15D,OACA25D,SAAAznD,SAAAw5C,QAAA,GAAA5Y,MAAA1I,OAAA,GAGA25B;QAAAtU,KAAA,GAAA3c,MAAA1I,OAAAwvB,SAAA,EAGAF,MAAAr/C,KAAA,WACA1Y,KAAAmxC,MAAA1I,OAAAuvB,WACAh4D,KAAAmxC,MAAA1I,QAAA,KAKAsvB,MAAAvpD,OAAA,IAAA+hD,aAAA1G,KAAA,OAAA5wC,MAAA6/C,eAGA/O,QAAA5vC,SAAAo2C,aAAA,GAAApf,MAAA1I,OAAAwvB,SAGAmK,QAAAvC,OAAAtU,IAGA,KAAAtyC,MAAAqrB,iBAAA,MAAA15B,OACA5K,KAAAmvD,IAAAnvD,UAGA6pD,MAAA4O,MAAA1O,QAAA,cAAA,SAAA9wC,OACAA,MAAAgX,SAAA85B,QAAA,IACA91C,EAAAquD,eAAA9zD,OAAA,YAAAooB,IAAAmzB,SAAAz8C,OAAAu8C,KAAA,QAAA5wC,QAEAjZ,KAAAmvD,IAAAnvD,OA9DAA,MAiEA4sD,OAAA,SAAA3zC,MAAA+9C,MAAAj1C,UAEA,MAAA9I,QAAAA,MAAA8/C,qBAAA/4D,SAGAoiE,SAAAxV,OAAA5sD,KAAA6pD,OAAAmN,MAAAj1C,WAGAoM,QAAA,WAEAnuB,KAAA6pD,KAAAE,QAAA7vC,YAAAmoD,YAGAriE,KAAA6pD,KAAAgP,QAAA74D,KAAA6pD,KAAAE,QAAA/pD,KAAAmvD,KAGAiT,QAAAxV,OAAA5sD,KAAA6pD,KAAAU,aACAvqD,MAAA6pD,KAAAI,SAAA0Z;IAKAxB,MAAAtW,QAAAwX,MAAA,SAAA9X,KACA,MAAA,IAAA8D,OAAA9D,IAAAA,IAAApoD,QAAA29B,KAAAuiC,QAIAlB,MAAArW,SAAA,SAAAxnD,MACAA,KAAAw8B,OACA,gBAAAx8B,MAAAw8B,KAAAuiC,MAAA/+D,KAAAw8B,KAAAuiC,OAAAnyD,KAAA5M,KAAAw8B,KAAAuiC,OACA,mBAAA/+D,MAAAw8B,KAAAuiC,MAAAnyD,KAAA5M,KAAAw8B,KAAAuiC,MAAAnyD,GAAAy6C,QAKAiC,KAAAgW,aAAAhW,KAAAsK,OAAA,IAGAiK,MAAA1jB,WAAA,SAGA+Q,OAAA6T,OACAS,yBAAA,WAEA9jE,KAAAmuB,UACAnuB,KAAAyN,OAGAzN,KAAA6pD,KAAAoR,MAAA0I,QAAA/W,OACA5sD,KAAA6pD,KAAAE,QAAA,GAAAwD,YAAA,KAMAt5C,EAAA8D,OAAA4zC,KAAAiC,KAAAxM,UACAtgB,MACAuiC,OACAnyD,GAAAq5C,MACAyK,OAAArJ,KACAiM,KAAAjM,KACA6X,WAAA7X,KACA2X,OAAA3X,SAIAE,QAAAyC,SAAA,SAAA/C,IAAAjtC,SAAAyvC,WAAAuH,YAAAC,aAAAwO,UAAAC,YAkCA,QAAA/C,WAAA1D,KAAA0G,UAAA/uD,KAAAu8C,OAAAyS,MAAAC,MAAAC,WAAAC,aAAAC,YACA,GAAAC,YAAAjmD,SAAA4lD,OACAM,OAAA/Y,GAAA8R,MACAkH,OAAA/Y,GAAA6R,MACAmH,QAAAxvD,OAAAi7C,MACAwU,SAAAH,SAAAN,MAAAI,WAAAE,SAAAL,OAAAG,YAAAA,WAAA,EACAM,SAAAH,SAAAP,MAAAG,aAAAI,SAAAN,OAAAE,cAAAA,aAAA,EACAQ,WAAAC,eAAAZ,OAAA1iC,eAAA0iC,QAAAa,gBAAA,EAAAC,gBAAAd,QACAe,UAAAJ,WAAAN,WACAW,UAAAX,WAAAD,YAAAF,aAAAzU,MAAAwV,cAAAC,gBAAAP,WACA54D,OAAA04D,UAAAlZ,GAAAyI,aAAAqJ,MAAAiH,SAAA/Y,GAAAwY,WAAAW,SAAA,IAAAH,SAAAxU,OAAAoU,aAAA,EAAA,EAgDA;MA7CAK,UACAz4D,QAAAu4D,SAAAN,MAAA,EAAA,IAAAS,SAGArmD,SAAA4lD,QAAAe,UAAA,EAAAA,UAAAC,UAAA,GAAAA,UAAA,EACA5mD,SAAA4lD,OAAAjoE,KAAAykB,KACAskD,gBAAAd,OAAA1iC,eAAA0iC,OACAK,WAAAt4D,OACAhQ,KAAA0kB,IACA1kB,KAAAykB,KACAskD,gBAAAd,OAAA1iC,eAAA0iC,QAAAE,aAAAzU,MAAAwV,cAAAC,gBACAb,WAAAt4D,QAEAqS,SAAA4lD,OAGA,WAAAM,OAAAD,WAAAI,SAAA,QASAlT,QAAAv8C,OAAAg7C,WAAA,EAAA,EAGA+U,UAAA,IAAAT,SAAAN,OAAAgB,UAAA,IACA5mD,SAAA4lD,QAAAj4D,OAAAwlD,OACA4T,MAAAvO,OAAAyG,KAAA2G,QAIAgB,UAAA,IAAAV,SAAAL,OAAAc,UAAA,KACA3mD,SAAA4lD,SAAAM,SAAAvU,QAAAhkD,OAAAA,QAAAwlD,OACA4T,MAAAvO,OAAAyG,KAAA4G,QAIA7lD,SAAA4lD,OAAAY,iBAAAxmD,SAAA4lD,OAAAgB,YACA5mD,SAAA4lD,OAAAK,WAAAc,MAAA5Z,GAAA3tD,UAIAwgB,SAAA4lD,OAAAK;CA1FA,GAYArX,OAAAmY,MAAAL,gBAAAD,gBACAI,cAAAC,eAAAN,eAAAtjC,eAbAvR,OAAA89B,WAAA99B,OACA85B,QAAAwB,IAAAtB,SAAAF,QACA0B,GAAAsC,WAAAtC,GACAC,GAAAqC,WAAArC,GACA+F,OAAA1D,WAAA0D,OACAjkD,OAAAikD,OAAAjkD,OAAArC,MAAA,KACAm6D,QAAA93D,OAAA,GACA+3D,QAAA/3D,OAAA,IAAAA,OAAA,GACA8gD,SAAAP,WAAAO,SACAF,UAAAL,WAAAK,UAEA8G,UADA3J,IAAAp0B,OACArb,KAAA,EAAA+C,IAAA,GAKA,OAAAyvC,UAAApD,QAAAj7B,OAAA,KAAAhC,QAAAgC,OAAA,KAAAtR,SAAAgvC,MAAA,SAAA8D,OAAAjkD,QAKAw3D,gBAAA5W,UAAAniD,UAAAipD,SACA6P,gBAAA,WAAA3W,UAAAryC,IAAA,YAGAmxC,MAAA,UAAAnD,QAAAhuC,IAAA,YACAopD,cAAA7W,SAAA,KAAArgC,OAAAqgC,SAAAvwC,QAAAuwC,SAAAxwC,WAAAysC,OACA6a,eAAA9W,SAAA,KAAArgC,OAAAqgC,SAAA/wC,SAAA+wC,SAAAhxC,YAAAitC,OACAua,gBAAAhpD,KAAAoxC,MAAA,EAAAoB,SAAAxsB,aAAAjjB,IAAAquC,MAAA,EAAAoB,SAAAzsB,aACAL,eAAA8sB,SAAAriD,UAAAipD,UAiEA,UAAAoQ,SAAA,UAAAC,WAAAF,MAAA5Z,GAAA3tD,SAGAo3D,UACAp5C,KAAA,SAAAwpD,QAAArE,UAAAvR,EAAA1vB,EAAAslC,QAAA7T,OAAA/uB,EAAAotB,KAAAE,MAAAL,MAAA2F,YAAAyO,WAAA,EACAllD,IAAA,SAAA0mD,QAAAtE,UAAAjhC,EAAA0vB,EAAA6V,QAAA9T,OAAAzlD,EAAA6jD,IAAAE,OAAAH,OAAA2F,aAAAyO,YAAA,EACAvY,GAAA4Z,QAnFAnQ;EAwFArJ,QAAA2Z,OAIAC,QAAA,SAAAC,WAAA9O,QACA,GAQAjlC,MAIAg0C,SAAAloD,UAZAnW,QACAyW,MAAA,EAAAR,OAAA,EACAe,UACAO,IAAA,KAAA3C,MAAA,EACA4C,OAAA,EAAAhD,KAAA,MAEAo6C,WAAA3L,OAEAnsD,EAAA,EACAukC,UACAijC,SAAA,EAAAC,SAAA,EACAC,MAAA,EAAAC,MAAA,CAIA,KAAA3nE,EAAAsnE,WAAArnE,OAAAD,KACAuzB,MAAAphB,SAAAm1D,aAAAtnE,GAAA,IAAAmS,SAAAm1D,WAAAtnE,EAAA,GAAA,KAEAuzB,KAAA,GAAArqB,OAAAgX,SAAApC,QAAA5U,OAAAgX,SAAApC,MAAAyV,KAAA,IACAA,KAAA,GAAArqB,OAAAgX,SAAAxC,OAAAxU,OAAAgX,SAAAxC,KAAA6V,KAAA,IACAA,KAAA,GAAArqB,OAAAgX,SAAAQ,SAAAxX,OAAAgX,SAAAQ,OAAA6S,KAAA,IACAA,KAAA,GAAArqB,OAAAgX,SAAAO,MAAAvX,OAAAgX,SAAAO,IAAA8S,KAAA,IAEAgR,OAAArkC,KAAAqzB,KAQA,IAJAg0C,SAAAr+D,OAAAyW,MAAA9hB,KAAAa,IAAAwK,OAAAgX,SAAApC,MAAA5U,OAAAgX,SAAAxC,MACA2B,UAAAnW,OAAAiW,OAAAthB,KAAAa,IAAAwK,OAAAgX,SAAAQ,OAAAxX,OAAAgX,SAAAO,KAGA,MAAA+3C,OAAA7B,SACAztD,OAAAgX,UACAxC,KAAAxU,OAAAgX,SAAAxC,KAAAxU,OAAAyW,MAAA,EACAc,IAAAvX,OAAAgX,SAAAO,IAAAvX,OAAAiW,OAAA;IAGA,CAEA,KAAAooD,SAAA,GAAAloD,UAAA,GAAAmoD,SAAA,GAAAC,SAAA,GAaA,IAXAF,SAAA1pE,KAAAgF,MAAA0kE,SAAA,GACAloD,UAAAxhB,KAAAgF,MAAAwc,UAAA,GAEAm5C,OAAAl0B,IAAAotB,KAAA8V,SAAAD,SACA/O,OAAAl0B,IAAAstB,MAAA4V,SAAAt+D,OAAAyW,MAAA4nD,SACAC,UAAA3pE,KAAAgF,MAAA0kE,SAAA,GAEA/O,OAAA5qD,IAAA6jD,IAAAgW,SAAApoD,UACAm5C,OAAA5qD,IAAA+jD,OAAA8V,SAAAv+D,OAAAiW,OAAAE,UACAooD,UAAA5pE,KAAAgF,MAAAwc,UAAA,GAEArf,EAAAukC,OAAAtkC,OAAAD,OAEAukC,OAAAtkC,OAAA,IAEAynE,MAAAnjC,OAAAvkC,GAAA,GAAAkJ,OAAAgX,SAAAxC,KACAiqD,MAAApjC,OAAAvkC,GAAA,GAAAkJ,OAAAgX,SAAAO,KAEA+3C,OAAAl0B,IAAAotB,MAAAgW,OAAAF,UACAhP,OAAAl0B,IAAAstB,OAAA4V,UAAAE,OACAlP,OAAAl0B,IAAAutB,SAAA2V,SAAAE,OAAAA,MAAAx+D,OAAAyW,MAAA6nD,WACAhP,OAAA5qD,IAAA6jD,KAAAkW,OAAAF,UACAjP,OAAA5qD,IAAA+jD,QAAA8V,UAAAE,OACAnP,OAAA5qD,IAAAikD,SAAA4V,SAAAE,OAAAA,MAAAz+D,OAAAiW,OAAAsoD,YACAljC,OAAA62B,OAAAp7D,EAAA,EAIAkJ;OAAAgX,UAAAxC,KAAA6mB,OAAA,GAAA,GAAA9jB,IAAA8jB,OAAA,GAAA,IAGA,MAAAr7B,SAGAwZ,KAAA,SAAAklD,GAAAC,GAAAC,GAAAC,IACA,OACApoD,MAAA9hB,KAAAa,IAAAopE,GAAAF,IACAzoD,OAAAthB,KAAAa,IAAAqpE,GAAAF,IACA3nD,UACAxC,KAAA7f,KAAA0kB,IAAAqlD,GAAAE,IACArnD,IAAA5iB,KAAA0kB,IAAAslD,GAAAE,OAKAC,SACApH,GAAA,IAAA3nB,GAAA,EAAA,EAAA0nB,GAAA,EAAA,EACAE,GAAA,GAAAJ,GAAA,IAAAC,GAAA,IACAI,GAAA,EAAAC,GAAA,EAAAjzD,EAAA,GAEAm6D,QAAA,SAAAC,GAAAC,GAAAC,GAAAC,GAAA7P,QACA,GAAA1qD,GAAA2/C,QAAA2Z,MAAAY,QAAAxP,OAAA7B,UACA2R,IAAA,IAAAx6D,EAAA,EAAAs6D,GAAAvqE,KAAA0qE,IAAAz6D,EAAAjQ,KAAA2qE,IACAC,IAAAJ,GAAAxqE,KAAA6qE,IAAA56D,EAAAjQ,KAAA2qE,GAEA,QACA7oD,MAAA,EAAAyoD,GAAAvqE,KAAAa,IAAA4pE,KACAnpD,OAAA,EAAAkpD,GAAAxqE,KAAAa,IAAA+pE,KACAvoD,UACAxC,KAAAwqD,GAAAI,IACA7nD,IAAA0nD,GAAAM,KAEA3Q,WAAA3L,QAGAwc,OAAA,SAAAT,GAAAC,GAAAzlE,EAAA81D,QACA,MAAA/K,SAAA2Z,MAAAa,QAAAC,GAAAC,GAAAzlE,EAAAA,EAAA81D,UAGA/K,QAAAmK,IAAA,SAAAzK,IAAAyK,IAAAY,QAYA,IAVA,GAKAoQ,aAAAC,IAAAC,YACAxgD,IAAAiL,KAAAvzB,EAAA+oE,OACA7/D,OAAAgX,SANAwvC,MADA75C,EAAA0K,UACAq3C,IAAA,IACAp7D,KAAAqZ,EAAA65C,KAAAmI,iBACAv3C,cAAAovC,KAAApvC,cACA0oD,cAAA72D,SAAAylD,IAAAj6C,IAAA,gBAAA,KAAA,GAAA,GAMA+xC,KAAAuZ,SAAAvZ,KAAAA,KAAA6U,UACA;IAAA7U,KAAAuZ,UAAAvZ,KAAA6U,WAAA,MAAApY,MAGA,QAAAuD,KAAAsM,UACA,IAAA,UACA,IAAA,SACA9yD,OAAAukD,QAAA2Z,MAAAa,QACAvY,KAAAwY,GAAAgB,QAAA9mE,MACAstD,KAAAyY,GAAAe,QAAA9mE,OACAstD,KAAA0Y,IAAA1Y,KAAAhtD,GAAAwmE,QAAA9mE,MAAA4mE,cACAtZ,KAAA2Y,IAAA3Y,KAAAhtD,GAAAwmE,QAAA9mE,MAAA4mE,aACAxQ,OAEA,MAEA,KAAA,OACA,IAAA,UACA,IAAA,WAOA,IALAuQ,OAAArZ,KAAAqZ,UACAzkC,EAAAorB,KAAAyZ,GAAAD,QAAA9mE,MAAAwL,EAAA8hD,KAAA0Z,GAAAF,QAAA9mE,QACAkiC,EAAAorB,KAAA2Z,GAAAH,QAAA9mE,MAAAwL,EAAA8hD,KAAA4Z,GAAAJ,QAAA9mE,QAGA8G,UAAAlJ,EAAA,GAAAsoB,IAAAygD,OAAAQ,eAAAR,OAAA9oE,SAAAD,EAAAsoB,KACAiL,KAAAw1C,OAAAS,QAAAT,OAAAS,QAAAxpE,GAAA+oE,OAAA/oE,GACAkJ,OAAAhJ,KAAA4c,MAAA5T,QAAAqqB,KAAA+Q,EAAA/Q,KAAA3lB,GAGA1E,QAAAukD,QAAA2Z,MAAAC,QAAAn+D,OAAAsvD,OACA,MAGA,SACAtvD,OAAAwmD,KAAAuZ,UACA//D,QACAyW,MAAAzW,OAAAyW,MACAR,OAAAjW,OAAAiW,OACAe,UACAxC,KAAAxU,OAAAo7B,EACA7jB,IAAAvX,OAAA0E;CAoCA,MA7BAsS,UAAAhX,OAAAgX,SACA1jB,KAAAA,KAAA,GAGAA,KAAAitE,iBACAZ,IAAAnZ,KAAAga,eACAX,OAAAvsE,KAAAitE,iBAEAV,OAAAzkC,EAAApkB,SAAAxC,KACAqrD,OAAAn7D,EAAAsS,SAAAO,IACAqoD,YAAAC,OAAAY,gBAAAd,KACA3oD,SAAAxC,KAAAorD,YAAAxkC,EACApkB,SAAAO,IAAAqoD,YAAAl7D,GAIA0S,gBAAAC,UAAA,UAAA4sC,IAAAjtC,SAAA2R,SACA+2C,YAAA/yD,GAAAyK,cAAAkP,aAAAlP,cAAAspD,cAAAC,cAAAh8D,SACA+6D,cACA1oD,SAAAxC,MAAAkrD,YAAAlrD,KACAwC,SAAAO,KAAAmoD,YAAAnoD,MAKAH,cAAAzK,EAAAyK,eACAJ,SAAAxC,MAAA4C,cAAAojB,aACAxjB,SAAAO,KAAAH,cAAAmjB,YAEAv6B,QAEAukD,QAAAkK,SAAA,SAAAxK,IAAA2c,KAAAtR,QAEAsR,KAAAhd,SAAAgd,KAAAj0D,EAAAi0D,MAEA;GAIAC,aAAAxlC,OAAAvkC,EAAAkJ,OAAAof,IAJA0hD,OAAAF,KAAAhhE,KAAA,UAAA,QAAAmE,cAAAJ,QAAA,OAAA,WACAo9D,MAAAp0D,EAAA,gBAAAi0D,KAAAryD,OAAA,OAAA3O,KAAA,QAAA,MACAohE,aAAAr0D,EAAAmG,KAAA8tD,KAAAhhE,KAAA,WACAqhE,YAAAD,aAAAr9D,QAAA,KAAA,IAAAE,MAAA,IAIA,KAAAk9D,MAAAhqE,OAAA,MAAAksD,MAGA,IAAA,YAAA6d,MACA9gE,OAAAukD,QAAA2Z,MAAAC,QAAA8C,YAAA3R,YAIA,CAAA,IAAA/K,QAAA2Z,MAAA4C,OAWA,MAAA7d,MAVA,KAAAnsD,EAAA,GAAAsoB,IAAA6hD,YAAAlqE,OAAAskC,YAAAvkC,EAAAsoB,KACAic,OAAArkC,KAAAiS,SAAAg4D,YAAAnqE,GAAA,IAGAkJ,QAAAukD,QAAA2Z,MAAA4C,OAAAltD,MACAlb,KAAA2iC,OAAA/hC,OAAAg2D,SAgBA,MARAuR,aAAAE,MAAAp8D,SACAk8D,YAAArsD,MAAA7f,KAAAC,MAAAmsE,MAAAvqD,WAAAysC,OAAA8d,MAAAtqD,SAAA,GACAoqD,YAAAtpD,KAAA5iB,KAAAC,MAAAmsE,MAAA/qD,YAAAitC,OAAA8d,MAAA9qD,UAAA,GAGAjW,OAAAgX,SAAAxC,MAAAqsD,YAAArsD,KACAxU,OAAAgX,SAAAO,KAAAspD,YAAAtpD,IAEAvX;CAEA,IAAAkhE,KAMAC,SAAA,+OASAx0D,GAAA8D,OAAAu3C,IAAArvD,WACAyoE,QAAA,WACA,GAAA/E,SAAA3jE,KAAA6pD,KAAAI,SAAA0Z,OACAA,WAAAA,QAAA,GAAAxyB,MAAAtyB,IAAA5K,EAAAga,QAAA4T,YAAA,OAGAp0B,KAAA,SAAAo8C,MACA,GAAAE,SAAAF,KAAAE,OAIA91C,GAAA,kBAAA5V,OAAA,IACA2B,KAAA2oE,SAAA9e,KAAAI,SAAA0e,SAAA10D,EAAAw0D,UAAA3oD,SAAAiqC,SAGAF,KAAA4O,MAAA1O,QAAA,cAAA/pD,KAAA4oE,eAAA5oE,KAAAmvD,IAAAnvD,OAIAA,KAAA6oE,gBAAA50D,EAAA,UAAA7F,GAAA87C,UAAA,gBACApqC,SAAAnB,SAAAgvC,MAGA9D,KAAAI,SAAA0Z,SAAA9Z,KAAAI,SAAA0Z,QAAAxpD,SAAA,sBACA0vC,KAAA4O,MAAAxqC,QAAA,SAAA,UAAAjuB,KAAA0oE,QAAA1oE,KAAAmvD,IAAAnvD,MACA6pD,KAAA4O,MAAA1O,SAAA,eAAA/pD,KAAA0oE,QAAA1oE,KAAAmvD,IAAAnvD,OAIAA,KAAA8oE;EAGAF,eAAA,WACA,GAOAG,WAAA98D,OAPA89C,QAAA/pD,KAAA6pD,KAAAE,QACAif,YACAzrD,OAAAwsC,QAAAzsC,YAAAitC,OACAxsC,MAAAgsC,QAAAjsC,WAAAysC,QAEA0e,OAAAjpE,KAAA6pD,KAAAQ,QAAAuS,IACAA,IAAA58D,KAAA6pD,KAAAI,SAAA2S,GAIA3wD,QAAAsE,SAAAw5C,QAAAhuC,IAAA,mBAAA,KAAA,EACA9P,QAAA6P,MAAA7P,OAAA4S,KAAA5S,QAGAg9D,QAAArM,MACAmM,UAAA,MAAAE,OAAArS,OAAA1C,YAAAvE,MAAAG,OAAAF,OAAAC,KACA5jD,OAAA88D,UAAA,KAAAnM,IAAAmM,UAAA,OAIA/oE,KAAA2oE,SAAA5sD,IAAA9P,QAAA8P,IAAAitD,aAIAF,OAAA,WACA,GAAA9oE,KAAA6pD,KAAAa,SAAA,GAAA1qD,KAAAkpE,QAAA,MAAAlpE,KAEA,IAGAmpE,MAAAprD,MAAA2C,IAAAC,IAHAopC,QAAA/pD,KAAA6pD,KAAAE,QACA5Y,MAAAnxC,KAAA6pD,KAAA1mD,QAAAguC,MACAid,UAAApuD,KAAA6pD,KAAA1mD,QAAAmb,SAAA8vC,SAsCA,OAlCApuD,MAAA6pD,KAAAqf,QAAA,EAGA/3B,MAAA5zB,QAAAwsC,QAAAhuC,IAAA6zC,OAAAze,MAAA5zB,QACA4zB,MAAApzB,MAAAgsC,QAAAhuC,IAAA4zC,MAAAxe,MAAApzB,QAKAgsC,QAAAhuC,IAAA4zC,MAAA,IAAA7vC,SAAA9f,KAAA6oE,iBAGA9qD,MAAAgsC,QAAAhsC,QACA,EAAAA,MAAA,IAAAA,OAAA,GAGA2C,IAAAqpC,QAAAhuC,IAAA,aAAA,GACA4E,IAAAopC,QAAAhuC,IAAA,aAAA,GAGAotD,MAAAzoD,IAAAC,KAAAlf,QAAA,KAAA,GAAA2sD,UAAArwC,QAAA,IAAA,EACA2C,KAAAA,IAAAjf,QAAA,KAAA,GAAA0nE,KAAA,GAAA54D,SAAAmQ,IAAA,KAAA3C,MACA4C,KAAAA,IAAAlf,QAAA,KAAA,GAAA0nE,KAAA,GAAA54D,SAAAoQ,IAAA,KAAA,EAGA5C,MAAA2C,IAAAC,IAAA1kB,KAAA0kB,IAAA1kB,KAAAykB,IAAA3C,MAAA4C,KAAAD,KAAA3C,MAGAgsC,QAAAhuC,IAAA4zC,MAAA1zD,KAAAc,MAAAghB,QAAA+B,SAAAsuC,YAIApuD,KAAAkpE,QAAA,EAEAlpE;EAGAmuB,QAAA,WAEAnuB,KAAA2oE,UAAA3oE,KAAA2oE,SAAA3oD,SAGAhgB,KAAA6pD,KAAAgP,SAAA5qC,OAAAjuB,KAAA6pD,KAAAE,SAAA/pD,KAAAmvD,QAIAqZ,IAAA3c,QAAAud,IAAA,SAAA7d,KAEA,MAAA,KAAAmF,QAAAC,GAAA,GAAArB,KAAA/D,KAAAhB,OAGAie,IAAA/pB,WAAA,SAEA+Q,OAAA4Z,KACAC,kBAAA,WACArpE,KAAA8oE,cAIA76C,OAAAtP,UCx2GAxkB,OAAA,sDACA,SACA,SACA,4CACA,SAAA6Z,EAAAC,GASA,MAAA,UAAA9Q,SACA,GAAAoR,MAAAvU,KACAmoD,gBACAwR,WAAA,EACA5sC,SACArmB,KAAA,IACAiQ,MAAA,KAEA2H,UACAmtC,GAAA,gBACAC,GAAA,aACA+F,QACA/sB,QAAA,EACAl3B,OAAA,SAEA8gD,SAAAr6C,EAAA0K,WAEAmiB,MAAA,EACAC,MAAA,EACAoQ,OACApzB,MAAA,IACAkY,QAAA,0BAIAj2B;KAAAyN,KAAA,WAEAtK,QADA,gBAAAA,SACA6Q,EAAAs1D,MAAAnhB,eAAAhlD,SAEAglD,eAEAnoD,KAAA+pD,QAAA91C,EAAA,UAAA41C,KAAA1mD,SAAA0mD,KAAA,OACA7pD,KAAA+pD,QAAAE,SAAAl9B,QAAA7b,GAAA,QAAA,YAAA,WACAqD,KAAAwsB,UAQA/gC,KAAA+gC,KAAA,WACA/gC,KAAAupE,WAGAvpE,KAAA+pD,QAAAhpB,QAOA/gC,KAAAupE,QAAA,WACA,MAAAvpE,MAAA+pD,QAAAE,SAAAF,QAAAx7B,GAAA,aASAvuB,KAAAuN,IAAA,SAAApK,SACAnD,KAAA+pD,QAAAx8C,IAAApK,UAyBAnD,KAAAwpE,SAAA,SAAAh4D,OACA,GACAi4D,SACA/b,SACAgc,UAHAC,aAAA,CAKA,KAAAjc,WAAAl8C,OACAk4D,UAAAn1D,KAAAq1D,MAAAvvD,KAAAqzC,UACAgc,UAAAhxD,KAAA,WACA,GAAAmxD,OAAAr4D,MAAAk8C,UAAA8b,SAAAtuD,MAAAlb,KACAypE,SAAAx1D,EAAAjU,MAAA6pD,KAAA,OACA4f,UACAA,QAAAx1D,EAAAjU,MAAA6pD,MACA98B,SACArmB,KAAA8K,MAAAk8C,UAAAz3C,SAEAqI,UACA2R,OAAA,QACAwhC,QAAA/uB,EAAA,EAAA12B,EAAA,MAEA69C,KAAA,QAGA6f,UAAA1X,YAAA,SAAA6X,OACAJ,QAAA7c,QAAAid,OAAA1R,QAAA0R,OAEAF,YAAAA,aAAAE;EAIA,OAAAF,cAGA3pE,KAAAyN,UCvJAtT,OAAA,0DAAA,cAAA,SAAA2vE,IACA,MAAAA,IAAAC,SAAA,SAAAC,WAAAC,OAAAC,QAAAC,SAAAh1D,MAKA,QAAAi1D,UAAAH,OAAA90D,MAEA,GAAAk1D,QAAAC,OAAAnnE,QAAAonE,OAAA,EAQA,OAPAA,SAAA,kBACAC,kBAAAF,OAAAJ,QAAAriB,IAAAoiB,QAAAA,OAAApiB,GAAA1kD,SAAAsnE,QAAAt1D,KAAAA,MAAAm1D,OAAAA,OAAA/gE,KAAA0gE,OAAA,MAAA9mE,SAAAunE,cAAAnhE,KAAA0gE,OAAA,KAAA,MAAA9mE,WACA,UACAmnE,OAAAJ,QAAA9pE,KAAAiqE,OAAAC,OAAA/gE,KAAA0gE,QAAAQ,QAAAt1D,KAAAA,QACAm1D,OAAAL,QAAAA,OAAA7pE,IAAAiqE,aAAAC,UAAAK,aAAAL,OAAA/gE,KAAA0gE,QAAAQ,QAAAt1D,KAAAA,OAAAm1D,QACAC,QAAAC,iBAAAH,QACA;CAIA,QAAAO,UAAAX,OAAA90D,MAEA,GAAAm1D,QAAAnnE,QAAAonE,OAAA,EAIA,OAHAA,SAAA,yDACAC,kBAAAF,OAAAJ,QAAAriB,IAAAoiB,QAAAA,OAAApiB,GAAA1kD,SAAAsnE,QAAAt1D,KAAAA,MAAAm1D,OAAAA,OAAA/gE,KAAA0gE,OAAA,qBAAA9mE,SAAAunE,cAAAnhE,KAAA0gE,OAAA,KAAA,qBAAA9mE,WACA,uBAIA,QAAA0nE,UAAAZ,OAAA90D,MAEA,GAAAm1D,QAAAnnE,QAAAonE,OAAA,EAMA,OALAA,SAAA,mDACAC,kBAAAF,OAAAJ,QAAAriB,IAAAoiB,QAAAA,OAAApiB,GAAA1kD,SAAAsnE,QAAAt1D,KAAAA,MAAAm1D,OAAAA,OAAA/gE,KAAA0gE,OAAA,SAAA9mE,SAAAunE,cAAAnhE,KAAA0gE,OAAA,KAAA,SAAA9mE,WACA,qDACAqnE,kBAAAF,OAAAJ,QAAAriB,IAAAoiB,QAAAA,OAAApiB,GAAA1kD,SAAAsnE,QAAAt1D,KAAAA,MAAAm1D,OAAAA,OAAA/gE,KAAA0gE,OAAA,gBAAA9mE,SAAAunE,cAAAnhE,KAAA0gE,OAAA,KAAA,gBAAA9mE,WACA;CAjCAnD,KAAA8qE,cAAA,EAAA,YACAZ,QAAAlqE,KAAAspE,MAAAY,QAAAF,WAAAE,SAAA/0D,KAAAA,QACA,IAAAk1D,QAAAC,OAAAnnE,QAAAonE,OAAA,GAAAG,cAAAR,QAAAQ,cAAAF,iBAAAxqE,KAAAwqE,iBAAAG,aAAA,WAAA36D,KAAAhQ,IAsDA,OAnBAuqE,SAAA,uKACAC,kBAAAF,OAAAJ,QAAAriB,IAAAoiB,QAAAA,OAAApiB,GAAA1kD,SAAAsnE,QAAAt1D,KAAAA,MAAAm1D,OAAAA,OAAA/gE,KAAA0gE,OAAA,QAAA9mE,SAAAunE,cAAAnhE,KAAA0gE,OAAA,KAAA,QAAA9mE,WACA,UACAmnE,OAAAJ,QAAA/pE,OAAAkqE,OAAAC,OAAA/gE,KAAA0gE,QAAAQ,QAAAt1D,KAAAA,QACAm1D,OAAAL,QAAAA,OAAA9pE,MAAAkqE,aAAAC,UAAAK,aAAAL,OAAA/gE,KAAA0gE,QAAAQ,QAAAt1D,KAAAA,OAAAm1D,QACAC,QAAAC,iBAAAH,QACA,mBACAA,OAAAH,QAAA,MAAA3gE,KAAA0gE,OAAAA,QAAAA,OAAA7pE,KAAAqqE,QAAAM,QAAA/6D,KAAAy4C,KAAAjqB,GAAAxuB,KAAAg7D,QAAA,EAAAZ,SAAAj1D,MAAAA,KAAAA,QACAk1D,QAAA,IAAAA,UAAAE,QAAAF,QACAE,QAAA,8FACAC,kBAAAH,OAAAJ,QAAAA,OAAAzzD,QAAA6zD,OAAA,MAAAA,QAAAA,UAAA,EAAAA,OAAAA,OAAAj8D,SAAAi8D,UAAAM,aAAAN,OAAAnvD,MAAA+uD,QAAAI,SACA,+DACAG,kBAAAH,OAAAJ,QAAAA,OAAAzzD,QAAA6zD,OAAA,MAAAA,QAAAA,UAAA,EAAAA,OAAAA,OAAAv0D,eAAAu0D,UAAAM,aAAAN,OAAAnvD,MAAA+uD,QAAAI,SACA,0DACAG,kBAAAH,OAAAJ,QAAAA,OAAAzzD,QAAA6zD,OAAA,MAAAA,QAAAA,UAAA,EAAAA,OAAAA,OAAA70D,UAAA60D,UAAAM,aAAAN,OAAAnvD,MAAA+uD,QAAAI,SACA,qFACAA,OAAAH,QAAA,MAAA3gE,KAAA0gE,QAAAI,OAAAJ,QAAAA,OAAAzzD,QAAA,MAAA6zD,QAAAA,UAAA,EAAAA,OAAAA,OAAA1wD,WAAA8wD,QAAAM,QAAA/6D,KAAAg7D,QAAA,EAAAH,SAAA11D,MAAAqpB,GAAAxuB,KAAAg7D,QAAA,EAAAJ,SAAAz1D,MAAAA,KAAAA,QACAk1D,QAAA,IAAAA,UAAAE,QAAAF,QACAE,QAAA;KCrDA,SAAA3/D,EAAA4iB,EAAA7qB,GAAA,mBAAA7H,SAAAA,OAAAC,QAAAD,OAAAC,QAAA4H,IAAA,kBAAAxI,SAAAA,OAAA+T,IAAA/T,OAAA,mCAAAwI,GAAA6qB,EAAA5iB,GAAAjI,KAAA,OAAA3C,KAAA,SAAA4K,EAAA4iB,GAAA5iB,EAAAA,GAAA,OAAA4iB,EAAAA,GAAAxtB,IAAA,IAAAirE,GAAAtoE,EAAAsrB,OAAAntB,EAAA0sB,EAAA5iB,GAAAxM,EAAA,sBAAA4E,EAAA,OAAA+M,EAAA,mBAAAm7D,EAAA,sBAAA1sE,EAAAmgB,aAAAvS,EAAA5N,EAAAo3D,oBAAArpD,EAAAH,EAAA2D,GAAA7D,EAAAK,EAAAwD,EAAA,cAAAzD,KAAAsF,EAAAjR,MAAAV,UAAAgC,MAAAkK,EAAA,SAAAvB,EAAA4iB,GAAA,MAAA5iB,GAAAO,MAAAqiB,GAAA,MAAA5oB,EAAA,SAAAgG,GAAA,MAAA,gBAAAA,IAAA4B,EAAA,SAAA5B,GAAA,MAAA,kBAAAA,IAAAyB,EAAA,8TAAAL,EAAA,sgBAAAvN,EAAA,SAAAmM,EAAA4iB,EAAA7qB,GAAA,IAAAA,EAAA,EAAAA,EAAA6qB,EAAAnvB,OAAAsE,IAAA6qB,EAAA7qB,KAAAiI,EAAA4iB,EAAA7qB,IAAA,EAAA;MAAAiI,OAAAuB,EAAAE,GAAAE,EAAAP,EAAA,MAAAm/D,EAAA,WAAA,GAAAvgE,GAAA,2BAAAwB,GAAA,SAAAxB,EAAA4iB,GAAA,MAAAA,GAAA49C,yBAAA,MAAA,GAAA59C,EAAA49C,wBAAAxgE,KAAA,YAAAwB,GAAA,SAAAxB,EAAA4iB,GAAA,MAAAA,GAAA,IAAAA,EAAA8mC,UAAA9mC,IAAAS,OAAA7hB,EAAAohB,EAAAA,IAAA5iB,GAAA4iB,EAAAlsB,SAAAsJ,IAAA,SAAAA,EAAA4iB,GAAA,KAAA5iB,EAAAA,EAAA+3D,YAAA,GAAA/3D,IAAA4iB,EAAA,MAAA,EAAA,OAAA,IAAAA,EAAA,SAAAA,GAAA,GAAA7qB,GAAA6qB,EAAAs/B,aAAA,OAAAnqD,GAAAA,IAAA3C,MAAA,QAAA2C,EAAAooB,SAAA,WAAA5rB,KAAAa,KAAA+C,cAAA6H,EAAAjI,EAAA3C,MAAA,MAAA2C,EAAA,QAAAmtC,YAAAquB,KAAA,YAAAkN,UAAA79C,GAAAwiB,YAAAmuB,KAAA,WAAAkN,UAAA79C,GAAA89C,YAAAnN,KAAA,UAAAh/D,KAAA8xD,UAAAC,WAAA,iBAAA,kBAAAqa,EAAA,WAAA,GAAA3gE,GAAAuB,EAAA,wNAAAqhB,EAAA5iB,EAAAhK,OAAAuL,EAAA,kHAAArL,EAAA0sB,EAAA5sB,OAAAuL,EAAA,wDAAA/N,EAAAwM,EAAAhK,OAAAuL,EAAA,iEAAAnJ,EAAA4H,EAAAhK,OAAAuL,EAAA,SAAA4D,EAAAnF,EAAAhK,OAAAuL,EAAA,wDAAA++D,EAAAtgE,EAAAhK,OAAAuL,EAAA,uBAAAI,EAAA3B,EAAAhK,OAAAuL,EAAA,UAAAD,EAAA,WAAAI,IAAAk/D,IAAA,OAAAtU,IAAA,SAAAtsD,EAAA4iB,GAAA,MAAAA,GAAA+1C,QAAA34D,EAAA24D,SAAA34D,EAAAyV,MAAAjiB;IAAAotE,IAAA,kDAAAtU,IAAA,SAAAtsD,EAAAjI,EAAA7B,GAAA,MAAA6B,GAAA8oE,WAAA,IAAA7gE,EAAAyV,OAAA,IAAAzV,EAAAsrB,OAAAvzB,EAAAgH,KAAA+4B,EAAA,EAAA12B,EAAA,GAAApB,EAAA+5B,OAAA/5B,EAAAg6B,OAAAjiC,EAAA+oE,QAAA9gE,EAAA+5B,MAAAhiC,EAAAgpE,QAAA/gE,EAAAg6B,QAAAh6B,EAAA8gE,SAAA9gE,EAAA+gE,WAAAhpE,EAAA+oE,QAAA9gE,EAAA8gE,QAAAltE,EAAAmvD,KAAA7rB,WAAA11B,EAAA01B,WAAAn/B,EAAAgpE,QAAA/gE,EAAA+gE,QAAAntE,EAAAmvD,KAAA9rB,UAAAz1B,EAAAy1B,WAAA31B,EAAA/M,KAAA2B,KAAA6B,EAAAmqD,cAAAliD,EAAAkiD,eAAAliD,GAAA,aAAA9J,EAAA,OAAA,MAAA,YAAA0sB,KAAAg+C,IAAA,yBAAAtU,IAAA,WAAA,MAAAp2D,MAAA0qE,IAAA,SAAAtU,IAAA,WAAA,MAAAl0D,MAAAwoE,IAAA,mBAAAtU,IAAA,WAAA,MAAAnnD,MAAAy7D,IAAA,aAAAtU,IAAA,WAAA,MAAAgU,MAAAM,IAAA,cAAAtU,IAAA,WAAA,MAAA3qD,MAAAi/D,IAAA,KAAAtU,IAAA,WAAA,MAAAtsD;IAAAgH,KAAAhN,EAAA,SAAAgG,EAAA4iB,EAAA1sB,GAAA,GAAAT,UAAAhC,SAAAuM,EAAAA,KAAA4iB,EAAA9O,eAAA8O,EAAA7O,UAAA6O,GAAAw6C,cAAArlE,GAAAsW,MAAAjZ,KAAA84D,cAAAluD,EAAA5K,KAAA4rE,SAAA9qE,EAAAd,KAAA6rE,QAAA,EAAAjhE,GAAA,CAAA,GAAAmF,GAAAm7D,EAAA1sE,EAAA4N,EAAAG,EAAAnO,EAAAwM,EAAAsK,KAAAlS,EAAA4H,EAAAqlB,QAAArlB,EAAAkhE,UAAA,IAAA9rE,KAAAiwB,OAAAjtB,GAAA,IAAAA,EAAAsxD,SAAAtxD,EAAA2/D,WAAA3/D,EAAAlC,EAAA,CAAA,GAAAyL,EAAAqF,EAAAxT,IAAAmO,EAAA,IAAAwD,EAAA,EAAAm7D,EAAA5+D,EAAAjO,OAAA6sE,EAAAn7D,EAAAA,IAAA,GAAAzD,EAAAyD,GAAAy7D,IAAArsE,KAAAf,GAAA,CAAAwT,EAAAxT,GAAAmO,EAAAD,EAAAyD,GAAAmnD,GAAA,OAAA,IAAA9qD,EAAAG,EAAA3B,EAAA5K,KAAA5B,GAAA2R,EAAA3D,EAAA/N,OAAA0R,QAAAvR,EAAA4N,EAAA2D,KAAA/P,QAAAxB,IAAAoM,KAAA5K,KAAAxB,GAAAoM,EAAApM,MAAA,OAAAoG,GAAA3E,UAAAqkC,eAAA,WAAAtkC,KAAA84D,cAAAx0B,eAAAtkC,KAAA84D,cAAAx0B,iBAAAtkC,KAAA84D,cAAAiT,aAAA,GAAAnnE,EAAA3E,UAAA+8D,gBAAA,WAAAh9D,KAAA84D,cAAAkE,gBAAAh9D,KAAA84D,cAAAkE,kBAAAh9D,KAAA84D,cAAAkT,cAAA;EAAApnE,EAAA3E,UAAAiW,KAAA,WAAAlW,KAAAskC,iBAAAtkC,KAAAg9D,kBAAAh9D,KAAAisE,SAAA,GAAArnE,EAAA3E,UAAAktD,yBAAA,WAAAntD,KAAA84D,cAAA3L,0BAAAntD,KAAA84D,cAAA3L,2BAAAntD,KAAAksE,8BAAA,WAAA,OAAA,IAAAtnE,EAAA3E,UAAAisE,8BAAA,WAAA,MAAAlsE,MAAA84D,cAAAoT,+BAAAlsE,KAAA84D,cAAAoT,iCAAAtnE,EAAA3E,UAAAnC,MAAA,SAAA8M,GAAA,GAAA4iB,GAAA,GAAA5oB,GAAA5E,KAAAA,KAAA6sB,QAAA7sB,KAAA4rE,SAAA,OAAAp+C,GAAAktC,cAAA9vD,EAAA4iB,GAAA5oB,KAAAwL,EAAA,SAAAxF,EAAA4iB,GAAA,MAAAjhB,IAAAihB,GAAA5iB,IAAApM,GAAAoM,IAAAjI,EAAAiI,EAAAwB,GAAAs2B,EAAA,WAAA,GAAA93B,GAAA,SAAAA,EAAA4iB,EAAA7qB,EAAA7B,GAAA,GAAA1C,GAAA,SAAAuE,EAAAvE,GAAA,MAAAovB,GAAAtS,MAAAtQ,EAAA9J,EAAA8Q,EAAArI,KAAAnL,EAAAuE,EAAA,EAAA,GAAA/B,OAAAE,GAAA1C;EAAA4E,EAAA,SAAAL,EAAA7B,GAAA,MAAA0sB,GAAA2+C,UAAA3+C,EAAA2+C,UAAAC,GAAAzpE,EAAAstB,OAAArlB,GAAA9J,GAAAiP,EAAApN,EAAA,SAAAiI,GAAA,GAAA4iB,GAAAxqB,EAAA4H,EAAA5K,KAAA,OAAA2C,GAAAuY,MAAAsS,EAAAntB,YAAAuK,IAAAA,EAAA8vD,cAAAltC,GAAApvB,EAAAwM,EAAAvK,YAAA,QAAA,SAAAuK,GAAA,MAAA4iB,GAAA2+C,YAAAvhE,EAAAA,EAAA9M,MAAAkF,EAAA4H,KAAAxM,EAAAwM,EAAAvK,WAAA,OAAA0P,GAAAo8D,UAAA3+C,EAAA2+C,UAAAp8D,GAAAyd,EAAA,SAAAA,EAAA7qB,EAAA7B,EAAA1C,EAAA4E,EAAA+M,EAAAm7D,GAAA,GAAA9+D,GAAA5N,EAAA2sE,EAAAxoE,EAAA,WAAAA,IAAA7B,EAAAq/B,EAAAksC,EAAA7+C,EAAA7qB,EAAA7B,EAAA1C,IAAAI,IAAAA,EAAA6sE,YAAAvqE,EAAA8J,EAAA4iB,EAAA1sB,EAAAtC,EAAA6sE,UAAAt7D,IAAApN,EAAAnE,EAAA2/D,MAAAx7D,GAAA3C,KAAA4rE,SAAAx/D,EAAA3N,EAAAkE,MAAA6qB,EAAAthB,GAAAlM,KAAAssE,YAAA//D,IAAAH,GAAAzJ,EAAA3C,KAAA6sB,QAAAW,EAAAxtB,KAAAkV,KAAAvS,EAAA3C,KAAAusE,SAAAnuE,EAAA4B,KAAAwsE,WAAAxpE,EAAAhD,KAAAysE,UAAAlgE,GAAAH,EAAAzJ,EAAA,iBAAA3C,KAAAiwB,OAAA7f,EAAAod,EAAAphB,GAAApM,KAAAkM,KAAAlM,KAAAiwB,OAAA/jB,GAAAlM,KAAApF,KAAAswE,EAAAlrE,KAAA0sE,QAAA9hE,EAAA4iB,EAAA1sB,EAAA,KAAAiP,GAAA,OAAAyd,GAAAvtB,UAAA0sE,aAAA,SAAA/hE,GAAA,GAAA4iB,GAAA7qB,EAAA7B,EAAA,CAAA;IAAA8J,EAAA,OAAA,CAAA,KAAA5K,KAAAwsE,WAAA,OAAA,CAAA,KAAAh/C,EAAA5iB,EAAAvM,OAAAmvB,KAAA,IAAA7qB,EAAA3C,KAAAwsE,WAAAnuE,OAAAsE,KAAAiI,EAAA4iB,IAAAxtB,KAAAwsE,WAAA7pE,IAAA7B,GAAA,OAAA8J,GAAAvM,SAAAyC,GAAA0sB,EAAAvtB,UAAA2sE,QAAA,SAAAhiE,EAAA4iB,EAAA7qB,GAAA,QAAA3C,KAAA6sB,UAAAjiB,GAAA4iB,GAAAxtB,KAAAusE,WAAA/+C,GAAA7qB,GAAA3C,KAAA0sE,UAAA/pE,IAAA6qB,KAAAuS,EAAA,WAAA,GAAAn1B,MAAA4iB,EAAA,SAAA7qB,EAAA7B,EAAA1C,EAAA4E,EAAA+M,EAAAm7D,GAAA,GAAA1sE,GAAAuR,EAAA,IAAA,GAAA,IAAAjP,GAAA,KAAAA,EAAA,CAAA,GAAAoL,GAAAK,EAAA,EAAAD,EAAA1B,EAAApM,EAAAsC,GAAA8Q,EAAA,KAAAjP,CAAA,KAAA2J,EAAA,MAAA,KAAAJ,EAAAI,EAAAjO,OAAA6N,EAAAK,EAAAA,IAAA,IAAAqF,GAAAtF,EAAAC,GAAAqgE,QAAAjqE,EAAAvE,EAAA4E,MAAAkoE,EAAA5+D,EAAAC,GAAAD,EAAAC,EAAAzL,GAAA,WAAA,KAAA,GAAAsL,KAAAxB,GAAAwB,EAAAsY,OAAA,IAAAlmB,GAAAgvB,EAAA7qB,EAAAyJ,EAAAyE,OAAA,GAAAzS,EAAA4E,EAAA+M,EAAAm7D,IAAAvoE,EAAA,SAAA6qB,EAAA7qB,EAAA7B,EAAA1C,GAAA,GAAA4E,GAAA+M,EAAAnF,GAAAxM,EAAA,IAAA,KAAAuE,EAAA,IAAAoN,EAAA,IAAA/M,EAAA+M,EAAA1R,OAAA2E,KAAA,IAAA+M,EAAA/M,GAAApI,MAAAmV,EAAA/M,GAAA4pE,QAAAp/C,EAAA1sB,EAAA,MAAA,OAAA,CAAA,QAAA,GAAAA,EAAA,SAAA8J,EAAAjI,EAAA7B,EAAA1C,GAAA,GAAA4E,KAAA;MAAAwqB,GAAA5iB,EAAAjI,EAAA7B,EAAA,KAAA1C,EAAA,SAAAwM,GAAA,MAAA5H,GAAA1E,KAAAsM,KAAA5H,GAAA5E,EAAA,SAAAovB,GAAA,GAAA7qB,IAAA6qB,EAAA5yB,OAAAoF,KAAAi3D,IAAAzpC,EAAAX,QAAAW,EAAAtY,KAAA,MAAA,GAAApU,GAAA0sB,EAAA5yB,KAAA,IAAA,KAAA4yB,EAAAtY,IAAA,QAAAtK,EAAA9J,KAAA8J,EAAA9J,QAAAxC,KAAAkvB,GAAA7qB,GAAAK,EAAA,SAAAL,GAAA6qB,EAAA7qB,EAAAkqB,QAAAlqB,EAAAuS,KAAA,KAAAvS,EAAA+pE,QAAA/pE,EAAA/H,KAAA,SAAA4yB,EAAA7qB,EAAA7B,GAAA,MAAA6B,GAAA62D,OAAA14D,EAAA,GAAA0sB,EAAAq/C,SAAA,EAAA,IAAAlqE,EAAAtE,cAAAuM,IAAA4iB,EAAA5yB,KAAA,IAAA,KAAA4yB,EAAAtY,OAAA,KAAAnF,EAAA,WAAA,GAAAyd,GAAA7qB,IAAA,KAAA6qB,IAAA5iB,GAAA,KAAA4iB,EAAA9I,OAAA,KAAA/hB,EAAAA,EAAA/B,OAAAgK,EAAA4iB,IAAA,OAAA7qB,GAAA,QAAAs0D,IAAAt0D,EAAA02C,IAAAv4C,EAAAgsE,IAAA1uE,EAAA2uE,IAAA/pE,EAAAgqE,QAAAj9D,MAAA2mD,EAAA,SAAA9rD,GAAAqgE,EAAA5qE,UAAAhC,OAAAuM,EAAApM,EAAAyuE,iBAAA,SAAAriE,EAAA4iB,GAAA,MAAAA,GAAAy/C,iBAAAriE,IAAA,WAAA,KAAA,IAAAzP,OAAA,wCAAA4K,EAAA,SAAA6E,EAAA4iB,GAAA,GAAAjhB,IAAAihB,IAAA5iB,GAAAA,EAAAsiE,cAAA,MAAA1/C,EAAA,CAAA,GAAA7qB,GAAAo9B,EAAAsZ,IAAAr5C,KAAAwtB,GAAA5iB,EAAAsK,KAAA,MAAA,GAAApU,EAAA6B,EAAAtE,OAAAD,EAAA,CAAA;IAAAwM,EAAA,GAAA2gE,GAAA3gE,EAAA5K,MAAA,GAAAwtB,IAAA5iB,EAAAsK,KAAAsY,GAAA1sB,EAAA1C,IAAAwM,EAAAshE,gCAAA9tE,IAAAuE,EAAAvE,GAAAyuE,SAAAlqE,EAAAvE,GAAAsuE,QAAAnjE,KAAAvJ,KAAA4K,KAAAuiE,EAAA5gE,EAAA,SAAA3B,EAAA4iB,EAAA7qB,GAAAiI,EAAAjI,EAAAoN,EAAAm7D,GAAA19C,EAAAznB,GAAA,IAAA,SAAA6E,EAAA4iB,EAAA7qB,EAAA7B,GAAA,GAAA1C,EAAAuE,IAAAo9B,EAAA+sC,IAAA1uE,EAAA,GAAAskC,GAAA93B,EAAA9J,GAAA0sB,EAAA,SAAAA,GAAAznB,EAAAwD,KAAAqB,EAAA4iB,EAAA1sB,IAAAiF,EAAA,KAAA,MAAA,IAAAjF,GAAA,MAAA8J,EAAA,MAAA9J,KAAA8J,EAAA,MAAA9J,GAAA,GAAA1C,EAAA6xB,OAAAm9C,YAAA,KAAAhvE,EAAAquE,UAAAruE,EAAAsuE,WAAAtuE,EAAA2hC,EAAAsZ,IAAAzuC,EAAA9J,GAAA0sB,EAAAznB,GAAA,GAAA,GAAA3H,IAAAA,EAAA6xB,OAAAo9C,YAAA,KAAAjvE,EAAAquE,UAAAruE,EAAAsuE,SAAA3sC,EAAAgtC,IAAA3uE,MAAA+hC,EAAA,SAAAv1B,EAAA4iB,EAAA7qB,EAAA7B,EAAA1C,GAAA,MAAA,YAAA0C,EAAAoa,MAAAlb,KAAAK,WAAAuK,EAAA4iB,EAAA7qB,EAAAvE,KAAAiuE,EAAA,SAAAzhE,EAAA4iB,EAAA7qB,EAAA7B,GAAA,GAAAtC,GAAA4N,EAAAhO,EAAAovB,GAAAA,EAAAviB,QAAAjI,EAAA,IAAA+M,EAAAgwB,EAAAsZ,IAAAzuC,EAAAxM,EAAA,MAAA,GAAA8sE,IAAA,KAAA1sE,EAAA,EAAA4N,EAAA2D,EAAA1R,OAAA+N,EAAA5N,EAAAA,MAAAmE,GAAAoN,EAAAvR,GAAA+tE,WAAA5pE,IAAAoN,EAAAvR,GAAAmuE,aAAA7rE,KAAAi/B,EAAAgtC,IAAAh9D,EAAAvR,KAAA0sE,EAAAn7D,EAAAvR,GAAAiuE,YAAA18D,EAAAvR,GAAA0N,KAAAg/D,EAAAn7D,EAAAvR,GAAAiuE,YAAAj/C,EAAAzd,EAAAvR,GAAAiuE,UAAAvgE,EAAA6D,EAAAvR,GAAA0W,OAAA;IAAA1W,IAAA0sE,GAAAnrC,EAAAk3B,IAAArsD,EAAAsgE,EAAA1sE,GAAAgvB,EAAA,MAAA,IAAA2/C,EAAAviE,EAAAsgE,EAAA1sE,GAAAgvB,GAAA,EAAA09C,EAAA1sE,GAAA0N,IAAA+zB,EAAA,SAAAr1B,EAAA4iB,GAAA,GAAA7qB,GAAA,SAAA6qB,EAAA7qB,GAAA,IAAA,GAAA7B,GAAA1C,EAAAwG,EAAAgG,GAAAqgE,EAAArgE,EAAAjI,GAAAiI,EAAA4iB,GAAAA,IAAA7qB,EAAA6qB,EAAAA,EAAAm1C,WAAA,IAAA7hE,EAAA1C,EAAAC,OAAAyC,KAAA,GAAA1C,EAAA0C,KAAA0sB,EAAA,MAAAA,IAAA1sB,EAAA,SAAA8J,GAAA,GAAA9J,GAAA6B,EAAAiI,EAAAqlB,OAAAjwB,KAAAc,IAAA0sB,EAAAtS,MAAApa,EAAAT,WAAA,OAAAS,GAAAqrE,WAAAC,GAAAzpE,EAAA+qD,SAAA9iD,GAAA9J,GAAAkT,EAAAzH,EAAA,SAAA3B,EAAA4iB,EAAA1sB,GAAA,GAAA1C,GAAAI,EAAAuW,YAAAnK,EAAA,aAAA,WAAAxM,GAAAwM,EAAA,YAAA,eAAA4iB,GAAA,GAAA,EAAA7qB,EAAA,GAAA7B,EAAAwsE,cAAAlvE,IAAA,SAAAwM,EAAA4iB,EAAA7qB,GAAAA,EAAAyN,EAAAzN,EAAAiI,GAAAA,EAAAjI,EAAA4qE,UAAA,KAAA//C,EAAAhvB,EAAAgvE,qBAAA7qE,EAAA,MAAA6qB,MAAA0S,EAAA,SAAAt1B,EAAA4iB,EAAA7qB,GAAA,GAAAoN,GAAAm7D,EAAA1sE,EAAA4N,EAAAtL,EAAA8D,EAAA4oB,EAAA,IAAA1sB,GAAA0sB,EAAA/rB,QAAA,KAAA,EAAA,CAAA,IAAA+rB,EAAArhB,EAAAqhB,GAAAphB,EAAAohB,EAAAnvB,OAAA+N,KAAA8zB,EAAAt1B,EAAA4iB,EAAAphB,GAAAzJ,EAAA,OAAAiI,GAAA,GAAAsgE,EAAApqE,GAAA0sB,EAAAviB,QAAAjI,EAAA,IAAAkoE,GAAAC,EAAAD,KAAAA,EAAAC,EAAAD,GAAA/M,OAAA3wC,GAAA1sB,GAAAtC,EAAAsC,GAAA0sB,EAAAviB,QAAA7M,EAAA,OAAAI,EAAA2N,EAAA3N,EAAA,MAAA6tE,EAAAzhE,EAAAsgE,EAAAvoE,EAAAnE;IAAA,IAAAgO,EAAAghB,GAAA6+C,EAAAzhE,EAAA,KAAA4iB,OAAA,KAAAzd,IAAAyd,GAAAA,EAAAllB,eAAAyH,IAAAmwB,EAAAt1B,EAAAmF,EAAAyd,EAAAzd,GAAA,OAAAnF,IAAA6iE,EAAA,SAAA7iE,EAAA4iB,EAAA7qB,EAAA7B,GAAA,GAAAiP,GAAAm7D,EAAA1sE,EAAA4N,EAAAG,EAAA3H,EAAAyH,CAAA,EAAA,GAAAqK,SAAA/T,GAAA,gBAAA6qB,GAAA,CAAA,IAAAhhB,EAAA7J,IAAA4J,EAAAqF,EAAArI,KAAAlJ,UAAA,GAAAS,EAAAiP,EAAApN,IAAAoN,EAAAjP,EAAAyL,EAAAqF,EAAArI,KAAAlJ,UAAA,GAAAS,EAAAm/B,EAAAt9B,EAAAoN,EAAAk7D,IAAAzsE,EAAA2N,EAAAqhB,GAAAxtB,OAAAsM,IAAAxL,EAAAq/B,EAAAD,EAAAt1B,EAAA4iB,EAAA1sB,EAAAiP,IAAA3D,EAAA5N,EAAAH,OAAA+N,KAAAC,EAAA0zB,EAAA+sC,IAAAloE,EAAA,GAAA89B,GAAA93B,EAAApM,EAAA4N,GAAAnB,QAAAjI,EAAA,IAAAlC,EAAAiP,EAAA5D,EAAA3N,EAAA4N,GAAAnB,QAAA7M,EAAA,IAAA,KAAAmO,GAAA,IAAA3H,EAAAsH,IAAAG,GAAA8gE,EAAAviE,EAAAhG,EAAA6nE,WAAA,EAAA7nE,EAAA0nE,WAAA,OAAA1hE,GAAA,IAAAsgE,IAAA19C,GAAAA,EAAAllB,eAAA4iE,IAAAuC,EAAAlkE,KAAAvJ,KAAA4K,EAAAsgE,EAAA19C,EAAA09C,MAAA9qC,EAAA,SAAAx1B,EAAA4iB,EAAA7qB,EAAA7B,GAAA,MAAA2sE,GAAAvyD,MAAA,KAAAtW,EAAAjC,IAAAiI,EAAAjI,EAAA6qB,EAAA1sB,GAAAF,OAAAP,UAAAhC,OAAA,EAAAuT,EAAArI,KAAAlJ,UAAA,OAAAuR,EAAArI,KAAAlJ,aAAAqtE,EAAA,WAAA,MAAAD,GAAAvyD,MAAA5O,EAAAjM,YAAAyF,EAAA,SAAA8E,EAAA4iB,EAAA7qB,GAAA,GAAAoN,GAAAm7D,EAAA1sE,EAAA4N,EAAAG,EAAAzL,EAAAqL,EAAAqhB,EAAA;IAAAzd,EAAAjP,EAAAzC,OAAA0R,KAAA,GAAAyd,EAAA1sB,EAAAiP,GAAA9E,QAAAjI,EAAA,KAAAoJ,EAAAtL,EAAAiP,GAAA9E,QAAA7M,EAAA,OAAAgO,EAAAD,EAAAC,EAAA,MAAAA,GAAAzJ,IAAAiI,EAAAsB,GAAA,IAAAK,EAAAwzB,EAAAsZ,IAAAzuC,EAAA4iB,EAAA,MAAA,GAAA7qB,IAAA,GAAA/B,OAAA+B,GAAAuoE,EAAA,EAAA1sE,EAAA+N,EAAAlO,OAAAG,EAAA0sE,EAAAA,IAAA3+D,EAAA2+D,GAAAyB,aAAAvgE,IAAAG,EAAA2+D,GAAAwB,QAAAxxD,MAAAtQ,EAAAjI,OAAAqR,GAAAvV,EAAA+uB,GAAAA,EAAA5iB,EAAA,OAAAA,IAAAgG,EAAA,SAAAhG,EAAA4iB,EAAA7qB,GAAA,IAAA,GAAAoN,GAAAm7D,EAAApqE,EAAAi/B,EAAAsZ,IAAA7rB,EAAA7qB,EAAA,MAAA,GAAAvE,EAAA0C,EAAAzC,OAAA2E,EAAA,EAAA5E,EAAA4E,EAAAA,IAAAlC,EAAAkC,GAAAupE,WAAAx8D,GAAAnF,EAAA9J,EAAAkC,GAAAkS,OAAAg2D,EAAApqE,EAAAkC,GAAA0pE,QAAAP,YAAAp8D,EAAAzR,KAAA4sE,EAAAxd,UAAA39C,EAAAzR,KAAAwC,EAAAkC,GAAAupE,UAAAkB,EAAAvyD,MAAA,KAAAnL,GAAA,OAAAnF,IAAA+iE,GAAAz8D,GAAAu8D,EAAA1/D,IAAAqyB,EAAAwyB,IAAA8a,EAAArsC,IAAAnB,EAAAlgB,OAAAkgB,EAAApiC,MAAA8S,EAAAg9D,KAAA9nE,EAAA6xD,MAAA4T,EAAAsC,kBAAAnX,EAAAoX,WAAA,WAAA,MAAAtgD,GAAA5iB,GAAA9J,EAAAd,MAAA,IAAA2C,EAAAyqE,YAAA,CAAA,GAAAW,GAAA,WAAA,GAAAnjE,GAAA4iB,EAAAuS,EAAAitC,SAAA,KAAApiE,IAAA4iB,GAAAA,EAAA5iB,GAAAsK,MAAA,WAAAsY,EAAA5iB,GAAAsK,MAAAgrB,EAAA1S,EAAA5iB,GAAAiiB,QAAAW,EAAA5iB,GAAAsK,KAAAvS;EAAA0qE,YAAA,WAAAU,GAAAprE,EAAAqrE,gBAAArrE,EAAAqrE,iBAAArrE,GAAAyqE,YAAA,WAAAW,GAAA,MAAArX,KAAAiX,ICaAxzE,OAAA,yCACA,oCACA,SAAA8zE,MAEA,GAAAC,kBACA,QACAh9D,GAAA,SAAAi9D,UAAAC,cACA,MAAAH,MAAA/8D,GAAAg9D,eAAAC,UAAAC,eAEA/sC,IAAA,SAAA8sC,WACA,MAAAF,MAAA5sC,IAAA6sC,eAAAC,YAEAP,KAAA,SAAAO,WACA,GAAAxmE,MAAAhH,MAAAV,UAAAgC,MAAAsH,KAAAlJ,UAAA,EACA,OAAA4tE,MAAAL,KAAAM,eAAAC,UAAAxmE,UCdAxN,OAAA,0DACA,SACA,SACA,qDACA,yDACA,wCACA,4CACA,SAAA6Z,EAAAC,EAAAo6D,aAAAC,WAAAC,UAGA,MAAA,YACA,GAAAh6D,MAAAvU,IAEAquE;aAAAnzD,MAAAlb,KAAAK,WAMAL,KAAAyN,KAAA,WACA8G,KAAAhH,KACAihE,cAAA,WAAAD,SAAAX,KAAA,0BACAa,0BAAA,IAGAl6D,KAAAw1C,QAAAE,SAAAl9B,QAAA7b,GAAA,QAAA,iBAAA,SAAAtG,GACAA,EAAA05B,iBACAiqC,SAAAX,KAAA,2BAGAr5D,KAAAw1C,QAAAE,SAAAl9B,QAAA7b,GAAA,QAAA,mBAAA,SAAAtG,GACAA,EAAA05B,iBACAiqC,SAAAX,KAAA,0BAAAr5D,KAAAm6D,WAGAn6D,KAAAw1C,QAAAE,SAAAl9B,QAAA7b,GAAA,QAAA,yBAAA,SAAAtG,GACAA,EAAA05B,iBACAiqC,SAAAX,KAAA,6BAAAr5D,KAAAm6D,YASA1uE,KAAA8gC,KAAA,SAAAtqB,SACA,GAAAm4D,aACAxuE,MAAAqW,QAAArW,MAAA0W,OAAA,qBACAzW,IAAAoW,QAAApW,IAAAoW,QAAApW,IAAAyW,OAAA,sBAAA,EACA+4B,MAAAp5B,QAAAo5B,OAAA,cACAp5B,QAAAA,QAGAjC;KAAAw1C,QAAAx8C,KACAqhE,eAAAN,WAAAK,YACAE,gBAAA,MAAA76D,EAAAsvD,OAAA9sD,QAAAG,OAAA,SAEApC,KAAAw1C,QAAAE,SAAA2K,SAAA74C,KAAA+yD,gBAAA,aAAAH,WAAA/+B,QACAr7B,KAAAw1C,QAAAjpB,QAOA9gC,KAAA0uE,MAAA,WACA,MAAAn6D,MAAAw1C,QAAAE,SAAAF,QAAA1vC,KAAA,oBAAA7Y,OAOAxB,KAAA+uE,YAAA,WACA,MAAAx6D,MAAAw1C,QAAAE,SAAAF,QAAA1vC,KAAA,0BAAA7Y,OAGAxB,KAAAyN,UC9EAtT,OAAA,4DACA,SACA,SACA,qDACA,aACA,OACA,wCACA,4CACA,SAAA6Z,EAAAC,EAAAo6D,aAAArE,WAAAniB,GAAA0mB,UAEA,MAAA,YACA,GAAAh6D,MAAAvU,IAEAquE;aAAAnzD,MAAAlb,KAAAK,WAEAL,KAAAgvE,eACAC,kBACAzF,SAAA,WACA,MAAA,KAAAv1D,EAAAjU,MAAAwB,MAAAnD,QAEA4X,QAAA4xC,GAAA,4BAQA7nD,KAAAyN,KAAA,WACA8G,KAAAhH,KACAshE,gBAAAhnB,GAAA,yBACAqnB,cAAA,IACAT,0BAAA,EACAD,cAAA,WAAAD,SAAAX,KAAA,+BAcA5tE,KAAA8gC,KAAA,SAAA39B,SACA,GAAAyV,UAAArI,SAAApN,QAAAyV,SAAA,IACAu2D,YAAAhsE,QAAAhD,MAAArC,QAAAqb,KAAAP,UAAA/B,OAAA,oBACAu4D,UAAAjsE,QAAA/C,IAAAtC,QAAAqb,KAAAP,UAAA/B,OAAA,oBACA83D,YACAxuE,MAAAgD,QAAAhD,MAAA0W,OAAA,qBACAzW,IAAA+C,QAAA/C,IAAA+C,QAAA/C,IAAAyW,OAAA,sBAAA,EAGA5C;EAAAe,MACAC,IAAA,+CACAC,KAAA,MACAC,MACAW,SAAA3S,QAAA2S,SACA1H,GAAAjL,QAAAiL,IAEAkH,QAAA,SAAAC,UACA,GACAq0D,OADAyF,IAAArF,WAAAsF,QAAA/5D,SAIAhB,MAAAw1C,QAAAx8C,KACAqhE,eAAAS,IAAAV,YACAY,kBAAApsE,QAAA8sB,QAAA9sB,QAAAyH,EAAAqlB,SAEA1b,KAAAw1C,QAAAjpB,OAEA8oC,MAAAr1D,KAAAi7D,UACA5F,MAAAvvD,KAAA,UAAAm9C,QACAoS,MAAAvvD,KAAA,kBAAA7Y,IAAA2tE,aACAvF,MAAAvvD,KAAA,gBAAA7Y,IAAA4tE,WAEA76D,KAAAq1D,MAAAA,MAEAr1D,KAAAq1D,MAAA14D,GAAA,QAAA,gBAAA,WACAqD,KAAAi1D,SAAAj1D,KAAAy6D,iBAGAz6D,KAAAq1D,MAAAvvD,KAAA,iBAAAnJ,GAAA,SAAA,WACA,GAAAxK,MAAAuN,EAAAjU,MAAAqa,KAAA,iBAAApG,EAAAjU,MAAAwB,MAAA,MAAAkF,OACA+oE,OAAA7F,MAAAvvD,KAAA,SACAo1D;OAAAjuE,IAAAkF,MAAA8wD,UACA5hD,QAAA,UAEArB,KAAAw1C,QAAAE,SAAAl9B,QAAA1S,KAAA,oBAAAnJ,GAAA,QAAA,WACA04D,MAAA8F,WAGA9F,MAAA14D,GAAA,SAAA,SAAAtG,GACAA,EAAA05B,iBACA/vB,KAAAm7D,OAAAz7D,EAAAjU,MAAA4K,SAYA5K,KAAA0vE,OAAA,WACA1vE,KAAAwpE,SAAAxpE,KAAAgvE,gBACAT,SAAAX,KAAA,4BAAAr5D,KAAAo7D,gBAQA3vE,KAAAwvE,QAAA,WACA,MAAAj7D,MAAAw1C,QAAAE,SAAAl9B,QAAA1S,KAAA,SAOAra,KAAA2vE,YAAA,WACA,GAAAx6D,SACAy0D,MAAAr1D,KAAAi7D,SAEA,OADA5F,OAAAgG,iBAAAz/D,IAAA,SAAAuyB,GAAAvtB,KAAAutB,EAAA5wB,MAAA4wB,EAAAliC,QACA2U,MAGAnV,KAAAyN,UCtIAtT,OAAA,6CACA,SACA,SACA,4CACA,SAAA6Z,EAAAC,GAQA,MAAA,UAAA9Q,SACA,GAAAoR,MAAAvU,KACAmoD,gBACAwR,WAAA,EACA5sC,SACArmB,KAAA,IACAiQ,MAAA,KAEA2H,UACAmtC,GAAA,SAAAC,GAAA,SACAz7B,OAAAhc,EAAAga,QACAwjC,QACA/sB,QAAA,IAGA5D,MACA8qB,OAAA,EACAyX,OACAnyD,IAAA,EACA0mD,MAAA,IAIA72B,MAAA,EACAoQ,OACApzB,MAAA,IACAkY,QAAA,mCAIAj2B;KAAAyN,KAAA,WACAwG,EAAAuqB,GAAAqrB,KAAA+Z,aAAA,KACAzgE,QAAA6Q,EAAAs1D,MAAAnhB,eAAAhlD,SACAnD,KAAAqjE,MAAApvD,EAAA,WAAA41C,KAAA1mD,SAAA0mD,KAAA,QAOA7pD,KAAA+gC,KAAA,WACAxsB,KAAAg1D,WAGAvpE,KAAAqjE,MAAAtiC,QAOA/gC,KAAAupE,QAAA,WACA,MAAAvpE,MAAAqjE,MAAApZ,SAAAF,QAAAx7B,GAAA,aASAvuB,KAAAuN,IAAA,SAAApK,SACAnD,KAAAqjE,MAAA91D,IAAApK,UAGAnD,KAAAyN,UC7EAtT,OAAA,kDACA,SACA,SACA,cACA,sBACA,SAAA6Z,EAAAC,GAIA,QAAA47D,qBAGA,GAAA,OAAAj7D,SACA,KAAA,IAAAzZ,OAAA,0FAGA6E,MAAA8vE,eAAA,SAAA3sE,SACA,GAAAqmD,UAAAv1C,EAAAo0C,UAcA;MAZAp0C,GAAAe,MACAC,IAAA,qCACAC,KAAA,MACAC,KAAAhS,QACAmS,QAAA,SAAAC,UACAi0C,SAAAZ,QAAArzC,WAEAY,MAAA,SAAAC,KACAozC,SAAAumB,OAAA35D,QAIAozC,SAAAC,WAxBA,GAAA70C,UAAA,IAoCA,OARAi7D,mBAAAr1D,YAAA,WAKA,MAHA,QAAA5F,WACAA,SAAA,GAAAi7D,oBAEAj7D,UAGAi7D,kBAAAr1D,gBCxBArgB,OACA,uDACA,SACA,SACA,aACA,OACA,cACA,kDAEA,SAAA6Z,EAAAC,EAAA+1D,WAAAniB,GAAA3zC,SAAA87D,mBACA,YACA,OAAA,UAAA7sE,SACA,GAIA8sE,oBACAC,mBALA37D,KAAAvU,KACAioD,WAAA9kD,QAAAirD,UACA+hB,cAAAloB,WAAA5tC,KAAA,wBACA+1D,cAAAnoB,WAAA5tC,KAAA,uBAQAra;KAAAyN,KAAA,WACAw6C,WAAA/2C,GAAA,QAAA,mBAAA,WACAqD,KAAA87D,YAAAp8D,EAAAjU,SAEAioD,WAAA/2C,GAAA,QAAA,mBAAA,SAAAtG,GACAA,EAAA05B,gBACA,IAAAgsC,QAAAr8D,EAAAjU,MAAAohC,QAAA,MAAA/mB,KAAA,mBACAi2D,QAAA9uE,IAAA,IACA+S,KAAA87D,YAAAC,UAGAroB,WAAA5tC,KAAA,cAAAnJ,GAAA,SAAA,WACAqD,KAAAg8D,YAAAt8D,EAAAjU,MAAAqa,KAAA,sBAGA41D,mBAAAjG,WAAAsF,QAAAr7D,EAAA,6BAAAs5B,QACA2iC,mBAAAlG,WAAAsF,QAAAr7D,EAAA,6BAAAs5B,QACAt5B,EAAA,6BAAAugD,QACAvgD,EAAA,6BAAAugD,QAEArxD,QAAAgS,MACAZ,KAAAuY,OAAA3pB,QAAAgS,OASAnV,KAAAuwE,YAAA,SAAAC,UAaA,MAZAA,UAAA93D,KAAA,WACA,GAAA+3D,SAAAx8D,EAAAjU,KACAiU;EAAA3S,SAAA6uE,cAAA,GAAAM,QAAA,IACAL,cAAAl7C,OAAAu7C,SAEAN,cAAAj7C,OAAAu7C,WAGAl8D,KAAAm8D,kBACAz8D,EAAA,oBAAAyE,KAAA,WACAnE,KAAA87D,YAAAp8D,EAAAjU,SAEAwwE,UAOAxwE,KAAA0wE,gBAAA,WACAz8D,EAAA,qBAAAyE,KAAA,WACAzE,EAAAjU,MAAA,GAAAoY,UAAA,KAeApY,KAAA8sB,OAAA,SAAA3X,MACAg7D,cAAA3b,QACA4b,cAAA5b,QACAvgD,EAAAyE,KAAAvD,KAAAw7D,WAAA,SAAAzsE,IAAA1C,KACA2uE,cAAAj7C,OACAjhB,EAAA,kBAAAzS,IAAAgU,IAAA,KAAAhU,IAAAuU,MAAA,gBAGA9B,EAAAyE,KAAAvD,KAAA4B,WAAA,SAAA7S,IAAA1C,KACA4uE,cAAAl7C,OACAjhB,EAAA,kBAAAzS,IAAAgU,IAAA,KAAAhU,IAAAuU,MAAA,gBAIAxB,KAAAq8D,iBAQA5wE,KAAA6wE,aAAA,SAAAx5D,QACA24D,kBAAAF,gBACAz4D,OAAAA,OAAA7B,IAAArS,QAAA2tE,aACAr/D,KACA,SAAA0D,MACAZ,KAAAuY,OAAA3X;IASAnV,KAAA4wE,cAAA,WACA,GAAAz7D,OACAw7D,YACA7mE,MAAAqmE,cAAA91D,KAAA,UAAAhc,OACAmL,SAAA2mE,cAAA91D,KAAA,mBAAAhc,QAEA0Y,YACAjN,MAAAsmE,cAAA/1D,KAAA,UAAAhc,OACAmL,SAAA4mE,cAAA/1D,KAAA,mBAAAhc,QAIA8W,MAAA4B,WAAAd,QAAAd,KAAA4B,WAAAjN,MAAA+9C,GAAA,gCAAAzoD,OAAA+V,KAAA4B,WAAAjN,QAAA,SACAqL,KAAAw7D,WAAA16D,QAAA4xC,GAAA,yCAAAzoD,OAAA+V,KAAAw7D,WAAA7mE,QAEAmK,EAAA,6BAAAs5B,KAAA0iC,mBAAA96D,KAAAw7D,aACA18D,EAAA,6BAAAs5B,KAAA2iC,mBAAA/6D,KAAA4B,cAQA/W,KAAAqwE,YAAA,SAAAC,QACA,GAAAroB,YAAAqoB,OAAAlvC,QAAA,MACA2vC,QAAA9oB,WAAA5tC,KAAA,cACA8I,IAAAmtD,OAAA9uE,MACAgI,SAAA,CAEAunE;QAAA12D,KAAA,iBAAA22D,SACAD,QAAA12D,KAAA,UAAAH,YAAA,YAAAxB,KAAA,SAAAxU,IAAAyuB,QACA,GAAA89C,SAAAx8D,EAAA0e,OACA89C,SAAA/pE,OAAAjF,QAAA0hB,KAAA,IAEAstD,QAAAt2D,SAAA,YAAA82D,KAAA,UAAAp7D,SAAAkrB,OACAv3B,cAIA+K,KAAAq8D,iBAGA5wE,KAAAyN,WCvMA,SAAA7C,EAAA9J,GAAA,GAAA,kBAAA3G,SAAAA,OAAA+T,IAAA/T,OAAA,uDAAA,UAAA,UAAA,SAAAyQ,EAAAxM,GAAA,MAAA0C,GAAA8J,EAAAxM,SAAA,IAAA,mBAAArD,SAAA,CAAA,GAAAqD,GAAAhE,QAAA,SAAA0G,GAAA/F,QAAAqD,OAAA0C,GAAA8J,EAAAA,EAAA8P,QAAA9P,EAAAsmE,OAAAtmE,EAAAqD,OAAArD,EAAAqJ,IAAAjU,KAAA,SAAA4K,EAAA9J,GAAA,QAAA1C,GAAAwM,EAAAxM,GAAA,QAAAuE,GAAAiI,EAAA9J,EAAA1C,GAAA,MAAAwM,GAAA9J,GAAA1C,EAAAwM,EAAA,QAAApM,GAAAoM,EAAA9J,GAAA,IAAA,GAAA1C,GAAAI,EAAAoM,EAAAW,MAAAiiB,EAAAtpB,KAAA,UAAA9F,EAAAI,EAAA63C,QAAA,GAAA7oB,EAAAlvB,KAAAa,KAAAf,GAAA,CAAA,GAAA2R,GAAA/M,EAAA4H,EAAAK,QAAA,QAAA,IAAAnK;EAAA6B,KAAAoN,EAAAjP,OAAA0sB,GAAA0/B,MAAA/tD,KAAAf,GAAA0C,EAAA6B,KAAAvE,EAAA0C,GAAA0sB,EAAA2jD,MAAAhyE,KAAAf,KAAA0C,EAAA6B,KAAAvE,EAAA0C,GAAA,OAAAA,GAAA,QAAAkC,GAAA4H,GAAA,MAAA,UAAA0B,EAAA1B,KAAA0B,EAAA1B,GAAA,GAAA0B,EAAA1B,KAAA,QAAAmF,GAAAnF,GAAA,OAAA9J,EAAA,UAAA8J,EAAAkH,KAAA,KAAA1T,GAAA8I,KAAA,SAAA,IAAA,WAAA,MAAA,OAAA0D,EAAApK,OAAA,EAAAoK,EAAApK,KAAA,SAAA,MAAAoK,GAAApK,OAAA,QAAA0qE,GAAApqE,GAAA,IAAA0sB,EAAAg8C,SAAArqE,KAAA2B,EAAAgR,MAAA,MAAA9R,KAAA,IAAA5B,GAAAI,EAAAsC,EAAAgR,KAAA/B,EAAAjP,GAAA,OAAAoL,GAAAtB,EAAAmN,QAAA,EAAA7L,EAAA9N,GAAA4B,KAAA,QAAAoM,GAAAtL,GAAA,IAAA8J,EAAA0M,QAAAxW,GAAA,KAAA,IAAA3F,OAAA,2CAAA,KAAA,GAAAiD,GAAA,EAAAovB,EAAA1sB,EAAAzC,OAAAmvB,EAAApvB,EAAAA,IAAA4B,KAAAoxE,QAAAtwE,EAAA1C,GAAA,OAAA4B,MAAA,QAAAmM,KAAA,MAAAD,GAAA,QAAAK,KAAA,MAAA8kE,MAAAC,UAAAnlE,KAAA,GAAAD,MAAAI,IAAAtM,MAAAoxE,QAAAlG,EAAAlrE,KAAAuxE,SAAAnlE,EAAApM,KAAAwxE,UAAArlE,EAAAnM,KAAAyxE,cAAAllE;CAAA,GAAAihB,IAAAg8C,SAAA,iDAAAtlE,IAAA,wBAAA5F,KAAA,KAAA4uD,MAAA,QAAAikB,MAAA,gBAAA,OAAA/yE,GAAAszE,SAAAlkD,EAAApvB,EAAAuzE,gBAAA,WAAA,MAAA3xE,MAAA3B,OAAA,EAAA,GAAAlD,OAAA,iEAAA,GAAAiD,GAAA0C,EAAAd,MAAAuxE,SAAAvxE,KAAA4vE,kBAAA4B,aAAApzE,EAAAqzE,cAAA,WAAA,MAAAzxE,MAAA3B,OAAA,EAAA,GAAAlD,OAAA,iEAAA,GAAAiD,GAAA0C,EAAAd,MAAAuxE,SAAAvxE,KAAA4vE,kBAAA6B,iBAAA,mBAAA3wE,GAAA09B,KAAA19B,EAAA09B,GAAAmzC,gBAAAvzE,EAAAuzE,gBAAA7wE,EAAA09B,GAAAizC,cAAArzE,EAAAqzE,eAAA7mE,EAAAgnE,eAAAxzE,EAAAA,ICaAjE,OAAA,sDACA,SACA,SACA,4CACA,wBACA,OACA,sBACA,SACA,aACA,4CACA,sDACA,wCACA,0CACA,sDACA,2CACA,YAAA,SAAA6Z,EAAAC,EAAAovD,MAAAwO,QAAAhqB,GAAAiqB,uBAAA19D,OAAA41D,WAAAliB,aAAAiqB,gBAEA,MAAA,YAOA,QAAAC,KAAAxxE,OACA,MAAA,IAAAA,MAAA,IAAAA,MAAAA;CAGA,QAAAyxE,cAAAzwE,KACA,GAAAyK,QAAAhQ,KAAAa,IAAA0E,KACA0wE,KAAA,EAAAjmE,OAAA,IAAA,IACA4W,MAAAmvD,IAAA/1E,KAAAgF,MAAAgL,OAAA,KACA6W,QAAAkvD,IAAA/lE,OAAA,GAEA,OAAAimE,MAAArvD,MAAA,IAAAC,QAhBA,GACAqvD,aACAC,eAFA79D,KAAAvU,IAIAqjE,OAAAnoD,MAAAlb,KAAAK,WAmBAL,KAAAyN,KAAA,WACAokE,QAAA7H,WAAAsF,QAAAuC,SAEAt9D,KAAAhH,KACA8kE,cAAA,aACAC,cAAA,aACA/C,kBAAAt7D,EAAAga,QACAihD,cAAA,IACAqD,gBAAA,wDAEAh+D,KAAA8uD,MAAApZ,SAAAl9B,QAAA7b,GAAA,QAAA,YAAA,WACAqD,KAAAwsB,UAQA/gC,KAAA8gC,KAAA,SAAAtqB,SACAvC,EAAAe,MACAC,IAAA,0CACAC,KAAA,MACAC,MACAK,IAAAgB,QAAApI,IAEAkH,QAAA,SAAAC,UACA,GAAAq6B,OAAAr6B,SAAAq6B,OAAA,aAEAr6B;SAAAi9D,mBAAAp+D,OAAA,IAAAmB,SAAAk9D,WAAA57D,OAAA,oBACAtB,SAAAm9D,kBAAAn+D,KAAAo+D,qBAAAp9D,SAAAq9D,YAEAr+D,KAAA8uD,MAAA91D,KACAqhE,eAAAiD,QAAAt8D,UACAs5D,gBAAA76D,EAAAsvD,OAAA/tD,SAAAoB,SAGApC,KAAA8uD,MAAAviC,OACAvsB,KAAA8uD,MAAApZ,SAAA2K,SAAA74C,KAAA+yD,gBAAA,aAAAl/B,QAEAwiC,eAAA,GAAAL,iBACA3jB,UAAAn6C,EAAA,eACAkB,MAAA4B,WAAAxB,SAAAwB,WAAA45D,WAAAp7D,SAAAo7D,YACAG,WAAAv7D,SAAAnH,KAGAmG,KAAAs+D,kBACAt+D,KAAAu+D,cAAAv9D,UACAhB,KAAAw+D,SAAAx9D,cASAvV,KAAA+gC,KAAA,WACA,GAAAxsB,KAAAg1D,UAGA,GAAAh1D,KAAAy+D,WAEA,CACA,GAAA/8D,SAAA,WAAA4xC,GAAA,qCAAA,yDACAA,GAAA,QAAA,8DACAA,GAAA,UAAA,kEACAA,GAAA,WAAA,iBAEA5zC;EAAA,WAAA41C,MACA98B,SACArmB,KAAAuN,EAAAgC,SACAU,MAAAkxC,GAAA,oCAEAvpC,UACAmtC,GAAA,SACAC,GAAA,SACAz7B,OAAAhc,EAAAga,QACAwjC,QACAzlD,EAAA,OAGA80B,MACA8qB,OAAA,EACAyX,OACAnyD,IAAA,EACA0mD,MAAA,IAGA72B,MAAA,EACAoQ,MAAA,kCACAp4B,QACA+T,OAAA,SAAA7T,MAAAsyC,KACAt3C,EAAA,qBAAAs3C,IAAAtB,SAAAl9B,SAAA0J,MAAA,SAAA7rB,GACA2gD,IAAAxqB,KAAAn2B,KAEAqJ,EAAA,sBAAAs3C,IAAAtB,SAAAl9B,SAAA0J,MAAA,SAAA7rB,GACA2gD,IAAAxqB,KAAAn2B,GACA2J,KAAA8uD,MAAAtiC,SAEA9sB,EAAA,mBAAAs3C,IAAAtB,SAAAl9B,SAAA0J,MAAA,SAAA7rB,GACA2gD,IAAAxqB,KAAAn2B,GACA2J,KAAAq1D,MAAA8F,YAGA3uC,KAAA,SAAA9nB,MAAAsyC,KAAAA,IAAAp9B,kBA3CA5Z,MAAA8uD,MAAAtiC,QAiDA/gC,KAAAgzE,SAAA,WACA,OAAAh/D,EAAAi/D,QAAAd,YAAA59D,KAAAo7D;EAQA3vE,KAAA+yE,SAAA,SAAA59D,MACAZ,KAAAq1D,MAAAr1D,KAAA8uD,MAAApZ,SAAAl9B,QAAA1S,KAAA,uBAEAlF,KAAA6B,cACAzC,KAAAq1D,MAAAvvD,KAAA,6CAAAlF,KAAA6B,aAAA,MAAA9P,KAAA,WAAA,YAGAqN,KAAAq1D,MAAA14D,GAAA,SAAA,SAAAtG,GAGA,GAFAA,EAAA05B,iBAEA/vB,KAAAi1D,WAAA,CACA,GAAA0J,UAAA3+D,KAAAo7D,cACAn5D,QAAAsxC,aAAAhvC,aAAAo6D,SAAA9kE,GAEA4F,GAAAq1C,OAAA7yC,QAAA08D,UACA18D,QAAArW,MAAA8T,EAAA0B,aAAAvB,OAAAgF,UAAA85D,SAAA/yE,OACAqW,QAAApW,IAAA6T,EAAA0B,aAAAvB,OAAAgF,UAAA85D,SAAA9yE,KAEA0nD,aAAAvxC,UAAAC,QAAA,WACA27D,YAAA59D,KAAAo7D,cACAp7D,KAAAwsB,YAKAxsB,KAAA4+D,WAAAh+D,MAEAlB,EAAA,qBACAgM,KAAA,YAAA9K,KAAA2B,YACA5F,GAAA,SAAA,WACA+C,EAAA,uBAAA24C,OAAA34C,EAAAjU,MAAAuuB,GAAA,aACAha,KAAA6+D;GAEAx9D,QAAA,UAEA3B,EAAA,wBACA/C,GAAA,SAAA,WACA+C,EAAA,iBAAA24C,OAAA34C,EAAAjU,MAAAwB,OAAA0B,MAAAiC,UAEAyQ,QAAA,UAEA3B,EAAA,oBAAA/C,GAAA,SAAA,WACAqD,KAAA6+D,qBAGA7+D,KAAAq1D,MAAA14D,GAAA,SAAA,gBAAA,WACAqD,KAAAi1D,aAGAj1D,KAAAq1D,MAAA14D,GAAA,QAAA,kBAAA,WACAqD,KAAAq1D,MAAA8F,WAGAyC,YAAA59D,KAAAo7D,eASA3vE,KAAA8yE,cAAA,SAAA3vE,SACAoR,KAAA8+D,UAAA,GAAAvB,wBAAA,aAAA,4BACAwB,aAAAnwE,QAAAkU,OACAk8D,kBACAC,WAAA,mDACAC,SAAA,mDAEAC,SAAA,GACAC,iBAAA,WACAvB,eAAAvB,aAAAt8D,KAAA8+D,UAAAO;KASA5zE,KAAA6yE,gBAAA,WAKA,IAAA,GAJA1yE,OAAAiU,OAAAH,EAAA,sBAAAzS,OAAA4X,YACAhZ,IAAAgU,OAAAH,EAAA,oBAAAzS,OAAA4X,YACAy6D,YAEAz1E,EAAA,EAAA,GAAAA,EAAAA,IAAA,CACA,GAAAyB,MAAA,GAAAzB,EAAA,IAAAA,EAAAA,CACAy1E,UAAAv1E,KAAAuB,KAAA,MAAAA,KAAA,OAGAoU,EAAA,kDAAAyvC,YACAowB,WAAA,WACAC,WAAA,SAAAC,QAAAp/D,UACAA,SAAAq/D,MAAA95D,SAAA,qCAGAlG,EAAA,2BAAAyvC,WAAA,UAAAvjD,MAAA0W,OAAA,eACA5C,EAAA,yBAAAyvC,WAAA,UAAAtjD,IAAAyW,OAAA,eAEA5C,EAAA,kDAAAigE,cACArqD,OAAA,SAAAsqD,QAAA5+D,UACAA,SAAAvB,EAAAxF,OAAAqlE,SAAA,SAAAryE,KACA,MAAA,KAAAA,IAAAC,QAAA0yE,QAAAC;KAGAC,UAAA,EACA/b,MAAA,WACArkD,EAAAjU,MAAA4V,QAAA,WAEAkK,SAAA,wBACA2W,MAAA,WACAxiB,EAAAjU,MAAAk0E,aAAA,SAAA,MAGAjgE,EAAA,kDAAA/C,GAAA,OAAA,WACA+C,EAAAjU,MAAAwB,IAAAyS,EAAAjU,MAAAwB,MAAAqP,OAAA,EAAA,MAGAoD,EAAA,2BAAAzS,IAAArB,MAAA0W,OAAA,UACA5C,EAAA,yBAAAzS,IAAApB,IAAAyW,OAAA,WAQA7W,KAAAs0E,eAAA,WACA,GAAA/6D,aAAAhF,KAAAggE,iBACA/6D,UAAAjF,KAAAigE,cAEAj7D,aAAAH,YACAI,UAAAJ,YAEAnF,EAAA,sBAAAzS,IAAA+X,YAAA1C,OAAA,0BACA5C,EAAA,oBAAAzS,IAAAgY,UAAA3C,OAAA,2BAUA7W,KAAAozE,iBAAA,SAAAF,UACA,GAEAxnE,OAFAlL,MAAA,GACA2U,KAAA+9D,UAAA3+D,KAAAq1D,MAAA+H,kBAEA8C,UAAAzgE,EAAAlW,MAAAqX,KAAAzJ,MAIA;GAFA+oE,UAAAjwE,QAAA+P,KAAAggE,iBAAAz2E,QAAAmoB,MAAA7O,SAEAnD,EAAA,qBAAAsa,GAAA,YAAA,CACA,GAAA7iB,OAAA,GAAAxI,OAAAuxE,UACAj0E,OAAAkL,MAAA3I,WACAkR,EAAA,qBAAAvN,KAAAxD,MAAAsI,WAAAE,MAAA3I,YAAA8E,UAKA,MAFAoM,GAAA,uBAAAzS,IAAAhB,OAEAA,OAQAR,KAAAmzE,WAAA,WACA,GACAznE,OADAmG,KAAAoC,EAAA,uBAAAzS,MAAAwF,cAEAuS,YAAAhF,KAAAggE,gBACA1iE,QAIAA,MAAA,YAAA0H,YAAAzb,QAAAmoB,MAAApP,OAAA,mBAAA,IACAnL,MAAAxI,MAAAsI,WAAAqG,MACAoC,EAAAyE,KAAAhN,MAAAvI,QAAA,SAAAe,IAAA1D,OACA,GAAAkL,MAAA/H,YAAAO,KAAA,CAGA,GAAAosE,QAAAr8D,EAAA,iBAAA/P,IAAAmH,cAAA,MACAilE,SAAAA,OAAAjyE,SACA2V,EAAAsD,QAAA9W,OACAyT,EAAAyE,KAAAlY,MAAA,SAAApC,EAAAs8C,KACA41B,OAAA7xD,GAAAi8B,KAAAz6B,KAAA,WAAA;GAGAqwD,OAAA9uE,IAAAhB,WAIAR,KAAAozE,qBAQApzE,KAAA2yE,qBAAA,SAAAC,YACA,GAAA38D,SAAA4xC,GAAA,2BAUA,OATA+qB,aAAA,IAEA38D,QADA,GAAA28D,WACA/qB,GAAA,oCACA,GAAA+qB,WACA/qB,GAAA,gCAEAA,GAAA,kCAAAzoD,OAAAwzE,cAGA38D,SAOAjW,KAAAwpE,SAAA,WACA,GAuCAC,SACAC,UAxCAl4D,OACAkjE,kDACAlL,SAAA,WACA,MAAA,cAAArqE,KAAA8U,EAAAjU,MAAAwB,QAEAyU,QAAA4xC,GAAA,kCAEA8sB,kDACAnL,SAAA,WACA,MAAA,uBAAArqE,KAAA8U,EAAAjU,MAAAwB;EAEAyU,QAAA4xC,GAAA,kCAEA+sB,aACApL,SAAA,WACA,MAAA,KAAAv1D,EAAAjU,MAAAwB,MAAAnD,QAEA4X,QAAA4xC,GAAA,2BAEAgtB,eACArL,SAAA,WACA,MAAA,QAAArqE,KAAA8U,EAAAjU,MAAAwB,QAEAyU,QAAA4xC,GAAA,2BAEAitB,yBACAtL,SAAA,WACA,MAAA,KAAAv1D,EAAAmG,KAAAnG,EAAAjU,MAAAwB,OAAAnD,QAEA4X,QAAA4xC,GAAA,2BAEAktB,yBACAvL,SAAA,WACA,MAAA,QAAArqE,KAAA8U,EAAAjU,MAAAwB,SAAAyS,EAAA,qBAAAsa,GAAA,aAEAtY,QAAA4xC,GAAA,4BAGA8hB,aAAA,CAIAp1D,MAAA+/D,gBAEA,KAAA,GAAA5mB,YAAAl8C,OACAk4D,UAAAn1D,KAAAq1D,MAAAvvD,KAAAqzC,UACAgc,UAAAhxD,KAAA,WACA,GAAAmxD,OAAAr4D,MAAAk8C,UAAA8b,SAAAtuD,MAAAlb,KACAypE;QAAAx1D,EAAAjU,MAAA6pD,KAAA,OACA4f,UACAA,QAAAx1D,EAAAjU,MAAA6pD,MACA98B,SACArmB,KAAA8K,MAAAk8C,UAAAz3C,SAEAqI,UACA2R,OAAA,QACAwhC,QAAA/uB,EAAA,EAAA12B,EAAA,MAEA69C,KAAA,QAGA6f,UAAA1X,YAAA,SAAA6X,OACAJ,QAAA7c,QAAAid,OAAA1R,QAAA0R,OAEAF,YAAAA,aAAAE,OAIA,OAAAF,cAOA3pE,KAAAu0E,eAAA,WACA,GAAA3gD,UAAA3f,EAAA,0BAAAzS,MACAwzE,SAAA/gE,EAAA,2BAAAzS,MACA,IAAAyS,EAAA,2BAAAzS,MACA,IAAAywE,aAAAr+C,UACAra,YAAAnF,OAAA4gE,SAAA,qBACA,OAAAz7D,cAOAvZ,KAAAw0E,aAAA,WACA,GAAA5gD,UAAA3f,EAAA,0BAAAzS,MACAyzE,OAAAhhE,EAAA,yBAAAzS,MACA,IAAAyS,EAAA,yBAAAzS,MACA,IAAAywE,aAAAr+C,UACApa,UAAApF,OAAA6gE,OAAA,qBAEA;MAAAz7D,YAOAxZ,KAAA2vE,YAAA,WACA,GAAAx6D,QAWA,OAVAZ,MAAA+/D,iBACA//D,KAAA6+D,mBACAj+D,KAAAZ,KAAAq1D,MAAA+H,kBACAx8D,KAAA4B,cACA9C,EAAA,+BAAAyE,KACA,WACAvD,KAAA4B,WAAAzY,KAAA0B,KAAAQ,SAGA2U,KAAAkC,OAAA9C,KAAA8+D,UAAAO,aACAz+D,MAGAnV,KAAAyN,UCpfAtT,OAAA,6CACA,SACA,SACA,OACA,aACA,wBACA,wCACA,4CACA,yDACA,2DACA,qDACA,iBACA,cACA,oBACA,wCACA,0CACA,0DAEA,SACA6Z,EACAC,EACA4zC,GACAmiB,WACAkL,OACAn0B,SACA+G,aACAqtB,iBACAC,mBACAC,eACAlhE,cACAD,SACAohE,gBACA/G,UAIA,QAAAgH,oBACAD,gBAAAtL,WAAAsF,QAAAgG,gBACA;GAAAtgD,UAEAwgD,iBACAC,mBACAC,eACAhhE,KAJAH,KAAAvU,KAKAwU,SAAAP,EAAA,kCACA0hE,mBAAA1hE,EAAA,yBACA2E,SAAA3E,EAAA,yBAAAkB,KAAA,mBAAA,MACAygE,UAAA3hE,EAAAqhE,kBAEAt1E,MAAAG,MAAA,WACAoU,KAAAshE,WACA/tB,aAAAxtC,MAAA1B,UAEAoc,SAAA,GAAA+rB,WACAkH,WAAA0tB,mBACAvkD,OAAA,SAAAjxB,MAAAC,IAAAwK,GACA4qE,iBAAAz0C,OACA5sB,cAAAzU,KACA,eACAsU,EAAA+D,OACA5D,cAAA6D,kBAEA7X,MAAAA,MACAC,IAAAA,IACAwK,EAAAA,EACAqlB,OAAArlB,EAAAqlB,OACArX,SAAAg9D,UAAAp0E,QAEAyW,OAAA9D,cAAA+D,MAAA,oBAIA49D,WAAA,SAAAt/D,QAAA5L,GACA6qE,mBAAA10C,OACAxsB,KAAAwhE,YAAAv/D,QAAApI,GAAAxD;EAEAorE,iBAAA,WACAzhE,KAAA0hE,gBAEAC,WAAA,WACAjiE,EAAA,gBAAA/C,GAAA,SAAA,SAAAtG,GACA4qE,iBAAAzrB,QAAAE,SAAAF,QAAAx7B,GAAA,aACAinD,iBAAAzrB,QAAAyD,WAAA5iD,GAEA6qE,mBAAA1rB,QAAAE,SAAAF,QAAAx7B,GAAA,aACAknD,mBAAA1rB,QAAAyD,WAAA5iD,MAIAurE,YAAA,WACA5hE,KAAA0hE,gBAEAG,YAAA,WACA7hE,KAAA0hE,kBAIA1hE,KAAA8hE,eACA9hE,KAAA+hE,eAGApB,OAAAqB,SAAA,sBAAA,WACAhiE,KAAA0hE,eACAjhD,SAAAt1B,KAAA,aAAA,WAEAw1E,OAAAqB,SAAA,qBAAA,WACAhiE,KAAA0hE,eACAjhD,SAAAt1B,KAAA,aAAA,gBAEAw1E,OAAAqB,SAAA,oBAAA,WACAhiE,KAAA0hE,eACAjhD,SAAAt1B,KAAA,aAAA;GAEAw1E,OAAAqB,SAAA,eAAA,SAAArxD,SACA3Q,KAAAiiE,uBAAAtxD,WAEAgwD,OAAAqB,SAAA,gBAAA,SAAArxD,SACA3Q,KAAAkiE,mBAAAvxD,WAEAgwD,OAAAqB,SAAA,kBAAA,SAAAG,cACAlB,iBAAAjM,WAAAiM,iBAAA9G,UAAAgI,aAAAlhE,KACAjB,KAAAwhE,YAAAW,aAAAlhE,OAGA0/D,OAAAqB,SAAA,eAAA,WACAhiE,KAAA0hE,kBAQAj2E,KAAAs2E,aAAA,WACAriE,EAAAuqB,GAAAqrB,KAAAqO,OAAA,IAGAsd,iBAAA,GAAAL,kBACA5G,SAAAr9D,GAAA,wBAAA,WACAiD,cAAAzU,KACA,gBACAsU,EAAA+D,OACA5D,cAAA6D,kBACAC,OAAA9D,cAAA+D,MAAA,sBAIAq2D,SAAAr9D,GAAA,wBAAA,WACA42C,aAAA9tC,gBAAA;GAEAu0D,SAAAr9D,GAAA,0BAAA,SAAAyH,SACAmvC,aAAAhwC,YAAAa,WAEA41D,SAAAr9D,GAAA,6BAAA,SAAAyH,SACA,GAAAnC,SAAAsxC,aAAAhvC,aAAAH,QACAnC,SAAAqD,eACAtF,KAAAwhE,YAAAv/D,QAAAqD,iBAKA47D,mBAAA,GAAAL,oBACA7G,SAAAr9D,GAAA,4BAAA,SAAAiE,MACA2yC,aAAA/yC,aACAI,KAAAA,KACAG,QAAAf,KAAA0hE,iBAGA1H,SAAAr9D,GAAA,0BAAA,WACA8jB,SAAAt1B,KAAA,cAGAg2E,eAAA,GAAAL,iBAOAr1E,KAAAq2E,aAAA,WACAT,UAAAv7D,KAAA,mBAAAzB,SAAA,KAAA1R,KAAA,WAAA,YACA+M,EAAA,yBAAA0Z,QAAAioD,WAEAA,UAAA1kE,GAAA,SAAA,WACAqD,KAAA0hE,eACAr9D,SAAAkvC,aAAAjvC,mBACAmc,SAAAt1B,KAAA;IAQAM,KAAA61E,SAAA,WACAnhE,KAAAT,EAAAS,KAAAC,UAAAH,UAEAP,EAAAO,UAAAtD,GACA,kBACA,WACA8jB,SAAAt1B,KAAA,mBAIAuU,EAAAO,UAAAtD,GACA,qBACA,SAAAtG,EAAAuK,MACA,GACAuC,mBADAlB,QAAAsxC,aAAAhvC,aAAA3D,KAAA/G,GAEAmG,MAAA0hE,eACAz/D,UACAkB,mBAAAlB,QAAApI,IACAoI,QAAAmB,mBAAAnB,QAAAmB,kBAAAtZ,SACAqZ,kBAAAA,kBAAA9W,OAAA4V,QAAAmB,oBAEAqd,SAAAt1B,KAAA,eAAA,SAAAkY,eACA,MAAA,KAAAF,kBAAAjW,QAAAmW,cAAAxJ,UAWApO,KAAAi2E,aAAA,WACAT,iBAAAz0C,OACA00C,mBAAA10C,QASA/gC,KAAA22E,qBAAA,SAAAngE,QAAA5L,GACA,GACAgsE,YADAjtB,cAAA7B,aAAA9uC,gBAAAxC,QAAApI,GAGA4mB;SAAAt1B,KAAA,YAEAiqD,cAAAtrD,SAIAypD,aAAA9tC,eAAAxD,SAEA,mBAAA5L,IAAAA,EAAAisE,WACAltB,cAAAp7B,GAAA,cACAqoD,WAAAjtB,cAAAvoB,QAAA,wBAAA/mB,KAAA,aACAsvC,cAAAitB,WAAAn4D,GAAA,IAEA+2D,iBAAAjoE,KACAgiE,kBAAA5lB,gBAEA6rB,iBAAAjoE,KACAupE,oBAAA,EACAC,oBAAA,EACA1E,cAAA,gBACAC,cAAA,gBAGAkD,iBAAAjoE,KACAupE,oBAAAlsE,EAAAosE,SAAApsE,EAAAg6B,MAAA+kB,cAAA19C,SAAA4S,IACAk4D,oBAAAnsE,EAAAqsE,SAAArsE,EAAA+5B,MAAAglB,cAAA19C,SAAA6P,KACAyzD,kBAAA3kE,EAAA8vD,cACA2X,cAAA,gBACAC,cAAA,aAIAkD,iBAAA10C,KAAAtqB;EASAxW,KAAAw2E,uBAAA,SAAAtxD,SACAuwD,mBAAA30C,KAAA5b,UASAllB,KAAAy2E,mBAAA,SAAAvxD,SACA,GAAA1O,SAAAsxC,aAAAhvC,aAAAoM,QAAA1P,IACAxV,MAAAi2E,eACAP,eAAA50C,KAAAtqB,UAUAxW,KAAA+1E,YAAA,SAAAp9D,QAAA/N,GACAoqB,SAAA00B,UAAA/wC,SAAAlH,KAAA,SAAA+E,SACAjC,KAAAoiE,qBAAAngE,QAAA5L,GACA2J,KAAA2iE,eAAA1gE,QAAApI,OASApO,KAAAk3E,eAAA,SAAAv+D,SACAjE,KAAAyD,gBAAAzD,KAAA0D,UACA4c,SAAAu0B,SAAA5wC,SAAAlH,KAAA,SAAA+E,SAEA,IAAAvC,EAAA,mCAAAuC,QAAApI,IAAA/P,SACAqW,KAAAyiE,cAAAljE,EAAA,IAAAuC,QAAA4gE,QAAA,WAEA5iE,SAAAo+C,IAAA,iBAAA,SAAAhoD,EAAAysE,KACApjE,EAAAojE,KAAA3gD,SAAA,SACAhiB,KAAAyiE,cAAAljE,EAAA,IAAA0E;IAKAnC,QAAA4gE,QACA1iE,KAAA4iE,YAAA,IAAA9gE,QAAA4gE,SAAA,EAAA,WACA1iE,KAAAyiE,cAAAljE,EAAA,IAAAuC,QAAApI,OAGAsG,KAAAyiE,cAAAljE,EAAA,IAAAuC,QAAApI,QAMA,MAAA,IAAAmnE","sourcesContent":["/**\r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n *\r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n *\r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n *\r\n * Copyright (c) 2014 (original work) Open Assessment Technologies SA (under the project TAO-PRODUCT);\r\n *\r\n *\r\n */\r\n\r\n/**\r\n * @see http://forge.taotesting.com/projects/tao/wiki/Front_js\r\n */\r\ndefine('taoDeliverySchedule/controller/routes',[],function () {\r\n    'use strict';\r\n    \r\n    require.config({\r\n        paths: {\r\n            editDeliveryForm : '/taoDeliverySchedule/Main/editDeliveryForm?noext', //load template from controller action. (noext extension may be useful here)\r\n            timeZoneList : '/taoDeliverySchedule/Main/timeZoneList?noext' //load template from controller action. (noext extension may be useful here)\r\n        }\r\n    });\r\n    \r\n    return {\r\n        'Main': {\r\n            'actions': {\r\n                'index' : 'controller/Main/index'\r\n            }\r\n        }\r\n    };\r\n});\r\n\n","/*!\r\n * rrule.js - Library for working with recurrence rules for calendar dates.\r\n * https://github.com/jakubroztocil/rrule\r\n *\r\n * Copyright 2010, Jakub Roztocil and Lars Schoning\r\n * Licenced under the BSD licence.\r\n * https://github.com/jakubroztocil/rrule/blob/master/LICENCE\r\n *\r\n * Based on:\r\n * python-dateutil - Extensions to the standard Python datetime module.\r\n * Copyright (c) 2003-2011 - Gustavo Niemeyer <gustavo@niemeyer.net>\r\n * Copyright (c) 2012 - Tomi Pieviläinen <tomi.pievilainen@iki.fi>\r\n * https://github.com/jakubroztocil/rrule/blob/master/LICENCE\r\n *\r\n */\r\n(function(root){\r\n\r\nvar serverSide = typeof module !== 'undefined' && module.exports;\r\n\r\n\r\nvar getnlp = function() {\r\n    if (!getnlp._nlp) {\r\n        if (serverSide) {\r\n            // Lazy, runtime import to avoid circular refs.\r\n            getnlp._nlp = require('./nlp')\r\n        } else if (!(getnlp._nlp = root._RRuleNLP)) {\r\n            throw new Error(\r\n                'You need to include rrule/nlp.js for fromText/toText to work.'\r\n            )\r\n        }\r\n    }\r\n    return getnlp._nlp;\r\n};\r\n\r\n\r\n//=============================================================================\r\n// Date utilities\r\n//=============================================================================\r\n\r\n/**\r\n * General date-related utilities.\r\n * Also handles several incompatibilities between JavaScript and Python\r\n *\r\n */\r\nvar dateutil = {\r\n\r\n    MONTH_DAYS: [31, 28, 31, 30, 31, 30, 31, 31, 30, 31, 30, 31],\r\n\r\n    /**\r\n     * Number of milliseconds of one day\r\n     */\r\n    ONE_DAY: 1000 * 60 * 60 * 24,\r\n\r\n    /**\r\n     * @see: <http://docs.python.org/library/datetime.html#datetime.MAXYEAR>\r\n     */\r\n    MAXYEAR: 9999,\r\n\r\n    /**\r\n     * Python uses 1-Jan-1 as the base for calculating ordinals but we don't\r\n     * want to confuse the JS engine with milliseconds > Number.MAX_NUMBER,\r\n     * therefore we use 1-Jan-1970 instead\r\n     */\r\n    ORDINAL_BASE: new Date(1970, 0, 1),\r\n\r\n    /**\r\n     * Python: MO-SU: 0 - 6\r\n     * JS: SU-SAT 0 - 6\r\n     */\r\n    PY_WEEKDAYS: [6, 0, 1, 2, 3, 4, 5],\r\n\r\n    /**\r\n     * py_date.timetuple()[7]\r\n     */\r\n    getYearDay: function(date) {\r\n        var dateNoTime = new Date(\r\n            date.getFullYear(), date.getMonth(), date.getDate());\r\n        return Math.ceil(\r\n            (dateNoTime - new Date(date.getFullYear(), 0, 1))\r\n            / dateutil.ONE_DAY) + 1;\r\n    },\r\n\r\n    isLeapYear: function(year) {\r\n        if (year instanceof Date) {\r\n            year = year.getFullYear();\r\n        }\r\n        return ((year % 4 === 0) && (year % 100 !== 0)) || (year % 400 === 0);\r\n    },\r\n\r\n    /**\r\n     * @return {Number} the date's timezone offset in ms\r\n     */\r\n    tzOffset: function(date) {\r\n         return date.getTimezoneOffset() * 60 * 1000\r\n    },\r\n\r\n    /**\r\n     * @see: <http://www.mcfedries.com/JavaScript/DaysBetween.asp>\r\n     */\r\n    daysBetween: function(date1, date2) {\r\n        // The number of milliseconds in one day\r\n        // Convert both dates to milliseconds\r\n        var date1_ms = date1.getTime() - dateutil.tzOffset(date1);\r\n        var date2_ms = date2.getTime() - dateutil.tzOffset(date2);\r\n        // Calculate the difference in milliseconds\r\n        var difference_ms = Math.abs(date1_ms - date2_ms);\r\n        // Convert back to days and return\r\n        return Math.round(difference_ms / dateutil.ONE_DAY);\r\n    },\r\n\r\n    /**\r\n     * @see: <http://docs.python.org/library/datetime.html#datetime.date.toordinal>\r\n     */\r\n    toOrdinal: function(date) {\r\n        return dateutil.daysBetween(date, dateutil.ORDINAL_BASE);\r\n    },\r\n\r\n    /**\r\n     * @see - <http://docs.python.org/library/datetime.html#datetime.date.fromordinal>\r\n     */\r\n    fromOrdinal: function(ordinal) {\r\n        var millisecsFromBase = ordinal * dateutil.ONE_DAY;\r\n        return new Date(dateutil.ORDINAL_BASE.getTime()\r\n                        - dateutil.tzOffset(dateutil.ORDINAL_BASE)\r\n                        +  millisecsFromBase\r\n                        + dateutil.tzOffset(new Date(millisecsFromBase)));\r\n    },\r\n\r\n    /**\r\n     * @see: <http://docs.python.org/library/calendar.html#calendar.monthrange>\r\n     */\r\n    monthRange: function(year, month) {\r\n        var date = new Date(year, month, 1);\r\n        return [dateutil.getWeekday(date), dateutil.getMonthDays(date)];\r\n    },\r\n\r\n    getMonthDays: function(date) {\r\n        var month = date.getMonth();\r\n        return month == 1 && dateutil.isLeapYear(date)\r\n            ? 29\r\n            : dateutil.MONTH_DAYS[month];\r\n    },\r\n\r\n    /**\r\n     * @return {Number} python-like weekday\r\n     */\r\n    getWeekday: function(date) {\r\n        return dateutil.PY_WEEKDAYS[date.getDay()];\r\n    },\r\n\r\n    /**\r\n     * @see: <http://docs.python.org/library/datetime.html#datetime.datetime.combine>\r\n     */\r\n    combine: function(date, time) {\r\n        time = time || date;\r\n        return new Date(\r\n            date.getFullYear(), date.getMonth(), date.getDate(),\r\n            time.getHours(), time.getMinutes(), time.getSeconds()\r\n        );\r\n    },\r\n\r\n    clone: function(date) {\r\n        var dolly = new Date(date.getTime());\r\n        dolly.setMilliseconds(0);\r\n        return dolly;\r\n    },\r\n\r\n    cloneDates: function(dates) {\r\n        var clones = [];\r\n        for (var i = 0; i < dates.length; i++) {\r\n            clones.push(dateutil.clone(dates[i]));\r\n        }\r\n        return clones;\r\n    },\r\n\r\n    /**\r\n     * Sorts an array of Date or dateutil.Time objects\r\n     */\r\n    sort: function(dates) {\r\n        dates.sort(function(a, b){\r\n            return a.getTime() - b.getTime();\r\n        });\r\n    },\r\n\r\n    timeToUntilString: function(time) {\r\n        var date = new Date(time);\r\n        var comp, comps = [\r\n            date.getUTCFullYear(),\r\n            date.getUTCMonth() + 1,\r\n            date.getUTCDate(),\r\n            'T',\r\n            date.getUTCHours(),\r\n            date.getUTCMinutes(),\r\n            date.getUTCSeconds(),\r\n            'Z'\r\n        ];\r\n        for (var i = 0; i < comps.length; i++) {\r\n            comp = comps[i];\r\n            if (!/[TZ]/.test(comp) && comp < 10) {\r\n                comps[i] = '0' + String(comp);\r\n            }\r\n        }\r\n        return comps.join('');\r\n    },\r\n\r\n    untilStringToDate: function(until) {\r\n        var re = /^(\\d{4})(\\d{2})(\\d{2})(T(\\d{2})(\\d{2})(\\d{2})Z)?$/;\r\n        var bits = re.exec(until);\r\n        if (!bits) {\r\n            throw new Error('Invalid UNTIL value: ' + until)\r\n        }\r\n        return new Date(\r\n            Date.UTC(bits[1],\r\n            bits[2] - 1,\r\n            bits[3],\r\n            bits[5] || 0,\r\n            bits[6] || 0,\r\n            bits[7] || 0\r\n        ));\r\n    }\r\n\r\n};\r\n\r\ndateutil.Time = function(hour, minute, second) {\r\n    this.hour = hour;\r\n    this.minute = minute;\r\n    this.second = second;\r\n};\r\n\r\ndateutil.Time.prototype = {\r\n    getHours: function() {\r\n        return this.hour;\r\n    },\r\n    getMinutes: function() {\r\n        return this.minute;\r\n    },\r\n    getSeconds: function() {\r\n        return this.second;\r\n    },\r\n    getTime: function() {\r\n        return ((this.hour * 60 * 60)\r\n                 + (this.minute * 60)\r\n                 + this.second)\r\n               * 1000;\r\n    }\r\n};\r\n\r\n\r\n//=============================================================================\r\n// Helper functions\r\n//=============================================================================\r\n\r\n\r\n/**\r\n * Simplified version of python's range()\r\n */\r\nvar range = function(start, end) {\r\n    if (arguments.length === 1) {\r\n        end = start;\r\n        start = 0;\r\n    }\r\n    var rang = [];\r\n    for (var i = start; i < end; i++) {\r\n        rang.push(i);\r\n    }\r\n    return rang;\r\n};\r\nvar repeat = function(value, times) {\r\n    var i = 0, array = [];\r\n    if (value instanceof Array) {\r\n        for (; i < times; i++) {\r\n            array[i] = [].concat(value);\r\n        }\r\n    } else {\r\n        for (; i < times; i++) {\r\n            array[i] = value;\r\n        }\r\n    }\r\n    return array;\r\n};\r\n\r\n\r\n/**\r\n * closure/goog/math/math.js:modulo\r\n * Copyright 2006 The Closure Library Authors.\r\n * The % operator in JavaScript returns the remainder of a / b, but differs from\r\n * some other languages in that the result will have the same sign as the\r\n * dividend. For example, -1 % 8 == -1, whereas in some other languages\r\n * (such as Python) the result would be 7. This function emulates the more\r\n * correct modulo behavior, which is useful for certain applications such as\r\n * calculating an offset index in a circular list.\r\n *\r\n * @param {number} a The dividend.\r\n * @param {number} b The divisor.\r\n * @return {number} a % b where the result is between 0 and b (either 0 <= x < b\r\n *     or b < x <= 0, depending on the sign of b).\r\n */\r\nvar pymod = function(a, b) {\r\n  var r = a % b;\r\n  // If r and b differ in sign, add b to wrap the result to the correct sign.\r\n  return (r * b < 0) ? r + b : r;\r\n};\r\n\r\n\r\n/**\r\n * @see: <http://docs.python.org/library/functions.html#divmod>\r\n */\r\nvar divmod = function(a, b) {\r\n    return {div: Math.floor(a / b), mod: pymod(a, b)};\r\n};\r\n\r\n\r\n/**\r\n * Python-like boolean\r\n * @return {Boolean} value of an object/primitive, taking into account\r\n * the fact that in Python an empty list's/tuple's\r\n * boolean value is False, whereas in JS it's true\r\n */\r\nvar plb = function(obj) {\r\n    return (obj instanceof Array && obj.length == 0)\r\n        ? false\r\n        : Boolean(obj);\r\n};\r\n\r\n\r\n/**\r\n * Return true if a value is in an array\r\n */\r\nvar contains = function(arr, val) {\r\n    return arr.indexOf(val) != -1;\r\n};\r\n\r\n\r\n//=============================================================================\r\n// Date masks\r\n//=============================================================================\r\n\r\n// Every mask is 7 days longer to handle cross-year weekly periods.\r\n\r\nvar M365MASK = [].concat(\r\n    repeat(1, 31),  repeat(2, 28),  repeat(3, 31),\r\n    repeat(4, 30),  repeat(5, 31),  repeat(6, 30),\r\n    repeat(7, 31),  repeat(8, 31),  repeat(9, 30),\r\n    repeat(10, 31), repeat(11, 30), repeat(12, 31),\r\n    repeat(1, 7)\r\n);\r\nvar M366MASK = [].concat(\r\n    repeat(1, 31),  repeat(2, 29),  repeat(3, 31),\r\n    repeat(4, 30),  repeat(5, 31),  repeat(6, 30),\r\n    repeat(7, 31),  repeat(8, 31),  repeat(9, 30),\r\n    repeat(10, 31), repeat(11, 30), repeat(12, 31),\r\n    repeat(1, 7)\r\n);\r\n\r\nvar\r\n    M28 = range(1, 29),\r\n    M29 = range(1, 30),\r\n    M30 = range(1, 31),\r\n    M31 = range(1, 32);\r\nvar MDAY366MASK = [].concat(\r\n    M31, M29, M31,\r\n    M30, M31, M30,\r\n    M31, M31, M30,\r\n    M31, M30, M31,\r\n    M31.slice(0, 7)\r\n);\r\nvar MDAY365MASK = [].concat(\r\n    M31, M28, M31,\r\n    M30, M31, M30,\r\n    M31, M31, M30,\r\n    M31, M30, M31,\r\n    M31.slice(0, 7)\r\n);\r\n\r\nM28 = range(-28, 0);\r\nM29 = range(-29, 0);\r\nM30 = range(-30, 0);\r\nM31 = range(-31, 0);\r\nvar NMDAY366MASK = [].concat(\r\n    M31, M29, M31,\r\n    M30, M31, M30,\r\n    M31, M31, M30,\r\n    M31, M30, M31,\r\n    M31.slice(0, 7)\r\n);\r\nvar NMDAY365MASK = [].concat(\r\n    M31, M28, M31,\r\n    M30, M31, M30,\r\n    M31, M31, M30,\r\n    M31, M30, M31,\r\n    M31.slice(0, 7)\r\n);\r\n\r\nvar M366RANGE = [0, 31, 60, 91, 121, 152, 182, 213, 244, 274, 305, 335, 366];\r\nvar M365RANGE = [0, 31, 59, 90, 120, 151, 181, 212, 243, 273, 304, 334, 365];\r\n\r\nvar WDAYMASK = (function() {\r\n    for (var wdaymask = [], i = 0; i < 55; i++) {\r\n        wdaymask = wdaymask.concat(range(7));\r\n    }\r\n    return wdaymask;\r\n}());\r\n\r\n\r\n//=============================================================================\r\n// Weekday\r\n//=============================================================================\r\n\r\nvar Weekday = function(weekday, n) {\r\n    if (n === 0) {\r\n        throw new Error('Can\\'t create weekday with n == 0');\r\n    }\r\n    this.weekday = weekday;\r\n    this.n = n;\r\n};\r\n\r\nWeekday.prototype = {\r\n\r\n    // __call__ - Cannot call the object directly, do it through\r\n    // e.g. RRule.TH.nth(-1) instead,\r\n    nth: function(n) {\r\n        return this.n == n ? this : new Weekday(this.weekday, n);\r\n    },\r\n\r\n    // __eq__\r\n    equals: function(other) {\r\n        return this.weekday == other.weekday && this.n == other.n;\r\n    },\r\n\r\n    // __repr__\r\n    toString: function() {\r\n        var s = ['MO', 'TU', 'WE', 'TH', 'FR', 'SA', 'SU'][this.weekday];\r\n        if (this.n) {\r\n            s = (this.n > 0 ? '+' : '') + String(this.n) + s;\r\n        }\r\n        return s;\r\n    },\r\n\r\n    getJsWeekday: function() {\r\n        return this.weekday == 6 ? 0 : this.weekday + 1;\r\n    }\r\n\r\n};\r\n\r\n\r\n//=============================================================================\r\n// RRule\r\n//=============================================================================\r\n\r\n/**\r\n *\r\n * @param {Object?} options - see <http://labix.org/python-dateutil/#head-cf004ee9a75592797e076752b2a889c10f445418>\r\n *        The only required option is `freq`, one of RRule.YEARLY, RRule.MONTHLY, ...\r\n * @constructor\r\n */\r\nvar RRule = function(options, noCache) {\r\n\r\n    // RFC string\r\n    this._string = null;\r\n\r\n    options = options || {};\r\n\r\n    this._cache = noCache ? null : {\r\n        all: false,\r\n        before: [],\r\n        after: [],\r\n        between: []\r\n    };\r\n\r\n    // used by toString()\r\n    this.origOptions = {};\r\n\r\n    var invalid = [],\r\n        keys = Object.keys(options),\r\n        defaultKeys = Object.keys(RRule.DEFAULT_OPTIONS);\r\n\r\n    // Shallow copy for origOptions and check for invalid\r\n    keys.forEach(function(key) {\r\n        this.origOptions[key] = options[key];\r\n        if (!contains(defaultKeys, key)) invalid.push(key);\r\n    }, this);\r\n\r\n    if (invalid.length) {\r\n        throw new Error('Invalid options: ' + invalid.join(', '))\r\n    }\r\n\r\n    if (!RRule.FREQUENCIES[options.freq] && options.byeaster === null) {\r\n        throw new Error('Invalid frequency: ' + String(options.freq))\r\n    }\r\n\r\n    // Merge in default options\r\n    defaultKeys.forEach(function(key) {\r\n        if (!contains(keys, key)) options[key] = RRule.DEFAULT_OPTIONS[key];\r\n    });\r\n\r\n    var opts = this.options = options;\r\n\r\n    if (opts.byeaster !== null) {\r\n        opts.freq = RRule.YEARLY;\r\n    }\r\n\r\n    if (!opts.dtstart) {\r\n        opts.dtstart = new Date();\r\n        opts.dtstart.setMilliseconds(0);\r\n    }\r\n\r\n    if (opts.wkst === null) {\r\n        opts.wkst = RRule.MO.weekday;\r\n    } else if (typeof opts.wkst == 'number') {\r\n        // cool, just keep it like that\r\n    } else {\r\n        opts.wkst = opts.wkst.weekday;\r\n    }\r\n\r\n    if (opts.bysetpos !== null) {\r\n        if (typeof opts.bysetpos == 'number') {\r\n            opts.bysetpos = [opts.bysetpos];\r\n        }\r\n        for (var i = 0; i < opts.bysetpos.length; i++) {\r\n            var v = opts.bysetpos[i];\r\n            if (v == 0 || !(-366 <= v && v <= 366)) {\r\n                throw new Error(\r\n                    'bysetpos must be between 1 and 366,' +\r\n                        ' or between -366 and -1'\r\n                );\r\n            }\r\n        }\r\n    }\r\n\r\n    if (!(plb(opts.byweekno) || plb(opts.byyearday)\r\n        || plb(opts.bymonthday) || opts.byweekday !== null\r\n        || opts.byeaster !== null))\r\n    {\r\n        switch (opts.freq) {\r\n            case RRule.YEARLY:\r\n                if (!opts.bymonth) {\r\n                    opts.bymonth = opts.dtstart.getMonth() + 1;\r\n                }\r\n                opts.bymonthday = opts.dtstart.getDate();\r\n                break;\r\n            case RRule.MONTHLY:\r\n                opts.bymonthday = opts.dtstart.getDate();\r\n                break;\r\n            case RRule.WEEKLY:\r\n                opts.byweekday = dateutil.getWeekday(\r\n                                            opts.dtstart);\r\n                break;\r\n        }\r\n    }\r\n\r\n    // bymonth\r\n    if (opts.bymonth !== null\r\n        && !(opts.bymonth instanceof Array)) {\r\n        opts.bymonth = [opts.bymonth];\r\n    }\r\n\r\n    // byyearday\r\n    if (opts.byyearday !== null\r\n        && !(opts.byyearday instanceof Array)) {\r\n        opts.byyearday = [opts.byyearday];\r\n    }\r\n\r\n    // bymonthday\r\n    if (opts.bymonthday === null) {\r\n        opts.bymonthday = [];\r\n        opts.bynmonthday = [];\r\n    } else if (opts.bymonthday instanceof Array) {\r\n        var bymonthday = [], bynmonthday = [];\r\n\r\n        for (i = 0; i < opts.bymonthday.length; i++) {\r\n            var v = opts.bymonthday[i];\r\n            if (v > 0) {\r\n                bymonthday.push(v);\r\n            } else if (v < 0) {\r\n                bynmonthday.push(v);\r\n            }\r\n        }\r\n        opts.bymonthday = bymonthday;\r\n        opts.bynmonthday = bynmonthday;\r\n    } else {\r\n        if (opts.bymonthday < 0) {\r\n            opts.bynmonthday = [opts.bymonthday];\r\n            opts.bymonthday = [];\r\n        } else {\r\n            opts.bynmonthday = [];\r\n            opts.bymonthday = [opts.bymonthday];\r\n        }\r\n    }\r\n\r\n    // byweekno\r\n    if (opts.byweekno !== null\r\n        && !(opts.byweekno instanceof Array)) {\r\n        opts.byweekno = [opts.byweekno];\r\n    }\r\n\r\n    // byweekday / bynweekday\r\n    if (opts.byweekday === null) {\r\n        opts.bynweekday = null;\r\n    } else if (typeof opts.byweekday == 'number') {\r\n        opts.byweekday = [opts.byweekday];\r\n        opts.bynweekday = null;\r\n\r\n    } else if (opts.byweekday instanceof Weekday) {\r\n\r\n        if (!opts.byweekday.n || opts.freq > RRule.MONTHLY) {\r\n            opts.byweekday = [opts.byweekday.weekday];\r\n            opts.bynweekday = null;\r\n        } else {\r\n            opts.bynweekday = [\r\n                [opts.byweekday.weekday,\r\n                 opts.byweekday.n]\r\n            ];\r\n            opts.byweekday = null;\r\n        }\r\n\r\n    } else {\r\n        var byweekday = [], bynweekday = [];\r\n\r\n        for (i = 0; i < opts.byweekday.length; i++) {\r\n            var wday = opts.byweekday[i];\r\n\r\n            if (typeof wday == 'number') {\r\n                byweekday.push(wday);\r\n            } else if (!wday.n || opts.freq > RRule.MONTHLY) {\r\n                byweekday.push(wday.weekday);\r\n            } else {\r\n                bynweekday.push([wday.weekday, wday.n]);\r\n            }\r\n        }\r\n        opts.byweekday = plb(byweekday) ? byweekday : null;\r\n        opts.bynweekday = plb(bynweekday) ? bynweekday : null;\r\n    }\r\n\r\n    // byhour\r\n    if (opts.byhour === null) {\r\n        opts.byhour = (opts.freq < RRule.HOURLY)\r\n            ? [opts.dtstart.getHours()]\r\n            : null;\r\n    } else if (typeof opts.byhour == 'number') {\r\n        opts.byhour = [opts.byhour];\r\n    }\r\n\r\n    // byminute\r\n    if (opts.byminute === null) {\r\n        opts.byminute = (opts.freq < RRule.MINUTELY)\r\n            ? [opts.dtstart.getMinutes()]\r\n            : null;\r\n    } else if (typeof opts.byminute == 'number') {\r\n        opts.byminute = [opts.byminute];\r\n    }\r\n\r\n    // bysecond\r\n    if (opts.bysecond === null) {\r\n        opts.bysecond = (opts.freq < RRule.SECONDLY)\r\n            ? [opts.dtstart.getSeconds()]\r\n            : null;\r\n    } else if (typeof opts.bysecond == 'number') {\r\n        opts.bysecond = [opts.bysecond];\r\n    }\r\n\r\n    if (opts.freq >= RRule.HOURLY) {\r\n        this.timeset = null;\r\n    } else {\r\n        this.timeset = [];\r\n        for (i = 0; i < opts.byhour.length; i++) {\r\n            var hour = opts.byhour[i];\r\n            for (var j = 0; j < opts.byminute.length; j++) {\r\n                var minute = opts.byminute[j];\r\n                for (var k = 0; k < opts.bysecond.length; k++) {\r\n                    var second = opts.bysecond[k];\r\n                    // python:\r\n                    // datetime.time(hour, minute, second,\r\n                    // tzinfo=self._tzinfo))\r\n                    this.timeset.push(new dateutil.Time(hour, minute, second));\r\n                }\r\n            }\r\n        }\r\n        dateutil.sort(this.timeset);\r\n    }\r\n\r\n};\r\n//}}}\r\n\r\n// RRule class 'constants'\r\n\r\nRRule.FREQUENCIES = [\r\n    'YEARLY', 'MONTHLY', 'WEEKLY', 'DAILY',\r\n    'HOURLY', 'MINUTELY', 'SECONDLY'\r\n];\r\n\r\nRRule.YEARLY   = 0;\r\nRRule.MONTHLY  = 1;\r\nRRule.WEEKLY   = 2;\r\nRRule.DAILY    = 3;\r\nRRule.HOURLY   = 4;\r\nRRule.MINUTELY = 5;\r\nRRule.SECONDLY = 6;\r\n\r\nRRule.MO = new Weekday(0);\r\nRRule.TU = new Weekday(1);\r\nRRule.WE = new Weekday(2);\r\nRRule.TH = new Weekday(3);\r\nRRule.FR = new Weekday(4);\r\nRRule.SA = new Weekday(5);\r\nRRule.SU = new Weekday(6);\r\n\r\nRRule.DEFAULT_OPTIONS = {\r\n    freq:        null,\r\n    dtstart:     null,\r\n    interval:    1,\r\n    wkst:        RRule.MO,\r\n    count:       null,\r\n    until:       null,\r\n    bysetpos:    null,\r\n    bymonth:     null,\r\n    bymonthday:  null,\r\n    byyearday:   null,\r\n    byweekno:    null,\r\n    byweekday:   null,\r\n    byhour:      null,\r\n    byminute:    null,\r\n    bysecond:    null,\r\n    byeaster:    null\r\n};\r\n\r\n\r\n\r\nRRule.parseText = function(text, language) {\r\n    return getnlp().parseText(text, language)\r\n};\r\n\r\nRRule.fromText = function(text, language) {\r\n    return getnlp().fromText(text, language)\r\n};\r\n\r\nRRule.optionsToString = function(options) {\r\n    var key, keys, defaultKeys, value, strValues, pairs = [];\r\n\r\n    keys = Object.keys(options);\r\n    defaultKeys = Object.keys(RRule.DEFAULT_OPTIONS);\r\n\r\n    for (var i = 0; i < keys.length; i++) {\r\n\r\n        if (!contains(defaultKeys, keys[i])) continue;\r\n\r\n        key = keys[i].toUpperCase();\r\n        value = options[keys[i]];\r\n        strValues = [];\r\n\r\n        if (value === null || value instanceof Array && !value.length) {\r\n            continue;\r\n        }\r\n\r\n        switch (key) {\r\n            case 'FREQ':\r\n                value = RRule.FREQUENCIES[options.freq];\r\n                break;\r\n            case 'WKST':\r\n                value = value.toString();\r\n                break;\r\n            case 'BYWEEKDAY':\r\n                /*\r\n                NOTE: BYWEEKDAY is a special case.\r\n                RRule() deconstructs the rule.options.byweekday array\r\n                into an array of Weekday arguments.\r\n                On the other hand, rule.origOptions is an array of Weekdays.\r\n                We need to handle both cases here.\r\n                It might be worth change RRule to keep the Weekdays.\r\n\r\n                Also, BYWEEKDAY (used by RRule) vs. BYDAY (RFC)\r\n\r\n                */\r\n                key = 'BYDAY';\r\n                if (!(value instanceof Array)) {\r\n                    value = [value];\r\n                }\r\n                for (var wday, j = 0; j < value.length; j++) {\r\n                    wday = value[j];\r\n                    if (wday instanceof Weekday) {\r\n                        // good\r\n                    } else if (wday instanceof Array) {\r\n                        wday = new Weekday(wday[0], wday[1]);\r\n                    } else {\r\n                        wday = new Weekday(wday);\r\n                    }\r\n                    strValues[j] = wday.toString();\r\n                }\r\n                value = strValues;\r\n                break;\r\n            case'DTSTART':\r\n            case'UNTIL':\r\n                value = dateutil.timeToUntilString(value);\r\n                break;\r\n            default:\r\n                if (value instanceof Array) {\r\n                    for (var j = 0; j < value.length; j++) {\r\n                        strValues[j] = String(value[j]);\r\n                    }\r\n                    value = strValues;\r\n                } else {\r\n                    value = String(value);\r\n                }\r\n\r\n        }\r\n        pairs.push([key, value]);\r\n    }\r\n\r\n    var strings = [];\r\n    for (var i = 0; i < pairs.length; i++) {\r\n        var attr = pairs[i];\r\n        strings.push(attr[0] + '=' + attr[1].toString());\r\n    }\r\n    return strings.join(';');\r\n\r\n};\r\n\r\nRRule.prototype = {\r\n\r\n    /**\r\n     * @param {Function} iterator - optional function that will be called\r\n     *                   on each date that is added. It can return false\r\n     *                   to stop the iteration.\r\n     * @return Array containing all recurrences.\r\n     */\r\n    all: function(iterator) {\r\n        if (iterator) {\r\n            return this._iter(new CallbackIterResult('all', {}, iterator));\r\n        } else {\r\n            var result = this._cacheGet('all');\r\n            if (result === false) {\r\n                result = this._iter(new IterResult('all', {}));\r\n                this._cacheAdd('all', result);\r\n            }\r\n            return result;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Returns all the occurrences of the rrule between after and before.\r\n     * The inc keyword defines what happens if after and/or before are\r\n     * themselves occurrences. With inc == True, they will be included in the\r\n     * list, if they are found in the recurrence set.\r\n     * @return Array\r\n     */\r\n    between: function(after, before, inc, iterator) {\r\n        var args = {\r\n                before: before,\r\n                after: after,\r\n                inc: inc\r\n            }\r\n\r\n        if (iterator) {\r\n            return this._iter(\r\n                new CallbackIterResult('between', args, iterator));\r\n        } else {\r\n            var result = this._cacheGet('between', args);\r\n            if (result === false) {\r\n                result = this._iter(new IterResult('between', args));\r\n                this._cacheAdd('between', result, args);\r\n            }\r\n            return result;\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Returns the last recurrence before the given datetime instance.\r\n     * The inc keyword defines what happens if dt is an occurrence.\r\n     * With inc == True, if dt itself is an occurrence, it will be returned.\r\n     * @return Date or null\r\n     */\r\n    before: function(dt, inc) {\r\n        var args = {\r\n                dt: dt,\r\n                inc: inc\r\n            },\r\n            result = this._cacheGet('before', args);\r\n        if (result === false) {\r\n            result = this._iter(new IterResult('before', args));\r\n            this._cacheAdd('before', result, args);\r\n        }\r\n        return result;\r\n    },\r\n\r\n    /**\r\n     * Returns the first recurrence after the given datetime instance.\r\n     * The inc keyword defines what happens if dt is an occurrence.\r\n     * With inc == True, if dt itself is an occurrence, it will be returned.\r\n     * @return Date or null\r\n     */\r\n    after: function(dt, inc) {\r\n        var args = {\r\n                dt: dt,\r\n                inc: inc\r\n            },\r\n            result = this._cacheGet('after', args);\r\n        if (result === false) {\r\n            result = this._iter(new IterResult('after', args));\r\n            this._cacheAdd('after', result, args);\r\n        }\r\n        return result;\r\n    },\r\n\r\n    /**\r\n     * Returns the number of recurrences in this set. It will have go trough\r\n     * the whole recurrence, if this hasn't been done before.\r\n     */\r\n    count: function() {\r\n        return this.all().length;\r\n    },\r\n\r\n    /**\r\n     * Converts the rrule into its string representation\r\n     * @see <http://www.ietf.org/rfc/rfc2445.txt>\r\n     * @return String\r\n     */\r\n    toString: function() {\r\n        return RRule.optionsToString(this.origOptions);\r\n    },\r\n\r\n\t/**\r\n\t* Will convert all rules described in nlp:ToText\r\n\t* to text.\r\n\t*/\r\n\ttoText: function(gettext, language) {\r\n        return getnlp().toText(this, gettext, language);\r\n\t},\r\n\r\n    isFullyConvertibleToText: function() {\r\n        return getnlp().isFullyConvertible(this)\r\n    },\r\n\r\n    /**\r\n     * @param {String} what - all/before/after/between\r\n     * @param {Array,Date} value - an array of dates, one date, or null\r\n     * @param {Object?} args - _iter arguments\r\n     */\r\n    _cacheAdd: function(what, value, args) {\r\n\r\n        if (!this._cache) return;\r\n\r\n        if (value) {\r\n            value = (value instanceof Date)\r\n                        ? dateutil.clone(value)\r\n                        : dateutil.cloneDates(value);\r\n        }\r\n\r\n        if (what == 'all') {\r\n                this._cache.all = value;\r\n        } else {\r\n            args._value = value;\r\n            this._cache[what].push(args);\r\n        }\r\n\r\n    },\r\n\r\n    /**\r\n     * @return false - not in the cache\r\n     *         null  - cached, but zero occurrences (before/after)\r\n     *         Date  - cached (before/after)\r\n     *         []    - cached, but zero occurrences (all/between)\r\n     *         [Date1, DateN] - cached (all/between)\r\n     */\r\n    _cacheGet: function(what, args) {\r\n\r\n        if (!this._cache) {\r\n            return false;\r\n        }\r\n\r\n        var cached = false;\r\n\r\n        if (what == 'all') {\r\n            cached = this._cache.all;\r\n        } else {\r\n            // Let's see whether we've already called the\r\n            // 'what' method with the same 'args'\r\n            loopItems:\r\n            for (var item, i = 0; i < this._cache[what].length; i++) {\r\n                item = this._cache[what][i];\r\n                for (var k in args) {\r\n                    if (args.hasOwnProperty(k)\r\n                        && String(args[k]) != String(item[k])) {\r\n                        continue loopItems;\r\n                    }\r\n                }\r\n                cached = item._value;\r\n                break;\r\n            }\r\n        }\r\n\r\n        if (!cached && this._cache.all) {\r\n            // Not in the cache, but we already know all the occurrences,\r\n            // so we can find the correct dates from the cached ones.\r\n            var iterResult = new IterResult(what, args);\r\n            for (var i = 0; i < this._cache.all.length; i++) {\r\n                if (!iterResult.accept(this._cache.all[i])) {\r\n                    break;\r\n                }\r\n            }\r\n            cached = iterResult.getValue();\r\n            this._cacheAdd(what, cached, args);\r\n        }\r\n\r\n        return cached instanceof Array\r\n            ? dateutil.cloneDates(cached)\r\n            : (cached instanceof Date\r\n                ? dateutil.clone(cached)\r\n                : cached);\r\n    },\r\n\r\n    /**\r\n     * @return a RRule instance with the same freq and options\r\n     *          as this one (cache is not cloned)\r\n     */\r\n    clone: function() {\r\n        return new RRule(this.origOptions);\r\n    },\r\n\r\n    _iter: function(iterResult) {\r\n\r\n        /* Since JavaScript doesn't have the python's yield operator (<1.7),\r\n           we use the IterResult object that tells us when to stop iterating.\r\n\r\n        */\r\n\r\n        var dtstart = this.options.dtstart;\r\n\r\n        var\r\n            year = dtstart.getFullYear(),\r\n            month = dtstart.getMonth() + 1,\r\n            day = dtstart.getDate(),\r\n            hour = dtstart.getHours(),\r\n            minute = dtstart.getMinutes(),\r\n            second = dtstart.getSeconds(),\r\n            weekday = dateutil.getWeekday(dtstart),\r\n            yearday = dateutil.getYearDay(dtstart);\r\n\r\n        // Some local variables to speed things up a bit\r\n        var\r\n            freq = this.options.freq,\r\n            interval = this.options.interval,\r\n            wkst = this.options.wkst,\r\n            until = this.options.until,\r\n            bymonth = this.options.bymonth,\r\n            byweekno = this.options.byweekno,\r\n            byyearday = this.options.byyearday,\r\n            byweekday = this.options.byweekday,\r\n            byeaster = this.options.byeaster,\r\n            bymonthday = this.options.bymonthday,\r\n            bynmonthday = this.options.bynmonthday,\r\n            bysetpos = this.options.bysetpos,\r\n            byhour = this.options.byhour,\r\n            byminute = this.options.byminute,\r\n            bysecond = this.options.bysecond;\r\n\r\n        var ii = new Iterinfo(this);\r\n        ii.rebuild(year, month);\r\n\r\n        var getdayset = {};\r\n        getdayset[RRule.YEARLY]   = ii.ydayset;\r\n        getdayset[RRule.MONTHLY]  = ii.mdayset;\r\n        getdayset[RRule.WEEKLY]   = ii.wdayset;\r\n        getdayset[RRule.DAILY]    = ii.ddayset;\r\n        getdayset[RRule.HOURLY]   = ii.ddayset;\r\n        getdayset[RRule.MINUTELY] = ii.ddayset;\r\n        getdayset[RRule.SECONDLY] = ii.ddayset;\r\n\r\n        getdayset = getdayset[freq];\r\n\r\n        var timeset;\r\n        if (freq < RRule.HOURLY) {\r\n            timeset = this.timeset;\r\n        } else {\r\n            var gettimeset = {};\r\n            gettimeset[RRule.HOURLY]   = ii.htimeset;\r\n            gettimeset[RRule.MINUTELY] = ii.mtimeset;\r\n            gettimeset[RRule.SECONDLY] = ii.stimeset;\r\n            gettimeset = gettimeset[freq];\r\n            if ((freq >= RRule.HOURLY   && plb(byhour)   && !contains(byhour, hour)) ||\r\n                (freq >= RRule.MINUTELY && plb(byminute) && !contains(byminute, minute)) ||\r\n                (freq >= RRule.SECONDLY && plb(bysecond) && !contains(bysecond, minute)))\r\n            {\r\n                timeset = [];\r\n            } else {\r\n                timeset = gettimeset.call(ii, hour, minute, second);\r\n            }\r\n        }\r\n\r\n        var filtered, total = 0, count = this.options.count;\r\n\r\n        var iterNo = 0;\r\n\r\n        var i, j, k, dm, div, mod, tmp, pos, dayset, start, end, fixday;\r\n\r\n        while (true) {\r\n\r\n            // Get dayset with the right frequency\r\n            tmp = getdayset.call(ii, year, month, day);\r\n            dayset = tmp[0]; start = tmp[1]; end = tmp[2];\r\n\r\n            // Do the \"hard\" work ;-)\r\n            filtered = false;\r\n            for (j = start; j < end; j++) {\r\n\r\n                i = dayset[j];\r\n\r\n                if ((plb(bymonth) && !contains(bymonth, ii.mmask[i])) ||\r\n                    (plb(byweekno) && !ii.wnomask[i]) ||\r\n                    (plb(byweekday) && !contains(byweekday, ii.wdaymask[i])) ||\r\n                    (plb(ii.nwdaymask) && !ii.nwdaymask[i]) ||\r\n                    (byeaster !== null && !contains(ii.eastermask, i)) ||\r\n                    (\r\n                        (plb(bymonthday) || plb(bynmonthday)) &&\r\n                        !contains(bymonthday, ii.mdaymask[i]) &&\r\n                        !contains(bynmonthday, ii.nmdaymask[i])\r\n                    )\r\n                    ||\r\n                    (\r\n                        plb(byyearday)\r\n                        &&\r\n                        (\r\n                            (\r\n                                i < ii.yearlen &&\r\n                                !contains(byyearday, i + 1) &&\r\n                                !contains(byyearday, -ii.yearlen + i)\r\n                            )\r\n                            ||\r\n                            (\r\n                                i >= ii.yearlen &&\r\n                                !contains(byyearday, i + 1 - ii.yearlen) &&\r\n                                !contains(byyearday, -ii.nextyearlen + i - ii.yearlen)\r\n                            )\r\n                        )\r\n                    )\r\n                )\r\n                {\r\n                    dayset[i] = null;\r\n                    filtered = true;\r\n                }\r\n            }\r\n\r\n            // Output results\r\n            if (plb(bysetpos) && plb(timeset)) {\r\n\r\n                var daypos, timepos, poslist = [];\r\n\r\n                for (i, j = 0; j < bysetpos.length; j++) {\r\n                    var pos = bysetpos[j];\r\n                    if (pos < 0) {\r\n                        daypos = Math.floor(pos / timeset.length);\r\n                        timepos = pymod(pos, timeset.length);\r\n                    } else {\r\n                        daypos = Math.floor((pos - 1) / timeset.length);\r\n                        timepos = pymod((pos - 1), timeset.length);\r\n                    }\r\n\r\n                    try {\r\n                        tmp = [];\r\n                        for (k = start; k < end; k++) {\r\n                            var val = dayset[k];\r\n                            if (val === null) {\r\n                                continue;\r\n                            }\r\n                            tmp.push(val);\r\n                        }\r\n                        if (daypos < 0) {\r\n                            // we're trying to emulate python's aList[-n]\r\n                            i = tmp.slice(daypos)[0];\r\n                        } else {\r\n                            i = tmp[daypos];\r\n                        }\r\n\r\n                        var time = timeset[timepos];\r\n\r\n                        var date = dateutil.fromOrdinal(ii.yearordinal + i);\r\n                        var res = dateutil.combine(date, time);\r\n                        // XXX: can this ever be in the array?\r\n                        // - compare the actual date instead?\r\n                        if (!contains(poslist, res)) {\r\n                            poslist.push(res);\r\n                        }\r\n                    } catch (e) {}\r\n                }\r\n\r\n                dateutil.sort(poslist);\r\n\r\n                for (j = 0; j < poslist.length; j++) {\r\n                    var res = poslist[j];\r\n                    if (until && res > until) {\r\n                        this._len = total;\r\n                        return iterResult.getValue();\r\n                    } else if (res >= dtstart) {\r\n                        ++total;\r\n                        if (!iterResult.accept(res)) {\r\n                            return iterResult.getValue();\r\n                        }\r\n                        if (count) {\r\n                            --count;\r\n                            if (!count) {\r\n                                this._len = total;\r\n                                return iterResult.getValue();\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n\r\n            } else {\r\n                for (j = start; j < end; j++) {\r\n                    i = dayset[j];\r\n                    if (i !== null) {\r\n                        var date = dateutil.fromOrdinal(ii.yearordinal + i);\r\n                        for (k = 0; k < timeset.length; k++) {\r\n                            var time = timeset[k];\r\n                            var res = dateutil.combine(date, time);\r\n                            if (until && res > until) {\r\n                                this._len = total;\r\n                                return iterResult.getValue();\r\n                            } else if (res >= dtstart) {\r\n                                ++total;\r\n                                if (!iterResult.accept(res)) {\r\n                                    return iterResult.getValue();\r\n                                }\r\n                                if (count) {\r\n                                    --count;\r\n                                    if (!count) {\r\n                                        this._len = total;\r\n                                        return iterResult.getValue();\r\n                                    }\r\n                                }\r\n                            }\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            // Handle frequency and interval\r\n            fixday = false;\r\n            if (freq == RRule.YEARLY) {\r\n                year += interval;\r\n                if (year > dateutil.MAXYEAR) {\r\n                    this._len = total;\r\n                    return iterResult.getValue();\r\n                }\r\n                ii.rebuild(year, month);\r\n            } else if (freq == RRule.MONTHLY) {\r\n                month += interval;\r\n                if (month > 12) {\r\n                    div = Math.floor(month / 12);\r\n                    mod = pymod(month, 12);\r\n                    month = mod;\r\n                    year += div;\r\n                    if (month == 0) {\r\n                        month = 12;\r\n                        --year;\r\n                    }\r\n                    if (year > dateutil.MAXYEAR) {\r\n                        this._len = total;\r\n                        return iterResult.getValue();\r\n                    }\r\n                }\r\n                ii.rebuild(year, month);\r\n            } else if (freq == RRule.WEEKLY) {\r\n                if (wkst > weekday) {\r\n                    day += -(weekday + 1 + (6 - wkst)) + interval * 7;\r\n                } else {\r\n                    day += -(weekday - wkst) + interval * 7;\r\n                }\r\n                weekday = wkst;\r\n                fixday = true;\r\n            } else if (freq == RRule.DAILY) {\r\n                day += interval;\r\n                fixday = true;\r\n            } else if (freq == RRule.HOURLY) {\r\n                if (filtered) {\r\n                    // Jump to one iteration before next day\r\n                    hour += Math.floor((23 - hour) / interval) * interval;\r\n                }\r\n                while (true) {\r\n                    hour += interval;\r\n                    dm = divmod(hour, 24);\r\n                    div = dm.div;\r\n                    mod = dm.mod;\r\n                    if (div) {\r\n                        hour = mod;\r\n                        day += div;\r\n                        fixday = true;\r\n                    }\r\n                    if (!plb(byhour) || contains(byhour, hour)) {\r\n                        break;\r\n                    }\r\n                }\r\n                timeset = gettimeset.call(ii, hour, minute, second);\r\n            } else if (freq == RRule.MINUTELY) {\r\n                if (filtered) {\r\n                    // Jump to one iteration before next day\r\n                    minute += Math.floor(\r\n                        (1439 - (hour * 60 + minute)) / interval) * interval;\r\n                }\r\n                while(true) {\r\n                    minute += interval;\r\n                    dm = divmod(minute, 60);\r\n                    div = dm.div;\r\n                    mod = dm.mod;\r\n                    if (div) {\r\n                        minute = mod;\r\n                        hour += div;\r\n                        dm = divmod(hour, 24);\r\n                        div = dm.div;\r\n                        mod = dm.mod;\r\n                        if (div) {\r\n                            hour = mod;\r\n                            day += div;\r\n                            fixday = true;\r\n                            filtered = false;\r\n                        }\r\n                    }\r\n                    if ((!plb(byhour) || contains(byhour, hour)) &&\r\n                        (!plb(byminute) || contains(byminute, minute))) {\r\n                        break;\r\n                    }\r\n                }\r\n                timeset = gettimeset.call(ii, hour, minute, second);\r\n            } else if (freq == RRule.SECONDLY) {\r\n                if (filtered) {\r\n                    // Jump to one iteration before next day\r\n                    second += Math.floor(\r\n                        (86399 - (hour * 3600 + minute * 60 + second))\r\n                        / interval) * interval;\r\n                }\r\n                while (true) {\r\n                    second += interval;\r\n                    dm = divmod(second, 60);\r\n                    div = dm.div;\r\n                    mod = dm.mod;\r\n                    if (div) {\r\n                        second = mod;\r\n                        minute += div;\r\n                        dm = divmod(minute, 60);\r\n                        div = dm.div;\r\n                        mod = dm.mod;\r\n                        if (div) {\r\n                            minute = mod;\r\n                            hour += div;\r\n                            dm = divmod(hour, 24);\r\n                            div = dm.div;\r\n                            mod = dm.mod;\r\n                            if (div) {\r\n                                hour = mod;\r\n                                day += div;\r\n                                fixday = true;\r\n                            }\r\n                        }\r\n                    }\r\n                    if ((!plb(byhour) || contains(byhour, hour)) &&\r\n                        (!plb(byminute) || contains(byminute, minute)) &&\r\n                        (!plb(bysecond) || contains(bysecond, second)))\r\n                    {\r\n                        break;\r\n                    }\r\n                }\r\n                timeset = gettimeset.call(ii, hour, minute, second);\r\n            }\r\n\r\n            if (fixday && day > 28) {\r\n                var daysinmonth = dateutil.monthRange(year, month - 1)[1];\r\n                if (day > daysinmonth) {\r\n                    while (day > daysinmonth) {\r\n                        day -= daysinmonth;\r\n                        ++month;\r\n                        if (month == 13) {\r\n                            month = 1;\r\n                            ++year;\r\n                            if (year > dateutil.MAXYEAR) {\r\n                                this._len = total;\r\n                                return iterResult.getValue();\r\n                            }\r\n                        }\r\n                        daysinmonth = dateutil.monthRange(year, month - 1)[1];\r\n                    }\r\n                    ii.rebuild(year, month);\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n};\r\n\r\n\r\nRRule.parseString = function(rfcString) {\r\n    rfcString = rfcString.replace(/^\\s+|\\s+$/, '');\r\n    if (!rfcString.length) {\r\n        return null;\r\n    }\r\n\r\n    var i, j, key, value, attr,\r\n        attrs = rfcString.split(';'),\r\n        options = {};\r\n\r\n    for (i = 0; i < attrs.length; i++) {\r\n        attr = attrs[i].split('=');\r\n        key = attr[0];\r\n        value = attr[1];\r\n        switch (key) {\r\n            case 'FREQ':\r\n                options.freq = RRule[value];\r\n                break;\r\n            case 'WKST':\r\n                options.wkst = RRule[value];\r\n                break;\r\n            case 'COUNT':\r\n            case 'INTERVAL':\r\n            case 'BYSETPOS':\r\n            case 'BYMONTH':\r\n            case 'BYMONTHDAY':\r\n            case 'BYYEARDAY':\r\n            case 'BYWEEKNO':\r\n            case 'BYHOUR':\r\n            case 'BYMINUTE':\r\n            case 'BYSECOND':\r\n                if (value.indexOf(',') != -1) {\r\n                    value = value.split(',');\r\n                    for (j = 0; j < value.length; j++) {\r\n                        if (/^[+-]?\\d+$/.test(value[j])) {\r\n                            value[j] = Number(value[j]);\r\n                        }\r\n                    }\r\n                } else if (/^[+-]?\\d+$/.test(value)) {\r\n                    value = Number(value);\r\n                }\r\n                key = key.toLowerCase();\r\n                options[key] = value;\r\n                break;\r\n            case 'BYDAY': // => byweekday\r\n                var n, wday, day, days = value.split(',');\r\n                options.byweekday = [];\r\n                for (j = 0; j < days.length; j++) {\r\n                    day = days[j];\r\n                    if (day.length == 2) { // MO, TU, ...\r\n                        wday = RRule[day]; // wday instanceof Weekday\r\n                        options.byweekday.push(wday);\r\n                    } else { // -1MO, +3FR, 1SO, ...\r\n                        day = day.match(/^([+-]?\\d)([A-Z]{2})$/);\r\n                        n = Number(day[1]);\r\n                        wday = day[2];\r\n                        wday = RRule[wday].weekday;\r\n                        options.byweekday.push(new Weekday(wday, n));\r\n                    }\r\n                }\r\n                break;\r\n            case 'DTSTART':\r\n                options.dtstart = dateutil.untilStringToDate(value);\r\n                break;\r\n            case 'UNTIL':\r\n                options.until = dateutil.untilStringToDate(value);\r\n                break;\r\n            case 'BYEASTER':\r\n                options.byeaster = Number(value);\r\n                break;\r\n            default:\r\n                throw new Error(\"Unknown RRULE property '\" + key + \"'\");\r\n        }\r\n    }\r\n    return options;\r\n};\r\n\r\n\r\nRRule.fromString = function(string) {\r\n    return new RRule(RRule.parseString(string));\r\n};\r\n\r\n\r\n//=============================================================================\r\n// Iterinfo\r\n//=============================================================================\r\n\r\nvar Iterinfo = function(rrule) {\r\n    this.rrule = rrule;\r\n    this.lastyear = null;\r\n    this.lastmonth = null;\r\n    this.yearlen = null;\r\n    this.nextyearlen = null;\r\n    this.yearordinal = null;\r\n    this.yearweekday = null;\r\n    this.mmask = null;\r\n    this.mrange = null;\r\n    this.mdaymask = null;\r\n    this.nmdaymask = null;\r\n    this.wdaymask = null;\r\n    this.wnomask = null;\r\n    this.nwdaymask = null;\r\n    this.eastermask = null;\r\n};\r\n\r\nIterinfo.prototype.easter = function(y, offset) {\r\n    offset = offset || 0;\r\n\r\n    var a = y % 19,\r\n        b = Math.floor(y / 100),\r\n        c = y % 100,\r\n        d = Math.floor(b / 4),\r\n        e = b % 4,\r\n        f = Math.floor((b + 8) / 25),\r\n        g = Math.floor((b - f + 1) / 3),\r\n        h = Math.floor(19 * a + b - d - g + 15) % 30,\r\n        i = Math.floor(c / 4),\r\n        k = c % 4,\r\n        l = Math.floor(32 + 2 * e + 2 * i - h - k) % 7,\r\n        m = Math.floor((a + 11 * h + 22 * l) / 451),\r\n        month = Math.floor((h + l - 7 * m + 114) / 31),\r\n        day = (h + l - 7 * m + 114) % 31 + 1,\r\n        date = Date.UTC(y, month - 1, day + offset),\r\n        yearStart = Date.UTC(y, 0, 1);\r\n\r\n    return [ Math.ceil((date - yearStart) / (1000 * 60 * 60 * 24)) ];\r\n}\r\n\r\nIterinfo.prototype.rebuild = function(year, month) {\r\n\r\n    var rr = this.rrule;\r\n\r\n    if (year != this.lastyear) {\r\n\r\n        this.yearlen = dateutil.isLeapYear(year) ? 366 : 365;\r\n        this.nextyearlen = dateutil.isLeapYear(year + 1) ? 366 : 365;\r\n        var firstyday = new Date(year, 0, 1);\r\n\r\n        this.yearordinal = dateutil.toOrdinal(firstyday);\r\n        this.yearweekday = dateutil.getWeekday(firstyday);\r\n\r\n        var wday = dateutil.getWeekday(new Date(year, 0, 1));\r\n\r\n        if (this.yearlen == 365) {\r\n            this.mmask = [].concat(M365MASK);\r\n            this.mdaymask = [].concat(MDAY365MASK);\r\n            this.nmdaymask = [].concat(NMDAY365MASK);\r\n            this.wdaymask = WDAYMASK.slice(wday);\r\n            this.mrange = [].concat(M365RANGE);\r\n        } else {\r\n            this.mmask = [].concat(M366MASK);\r\n            this.mdaymask = [].concat(MDAY366MASK);\r\n            this.nmdaymask = [].concat(NMDAY366MASK);\r\n            this.wdaymask = WDAYMASK.slice(wday);\r\n            this.mrange = [].concat(M366RANGE);\r\n        }\r\n\r\n        if (!plb(rr.options.byweekno)) {\r\n            this.wnomask = null;\r\n        } else {\r\n            this.wnomask = repeat(0, this.yearlen + 7);\r\n            var no1wkst, firstwkst, wyearlen;\r\n            no1wkst = firstwkst = pymod(\r\n                7 - this.yearweekday + rr.options.wkst, 7);\r\n            if (no1wkst >= 4) {\r\n                no1wkst = 0;\r\n                // Number of days in the year, plus the days we got\r\n                // from last year.\r\n                wyearlen = this.yearlen + pymod(\r\n                    this.yearweekday - rr.options.wkst, 7);\r\n            } else {\r\n                // Number of days in the year, minus the days we\r\n                // left in last year.\r\n                wyearlen = this.yearlen - no1wkst;\r\n            }\r\n            var div = Math.floor(wyearlen / 7);\r\n            var mod = pymod(wyearlen, 7);\r\n            var numweeks = Math.floor(div + (mod / 4));\r\n            for (var n, i, j = 0; j < rr.options.byweekno.length; j++) {\r\n                n = rr.options.byweekno[j];\r\n                if (n < 0) {\r\n                    n += numweeks + 1;\r\n                } if (!(0 < n && n <= numweeks)) {\r\n                    continue;\r\n                } if (n > 1) {\r\n                    i = no1wkst + (n - 1) * 7;\r\n                    if (no1wkst != firstwkst) {\r\n                        i -= 7-firstwkst;\r\n                    }\r\n                } else {\r\n                    i = no1wkst;\r\n                }\r\n                for (var k = 0; k < 7; k++) {\r\n                    this.wnomask[i] = 1;\r\n                    i++;\r\n                    if (this.wdaymask[i] == rr.options.wkst) {\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (contains(rr.options.byweekno, 1)) {\r\n                // Check week number 1 of next year as well\r\n                // orig-TODO : Check -numweeks for next year.\r\n                var i = no1wkst + numweeks * 7;\r\n                if (no1wkst != firstwkst) {\r\n                    i -= 7 - firstwkst;\r\n                }\r\n                if (i < this.yearlen) {\r\n                    // If week starts in next year, we\r\n                    // don't care about it.\r\n                    for (var j = 0; j < 7; j++) {\r\n                        this.wnomask[i] = 1;\r\n                        i += 1;\r\n                        if (this.wdaymask[i] == rr.options.wkst) {\r\n                            break;\r\n                        }\r\n                    }\r\n                }\r\n            }\r\n\r\n            if (no1wkst) {\r\n                // Check last week number of last year as\r\n                // well. If no1wkst is 0, either the year\r\n                // started on week start, or week number 1\r\n                // got days from last year, so there are no\r\n                // days from last year's last week number in\r\n                // this year.\r\n                var lnumweeks;\r\n                if (!contains(rr.options.byweekno, -1)) {\r\n                    var lyearweekday = dateutil.getWeekday(\r\n                        new Date(year - 1, 0, 1));\r\n                    var lno1wkst = pymod(\r\n                        7 - lyearweekday + rr.options.wkst, 7);\r\n                    var lyearlen = dateutil.isLeapYear(year - 1) ? 366 : 365;\r\n                    if (lno1wkst >= 4) {\r\n                        lno1wkst = 0;\r\n                        lnumweeks = Math.floor(\r\n                            52\r\n                            + pymod(\r\n                                lyearlen + pymod(\r\n                                    lyearweekday - rr.options.wkst, 7), 7)\r\n                            / 4);\r\n                    } else {\r\n                        lnumweeks = Math.floor(\r\n                            52 + pymod(this.yearlen - no1wkst, 7) / 4);\r\n                    }\r\n                } else {\r\n                    lnumweeks = -1;\r\n                }\r\n                if (contains(rr.options.byweekno, lnumweeks)) {\r\n                    for (var i = 0; i < no1wkst; i++) {\r\n                        this.wnomask[i] = 1;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n    }\r\n\r\n    if (plb(rr.options.bynweekday)\r\n        && (month != this.lastmonth || year != this.lastyear)) {\r\n        var ranges = [];\r\n        if (rr.options.freq == RRule.YEARLY) {\r\n            if (plb(rr.options.bymonth)) {\r\n                for (j = 0; j < rr.options.bymonth.length; j++) {\r\n                    month = rr.options.bymonth[j];\r\n                    ranges.push(this.mrange.slice(month - 1, month + 1));\r\n                }\r\n            } else {\r\n                ranges = [[0, this.yearlen]];\r\n            }\r\n        } else if (rr.options.freq == RRule.MONTHLY) {\r\n            ranges = [this.mrange.slice(month - 1, month + 1)];\r\n        }\r\n        if (plb(ranges)) {\r\n            // Weekly frequency won't get here, so we may not\r\n            // care about cross-year weekly periods.\r\n            this.nwdaymask = repeat(0, this.yearlen);\r\n\r\n            for (var j = 0; j < ranges.length; j++) {\r\n                var rang = ranges[j];\r\n                var first = rang[0], last = rang[1];\r\n                last -= 1;\r\n                for (var k = 0; k < rr.options.bynweekday.length; k++) {\r\n                    var wday = rr.options.bynweekday[k][0],\r\n                        n = rr.options.bynweekday[k][1];\r\n                    if (n < 0) {\r\n                        i = last + (n + 1) * 7;\r\n                        i -= pymod(this.wdaymask[i] - wday, 7);\r\n                    } else {\r\n                        i = first + (n - 1) * 7;\r\n                        i += pymod(7 - this.wdaymask[i] + wday, 7);\r\n                    }\r\n                    if (first <= i && i <= last) {\r\n                        this.nwdaymask[i] = 1;\r\n                    }\r\n                }\r\n            }\r\n\r\n        }\r\n\r\n        this.lastyear = year;\r\n        this.lastmonth = month;\r\n    }\r\n\r\n    if (rr.options.byeaster !== null) {\r\n        this.eastermask = this.easter(year, rr.options.byeaster);\r\n    }\r\n};\r\n\r\nIterinfo.prototype.ydayset = function(year, month, day) {\r\n    return [range(this.yearlen), 0, this.yearlen];\r\n};\r\n\r\nIterinfo.prototype.mdayset = function(year, month, day) {\r\n    var set = repeat(null, this.yearlen);\r\n    var start = this.mrange[month-1];\r\n    var end = this.mrange[month];\r\n    for (var i = start; i < end; i++) {\r\n        set[i] = i;\r\n    }\r\n    return [set, start, end];\r\n};\r\n\r\nIterinfo.prototype.wdayset = function(year, month, day) {\r\n\r\n    // We need to handle cross-year weeks here.\r\n    var set = repeat(null, this.yearlen + 7);\r\n    var i = dateutil.toOrdinal(\r\n        new Date(year, month - 1, day)) - this.yearordinal;\r\n    var start = i;\r\n    for (var j = 0; j < 7; j++) {\r\n        set[i] = i;\r\n        ++i;\r\n        if (this.wdaymask[i] == this.rrule.options.wkst) {\r\n            break;\r\n        }\r\n    }\r\n    return [set, start, i];\r\n};\r\n\r\nIterinfo.prototype.ddayset = function(year, month, day) {\r\n    var set = repeat(null, this.yearlen);\r\n    var i = dateutil.toOrdinal(\r\n        new Date(year, month - 1, day)) - this.yearordinal;\r\n    set[i] = i;\r\n    return [set, i, i + 1];\r\n};\r\n\r\nIterinfo.prototype.htimeset = function(hour, minute, second) {\r\n    var set = [], rr = this.rrule;\r\n    for (var i = 0; i < rr.options.byminute.length; i++) {\r\n        minute = rr.options.byminute[i];\r\n        for (var j = 0; j < rr.options.bysecond.length; j++) {\r\n            second = rr.options.bysecond[j];\r\n            set.push(new dateutil.Time(hour, minute, second));\r\n        }\r\n    }\r\n    dateutil.sort(set);\r\n    return set;\r\n};\r\n\r\nIterinfo.prototype.mtimeset = function(hour, minute, second) {\r\n    var set = [], rr = this.rrule;\r\n    for (var j = 0; j < rr.options.bysecond.length; j++) {\r\n        second = rr.options.bysecond[j];\r\n        set.push(new dateutil.Time(hour, minute, second));\r\n    }\r\n    dateutil.sort(set);\r\n    return set;\r\n};\r\n\r\nIterinfo.prototype.stimeset = function(hour, minute, second) {\r\n    return [new dateutil.Time(hour, minute, second)];\r\n};\r\n\r\n\r\n//=============================================================================\r\n// Results\r\n//=============================================================================\r\n\r\n/**\r\n * This class helps us to emulate python's generators, sorta.\r\n */\r\nvar IterResult = function(method, args) {\r\n    this.init(method, args)\r\n};\r\n\r\nIterResult.prototype = {\r\n\r\n    init: function(method, args) {\r\n        this.method = method;\r\n        this.args = args;\r\n\r\n        this._result = [];\r\n\r\n        this.minDate = null;\r\n        this.maxDate = null;\r\n\r\n        if (method == 'between') {\r\n            this.maxDate = args.inc\r\n                ? args.before\r\n                : new Date(args.before.getTime() - 1);\r\n            this.minDate = args.inc\r\n                ? args.after\r\n                : new Date(args.after.getTime() + 1);\r\n        } else if (method == 'before') {\r\n            this.maxDate = args.inc ? args.dt : new Date(args.dt.getTime() - 1);\r\n        } else if (method == 'after') {\r\n            this.minDate = args.inc ? args.dt : new Date(args.dt.getTime() + 1);\r\n        }\r\n    },\r\n\r\n    /**\r\n     * Possibly adds a date into the result.\r\n     *\r\n     * @param {Date} date - the date isn't necessarly added to the result\r\n     *                      list (if it is too late/too early)\r\n     * @return {Boolean} true if it makes sense to continue the iteration;\r\n     *                   false if we're done.\r\n     */\r\n    accept: function(date) {\r\n        var tooEarly = this.minDate && date < this.minDate,\r\n            tooLate = this.maxDate && date > this.maxDate;\r\n\r\n        if (this.method == 'between') {\r\n            if (tooEarly)\r\n                return true;\r\n            if (tooLate)\r\n                return false;\r\n        } else if (this.method == 'before') {\r\n            if (tooLate)\r\n                return false;\r\n        } else if (this.method == 'after') {\r\n            if (tooEarly)\r\n                return true;\r\n            this.add(date);\r\n            return false;\r\n        }\r\n\r\n        return this.add(date);\r\n\r\n    },\r\n\r\n    /**\r\n     *\r\n     * @param {Date} date that is part of the result.\r\n     * @return {Boolean} whether we are interested in more values.\r\n     */\r\n    add: function(date) {\r\n        this._result.push(date);\r\n        return true;\r\n    },\r\n\r\n    /**\r\n     * 'before' and 'after' return only one date, whereas 'all'\r\n     * and 'between' an array.\r\n     * @return {Date,Array?}\r\n     */\r\n    getValue: function() {\r\n        switch (this.method) {\r\n            case 'all':\r\n            case 'between':\r\n                return this._result;\r\n            case 'before':\r\n            case 'after':\r\n                return this._result.length\r\n                    ? this._result[this._result.length - 1]\r\n                    : null;\r\n        }\r\n    }\r\n\r\n};\r\n\r\n\r\n/**\r\n * IterResult subclass that calls a callback function on each add,\r\n * and stops iterating when the callback returns false.\r\n */\r\nvar CallbackIterResult = function(method, args, iterator) {\r\n    var allowedMethods = ['all', 'between'];\r\n    if (!contains(allowedMethods, method)) {\r\n        throw new Error('Invalid method \"' + method\r\n            + '\". Only all and between works with iterator.');\r\n    }\r\n    this.add = function(date) {\r\n        if (iterator(date, this._result.length)) {\r\n            this._result.push(date);\r\n            return true;\r\n        }\r\n        return false;\r\n\r\n    };\r\n\r\n    this.init(method, args);\r\n\r\n};\r\nCallbackIterResult.prototype = IterResult.prototype;\r\n\r\n\r\n//=============================================================================\r\n// Export\r\n//=============================================================================\r\n\r\nif (serverSide) {\r\n    module.exports = {\r\n        RRule: RRule\r\n        // rruleset: rruleset\r\n    }\r\n}\r\nif (typeof ender === 'undefined') {\r\n    root['RRule'] = RRule;\r\n    // root['rruleset'] = rruleset;\r\n}\r\n\r\nif (typeof define === \"function\" && define.amd) {\r\n    /*global define:false */\r\n    define(\"rrule\", [], function () {\r\n        return RRule;\r\n    });\r\n}\r\n\r\n}(this));\r\n\ndefine(\"taoDeliverySchedule/lib/rrule/rrule\", function(){});\n\n","/*!\r\n * rrule.js - Library for working with recurrence rules for calendar dates.\r\n * https://github.com/jakubroztocil/rrule\r\n *\r\n * Copyright 2010, Jakub Roztocil and Lars Schoning\r\n * Licenced under the BSD licence.\r\n * https://github.com/jakubroztocil/rrule/blob/master/LICENCE\r\n *\r\n */\r\n\r\n/**\r\n *\r\n * Implementation of RRule.fromText() and RRule::toText().\r\n *\r\n *\r\n * On the client side, this file needs to be included\r\n * when those functions are used.\r\n *\r\n */\r\n(function (root){\r\n\r\n\r\nvar serverSide = typeof module !== 'undefined' && module.exports;\r\nvar RRule;\r\n\r\n\r\nif (serverSide) {\r\n    RRule = require('./rrule').RRule;\r\n} else if (root.RRule) {\r\n    RRule = root.RRule;\r\n} else if (typeof require !== 'undefined') {\r\n    if (!RRule) {RRule = require('rrule');}\r\n} else {\r\n    throw new Error('rrule.js is required for rrule/nlp.js to work')\r\n}\r\n\r\n\r\n//=============================================================================\r\n// Helper functions\r\n//=============================================================================\r\n\r\n/**\r\n * Return true if a value is in an array\r\n */\r\nvar contains = function(arr, val) {\r\n    return arr.indexOf(val) != -1;\r\n};\r\n\r\n\r\n//=============================================================================\r\n// ToText\r\n//=============================================================================\r\n\r\n\r\n/**\r\n *\r\n * @param {RRule} rrule\r\n * Optional:\r\n * @param {Function} gettext function\r\n * @param {Object} language definition\r\n * @constructor\r\n */\r\nvar ToText = function(rrule, gettext, language) {\r\n\r\n    this.gettext = gettext || function(id) {return id};\r\n    this.language = language || ENGLISH;\r\n    this.text = '';\r\n\r\n    this.rrule = rrule;\r\n    this.freq = rrule.options.freq;\r\n    this.options = rrule.options;\r\n    this.origOptions = rrule.origOptions;\r\n\r\n    if (this.origOptions.bymonthday) {\r\n        var bymonthday = [].concat(this.options.bymonthday);\r\n        var bynmonthday = [].concat(this.options.bynmonthday);\r\n        bymonthday.sort();\r\n        bynmonthday.sort();\r\n        bynmonthday.reverse();\r\n        // 1, 2, 3, .., -5, -4, -3, ..\r\n        this.bymonthday = bymonthday.concat(bynmonthday);\r\n        if (!this.bymonthday.length) {\r\n            this.bymonthday = null;\r\n        }\r\n    }\r\n\r\n    if (this.origOptions.byweekday) {\r\n        var byweekday = !(this.origOptions.byweekday instanceof Array)\r\n                            ? [this.origOptions.byweekday]\r\n                            : this.origOptions.byweekday;\r\n        var days = String(byweekday);\r\n        this.byweekday = {\r\n            allWeeks:byweekday.filter(function (weekday) {\r\n                return !Boolean(weekday.n);\r\n            }),\r\n            someWeeks:byweekday.filter(function (weekday) {\r\n                return Boolean(weekday.n);\r\n            }),\r\n            isWeekdays:(\r\n                days.indexOf('MO') != -1 &&\r\n                    days.indexOf('TU') != -1 &&\r\n                    days.indexOf('WE') != -1 &&\r\n                    days.indexOf('TH') != -1 &&\r\n                    days.indexOf('FR') != -1 &&\r\n                    days.indexOf('SA') == -1 &&\r\n                    days.indexOf('SU') == -1\r\n                )\r\n        };\r\n\r\n\r\n        var sortWeekDays = function(a, b) {\r\n            return a.weekday - b.weekday;\r\n        };\r\n\r\n        this.byweekday.allWeeks.sort(sortWeekDays);\r\n        this.byweekday.someWeeks.sort(sortWeekDays);\r\n\r\n        if (!this.byweekday.allWeeks.length) {\r\n            this.byweekday.allWeeks = null;\r\n        }\r\n        if (!this.byweekday.someWeeks.length) {\r\n            this.byweekday.someWeeks = null;\r\n        }\r\n    }\r\n    else {\r\n        this.byweekday = null;\r\n    }\r\n\r\n};\r\n\r\n\r\nToText.IMPLEMENTED = [];\r\nvar common = [\r\n    'count', 'until', 'interval',\r\n    'byweekday', 'bymonthday', 'bymonth'\r\n];\r\nToText.IMPLEMENTED[RRule.DAILY]   = common;\r\nToText.IMPLEMENTED[RRule.WEEKLY]  = common;\r\nToText.IMPLEMENTED[RRule.MONTHLY] = common;\r\nToText.IMPLEMENTED[RRule.YEARLY]  = ['byweekno', 'byyearday'].concat(common);\r\n\r\n/**\r\n * Test whether the rrule can be fully converted to text.\r\n * @param {RRule} rrule\r\n * @return {Boolean}\r\n */\r\nToText.isFullyConvertible = function(rrule) {\r\n    var canConvert = true;\r\n\r\n    if (!(rrule.options.freq in ToText.IMPLEMENTED)) {\r\n        return false;\r\n    }\r\n    if (rrule.origOptions.until && rrule.origOptions.count) {\r\n        return false;\r\n    }\r\n    for (var key in rrule.origOptions) {\r\n        if (contains(['dtstart', 'wkst', 'freq'], key)) {\r\n            return true;\r\n        }\r\n        if (!contains(ToText.IMPLEMENTED[rrule.options.freq], key)) {\r\n            canConvert = false;\r\n            return false;\r\n        }\r\n    }\r\n\r\n    return canConvert;\r\n};\r\n\r\n\r\nToText.prototype = {\r\n\r\n\r\n    isFullyConvertible: function() {\r\n        return ToText.isFullyConvertible(this.rrule);\r\n    },\r\n\r\n\r\n    /**\r\n     * Perform the conversion. Only some of the frequencies are supported.\r\n     * If some of the rrule's options aren't supported, they'll\r\n     * be omitted from the output an \"(~ approximate)\" will be appended.\r\n     * @return {*}\r\n     */\r\n    toString: function() {\r\n\r\n        var gettext = this.gettext;\r\n\r\n        if (!(this.options.freq in ToText.IMPLEMENTED)) {\r\n            return gettext(\r\n                'RRule error: Unable to fully convert this rrule to text');\r\n        }\r\n\r\n        this.text = [gettext('every')];\r\n\r\n        this[RRule.FREQUENCIES[this.options.freq]]();\r\n\r\n        if (this.options.until) {\r\n            this.add(gettext('until'));\r\n            var until = this.options.until;\r\n            this.add(this.language.monthNames[until.getMonth()])\r\n                .add(until.getDate() + ',')\r\n                .add(until.getFullYear());\r\n        } else if (this.options.count) {\r\n            this.add(gettext('for'))\r\n                .add(this.options.count)\r\n                .add(this.plural(this.options.count)\r\n                        ? gettext('times')\r\n                        : gettext('time'));\r\n        }\r\n\r\n        if (!this.isFullyConvertible()) {\r\n            this.add(gettext('(~ approximate)'));\r\n        }\r\n        return this.text.join('');\r\n    },\r\n\r\n    DAILY: function() {\r\n        var gettext = this.gettext;\r\n        if (this.options.interval != 1) {\r\n            this.add(this.options.interval);\r\n        }\r\n\r\n        if (this.byweekday && this.byweekday.isWeekdays) {\r\n            this.add(this.plural(this.options.interval)\r\n                         ? gettext('weekdays')\r\n                         : gettext('weekday'));\r\n        } else {\r\n            this.add(this.plural(this.options.interval)\r\n                ? gettext('days') :  gettext('day'));\r\n        }\r\n\r\n        if (this.origOptions.bymonth) {\r\n            this.add(gettext('in'));\r\n            this._bymonth();\r\n        }\r\n\r\n        if (this.bymonthday) {\r\n            this._bymonthday();\r\n        } else if (this.byweekday) {\r\n            this._byweekday();\r\n        }\r\n\r\n    },\r\n\r\n    WEEKLY: function() {\r\n        var gettext = this.gettext;\r\n        if (this.options.interval != 1) {\r\n            this.add(this.options.interval).add(\r\n                this.plural(this.options.interval)\r\n                    ? gettext('weeks')\r\n                    :  gettext('week'));\r\n        }\r\n\r\n        if (this.byweekday && this.byweekday.isWeekdays) {\r\n\r\n            if (this.options.interval == 1) {\r\n                this.add(this.plural(this.options.interval)\r\n                    ? gettext('weekdays')\r\n                    : gettext('weekday'));\r\n            } else {\r\n                this.add(gettext('on')).add(gettext('weekdays'));\r\n            }\r\n\r\n        } else {\r\n\r\n            if (this.options.interval == 1) {\r\n                this.add(gettext('week'))\r\n            }\r\n\r\n            if (this.origOptions.bymonth) {\r\n                this.add(gettext('in'));\r\n                this._bymonth();\r\n            }\r\n\r\n            if (this.bymonthday) {\r\n                this._bymonthday();\r\n            } else if (this.byweekday) {\r\n                this._byweekday();\r\n            }\r\n        }\r\n\r\n    },\r\n\r\n    MONTHLY: function() {\r\n        var gettext = this.gettext;\r\n        if (this.origOptions.bymonth) {\r\n            if (this.options.interval != 1) {\r\n                this.add(this.options.interval).add(gettext('months'));\r\n                if (this.plural(this.options.interval)) {\r\n                    this.add(gettext('in'));\r\n                }\r\n            } else {\r\n                //this.add(gettext('MONTH'));\r\n            }\r\n            this._bymonth();\r\n        } else {\r\n            if (this.options.interval != 1) {\r\n                this.add(this.options.interval);\r\n            }\r\n            this.add(this.plural(this.options.interval)\r\n                ? gettext('months')\r\n                :  gettext('month'));\r\n        }\r\n        if (this.bymonthday) {\r\n            this._bymonthday();\r\n        } else if (this.byweekday && this.byweekday.isWeekdays) {\r\n            this.add(gettext('on')).add(gettext('weekdays'));\r\n        } else if (this.byweekday) {\r\n            this._byweekday();\r\n        }\r\n    },\r\n\r\n    YEARLY: function() {\r\n        var gettext = this.gettext;\r\n        if (this.origOptions.bymonth) {\r\n            if (this.options.interval != 1) {\r\n                this.add(this.options.interval);\r\n                this.add(gettext('years'));\r\n            } else {\r\n                // this.add(gettext('YEAR'));\r\n            }\r\n            this._bymonth();\r\n        } else {\r\n            if (this.options.interval != 1) {\r\n                this.add(this.options.interval);\r\n            }\r\n            this.add(this.plural(this.options.interval)\r\n                ? gettext('years')\r\n                :  gettext('year'));\r\n        }\r\n\r\n\r\n        if (this.bymonthday) {\r\n            this._bymonthday();\r\n        } else if (this.byweekday) {\r\n            this._byweekday();\r\n        }\r\n\r\n\r\n        if (this.options.byyearday) {\r\n            this.add(gettext('on the'))\r\n                .add(this.list(this.options.byyearday,\r\n                     this.nth, gettext('and')))\r\n                .add(gettext('day'));\r\n        }\r\n\r\n        if (this.options.byweekno) {\r\n            this.add(gettext('in'))\r\n                .add(this.plural(this.options.byweekno.length)\r\n                        ? gettext('weeks') :  gettext('week'))\r\n                .add(this.list(this.options.byweekno, null, gettext('and')));\r\n        }\r\n    },\r\n\r\n    _bymonthday: function() {\r\n        var gettext = this.gettext;\r\n        if (this.byweekday && this.byweekday.allWeeks) {\r\n            this.add(gettext('on'))\r\n                .add(this.list(this.byweekday.allWeeks,\r\n                     this.weekdaytext, gettext('or')))\r\n                .add(gettext('the'))\r\n                .add(this.list(this.bymonthday, this.nth, gettext('or')));\r\n        } else {\r\n            this.add(gettext('on the'))\r\n                .add(this.list(this.bymonthday, this.nth, gettext('and')));\r\n        }\r\n        //this.add(gettext('DAY'));\r\n    },\r\n\r\n    _byweekday: function() {\r\n        var gettext = this.gettext;\r\n        if (this.byweekday.allWeeks && !this.byweekday.isWeekdays) {\r\n            this.add(gettext('on'))\r\n                .add(this.list(this.byweekday.allWeeks, this.weekdaytext));\r\n        }\r\n\r\n        if (this.byweekday.someWeeks) {\r\n\r\n            if (this.byweekday.allWeeks) {\r\n                this.add(gettext('and'));\r\n            }\r\n\r\n            this.add(gettext('on the'))\r\n                .add(this.list(this.byweekday.someWeeks,\r\n                               this.weekdaytext,\r\n                               gettext('and')));\r\n        }\r\n    },\r\n\r\n    _bymonth: function() {\r\n        this.add(this.list(this.options.bymonth,\r\n                           this.monthtext,\r\n                           this.gettext('and')));\r\n    },\r\n\r\n    nth: function(n) {\r\n        var nth, npos, gettext = this.gettext;\r\n\r\n        if (n == -1) {\r\n            return gettext('last');\r\n        }\r\n\r\n        npos = Math.abs(n);\r\n\r\n        switch(npos) {\r\n            case 1:\r\n            case 21:\r\n            case 31:\r\n                nth = npos + gettext('st');\r\n                break;\r\n            case 2:\r\n            case 22:\r\n                nth = npos + gettext('nd');\r\n                break;\r\n            case 3:\r\n            case 23:\r\n                nth = npos + gettext('rd');\r\n                break;\r\n            default:\r\n                nth = npos + gettext('th');\r\n        }\r\n\r\n        return  n < 0 ? nth + ' ' + gettext('last') : nth;\r\n\r\n    },\r\n\r\n    monthtext: function(m) {\r\n        return this.language.monthNames[m - 1];\r\n    },\r\n\r\n    weekdaytext: function(wday) {\r\n        return (wday.n ? this.nth(wday.n) + ' ' : '')\r\n            + this.language.dayNames[wday.getJsWeekday()];\r\n    },\r\n\r\n    plural: function(n) {\r\n        return n % 100 != 1;\r\n    },\r\n\r\n    add: function(s) {\r\n        this.text.push(' ');\r\n        this.text.push(s);\r\n        return this;\r\n    },\r\n\r\n    list: function(arr, callback, finalDelim, delim) {\r\n\r\n        var delimJoin = function (array, delimiter, finalDelimiter) {\r\n            var list = '';\r\n            for(var i = 0; i < array.length; i++) {\r\n                if (i != 0) {\r\n                    if (i == array.length - 1) {\r\n                        list += ' ' + finalDelimiter + ' ';\r\n                    } else {\r\n                        list += delimiter + ' ';\r\n                    }\r\n                }\r\n                list += array[i];\r\n            }\r\n            return list;\r\n        };\r\n\r\n        delim = delim || ',';\r\n        callback = callback || (function(o){return o;});\r\n        var self = this;\r\n        var realCallback = function(arg) {\r\n            return callback.call(self, arg);\r\n        };\r\n\r\n        if (finalDelim) {\r\n            return delimJoin(arr.map(realCallback), delim, finalDelim);\r\n        } else {\r\n            return arr.map(realCallback).join(delim + ' ');\r\n        }\r\n\r\n\r\n    }\r\n\r\n\r\n};\r\n\r\n\r\n//=============================================================================\r\n// fromText\r\n//=============================================================================\r\n/**\r\n * Will be able to convert some of the below described rules from\r\n * text format to a rule object.\r\n *\r\n *\r\n * RULES\r\n *\r\n * Every ([n])\r\n * \t\t  day(s)\r\n * \t\t| [weekday], ..., (and) [weekday]\r\n * \t\t| weekday(s)\r\n * \t\t| week(s)\r\n * \t\t| month(s)\r\n * \t\t| [month], ..., (and) [month]\r\n * \t\t| year(s)\r\n *\r\n *\r\n * Plus 0, 1, or multiple of these:\r\n *\r\n * on [weekday], ..., (or) [weekday] the [monthday], [monthday], ... (or) [monthday]\r\n *\r\n * on [weekday], ..., (and) [weekday]\r\n *\r\n * on the [monthday], [monthday], ... (and) [monthday] (day of the month)\r\n *\r\n * on the [nth-weekday], ..., (and) [nth-weekday] (of the month/year)\r\n *\r\n *\r\n * Plus 0 or 1 of these:\r\n *\r\n * for [n] time(s)\r\n *\r\n * until [date]\r\n *\r\n * Plus (.)\r\n *\r\n *\r\n * Definitely no supported for parsing:\r\n *\r\n * (for year):\r\n * \t\tin week(s) [n], ..., (and) [n]\r\n *\r\n * \t\ton the [yearday], ..., (and) [n] day of the year\r\n * \t\ton day [yearday], ..., (and) [n]\r\n *\r\n *\r\n * NON-TERMINALS\r\n *\r\n * [n]: 1, 2 ..., one, two, three ..\r\n * [month]: January, February, March, April, May, ... December\r\n * [weekday]: Monday, ... Sunday\r\n * [nth-weekday]: first [weekday], 2nd [weekday], ... last [weekday], ...\r\n * [monthday]: first, 1., 2., 1st, 2nd, second, ... 31st, last day, 2nd last day, ..\r\n * [date]:\r\n * \t\t[month] (0-31(,) ([year])),\r\n * \t\t(the) 0-31.(1-12.([year])),\r\n * \t\t(the) 0-31/(1-12/([year])),\r\n * \t\t[weekday]\r\n *\r\n * [year]: 0000, 0001, ... 01, 02, ..\r\n *\r\n * Definitely not supported for parsing:\r\n *\r\n * [yearday]: first, 1., 2., 1st, 2nd, second, ... 366th, last day, 2nd last day, ..\r\n *\r\n * @param {String} text\r\n * @return {Object, Boolean} the rule, or null.\r\n */\r\nvar fromText = function(text, language) {\r\n    return new RRule(parseText(text, language))\r\n};\r\n\r\nvar parseText = function(text, language) {\r\n\r\n    var ttr = new Parser((language || ENGLISH).tokens);\r\n\r\n    if(!ttr.start(text)) {\r\n        return null;\r\n    }\r\n\r\n    var options = {};\r\n\r\n    S();\r\n    return options;\r\n\r\n    function S() {\r\n        ttr.expect('every');\r\n\r\n        // every [n]\r\n        var n;\r\n        if(n = ttr.accept('number'))\r\n            options.interval = parseInt(n[0]);\r\n\r\n        if(ttr.isDone())\r\n            throw new Error('Unexpected end');\r\n\r\n        switch(ttr.symbol) {\r\n        case 'day(s)':\r\n            options.freq = RRule.DAILY;\r\n            if (ttr.nextSymbol()) {\r\n                ON();\r\n                F();\r\n            }\r\n            break;\r\n\r\n            // FIXME Note: every 2 weekdays != every two weeks on weekdays.\r\n            // DAILY on weekdays is not a valid rule\r\n        case 'weekday(s)':\r\n            options.freq = RRule.WEEKLY;\r\n            options.byweekday = [\r\n                RRule.MO,\r\n                RRule.TU,\r\n                RRule.WE,\r\n                RRule.TH,\r\n                RRule.FR\r\n            ];\r\n            ttr.nextSymbol();\r\n            F();\r\n            break;\r\n\r\n        case 'week(s)':\r\n            options.freq = RRule.WEEKLY;\r\n            if (ttr.nextSymbol()) {\r\n                ON();\r\n                F();\r\n            }\r\n            break;\r\n\r\n        case 'month(s)':\r\n            options.freq = RRule.MONTHLY;\r\n            if (ttr.nextSymbol()) {\r\n                ON();\r\n                F();\r\n            }\r\n            break;\r\n\r\n        case 'year(s)':\r\n            options.freq = RRule.YEARLY;\r\n            if (ttr.nextSymbol()) {\r\n                ON();\r\n                F();\r\n            }\r\n            break;\r\n\r\n        case 'monday':\r\n        case 'tuesday':\r\n        case 'wednesday':\r\n        case 'thursday':\r\n        case 'friday':\r\n        case 'saturday':\r\n        case 'sunday':\r\n            options.freq = RRule.WEEKLY;\r\n            options.byweekday = [RRule[ttr.symbol.substr(0, 2).toUpperCase()]];\r\n\r\n            if(!ttr.nextSymbol())\r\n                return;\r\n\r\n            // TODO check for duplicates\r\n            while (ttr.accept('comma')) {\r\n                if(ttr.isDone())\r\n                    throw new Error('Unexpected end');\r\n\r\n                var wkd;\r\n                if(!(wkd = decodeWKD())) {\r\n                    throw new Error('Unexpected symbol ' + ttr.symbol\r\n                        + ', expected weekday');\r\n                }\r\n\r\n                options.byweekday.push(RRule[wkd]);\r\n                ttr.nextSymbol();\r\n            }\r\n            MDAYs();\r\n            F();\r\n            break;\r\n\r\n        case 'january':\r\n        case 'february':\r\n        case 'march':\r\n        case 'april':\r\n        case 'may':\r\n        case 'june':\r\n        case 'july':\r\n        case 'august':\r\n        case 'september':\r\n        case 'october':\r\n        case 'november':\r\n        case 'december':\r\n            options.freq = RRule.YEARLY;\r\n            options.bymonth = [decodeM()];\r\n\r\n            if(!ttr.nextSymbol())\r\n                return;\r\n\r\n            // TODO check for duplicates\r\n            while (ttr.accept('comma')) {\r\n                if(ttr.isDone())\r\n                    throw new Error('Unexpected end');\r\n\r\n                var m;\r\n                if(!(m = decodeM())) {\r\n                    throw new Error('Unexpected symbol ' + ttr.symbol\r\n                        + ', expected month');\r\n                }\r\n\r\n                options.bymonth.push(m);\r\n                ttr.nextSymbol();\r\n            }\r\n\r\n            ON();\r\n            F();\r\n            break;\r\n\r\n        default:\r\n            throw new Error('Unknown symbol');\r\n\r\n        }\r\n    }\r\n\r\n    function ON() {\r\n\r\n        var on = ttr.accept('on');\r\n        var the = ttr.accept('the');\r\n        if(!(on || the)) {\r\n            return;\r\n        }\r\n\r\n        do {\r\n\r\n            var nth, wkd, m;\r\n\r\n            // nth <weekday> | <weekday>\r\n            if(nth = decodeNTH()) {\r\n                //ttr.nextSymbol();\r\n\r\n                if (wkd = decodeWKD()) {\r\n                    ttr.nextSymbol();\r\n                    if (!options.byweekday) {\r\n                        options.byweekday = [];\r\n                    }\r\n                    options.byweekday.push(RRule[wkd].nth(nth));\r\n                } else {\r\n                    if(!options.bymonthday) {\r\n                        options.bymonthday = [];\r\n                    }\r\n                    options.bymonthday.push(nth);\r\n                    ttr.accept('day(s)');\r\n                }\r\n\r\n                // <weekday>\r\n            } else if(wkd = decodeWKD()) {\r\n                ttr.nextSymbol();\r\n                if(!options.byweekday)\r\n                    options.byweekday = [];\r\n                options.byweekday.push(RRule[wkd]);\r\n            } else if(ttr.symbol == 'weekday(s)') {\r\n                ttr.nextSymbol();\r\n                if(!options.byweekday)\r\n                    options.byweekday = [];\r\n                options.byweekday.push(RRule.MO);\r\n                options.byweekday.push(RRule.TU);\r\n                options.byweekday.push(RRule.WE);\r\n                options.byweekday.push(RRule.TH);\r\n                options.byweekday.push(RRule.FR);\r\n            } else if(ttr.symbol == 'week(s)') {\r\n                ttr.nextSymbol();\r\n                var n;\r\n                if(!(n = ttr.accept('number'))) {\r\n                    throw new Error('Unexpected symbol ' + ttr.symbol\r\n                        + ', expected week number');\r\n                }\r\n                options.byweekno = [n[0]];\r\n                while(ttr.accept('comma')) {\r\n                    if(!(n = ttr.accept('number'))) {\r\n                        throw new Error('Unexpected symbol ' + ttr.symbol\r\n                            + '; expected monthday');\r\n                    }\r\n                    options.byweekno.push(n[0]);\r\n                }\r\n\r\n            } else if(m = decodeM()) {\r\n                ttr.nextSymbol();\r\n                if(!options.bymonth)\r\n                    options.bymonth = [];\r\n                options.bymonth.push(m);\r\n            } else {\r\n                return;\r\n            }\r\n\r\n        } while (ttr.accept('comma') || ttr.accept('the') || ttr.accept('on'));\r\n    }\r\n\r\n    function decodeM() {\r\n        switch(ttr.symbol) {\r\n        case 'january':\r\n            return 1;\r\n        case 'february':\r\n            return 2;\r\n        case 'march':\r\n            return 3;\r\n        case 'april':\r\n            return 4;\r\n        case 'may':\r\n            return 5;\r\n        case 'june':\r\n            return 6;\r\n        case 'july':\r\n            return 7;\r\n        case 'august':\r\n            return 8;\r\n        case 'september':\r\n            return 9;\r\n        case 'october':\r\n            return 10;\r\n        case 'november':\r\n            return 11;\r\n        case 'december':\r\n            return 12;\r\n        default:\r\n            return false;\r\n        }\r\n    }\r\n\r\n    function decodeWKD() {\r\n        switch(ttr.symbol) {\r\n        case 'monday':\r\n        case 'tuesday':\r\n        case 'wednesday':\r\n        case 'thursday':\r\n        case 'friday':\r\n        case 'saturday':\r\n        case 'sunday':\r\n            return ttr.symbol.substr(0, 2).toUpperCase();\r\n            break;\r\n\r\n        default:\r\n            return false;\r\n        }\r\n    }\r\n\r\n    function decodeNTH() {\r\n\r\n        switch(ttr.symbol) {\r\n        case 'last':\r\n            ttr.nextSymbol();\r\n            return -1;\r\n        case 'first':\r\n            ttr.nextSymbol();\r\n            return 1;\r\n        case 'second':\r\n            ttr.nextSymbol();\r\n            return ttr.accept('last') ? -2 : 2;\r\n        case 'third':\r\n            ttr.nextSymbol();\r\n            return ttr.accept('last') ? -3 : 3;\r\n        case 'nth':\r\n            var v = parseInt(ttr.value[1]);\r\n            if(v < -366 || v > 366)\r\n                throw new Error('Nth out of range: ' + v);\r\n\r\n            ttr.nextSymbol();\r\n            return ttr.accept('last') ? -v : v;\r\n\r\n        default:\r\n            return false;\r\n        }\r\n    }\r\n\r\n    function MDAYs() {\r\n\r\n        ttr.accept('on');\r\n        ttr.accept('the');\r\n\r\n        var nth;\r\n        if(!(nth = decodeNTH())) {\r\n            return;\r\n        }\r\n\r\n        options.bymonthday = [nth];\r\n        ttr.nextSymbol();\r\n\r\n        while(ttr.accept('comma')) {\r\n\r\n            if (!(nth = decodeNTH())) {\r\n                throw new Error('Unexpected symbol ' + ttr.symbol\r\n                        + '; expected monthday');\r\n            }\r\n\r\n            options.bymonthday.push(nth);\r\n\r\n            ttr.nextSymbol();\r\n        }\r\n    }\r\n\r\n    function F() {\r\n\r\n        if(ttr.symbol == 'until') {\r\n\r\n            var date = Date.parse(ttr.text);\r\n\r\n            if (!date) {\r\n                throw new Error('Cannot parse until date:' + ttr.text);\r\n            }\r\n            options.until = new Date(date);\r\n        } else if(ttr.accept('for')){\r\n\r\n            options.count = ttr.value[0];\r\n            ttr.expect('number');\r\n            /* ttr.expect('times') */\r\n        }\r\n    }\r\n};\r\n\r\n\r\n//=============================================================================\r\n// Parser\r\n//=============================================================================\r\n\r\nvar Parser = function(rules) {\r\n   this.rules = rules;\r\n};\r\n\r\nParser.prototype.start = function(text) {\r\n   this.text = text;\r\n   this.done = false;\r\n   return this.nextSymbol();\r\n};\r\n\r\nParser.prototype.isDone = function() {\r\n   return this.done && this.symbol == null;\r\n};\r\n\r\nParser.prototype.nextSymbol = function() {\r\n   var p = this, best, bestSymbol;\r\n\r\n   this.symbol = null;\r\n   this.value = null;\r\n   do {\r\n       if(this.done) {\r\n           return false;\r\n       }\r\n\r\n       best = null;\r\n\r\n       var match, rule;\r\n       for (var name in this.rules) {\r\n           rule = this.rules[name];\r\n           if(match = rule.exec(p.text)) {\r\n               if(best == null || match[0].length > best[0].length) {\r\n                   best = match;\r\n                   bestSymbol = name;\r\n               }\r\n           }\r\n\r\n       }\r\n\r\n       if(best != null) {\r\n           this.text = this.text.substr(best[0].length);\r\n\r\n           if(this.text == '') {\r\n               this.done = true;\r\n           }\r\n       }\r\n\r\n       if(best == null) {\r\n           this.done = true;\r\n           this.symbol = null;\r\n           this.value = null;\r\n           return;\r\n       }\r\n   } while(bestSymbol == 'SKIP');\r\n\r\n   this.symbol = bestSymbol;\r\n   this.value = best;\r\n   return true;\r\n};\r\n\r\nParser.prototype.accept = function(name) {\r\n   if(this.symbol == name) {\r\n       if(this.value) {\r\n           var v = this.value;\r\n           this.nextSymbol();\r\n           return v;\r\n       }\r\n\r\n       this.nextSymbol();\r\n       return true;\r\n   }\r\n\r\n   return false;\r\n};\r\n\r\nParser.prototype.expect = function(name) {\r\n   if(this.accept(name)) {\r\n       return true;\r\n   }\r\n\r\n   throw new Error('expected ' + name + ' but found ' + this.symbol);\r\n};\r\n\r\n\r\n//=============================================================================\r\n// i18n\r\n//=============================================================================\r\n\r\nvar ENGLISH = {\r\n    dayNames: [\r\n        \"Sunday\", \"Monday\", \"Tuesday\", \"Wednesday\",\r\n        \"Thursday\", \"Friday\", \"Saturday\"\r\n    ],\r\n    monthNames: [\r\n        \"January\", \"February\", \"March\", \"April\", \"May\",\r\n        \"June\", \"July\", \"August\", \"September\", \"October\",\r\n        \"November\", \"December\"\r\n    ],\r\n    tokens: {\r\n        'SKIP': /^[ \\r\\n\\t]+|^\\.$/,\r\n        'number': /^[1-9][0-9]*/,\r\n        'numberAsText': /^(one|two|three)/i,\r\n        'every': /^every/i,\r\n        'day(s)': /^days?/i,\r\n        'weekday(s)': /^weekdays?/i,\r\n        'week(s)': /^weeks?/i,\r\n        'month(s)': /^months?/i,\r\n        'year(s)': /^years?/i,\r\n        'on': /^(on|in)/i,\r\n        'the': /^the/i,\r\n        'first': /^first/i,\r\n        'second': /^second/i,\r\n        'third': /^third/i,\r\n        'nth': /^([1-9][0-9]*)(\\.|th|nd|rd|st)/i,\r\n        'last': /^last/i,\r\n        'for': /^for/i,\r\n        'time(s)': /^times?/i,\r\n        'until': /^(un)?til/i,\r\n        'monday': /^mo(n(day)?)?/i,\r\n        'tuesday': /^tu(e(s(day)?)?)?/i,\r\n        'wednesday': /^we(d(n(esday)?)?)?/i,\r\n        'thursday': /^th(u(r(sday)?)?)?/i,\r\n        'friday': /^fr(i(day)?)?/i,\r\n        'saturday': /^sa(t(urday)?)?/i,\r\n        'sunday': /^su(n(day)?)?/i,\r\n        'january': /^jan(uary)?/i,\r\n        'february': /^feb(ruary)?/i,\r\n        'march': /^mar(ch)?/i,\r\n        'april': /^apr(il)?/i,\r\n        'may': /^may/i,\r\n        'june': /^june?/i,\r\n        'july': /^july?/i,\r\n        'august': /^aug(ust)?/i,\r\n        'september': /^sep(t(ember)?)?/i,\r\n        'october': /^oct(ober)?/i,\r\n        'november': /^nov(ember)?/i,\r\n        'december': /^dec(ember)?/i,\r\n        'comma': /^(,\\s*|(and|or)\\s*)+/i\r\n    }\r\n};\r\n\r\n\r\n//=============================================================================\r\n// Export\r\n//=============================================================================\r\n\r\nvar nlp = {\r\n    fromText: fromText,\r\n    parseText: parseText,\r\n    isFullyConvertible: ToText.isFullyConvertible,\r\n    toText: function(rrule, gettext, language) {\r\n        return new ToText(rrule, gettext, language).toString();\r\n    }\r\n};\r\n\r\nif (serverSide) {\r\n    module.exports = nlp\r\n} else {\r\n  root['_RRuleNLP'] = nlp;\r\n}\r\n\r\nif (typeof define === \"function\" && define.amd) {\r\n    /*global define:false */\r\n    define(\"rrule\", [], function () {\r\n        return RRule;\r\n    });\r\n}\r\n\r\n})(this);\r\n\ndefine(\"taoDeliverySchedule/lib/rrule/nlp\", function(){});\n\n","define('taoDeliverySchedule/lib/rrule/rrule.amd',['taoDeliverySchedule/lib/rrule/rrule'], function () {\r\n    require(['taoDeliverySchedule/lib/rrule/nlp']);\r\n});\n","/**  \r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n * \r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n * \r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n * \r\n * Copyright (c) 2015 (original work) Open Assessment Technologies SA;\r\n *               \r\n */\r\ndefine('taoDeliverySchedule/calendar/eventService',[\r\n    'lodash',\r\n    'jquery',\r\n    'ui/feedback',\r\n    'layout/actions',\r\n    'moment',\r\n    'layout/loading-bar',\r\n    'taoDeliverySchedule/lib/rrule/rrule.amd'\r\n], function (_, $, feedback, actionManager, moment, loadingBar) {\r\n    'use strict';\r\n    var instance = null;\r\n\r\n    function EventService(calendar) {\r\n        var that = this,\r\n            $treeElt = $('#tree-manage_delivery_schedule'),\r\n            $calendar = $('.js-delivery-calendar'),\r\n            tree = $.tree.reference($treeElt);\r\n\r\n        if (instance !== null) {\r\n            throw new Error(\"Cannot instantiate more than one EventService, use EventService.getInstance()\");\r\n        }\r\n\r\n        this.tz = 'UTC';\r\n        this.classAttrPrefix = 'fc_event_id_';\r\n\r\n        /**\r\n         * Create new event\r\n         * @param {object} options\r\n         * @property {string} options.url Url address to creaet new event\r\n         * @property {string} options.data Event data. Example:\r\n         *      <pre>\r\n         *      {\r\n         *         classUri: \"http://www.tao.lu/Ontologies/TAODelivery.rdf#AssembledDelivery\",\r\n         *         end: \"2015-04-18 00:00\",\r\n         *         label: \"sdfdsf\",\r\n         *         simpleWizard_sent: \"1\",\r\n         *         start: \"2015-04-17 00:00\",\r\n         *         test: \"http://sample/first.rdf#i1429018012670729\"\r\n         *      }\r\n         *      </pre>\r\n         * @returns {undefined}\r\n         */\r\n        this.createEvent = function (options) {\r\n            loadingBar.start();\r\n            $.ajax({\r\n                url : '/taoDeliverySchedule/CalendarApi',\r\n                type : 'POST',\r\n                data : options.data,\r\n                global : false,\r\n                dataType : 'json',\r\n                success : function (response) {\r\n                    if (response.uri) {\r\n                        that.loadEvent(\r\n                            response.id,\r\n                            function (eventData) {\r\n                                $calendar.fullCalendar('renderEvent', eventData);\r\n\r\n                                $treeElt.trigger('addnode.taotree', [{\r\n                                    'uri'       : response.uri,\r\n                                    'parent'    : options.data.classUri,\r\n                                    'label'     : options.data.label,\r\n                                    'cssClass'  : 'node-instance'\r\n                                }]);\r\n\r\n                                feedback().success(response.message);\r\n\r\n                                if(typeof options.success === 'function') {\r\n                                    options.success();\r\n                                }\r\n\r\n                                loadingBar.stop();\r\n                            }\r\n                        );\r\n                    }\r\n                },\r\n                error : function (xhr, err) {\r\n                    var message = that.getRequestErrorMessage(xhr);\r\n                    feedback().error(message, {encodeHtml : false});\r\n                    if(typeof options.error === 'function') {\r\n                        options.error();\r\n                    }\r\n                    loadingBar.stop();\r\n                }\r\n            });\r\n        };\r\n\r\n        /**\r\n         * Save event\r\n         * @param {object} options\r\n         * @property {string} options.url Url address to creaet new event\r\n         * @property {string} options.data Event data. Example:\r\n         *      <pre>\r\n         *      {\r\n         *         classUri: \"http://www.tao.lu/Ontologies/TAODelivery.rdf#AssembledDelivery\",\r\n         *         start: \"2015-04-17 00:00\"\r\n         *         end: \"2015-04-18 00:00\",\r\n         *         label: \"Delivery label\",\r\n         *         uri: \"http_2_sample_1_first_0_rdf_3_i14301245512201554\",\r\n         *         id: \"http://sample/first.rdf#i14301245512201554\"\r\n         *      }\r\n         *      </pre>\r\n         * @param {function} callback success callback\r\n         * @param {function} errorCallback error callback\r\n         * @returns {undefined}\r\n         */\r\n        this.saveEvent = function (fcEvent, callback, errorCallback) {\r\n            loadingBar.start();\r\n\r\n            var data = {\r\n                label      : fcEvent.label === undefined ? fcEvent.title : fcEvent.label,\r\n                classUri   : fcEvent.classUri,\r\n                id         : fcEvent.id,\r\n                uri        : fcEvent.uri,\r\n                start      : fcEvent.start.clone().add(fcEvent.start._tzm, 'm').format('YYYY-MM-DD HH:mm'),\r\n                end        : fcEvent.end.clone().add(fcEvent.end._tzm, 'm').format('YYYY-MM-DD HH:mm'),\r\n                recurrence : '',\r\n            };\r\n\r\n            if (fcEvent.ttexcluded) {\r\n                data.ttexcluded = fcEvent.ttexcluded.length ? fcEvent.ttexcluded : ''; //jquery does not send empty arrays via ajax.\r\n            }\r\n\r\n            if (fcEvent.resultserver) {\r\n                data.resultserver = fcEvent.resultserver;\r\n            }\r\n\r\n            if (fcEvent.recurrence) {\r\n                var rruleOptions = RRule.parseString(fcEvent.recurrence),\r\n                    rrule;\r\n\r\n                if (fcEvent.start._ambigZone) {\r\n                    rruleOptions.dtstart = fcEvent.start.clone().add(-that.getCurrentTZOffset(), 'm').toDate();\r\n                } else {\r\n                    rruleOptions.dtstart = fcEvent.start.clone().toDate();\r\n                }\r\n\r\n                rrule = new RRule(rruleOptions);\r\n                data.recurrence = rrule.toString();\r\n            }\r\n\r\n            if (fcEvent.groups && _.isArray(fcEvent.groups)) {\r\n                data.groups = fcEvent.groups;\r\n            }\r\n            if (fcEvent.maxexec !== undefined) {\r\n                data.maxexec = fcEvent.maxexec;\r\n            }\r\n\r\n            $.ajax({\r\n                url : '/taoDeliverySchedule/CalendarApi',\r\n                type : 'PUT',\r\n                data : data,\r\n                global : false,\r\n                dataType : 'json',\r\n                success : function (response) {\r\n                    that.loadEvent(fcEvent.id, function (eventData) {\r\n                        var eventsToBeAdded = that.getRecurringEvents(eventData),\r\n                            eventsToBeRemoved = fcEvent.recurringEventIds || [];\r\n\r\n                        eventsToBeRemoved.push(fcEvent.id);\r\n                        eventsToBeAdded.push(eventData);\r\n\r\n                        $calendar.fullCalendar('removeEvents', function (eventToRemove) {\r\n                            return eventsToBeRemoved.indexOf(eventToRemove.id) !== -1;\r\n                        });\r\n\r\n                        $calendar.fullCalendar('addEventSource', eventsToBeAdded);\r\n\r\n                        if (typeof callback === 'function') {\r\n                            callback(eventData);\r\n                        }\r\n\r\n                        feedback().success(response.message);\r\n                        loadingBar.stop();\r\n                    });\r\n                },\r\n                error : function (xhr, err) {\r\n                    loadingBar.stop();\r\n                    var message = that.getRequestErrorMessage(xhr);\r\n                    feedback().warning(message, {encodeHtml : false});\r\n                    if (typeof errorCallback === 'function') {\r\n                        errorCallback();\r\n                    }\r\n                }\r\n            });\r\n        };\r\n\r\n        /**\r\n         * Delete delivery selected on the tree\r\n         * @returns {undefined}\r\n         */\r\n        this.deleteEvent = function (eventId) {\r\n            actionManager.exec(\r\n                'delivery-delete', \r\n                _.extend(\r\n                    actionManager._resourceContext, \r\n                    {action : actionManager.getBy('delivery-delete')}\r\n                )\r\n            );\r\n            tree.deselect_branch(tree.selected);\r\n        };\r\n\r\n        /**\r\n         * Function parse response and returns error message\r\n         * @param {object} xhr jqXHR object.\r\n         * @returns {string} error message\r\n         */\r\n        this.getRequestErrorMessage = function (xhr) {\r\n            var message = '';\r\n            try {\r\n                var responseJSON = $.parseJSON(xhr.responseText);\r\n                if (responseJSON.message) {\r\n                    message = responseJSON.message;\r\n                } else if (responseJSON.errors && !_.isEmpty(responseJSON.errors)) {\r\n                    $.each(responseJSON.errors, function (key, val) {\r\n                        message += key + ': ' + val + \"<br>\";\r\n                    });\r\n                } else {\r\n                    message = xhr.responseText;\r\n                }\r\n\r\n            } catch (e) {\r\n                message = xhr.responseText;\r\n            }\r\n\r\n            return message;\r\n        };\r\n\r\n        /**\r\n         * Load event by Id from the server\r\n         * \r\n         * @param {string} eventId\r\n         * @param {function} callback\r\n         * @returns {undefined}\r\n         */\r\n        this.loadEvent = function (eventId, callback) {\r\n            var timeZone = that.getCurrentTZName();\r\n\r\n            $.ajax({\r\n                url : '/taoDeliverySchedule/CalendarApi?uri=' + eventId + '&timeZone=' + timeZone,\r\n                type : 'GET',\r\n                global : false,\r\n                success : function (data) {\r\n                    if (typeof callback === 'function') {\r\n                        callback(data);\r\n                    }\r\n                },\r\n                error : function (xhr) {\r\n                    loadingBar.stop();\r\n                    var message = that.getRequestErrorMessage(xhr);\r\n                    feedback().error(message, {encodeHtml : false});\r\n                }\r\n            });\r\n        };\r\n\r\n        /**\r\n         * Get FullCalendar event object\r\n         * @param {string} id Event id. If paraneter is not given all event will be returned.\r\n         * @returns {object|array} FullCalendar event (@see http://fullcalendar.io/docs/event_data/Event_Object) or array of events\r\n         */\r\n        this.getEventById = function (id) {\r\n            var events = $calendar.fullCalendar('clientEvents', id);\r\n            if (events.length === 1) {\r\n                return events[0];\r\n            }\r\n            return events;\r\n        };\r\n\r\n        /**\r\n         * Get event jQuery DOM elements by id \r\n         * \r\n         * @param {string} id Event id\r\n         * @returns {jQuery element}\r\n         */\r\n        this.getEventElement = function (id) {\r\n            return $('.' + that.classAttrPrefix + id);\r\n        };\r\n\r\n        /**\r\n         * Function create recurring events if for initial event specified recurrence rule\r\n         * @param {object} event Fullcalendar event.\r\n         * @returns {Array} array of recurring fullcalendar events.\r\n         */\r\n        this.getRecurringEvents = function (event) {\r\n            var events = [];\r\n            if (event.recurrence) {\r\n                var diff = moment(event.end).diff(moment(event.start)),\r\n                    rrule = RRule.fromString(event.recurrence),\r\n                    zone = moment(event.start).parseZone().zone();\r\n\r\n                var recurringEventIds = [];\r\n\r\n                $.each(rrule.all(), function (rEventKey, rEventDate) {\r\n                    var startMoment = moment(rEventDate),\r\n                        endMoment = moment(rEventDate).add(diff, 'ms'),\r\n                        rEvent = _.cloneDeep(event);\r\n\r\n                    rEvent.start = startMoment.zone(zone).format('YYYY-MM-DDTHH:mm:ssZZ');\r\n                    if (rEvent.start === event.start) {\r\n                        return;\r\n                    }\r\n\r\n                    rEvent.end = endMoment.zone(zone).format('YYYY-MM-DDTHH:mm:ssZZ');\r\n                    rEvent.id = event.id + rEventKey;\r\n                    rEvent.subEvent = true;\r\n                    rEvent.subEventNum = rEventKey;\r\n                    rEvent.parentEventId = event.id;\r\n                    rEvent.className = ['sub-event'];\r\n                    rEvent.durationEditable = false;\r\n                    //rEvent.editable = false;\r\n                    recurringEventIds.push(rEvent.id);\r\n                    events.push(rEvent);\r\n                });\r\n                event.className = ['recurring-event'];\r\n                event.recurringEventIds = recurringEventIds;\r\n            }\r\n\r\n            return events;\r\n        };\r\n\r\n        /**\r\n         * Function highlights event element (or elements for long events) by adding <b>fc-selected</b> class\r\n         * @param {object} fcEvent Fullcalendar event object.\r\n         * @param {boolean} deselectedOther Whether other event must be deselected. True by default.\r\n         * @returns {undefined}\r\n         */\r\n        this.highlightEvent = function (fcEvent, deselectedOther) {\r\n            if (deselectedOther === undefined) {\r\n               deselectedOther = true; \r\n            }\r\n            if (deselectedOther) {\r\n                $('.fc-event.fc-selected').removeClass('fc-selected');\r\n            }\r\n            if (fcEvent.id) {\r\n                $('.' + that.classAttrPrefix + fcEvent.id).addClass('fc-selected');\r\n            }\r\n        };\r\n\r\n        /**\r\n         * Get time zone name from the select box on the calendar toolbar.\r\n         * @returns {String} Example 'Europe/Luxembourg'\r\n         */\r\n        this.getCurrentTZName = function () {\r\n            var timeZone = $.trim($('.js-time-zone-list').find('option:selected').text());\r\n            if (timeZone === '') {\r\n                timeZone = this.tz || 'UTC';\r\n            }\r\n            return timeZone;\r\n        };\r\n\r\n        /**\r\n         * Set current time zone\r\n         * \r\n         * @param {string} value - Time zone name (e.g. 'Europe/Luxembourg')\r\n         */\r\n        this.setTZ = function (value) {\r\n            this.tz = value;\r\n            $('.js-time-zone-list').find('option:contains(' + value + ')')\r\n                .attr('selected', 'selected')\r\n                .trigger('change');\r\n        };\r\n\r\n        /**\r\n         * Get time zone offset in minutes from the select box on the calendar toolbar.\r\n         * @returns {integer} Example 120\r\n         */\r\n        this.getCurrentTZOffset = function () {\r\n            var offset = parseInt($('.js-time-zone-list').val());\r\n            if (isNaN(offset)) {\r\n                offset = 0;\r\n            }\r\n            return offset;\r\n        };\r\n    };\r\n\r\n    EventService.getInstance = function () {\r\n        // Gets an instance of the singleton.\r\n        if (instance === null) {\r\n            instance = new EventService();\r\n        }\r\n        return instance;\r\n    };\r\n\r\n    return EventService.getInstance();\r\n});\n","/*!\r\n * FullCalendar v2.3.1\r\n * Docs & License: http://fullcalendar.io/\r\n * (c) 2015 Adam Shaw\r\n */\r\n\r\n(function(factory) {\r\n\tif (typeof define === 'function' && define.amd) {\r\n\t\tdefine('taoDeliverySchedule/lib/fullcalendar/fullcalendar',[ 'jquery', 'moment' ], factory);\r\n\t}\r\n\telse if (typeof exports === 'object') { // Node/CommonJS\r\n\t\tmodule.exports = factory(require('jquery'), require('moment'));\r\n\t}\r\n\telse {\r\n\t\tfactory(jQuery, moment);\r\n\t}\r\n})(function($, moment) {\r\n\r\n;;\r\n\r\nvar fc = $.fullCalendar = { version: \"2.3.1\" };\r\nvar fcViews = fc.views = {};\r\n\r\n\r\n$.fn.fullCalendar = function(options) {\r\n\tvar args = Array.prototype.slice.call(arguments, 1); // for a possible method call\r\n\tvar res = this; // what this function will return (this jQuery object by default)\r\n\r\n\tthis.each(function(i, _element) { // loop each DOM element involved\r\n\t\tvar element = $(_element);\r\n\t\tvar calendar = element.data('fullCalendar'); // get the existing calendar object (if any)\r\n\t\tvar singleRes; // the returned value of this single method call\r\n\r\n\t\t// a method call\r\n\t\tif (typeof options === 'string') {\r\n\t\t\tif (calendar && $.isFunction(calendar[options])) {\r\n\t\t\t\tsingleRes = calendar[options].apply(calendar, args);\r\n\t\t\t\tif (!i) {\r\n\t\t\t\t\tres = singleRes; // record the first method call result\r\n\t\t\t\t}\r\n\t\t\t\tif (options === 'destroy') { // for the destroy method, must remove Calendar object data\r\n\t\t\t\t\telement.removeData('fullCalendar');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t\t// a new calendar initialization\r\n\t\telse if (!calendar) { // don't initialize twice\r\n\t\t\tcalendar = new fc.CalendarBase(element, options);\r\n\t\t\telement.data('fullCalendar', calendar);\r\n\t\t\tcalendar.render();\r\n\t\t}\r\n\t});\r\n\t\r\n\treturn res;\r\n};\r\n\r\n\r\nvar complexOptions = [ // names of options that are objects whose properties should be combined\r\n\t'header',\r\n\t'buttonText',\r\n\t'buttonIcons',\r\n\t'themeButtonIcons'\r\n];\r\n\r\n\r\n// Recursively combines all passed-in option-hash arguments into a new single option-hash.\r\n// Given option-hashes are ordered from lowest to highest priority.\r\nfunction mergeOptions() {\r\n\tvar chain = Array.prototype.slice.call(arguments); // convert to a real array\r\n\tvar complexVals = {}; // hash for each complex option's combined values\r\n\tvar i, name;\r\n\tvar combinedVal;\r\n\tvar j;\r\n\tvar val;\r\n\r\n\t// for each complex option, loop through each option-hash and accumulate the combined values\r\n\tfor (i = 0; i < complexOptions.length; i++) {\r\n\t\tname = complexOptions[i];\r\n\t\tcombinedVal = null; // an object holding the merge of all the values\r\n\r\n\t\tfor (j = 0; j < chain.length; j++) {\r\n\t\t\tval = chain[j][name];\r\n\r\n\t\t\tif ($.isPlainObject(val)) {\r\n\t\t\t\tcombinedVal = $.extend(combinedVal || {}, val); // merge new properties\r\n\t\t\t}\r\n\t\t\telse if (val != null) { // a non-null non-undefined atomic option\r\n\t\t\t\tcombinedVal = null; // signal to use the atomic value\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// if not null, the final value was a combination of other objects. record it\r\n\t\tif (combinedVal !== null) {\r\n\t\t\tcomplexVals[name] = combinedVal;\r\n\t\t}\r\n\t}\r\n\r\n\tchain.unshift({}); // $.extend will mutate this with the result\r\n\tchain.push(complexVals); // computed complex values are applied last\r\n\treturn $.extend.apply($, chain); // combine\r\n}\r\n\r\n\r\n// Given options specified for the calendar's constructor, massages any legacy options into a non-legacy form.\r\n// Converts View-Option-Hashes into the View-Specific-Options format.\r\nfunction massageOverrides(input) {\r\n\tvar overrides = { views: input.views || {} }; // the output. ensure a `views` hash\r\n\tvar subObj;\r\n\r\n\t// iterate through all option override properties (except `views`)\r\n\t$.each(input, function(name, val) {\r\n\t\tif (name != 'views') {\r\n\r\n\t\t\t// could the value be a legacy View-Option-Hash?\r\n\t\t\tif (\r\n\t\t\t\t$.isPlainObject(val) &&\r\n\t\t\t\t!/(time|duration|interval)$/i.test(name) && // exclude duration options. might be given as objects\r\n\t\t\t\t$.inArray(name, complexOptions) == -1 // complex options aren't allowed to be View-Option-Hashes\r\n\t\t\t) {\r\n\t\t\t\tsubObj = null;\r\n\r\n\t\t\t\t// iterate through the properties of this possible View-Option-Hash value\r\n\t\t\t\t$.each(val, function(subName, subVal) {\r\n\r\n\t\t\t\t\t// is the property targeting a view?\r\n\t\t\t\t\tif (/^(month|week|day|default|basic(Week|Day)?|agenda(Week|Day)?)$/.test(subName)) {\r\n\t\t\t\t\t\tif (!overrides.views[subName]) { // ensure the view-target entry exists\r\n\t\t\t\t\t\t\toverrides.views[subName] = {};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\toverrides.views[subName][name] = subVal; // record the value in the `views` object\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse { // a non-View-Option-Hash property\r\n\t\t\t\t\t\tif (!subObj) {\r\n\t\t\t\t\t\t\tsubObj = {};\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tsubObj[subName] = subVal; // accumulate these unrelated values for later\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (subObj) { // non-View-Option-Hash properties? transfer them as-is\r\n\t\t\t\t\toverrides[name] = subObj;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\toverrides[name] = val; // transfer normal options as-is\r\n\t\t\t}\r\n\t\t}\r\n\t});\r\n\r\n\treturn overrides;\r\n}\r\n\r\n;;\r\n\r\n// exports\r\nfc.intersectionToSeg = intersectionToSeg;\r\nfc.applyAll = applyAll;\r\nfc.debounce = debounce;\r\nfc.isInt = isInt;\r\nfc.htmlEscape = htmlEscape;\r\nfc.cssToStr = cssToStr;\r\nfc.proxy = proxy;\r\n\r\n\r\n/* FullCalendar-specific DOM Utilities\r\n----------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n// Given the scrollbar widths of some other container, create borders/margins on rowEls in order to match the left\r\n// and right space that was offset by the scrollbars. A 1-pixel border first, then margin beyond that.\r\nfunction compensateScroll(rowEls, scrollbarWidths) {\r\n\tif (scrollbarWidths.left) {\r\n\t\trowEls.css({\r\n\t\t\t'border-left-width': 1,\r\n\t\t\t'margin-left': scrollbarWidths.left - 1\r\n\t\t});\r\n\t}\r\n\tif (scrollbarWidths.right) {\r\n\t\trowEls.css({\r\n\t\t\t'border-right-width': 1,\r\n\t\t\t'margin-right': scrollbarWidths.right - 1\r\n\t\t});\r\n\t}\r\n}\r\n\r\n\r\n// Undoes compensateScroll and restores all borders/margins\r\nfunction uncompensateScroll(rowEls) {\r\n\trowEls.css({\r\n\t\t'margin-left': '',\r\n\t\t'margin-right': '',\r\n\t\t'border-left-width': '',\r\n\t\t'border-right-width': ''\r\n\t});\r\n}\r\n\r\n\r\n// Make the mouse cursor express that an event is not allowed in the current area\r\nfunction disableCursor() {\r\n\t$('body').addClass('fc-not-allowed');\r\n}\r\n\r\n\r\n// Returns the mouse cursor to its original look\r\nfunction enableCursor() {\r\n\t$('body').removeClass('fc-not-allowed');\r\n}\r\n\r\n\r\n// Given a total available height to fill, have `els` (essentially child rows) expand to accomodate.\r\n// By default, all elements that are shorter than the recommended height are expanded uniformly, not considering\r\n// any other els that are already too tall. if `shouldRedistribute` is on, it considers these tall rows and \r\n// reduces the available height.\r\nfunction distributeHeight(els, availableHeight, shouldRedistribute) {\r\n\r\n\t// *FLOORING NOTE*: we floor in certain places because zoom can give inaccurate floating-point dimensions,\r\n\t// and it is better to be shorter than taller, to avoid creating unnecessary scrollbars.\r\n\r\n\tvar minOffset1 = Math.floor(availableHeight / els.length); // for non-last element\r\n\tvar minOffset2 = Math.floor(availableHeight - minOffset1 * (els.length - 1)); // for last element *FLOORING NOTE*\r\n\tvar flexEls = []; // elements that are allowed to expand. array of DOM nodes\r\n\tvar flexOffsets = []; // amount of vertical space it takes up\r\n\tvar flexHeights = []; // actual css height\r\n\tvar usedHeight = 0;\r\n\r\n\tundistributeHeight(els); // give all elements their natural height\r\n\r\n\t// find elements that are below the recommended height (expandable).\r\n\t// important to query for heights in a single first pass (to avoid reflow oscillation).\r\n\tels.each(function(i, el) {\r\n\t\tvar minOffset = i === els.length - 1 ? minOffset2 : minOffset1;\r\n\t\tvar naturalOffset = $(el).outerHeight(true);\r\n\r\n\t\tif (naturalOffset < minOffset) {\r\n\t\t\tflexEls.push(el);\r\n\t\t\tflexOffsets.push(naturalOffset);\r\n\t\t\tflexHeights.push($(el).height());\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// this element stretches past recommended height (non-expandable). mark the space as occupied.\r\n\t\t\tusedHeight += naturalOffset;\r\n\t\t}\r\n\t});\r\n\r\n\t// readjust the recommended height to only consider the height available to non-maxed-out rows.\r\n\tif (shouldRedistribute) {\r\n\t\tavailableHeight -= usedHeight;\r\n\t\tminOffset1 = Math.floor(availableHeight / flexEls.length);\r\n\t\tminOffset2 = Math.floor(availableHeight - minOffset1 * (flexEls.length - 1)); // *FLOORING NOTE*\r\n\t}\r\n\r\n\t// assign heights to all expandable elements\r\n\t$(flexEls).each(function(i, el) {\r\n\t\tvar minOffset = i === flexEls.length - 1 ? minOffset2 : minOffset1;\r\n\t\tvar naturalOffset = flexOffsets[i];\r\n\t\tvar naturalHeight = flexHeights[i];\r\n\t\tvar newHeight = minOffset - (naturalOffset - naturalHeight); // subtract the margin/padding\r\n\r\n\t\tif (naturalOffset < minOffset) { // we check this again because redistribution might have changed things\r\n\t\t\t$(el).height(newHeight);\r\n\t\t}\r\n\t});\r\n}\r\n\r\n\r\n// Undoes distrubuteHeight, restoring all els to their natural height\r\nfunction undistributeHeight(els) {\r\n\tels.height('');\r\n}\r\n\r\n\r\n// Given `els`, a jQuery set of <td> cells, find the cell with the largest natural width and set the widths of all the\r\n// cells to be that width.\r\n// PREREQUISITE: if you want a cell to take up width, it needs to have a single inner element w/ display:inline\r\nfunction matchCellWidths(els) {\r\n\tvar maxInnerWidth = 0;\r\n\r\n\tels.find('> *').each(function(i, innerEl) {\r\n\t\tvar innerWidth = $(innerEl).outerWidth();\r\n\t\tif (innerWidth > maxInnerWidth) {\r\n\t\t\tmaxInnerWidth = innerWidth;\r\n\t\t}\r\n\t});\r\n\r\n\tmaxInnerWidth++; // sometimes not accurate of width the text needs to stay on one line. insurance\r\n\r\n\tels.width(maxInnerWidth);\r\n\r\n\treturn maxInnerWidth;\r\n}\r\n\r\n\r\n// Turns a container element into a scroller if its contents is taller than the allotted height.\r\n// Returns true if the element is now a scroller, false otherwise.\r\n// NOTE: this method is best because it takes weird zooming dimensions into account\r\nfunction setPotentialScroller(containerEl, height) {\r\n\tcontainerEl.height(height).addClass('fc-scroller');\r\n\r\n\t// are scrollbars needed?\r\n\tif (containerEl[0].scrollHeight - 1 > containerEl[0].clientHeight) { // !!! -1 because IE is often off-by-one :(\r\n\t\treturn true;\r\n\t}\r\n\r\n\tunsetScroller(containerEl); // undo\r\n\treturn false;\r\n}\r\n\r\n\r\n// Takes an element that might have been a scroller, and turns it back into a normal element.\r\nfunction unsetScroller(containerEl) {\r\n\tcontainerEl.height('').removeClass('fc-scroller');\r\n}\r\n\r\n\r\n/* General DOM Utilities\r\n----------------------------------------------------------------------------------------------------------------------*/\r\n\r\nfc.getClientRect = getClientRect;\r\nfc.getContentRect = getContentRect;\r\nfc.getScrollbarWidths = getScrollbarWidths;\r\n\r\n\r\n// borrowed from https://github.com/jquery/jquery-ui/blob/1.11.0/ui/core.js#L51\r\nfunction getScrollParent(el) {\r\n\tvar position = el.css('position'),\r\n\t\tscrollParent = el.parents().filter(function() {\r\n\t\t\tvar parent = $(this);\r\n\t\t\treturn (/(auto|scroll)/).test(\r\n\t\t\t\tparent.css('overflow') + parent.css('overflow-y') + parent.css('overflow-x')\r\n\t\t\t);\r\n\t\t}).eq(0);\r\n\r\n\treturn position === 'fixed' || !scrollParent.length ? $(el[0].ownerDocument || document) : scrollParent;\r\n}\r\n\r\n\r\n// Queries the outer bounding area of a jQuery element.\r\n// Returns a rectangle with absolute coordinates: left, right (exclusive), top, bottom (exclusive).\r\nfunction getOuterRect(el) {\r\n\tvar offset = el.offset();\r\n\r\n\treturn {\r\n\t\tleft: offset.left,\r\n\t\tright: offset.left + el.outerWidth(),\r\n\t\ttop: offset.top,\r\n\t\tbottom: offset.top + el.outerHeight()\r\n\t};\r\n}\r\n\r\n\r\n// Queries the area within the margin/border/scrollbars of a jQuery element. Does not go within the padding.\r\n// Returns a rectangle with absolute coordinates: left, right (exclusive), top, bottom (exclusive).\r\n// NOTE: should use clientLeft/clientTop, but very unreliable cross-browser.\r\nfunction getClientRect(el) {\r\n\tvar offset = el.offset();\r\n\tvar scrollbarWidths = getScrollbarWidths(el);\r\n\tvar left = offset.left + getCssFloat(el, 'border-left-width') + scrollbarWidths.left;\r\n\tvar top = offset.top + getCssFloat(el, 'border-top-width') + scrollbarWidths.top;\r\n\r\n\treturn {\r\n\t\tleft: left,\r\n\t\tright: left + el[0].clientWidth, // clientWidth includes padding but NOT scrollbars\r\n\t\ttop: top,\r\n\t\tbottom: top + el[0].clientHeight // clientHeight includes padding but NOT scrollbars\r\n\t};\r\n}\r\n\r\n\r\n// Queries the area within the margin/border/padding of a jQuery element. Assumed not to have scrollbars.\r\n// Returns a rectangle with absolute coordinates: left, right (exclusive), top, bottom (exclusive).\r\nfunction getContentRect(el) {\r\n\tvar offset = el.offset(); // just outside of border, margin not included\r\n\tvar left = offset.left + getCssFloat(el, 'border-left-width') + getCssFloat(el, 'padding-left');\r\n\tvar top = offset.top + getCssFloat(el, 'border-top-width') + getCssFloat(el, 'padding-top');\r\n\r\n\treturn {\r\n\t\tleft: left,\r\n\t\tright: left + el.width(),\r\n\t\ttop: top,\r\n\t\tbottom: top + el.height()\r\n\t};\r\n}\r\n\r\n\r\n// Returns the computed left/right/top/bottom scrollbar widths for the given jQuery element.\r\n// NOTE: should use clientLeft/clientTop, but very unreliable cross-browser.\r\nfunction getScrollbarWidths(el) {\r\n\tvar leftRightWidth = el.innerWidth() - el[0].clientWidth; // the paddings cancel out, leaving the scrollbars\r\n\tvar widths = {\r\n\t\tleft: 0,\r\n\t\tright: 0,\r\n\t\ttop: 0,\r\n\t\tbottom: el.innerHeight() - el[0].clientHeight // the paddings cancel out, leaving the bottom scrollbar\r\n\t};\r\n\r\n\tif (getIsLeftRtlScrollbars() && el.css('direction') == 'rtl') { // is the scrollbar on the left side?\r\n\t\twidths.left = leftRightWidth;\r\n\t}\r\n\telse {\r\n\t\twidths.right = leftRightWidth;\r\n\t}\r\n\r\n\treturn widths;\r\n}\r\n\r\n\r\n// Logic for determining if, when the element is right-to-left, the scrollbar appears on the left side\r\n\r\nvar _isLeftRtlScrollbars = null;\r\n\r\nfunction getIsLeftRtlScrollbars() { // responsible for caching the computation\r\n\tif (_isLeftRtlScrollbars === null) {\r\n\t\t_isLeftRtlScrollbars = computeIsLeftRtlScrollbars();\r\n\t}\r\n\treturn _isLeftRtlScrollbars;\r\n}\r\n\r\nfunction computeIsLeftRtlScrollbars() { // creates an offscreen test element, then removes it\r\n\tvar el = $('<div><div/></div>')\r\n\t\t.css({\r\n\t\t\tposition: 'absolute',\r\n\t\t\ttop: -1000,\r\n\t\t\tleft: 0,\r\n\t\t\tborder: 0,\r\n\t\t\tpadding: 0,\r\n\t\t\toverflow: 'scroll',\r\n\t\t\tdirection: 'rtl'\r\n\t\t})\r\n\t\t.appendTo('body');\r\n\tvar innerEl = el.children();\r\n\tvar res = innerEl.offset().left > el.offset().left; // is the inner div shifted to accommodate a left scrollbar?\r\n\tel.remove();\r\n\treturn res;\r\n}\r\n\r\n\r\n// Retrieves a jQuery element's computed CSS value as a floating-point number.\r\n// If the queried value is non-numeric (ex: IE can return \"medium\" for border width), will just return zero.\r\nfunction getCssFloat(el, prop) {\r\n\treturn parseFloat(el.css(prop)) || 0;\r\n}\r\n\r\n\r\n// Returns a boolean whether this was a left mouse click and no ctrl key (which means right click on Mac)\r\nfunction isPrimaryMouseButton(ev) {\r\n\treturn ev.which == 1 && !ev.ctrlKey;\r\n}\r\n\r\n\r\n/* Geometry\r\n----------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n// Returns a new rectangle that is the intersection of the two rectangles. If they don't intersect, returns false\r\nfunction intersectRects(rect1, rect2) {\r\n\tvar res = {\r\n\t\tleft: Math.max(rect1.left, rect2.left),\r\n\t\tright: Math.min(rect1.right, rect2.right),\r\n\t\ttop: Math.max(rect1.top, rect2.top),\r\n\t\tbottom: Math.min(rect1.bottom, rect2.bottom)\r\n\t};\r\n\r\n\tif (res.left < res.right && res.top < res.bottom) {\r\n\t\treturn res;\r\n\t}\r\n\treturn false;\r\n}\r\n\r\n\r\n// Returns a new point that will have been moved to reside within the given rectangle\r\nfunction constrainPoint(point, rect) {\r\n\treturn {\r\n\t\tleft: Math.min(Math.max(point.left, rect.left), rect.right),\r\n\t\ttop: Math.min(Math.max(point.top, rect.top), rect.bottom)\r\n\t};\r\n}\r\n\r\n\r\n// Returns a point that is the center of the given rectangle\r\nfunction getRectCenter(rect) {\r\n\treturn {\r\n\t\tleft: (rect.left + rect.right) / 2,\r\n\t\ttop: (rect.top + rect.bottom) / 2\r\n\t};\r\n}\r\n\r\n\r\n// Subtracts point2's coordinates from point1's coordinates, returning a delta\r\nfunction diffPoints(point1, point2) {\r\n\treturn {\r\n\t\tleft: point1.left - point2.left,\r\n\t\ttop: point1.top - point2.top\r\n\t};\r\n}\r\n\r\n\r\n/* FullCalendar-specific Misc Utilities\r\n----------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n// Creates a basic segment with the intersection of the two ranges. Returns undefined if no intersection.\r\n// Expects all dates to be normalized to the same timezone beforehand.\r\n// TODO: move to date section?\r\nfunction intersectionToSeg(subjectRange, constraintRange) {\r\n\tvar subjectStart = subjectRange.start;\r\n\tvar subjectEnd = subjectRange.end;\r\n\tvar constraintStart = constraintRange.start;\r\n\tvar constraintEnd = constraintRange.end;\r\n\tvar segStart, segEnd;\r\n\tvar isStart, isEnd;\r\n\r\n\tif (subjectEnd > constraintStart && subjectStart < constraintEnd) { // in bounds at all?\r\n\r\n\t\tif (subjectStart >= constraintStart) {\r\n\t\t\tsegStart = subjectStart.clone();\r\n\t\t\tisStart = true;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tsegStart = constraintStart.clone();\r\n\t\t\tisStart =  false;\r\n\t\t}\r\n\r\n\t\tif (subjectEnd <= constraintEnd) {\r\n\t\t\tsegEnd = subjectEnd.clone();\r\n\t\t\tisEnd = true;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tsegEnd = constraintEnd.clone();\r\n\t\t\tisEnd = false;\r\n\t\t}\r\n\r\n\t\treturn {\r\n\t\t\tstart: segStart,\r\n\t\t\tend: segEnd,\r\n\t\t\tisStart: isStart,\r\n\t\t\tisEnd: isEnd\r\n\t\t};\r\n\t}\r\n}\r\n\r\n\r\n/* Date Utilities\r\n----------------------------------------------------------------------------------------------------------------------*/\r\n\r\nfc.computeIntervalUnit = computeIntervalUnit;\r\nfc.durationHasTime = durationHasTime;\r\n\r\nvar dayIDs = [ 'sun', 'mon', 'tue', 'wed', 'thu', 'fri', 'sat' ];\r\nvar intervalUnits = [ 'year', 'month', 'week', 'day', 'hour', 'minute', 'second', 'millisecond' ];\r\n\r\n\r\n// Diffs the two moments into a Duration where full-days are recorded first, then the remaining time.\r\n// Moments will have their timezones normalized.\r\nfunction diffDayTime(a, b) {\r\n\treturn moment.duration({\r\n\t\tdays: a.clone().stripTime().diff(b.clone().stripTime(), 'days'),\r\n\t\tms: a.time() - b.time() // time-of-day from day start. disregards timezone\r\n\t});\r\n}\r\n\r\n\r\n// Diffs the two moments via their start-of-day (regardless of timezone). Produces whole-day durations.\r\nfunction diffDay(a, b) {\r\n\treturn moment.duration({\r\n\t\tdays: a.clone().stripTime().diff(b.clone().stripTime(), 'days')\r\n\t});\r\n}\r\n\r\n\r\n// Diffs two moments, producing a duration, made of a whole-unit-increment of the given unit. Uses rounding.\r\nfunction diffByUnit(a, b, unit) {\r\n\treturn moment.duration(\r\n\t\tMath.round(a.diff(b, unit, true)), // returnFloat=true\r\n\t\tunit\r\n\t);\r\n}\r\n\r\n\r\n// Computes the unit name of the largest whole-unit period of time.\r\n// For example, 48 hours will be \"days\" whereas 49 hours will be \"hours\".\r\n// Accepts start/end, a range object, or an original duration object.\r\nfunction computeIntervalUnit(start, end) {\r\n\tvar i, unit;\r\n\tvar val;\r\n\r\n\tfor (i = 0; i < intervalUnits.length; i++) {\r\n\t\tunit = intervalUnits[i];\r\n\t\tval = computeRangeAs(unit, start, end);\r\n\r\n\t\tif (val >= 1 && isInt(val)) {\r\n\t\t\tbreak;\r\n\t\t}\r\n\t}\r\n\r\n\treturn unit; // will be \"milliseconds\" if nothing else matches\r\n}\r\n\r\n\r\n// Computes the number of units (like \"hours\") in the given range.\r\n// Range can be a {start,end} object, separate start/end args, or a Duration.\r\n// Results are based on Moment's .as() and .diff() methods, so results can depend on internal handling\r\n// of month-diffing logic (which tends to vary from version to version).\r\nfunction computeRangeAs(unit, start, end) {\r\n\r\n\tif (end != null) { // given start, end\r\n\t\treturn end.diff(start, unit, true);\r\n\t}\r\n\telse if (moment.isDuration(start)) { // given duration\r\n\t\treturn start.as(unit);\r\n\t}\r\n\telse { // given { start, end } range object\r\n\t\treturn start.end.diff(start.start, unit, true);\r\n\t}\r\n}\r\n\r\n\r\n// Returns a boolean about whether the given duration has any time parts (hours/minutes/seconds/ms)\r\nfunction durationHasTime(dur) {\r\n\treturn Boolean(dur.hours() || dur.minutes() || dur.seconds() || dur.milliseconds());\r\n}\r\n\r\n\r\nfunction isNativeDate(input) {\r\n\treturn  Object.prototype.toString.call(input) === '[object Date]' || input instanceof Date;\r\n}\r\n\r\n\r\n// Returns a boolean about whether the given input is a time string, like \"06:40:00\" or \"06:00\"\r\nfunction isTimeString(str) {\r\n\treturn /^\\d+\\:\\d+(?:\\:\\d+\\.?(?:\\d{3})?)?$/.test(str);\r\n}\r\n\r\n\r\n/* General Utilities\r\n----------------------------------------------------------------------------------------------------------------------*/\r\n\r\nvar hasOwnPropMethod = {}.hasOwnProperty;\r\n\r\n\r\n// Create an object that has the given prototype. Just like Object.create\r\nfunction createObject(proto) {\r\n\tvar f = function() {};\r\n\tf.prototype = proto;\r\n\treturn new f();\r\n}\r\n\r\n\r\nfunction copyOwnProps(src, dest) {\r\n\tfor (var name in src) {\r\n\t\tif (hasOwnProp(src, name)) {\r\n\t\t\tdest[name] = src[name];\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\n// Copies over certain methods with the same names as Object.prototype methods. Overcomes an IE<=8 bug:\r\n// https://developer.mozilla.org/en-US/docs/ECMAScript_DontEnum_attribute#JScript_DontEnum_Bug\r\nfunction copyNativeMethods(src, dest) {\r\n\tvar names = [ 'constructor', 'toString', 'valueOf' ];\r\n\tvar i, name;\r\n\r\n\tfor (i = 0; i < names.length; i++) {\r\n\t\tname = names[i];\r\n\r\n\t\tif (src[name] !== Object.prototype[name]) {\r\n\t\t\tdest[name] = src[name];\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\nfunction hasOwnProp(obj, name) {\r\n\treturn hasOwnPropMethod.call(obj, name);\r\n}\r\n\r\n\r\n// Is the given value a non-object non-function value?\r\nfunction isAtomic(val) {\r\n\treturn /undefined|null|boolean|number|string/.test($.type(val));\r\n}\r\n\r\n\r\nfunction applyAll(functions, thisObj, args) {\r\n\tif ($.isFunction(functions)) {\r\n\t\tfunctions = [ functions ];\r\n\t}\r\n\tif (functions) {\r\n\t\tvar i;\r\n\t\tvar ret;\r\n\t\tfor (i=0; i<functions.length; i++) {\r\n\t\t\tret = functions[i].apply(thisObj, args) || ret;\r\n\t\t}\r\n\t\treturn ret;\r\n\t}\r\n}\r\n\r\n\r\nfunction firstDefined() {\r\n\tfor (var i=0; i<arguments.length; i++) {\r\n\t\tif (arguments[i] !== undefined) {\r\n\t\t\treturn arguments[i];\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\nfunction htmlEscape(s) {\r\n\treturn (s + '').replace(/&/g, '&amp;')\r\n\t\t.replace(/</g, '&lt;')\r\n\t\t.replace(/>/g, '&gt;')\r\n\t\t.replace(/'/g, '&#039;')\r\n\t\t.replace(/\"/g, '&quot;')\r\n\t\t.replace(/\\n/g, '<br />');\r\n}\r\n\r\n\r\nfunction stripHtmlEntities(text) {\r\n\treturn text.replace(/&.*?;/g, '');\r\n}\r\n\r\n\r\n// Given a hash of CSS properties, returns a string of CSS.\r\n// Uses property names as-is (no camel-case conversion). Will not make statements for null/undefined values.\r\nfunction cssToStr(cssProps) {\r\n\tvar statements = [];\r\n\r\n\t$.each(cssProps, function(name, val) {\r\n\t\tif (val != null) {\r\n\t\t\tstatements.push(name + ':' + val);\r\n\t\t}\r\n\t});\r\n\r\n\treturn statements.join(';');\r\n}\r\n\r\n\r\nfunction capitaliseFirstLetter(str) {\r\n\treturn str.charAt(0).toUpperCase() + str.slice(1);\r\n}\r\n\r\n\r\nfunction compareNumbers(a, b) { // for .sort()\r\n\treturn a - b;\r\n}\r\n\r\n\r\nfunction isInt(n) {\r\n\treturn n % 1 === 0;\r\n}\r\n\r\n\r\n// Returns a method bound to the given object context.\r\n// Just like one of the jQuery.proxy signatures, but without the undesired behavior of treating the same method with\r\n// different contexts as identical when binding/unbinding events.\r\nfunction proxy(obj, methodName) {\r\n\tvar method = obj[methodName];\r\n\r\n\treturn function() {\r\n\t\treturn method.apply(obj, arguments);\r\n\t};\r\n}\r\n\r\n\r\n// Returns a function, that, as long as it continues to be invoked, will not\r\n// be triggered. The function will be called after it stops being called for\r\n// N milliseconds.\r\n// https://github.com/jashkenas/underscore/blob/1.6.0/underscore.js#L714\r\nfunction debounce(func, wait) {\r\n\tvar timeoutId;\r\n\tvar args;\r\n\tvar context;\r\n\tvar timestamp; // of most recent call\r\n\tvar later = function() {\r\n\t\tvar last = +new Date() - timestamp;\r\n\t\tif (last < wait && last > 0) {\r\n\t\t\ttimeoutId = setTimeout(later, wait - last);\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttimeoutId = null;\r\n\t\t\tfunc.apply(context, args);\r\n\t\t\tif (!timeoutId) {\r\n\t\t\t\tcontext = args = null;\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\treturn function() {\r\n\t\tcontext = this;\r\n\t\targs = arguments;\r\n\t\ttimestamp = +new Date();\r\n\t\tif (!timeoutId) {\r\n\t\t\ttimeoutId = setTimeout(later, wait);\r\n\t\t}\r\n\t};\r\n}\r\n\r\n;;\r\n\r\nvar ambigDateOfMonthRegex = /^\\s*\\d{4}-\\d\\d$/;\r\nvar ambigTimeOrZoneRegex =\r\n\t/^\\s*\\d{4}-(?:(\\d\\d-\\d\\d)|(W\\d\\d$)|(W\\d\\d-\\d)|(\\d\\d\\d))((T| )(\\d\\d(:\\d\\d(:\\d\\d(\\.\\d+)?)?)?)?)?$/;\r\nvar newMomentProto = moment.fn; // where we will attach our new methods\r\nvar oldMomentProto = $.extend({}, newMomentProto); // copy of original moment methods\r\nvar allowValueOptimization;\r\nvar setUTCValues; // function defined below\r\nvar setLocalValues; // function defined below\r\n\r\n\r\n// Creating\r\n// -------------------------------------------------------------------------------------------------\r\n\r\n// Creates a new moment, similar to the vanilla moment(...) constructor, but with\r\n// extra features (ambiguous time, enhanced formatting). When given an existing moment,\r\n// it will function as a clone (and retain the zone of the moment). Anything else will\r\n// result in a moment in the local zone.\r\nfc.moment = function() {\r\n\treturn makeMoment(arguments);\r\n};\r\n\r\n// Sames as fc.moment, but forces the resulting moment to be in the UTC timezone.\r\nfc.moment.utc = function() {\r\n\tvar mom = makeMoment(arguments, true);\r\n\r\n\t// Force it into UTC because makeMoment doesn't guarantee it\r\n\t// (if given a pre-existing moment for example)\r\n\tif (mom.hasTime()) { // don't give ambiguously-timed moments a UTC zone\r\n\t\tmom.utc();\r\n\t}\r\n\r\n\treturn mom;\r\n};\r\n\r\n// Same as fc.moment, but when given an ISO8601 string, the timezone offset is preserved.\r\n// ISO8601 strings with no timezone offset will become ambiguously zoned.\r\nfc.moment.parseZone = function() {\r\n\treturn makeMoment(arguments, true, true);\r\n};\r\n\r\n// Builds an enhanced moment from args. When given an existing moment, it clones. When given a\r\n// native Date, or called with no arguments (the current time), the resulting moment will be local.\r\n// Anything else needs to be \"parsed\" (a string or an array), and will be affected by:\r\n//    parseAsUTC - if there is no zone information, should we parse the input in UTC?\r\n//    parseZone - if there is zone information, should we force the zone of the moment?\r\nfunction makeMoment(args, parseAsUTC, parseZone) {\r\n\tvar input = args[0];\r\n\tvar isSingleString = args.length == 1 && typeof input === 'string';\r\n\tvar isAmbigTime;\r\n\tvar isAmbigZone;\r\n\tvar ambigMatch;\r\n\tvar mom;\r\n\r\n\tif (moment.isMoment(input)) {\r\n\t\tmom = moment.apply(null, args); // clone it\r\n\t\ttransferAmbigs(input, mom); // the ambig flags weren't transfered with the clone\r\n\t}\r\n\telse if (isNativeDate(input) || input === undefined) {\r\n\t\tmom = moment.apply(null, args); // will be local\r\n\t}\r\n\telse { // \"parsing\" is required\r\n\t\tisAmbigTime = false;\r\n\t\tisAmbigZone = false;\r\n\r\n\t\tif (isSingleString) {\r\n\t\t\tif (ambigDateOfMonthRegex.test(input)) {\r\n\t\t\t\t// accept strings like '2014-05', but convert to the first of the month\r\n\t\t\t\tinput += '-01';\r\n\t\t\t\targs = [ input ]; // for when we pass it on to moment's constructor\r\n\t\t\t\tisAmbigTime = true;\r\n\t\t\t\tisAmbigZone = true;\r\n\t\t\t}\r\n\t\t\telse if ((ambigMatch = ambigTimeOrZoneRegex.exec(input))) {\r\n\t\t\t\tisAmbigTime = !ambigMatch[5]; // no time part?\r\n\t\t\t\tisAmbigZone = true;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if ($.isArray(input)) {\r\n\t\t\t// arrays have no timezone information, so assume ambiguous zone\r\n\t\t\tisAmbigZone = true;\r\n\t\t}\r\n\t\t// otherwise, probably a string with a format\r\n\r\n\t\tif (parseAsUTC || isAmbigTime) {\r\n\t\t\tmom = moment.utc.apply(moment, args);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tmom = moment.apply(null, args);\r\n\t\t}\r\n\r\n\t\tif (isAmbigTime) {\r\n\t\t\tmom._ambigTime = true;\r\n\t\t\tmom._ambigZone = true; // ambiguous time always means ambiguous zone\r\n\t\t}\r\n\t\telse if (parseZone) { // let's record the inputted zone somehow\r\n\t\t\tif (isAmbigZone) {\r\n\t\t\t\tmom._ambigZone = true;\r\n\t\t\t}\r\n\t\t\telse if (isSingleString) {\r\n\t\t\t\tif (mom.utcOffset) {\r\n\t\t\t\t\tmom.utcOffset(input); // if not a valid zone, will assign UTC\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tmom.zone(input); // for moment-pre-2.9\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tmom._fullCalendar = true; // flag for extended functionality\r\n\r\n\treturn mom;\r\n}\r\n\r\n\r\n// A clone method that works with the flags related to our enhanced functionality.\r\n// In the future, use moment.momentProperties\r\nnewMomentProto.clone = function() {\r\n\tvar mom = oldMomentProto.clone.apply(this, arguments);\r\n\r\n\t// these flags weren't transfered with the clone\r\n\ttransferAmbigs(this, mom);\r\n\tif (this._fullCalendar) {\r\n\t\tmom._fullCalendar = true;\r\n\t}\r\n\r\n\treturn mom;\r\n};\r\n\r\n\r\n// Week Number\r\n// -------------------------------------------------------------------------------------------------\r\n\r\n\r\n// Returns the week number, considering the locale's custom week number calcuation\r\n// `weeks` is an alias for `week`\r\nnewMomentProto.week = newMomentProto.weeks = function(input) {\r\n\tvar weekCalc = (this._locale || this._lang) // works pre-moment-2.8\r\n\t\t._fullCalendar_weekCalc;\r\n\r\n\tif (input == null && typeof weekCalc === 'function') { // custom function only works for getter\r\n\t\treturn weekCalc(this);\r\n\t}\r\n\telse if (weekCalc === 'ISO') {\r\n\t\treturn oldMomentProto.isoWeek.apply(this, arguments); // ISO getter/setter\r\n\t}\r\n\r\n\treturn oldMomentProto.week.apply(this, arguments); // local getter/setter\r\n};\r\n\r\n\r\n// Time-of-day\r\n// -------------------------------------------------------------------------------------------------\r\n\r\n// GETTER\r\n// Returns a Duration with the hours/minutes/seconds/ms values of the moment.\r\n// If the moment has an ambiguous time, a duration of 00:00 will be returned.\r\n//\r\n// SETTER\r\n// You can supply a Duration, a Moment, or a Duration-like argument.\r\n// When setting the time, and the moment has an ambiguous time, it then becomes unambiguous.\r\nnewMomentProto.time = function(time) {\r\n\r\n\t// Fallback to the original method (if there is one) if this moment wasn't created via FullCalendar.\r\n\t// `time` is a generic enough method name where this precaution is necessary to avoid collisions w/ other plugins.\r\n\tif (!this._fullCalendar) {\r\n\t\treturn oldMomentProto.time.apply(this, arguments);\r\n\t}\r\n\r\n\tif (time == null) { // getter\r\n\t\treturn moment.duration({\r\n\t\t\thours: this.hours(),\r\n\t\t\tminutes: this.minutes(),\r\n\t\t\tseconds: this.seconds(),\r\n\t\t\tmilliseconds: this.milliseconds()\r\n\t\t});\r\n\t}\r\n\telse { // setter\r\n\r\n\t\tthis._ambigTime = false; // mark that the moment now has a time\r\n\r\n\t\tif (!moment.isDuration(time) && !moment.isMoment(time)) {\r\n\t\t\ttime = moment.duration(time);\r\n\t\t}\r\n\r\n\t\t// The day value should cause overflow (so 24 hours becomes 00:00:00 of next day).\r\n\t\t// Only for Duration times, not Moment times.\r\n\t\tvar dayHours = 0;\r\n\t\tif (moment.isDuration(time)) {\r\n\t\t\tdayHours = Math.floor(time.asDays()) * 24;\r\n\t\t}\r\n\r\n\t\t// We need to set the individual fields.\r\n\t\t// Can't use startOf('day') then add duration. In case of DST at start of day.\r\n\t\treturn this.hours(dayHours + time.hours())\r\n\t\t\t.minutes(time.minutes())\r\n\t\t\t.seconds(time.seconds())\r\n\t\t\t.milliseconds(time.milliseconds());\r\n\t}\r\n};\r\n\r\n// Converts the moment to UTC, stripping out its time-of-day and timezone offset,\r\n// but preserving its YMD. A moment with a stripped time will display no time\r\n// nor timezone offset when .format() is called.\r\nnewMomentProto.stripTime = function() {\r\n\tvar a;\r\n\r\n\tif (!this._ambigTime) {\r\n\r\n\t\t// get the values before any conversion happens\r\n\t\ta = this.toArray(); // array of y/m/d/h/m/s/ms\r\n\r\n\t\t// TODO: use keepLocalTime in the future\r\n\t\tthis.utc(); // set the internal UTC flag (will clear the ambig flags)\r\n\t\tsetUTCValues(this, a.slice(0, 3)); // set the year/month/date. time will be zero\r\n\r\n\t\t// Mark the time as ambiguous. This needs to happen after the .utc() call, which might call .utcOffset(),\r\n\t\t// which clears all ambig flags. Same with setUTCValues with moment-timezone.\r\n\t\tthis._ambigTime = true;\r\n\t\tthis._ambigZone = true; // if ambiguous time, also ambiguous timezone offset\r\n\t}\r\n\r\n\treturn this; // for chaining\r\n};\r\n\r\n// Returns if the moment has a non-ambiguous time (boolean)\r\nnewMomentProto.hasTime = function() {\r\n\treturn !this._ambigTime;\r\n};\r\n\r\n\r\n// Timezone\r\n// -------------------------------------------------------------------------------------------------\r\n\r\n// Converts the moment to UTC, stripping out its timezone offset, but preserving its\r\n// YMD and time-of-day. A moment with a stripped timezone offset will display no\r\n// timezone offset when .format() is called.\r\n// TODO: look into Moment's keepLocalTime functionality\r\nnewMomentProto.stripZone = function() {\r\n\tvar a, wasAmbigTime;\r\n\r\n\tif (!this._ambigZone) {\r\n\r\n\t\t// get the values before any conversion happens\r\n\t\ta = this.toArray(); // array of y/m/d/h/m/s/ms\r\n\t\twasAmbigTime = this._ambigTime;\r\n\r\n\t\tthis.utc(); // set the internal UTC flag (might clear the ambig flags, depending on Moment internals)\r\n\t\tsetUTCValues(this, a); // will set the year/month/date/hours/minutes/seconds/ms\r\n\r\n\t\t// the above call to .utc()/.utcOffset() unfortunately might clear the ambig flags, so restore\r\n\t\tthis._ambigTime = wasAmbigTime || false;\r\n\r\n\t\t// Mark the zone as ambiguous. This needs to happen after the .utc() call, which might call .utcOffset(),\r\n\t\t// which clears the ambig flags. Same with setUTCValues with moment-timezone.\r\n\t\tthis._ambigZone = true;\r\n\t}\r\n\r\n\treturn this; // for chaining\r\n};\r\n\r\n// Returns of the moment has a non-ambiguous timezone offset (boolean)\r\nnewMomentProto.hasZone = function() {\r\n\treturn !this._ambigZone;\r\n};\r\n\r\n\r\n// this method implicitly marks a zone\r\nnewMomentProto.local = function() {\r\n\tvar a = this.toArray(); // year,month,date,hours,minutes,seconds,ms as an array\r\n\tvar wasAmbigZone = this._ambigZone;\r\n\r\n\toldMomentProto.local.apply(this, arguments);\r\n\r\n\t// ensure non-ambiguous\r\n\t// this probably already happened via local() -> utcOffset(), but don't rely on Moment's internals\r\n\tthis._ambigTime = false;\r\n\tthis._ambigZone = false;\r\n\r\n\tif (wasAmbigZone) {\r\n\t\t// If the moment was ambiguously zoned, the date fields were stored as UTC.\r\n\t\t// We want to preserve these, but in local time.\r\n\t\t// TODO: look into Moment's keepLocalTime functionality\r\n\t\tsetLocalValues(this, a);\r\n\t}\r\n\r\n\treturn this; // for chaining\r\n};\r\n\r\n\r\n// implicitly marks a zone\r\nnewMomentProto.utc = function() {\r\n\toldMomentProto.utc.apply(this, arguments);\r\n\r\n\t// ensure non-ambiguous\r\n\t// this probably already happened via utc() -> utcOffset(), but don't rely on Moment's internals\r\n\tthis._ambigTime = false;\r\n\tthis._ambigZone = false;\r\n\r\n\treturn this;\r\n};\r\n\r\n\r\n// methods for arbitrarily manipulating timezone offset.\r\n// should clear time/zone ambiguity when called.\r\n$.each([\r\n\t'zone', // only in moment-pre-2.9. deprecated afterwards\r\n\t'utcOffset'\r\n], function(i, name) {\r\n\tif (oldMomentProto[name]) { // original method exists?\r\n\r\n\t\t// this method implicitly marks a zone (will probably get called upon .utc() and .local())\r\n\t\tnewMomentProto[name] = function(tzo) {\r\n\r\n\t\t\tif (tzo != null) { // setter\r\n\t\t\t\t// these assignments needs to happen before the original zone method is called.\r\n\t\t\t\t// I forget why, something to do with a browser crash.\r\n\t\t\t\tthis._ambigTime = false;\r\n\t\t\t\tthis._ambigZone = false;\r\n\t\t\t}\r\n\r\n\t\t\treturn oldMomentProto[name].apply(this, arguments);\r\n\t\t};\r\n\t}\r\n});\r\n\r\n\r\n// Formatting\r\n// -------------------------------------------------------------------------------------------------\r\n\r\nnewMomentProto.format = function() {\r\n\tif (this._fullCalendar && arguments[0]) { // an enhanced moment? and a format string provided?\r\n\t\treturn formatDate(this, arguments[0]); // our extended formatting\r\n\t}\r\n\tif (this._ambigTime) {\r\n\t\treturn oldMomentFormat(this, 'YYYY-MM-DD');\r\n\t}\r\n\tif (this._ambigZone) {\r\n\t\treturn oldMomentFormat(this, 'YYYY-MM-DD[T]HH:mm:ss');\r\n\t}\r\n\treturn oldMomentProto.format.apply(this, arguments);\r\n};\r\n\r\nnewMomentProto.toISOString = function() {\r\n\tif (this._ambigTime) {\r\n\t\treturn oldMomentFormat(this, 'YYYY-MM-DD');\r\n\t}\r\n\tif (this._ambigZone) {\r\n\t\treturn oldMomentFormat(this, 'YYYY-MM-DD[T]HH:mm:ss');\r\n\t}\r\n\treturn oldMomentProto.toISOString.apply(this, arguments);\r\n};\r\n\r\n\r\n// Querying\r\n// -------------------------------------------------------------------------------------------------\r\n\r\n// Is the moment within the specified range? `end` is exclusive.\r\n// FYI, this method is not a standard Moment method, so always do our enhanced logic.\r\nnewMomentProto.isWithin = function(start, end) {\r\n\tvar a = commonlyAmbiguate([ this, start, end ]);\r\n\treturn a[0] >= a[1] && a[0] < a[2];\r\n};\r\n\r\n// When isSame is called with units, timezone ambiguity is normalized before the comparison happens.\r\n// If no units specified, the two moments must be identically the same, with matching ambig flags.\r\nnewMomentProto.isSame = function(input, units) {\r\n\tvar a;\r\n\r\n\t// only do custom logic if this is an enhanced moment\r\n\tif (!this._fullCalendar) {\r\n\t\treturn oldMomentProto.isSame.apply(this, arguments);\r\n\t}\r\n\r\n\tif (units) {\r\n\t\ta = commonlyAmbiguate([ this, input ], true); // normalize timezones but don't erase times\r\n\t\treturn oldMomentProto.isSame.call(a[0], a[1], units);\r\n\t}\r\n\telse {\r\n\t\tinput = fc.moment.parseZone(input); // normalize input\r\n\t\treturn oldMomentProto.isSame.call(this, input) &&\r\n\t\t\tBoolean(this._ambigTime) === Boolean(input._ambigTime) &&\r\n\t\t\tBoolean(this._ambigZone) === Boolean(input._ambigZone);\r\n\t}\r\n};\r\n\r\n// Make these query methods work with ambiguous moments\r\n$.each([\r\n\t'isBefore',\r\n\t'isAfter'\r\n], function(i, methodName) {\r\n\tnewMomentProto[methodName] = function(input, units) {\r\n\t\tvar a;\r\n\r\n\t\t// only do custom logic if this is an enhanced moment\r\n\t\tif (!this._fullCalendar) {\r\n\t\t\treturn oldMomentProto[methodName].apply(this, arguments);\r\n\t\t}\r\n\r\n\t\ta = commonlyAmbiguate([ this, input ]);\r\n\t\treturn oldMomentProto[methodName].call(a[0], a[1], units);\r\n\t};\r\n});\r\n\r\n\r\n// Misc Internals\r\n// -------------------------------------------------------------------------------------------------\r\n\r\n// given an array of moment-like inputs, return a parallel array w/ moments similarly ambiguated.\r\n// for example, of one moment has ambig time, but not others, all moments will have their time stripped.\r\n// set `preserveTime` to `true` to keep times, but only normalize zone ambiguity.\r\n// returns the original moments if no modifications are necessary.\r\nfunction commonlyAmbiguate(inputs, preserveTime) {\r\n\tvar anyAmbigTime = false;\r\n\tvar anyAmbigZone = false;\r\n\tvar len = inputs.length;\r\n\tvar moms = [];\r\n\tvar i, mom;\r\n\r\n\t// parse inputs into real moments and query their ambig flags\r\n\tfor (i = 0; i < len; i++) {\r\n\t\tmom = inputs[i];\r\n\t\tif (!moment.isMoment(mom)) {\r\n\t\t\tmom = fc.moment.parseZone(mom);\r\n\t\t}\r\n\t\tanyAmbigTime = anyAmbigTime || mom._ambigTime;\r\n\t\tanyAmbigZone = anyAmbigZone || mom._ambigZone;\r\n\t\tmoms.push(mom);\r\n\t}\r\n\r\n\t// strip each moment down to lowest common ambiguity\r\n\t// use clones to avoid modifying the original moments\r\n\tfor (i = 0; i < len; i++) {\r\n\t\tmom = moms[i];\r\n\t\tif (!preserveTime && anyAmbigTime && !mom._ambigTime) {\r\n\t\t\tmoms[i] = mom.clone().stripTime();\r\n\t\t}\r\n\t\telse if (anyAmbigZone && !mom._ambigZone) {\r\n\t\t\tmoms[i] = mom.clone().stripZone();\r\n\t\t}\r\n\t}\r\n\r\n\treturn moms;\r\n}\r\n\r\n// Transfers all the flags related to ambiguous time/zone from the `src` moment to the `dest` moment\r\n// TODO: look into moment.momentProperties for this.\r\nfunction transferAmbigs(src, dest) {\r\n\tif (src._ambigTime) {\r\n\t\tdest._ambigTime = true;\r\n\t}\r\n\telse if (dest._ambigTime) {\r\n\t\tdest._ambigTime = false;\r\n\t}\r\n\r\n\tif (src._ambigZone) {\r\n\t\tdest._ambigZone = true;\r\n\t}\r\n\telse if (dest._ambigZone) {\r\n\t\tdest._ambigZone = false;\r\n\t}\r\n}\r\n\r\n\r\n// Sets the year/month/date/etc values of the moment from the given array.\r\n// Inefficient because it calls each individual setter.\r\nfunction setMomentValues(mom, a) {\r\n\tmom.year(a[0] || 0)\r\n\t\t.month(a[1] || 0)\r\n\t\t.date(a[2] || 0)\r\n\t\t.hours(a[3] || 0)\r\n\t\t.minutes(a[4] || 0)\r\n\t\t.seconds(a[5] || 0)\r\n\t\t.milliseconds(a[6] || 0);\r\n}\r\n\r\n// Can we set the moment's internal date directly?\r\nallowValueOptimization = '_d' in moment() && 'updateOffset' in moment;\r\n\r\n// Utility function. Accepts a moment and an array of the UTC year/month/date/etc values to set.\r\n// Assumes the given moment is already in UTC mode.\r\nsetUTCValues = allowValueOptimization ? function(mom, a) {\r\n\t// simlate what moment's accessors do\r\n\tmom._d.setTime(Date.UTC.apply(Date, a));\r\n\tmoment.updateOffset(mom, false); // keepTime=false\r\n} : setMomentValues;\r\n\r\n// Utility function. Accepts a moment and an array of the local year/month/date/etc values to set.\r\n// Assumes the given moment is already in local mode.\r\nsetLocalValues = allowValueOptimization ? function(mom, a) {\r\n\t// simlate what moment's accessors do\r\n\tmom._d.setTime(+new Date( // FYI, there is now way to apply an array of args to a constructor\r\n\t\ta[0] || 0,\r\n\t\ta[1] || 0,\r\n\t\ta[2] || 0,\r\n\t\ta[3] || 0,\r\n\t\ta[4] || 0,\r\n\t\ta[5] || 0,\r\n\t\ta[6] || 0\r\n\t));\r\n\tmoment.updateOffset(mom, false); // keepTime=false\r\n} : setMomentValues;\r\n\r\n;;\r\n\r\n// Single Date Formatting\r\n// -------------------------------------------------------------------------------------------------\r\n\r\n\r\n// call this if you want Moment's original format method to be used\r\nfunction oldMomentFormat(mom, formatStr) {\r\n\treturn oldMomentProto.format.call(mom, formatStr); // oldMomentProto defined in moment-ext.js\r\n}\r\n\r\n\r\n// Formats `date` with a Moment formatting string, but allow our non-zero areas and\r\n// additional token.\r\nfunction formatDate(date, formatStr) {\r\n\treturn formatDateWithChunks(date, getFormatStringChunks(formatStr));\r\n}\r\n\r\n\r\nfunction formatDateWithChunks(date, chunks) {\r\n\tvar s = '';\r\n\tvar i;\r\n\r\n\tfor (i=0; i<chunks.length; i++) {\r\n\t\ts += formatDateWithChunk(date, chunks[i]);\r\n\t}\r\n\r\n\treturn s;\r\n}\r\n\r\n\r\n// addition formatting tokens we want recognized\r\nvar tokenOverrides = {\r\n\tt: function(date) { // \"a\" or \"p\"\r\n\t\treturn oldMomentFormat(date, 'a').charAt(0);\r\n\t},\r\n\tT: function(date) { // \"A\" or \"P\"\r\n\t\treturn oldMomentFormat(date, 'A').charAt(0);\r\n\t}\r\n};\r\n\r\n\r\nfunction formatDateWithChunk(date, chunk) {\r\n\tvar token;\r\n\tvar maybeStr;\r\n\r\n\tif (typeof chunk === 'string') { // a literal string\r\n\t\treturn chunk;\r\n\t}\r\n\telse if ((token = chunk.token)) { // a token, like \"YYYY\"\r\n\t\tif (tokenOverrides[token]) {\r\n\t\t\treturn tokenOverrides[token](date); // use our custom token\r\n\t\t}\r\n\t\treturn oldMomentFormat(date, token);\r\n\t}\r\n\telse if (chunk.maybe) { // a grouping of other chunks that must be non-zero\r\n\t\tmaybeStr = formatDateWithChunks(date, chunk.maybe);\r\n\t\tif (maybeStr.match(/[1-9]/)) {\r\n\t\t\treturn maybeStr;\r\n\t\t}\r\n\t}\r\n\r\n\treturn '';\r\n}\r\n\r\n\r\n// Date Range Formatting\r\n// -------------------------------------------------------------------------------------------------\r\n// TODO: make it work with timezone offset\r\n\r\n// Using a formatting string meant for a single date, generate a range string, like\r\n// \"Sep 2 - 9 2013\", that intelligently inserts a separator where the dates differ.\r\n// If the dates are the same as far as the format string is concerned, just return a single\r\n// rendering of one date, without any separator.\r\nfunction formatRange(date1, date2, formatStr, separator, isRTL) {\r\n\tvar localeData;\r\n\r\n\tdate1 = fc.moment.parseZone(date1);\r\n\tdate2 = fc.moment.parseZone(date2);\r\n\r\n\tlocaleData = (date1.localeData || date1.lang).call(date1); // works with moment-pre-2.8\r\n\r\n\t// Expand localized format strings, like \"LL\" -> \"MMMM D YYYY\"\r\n\tformatStr = localeData.longDateFormat(formatStr) || formatStr;\r\n\t// BTW, this is not important for `formatDate` because it is impossible to put custom tokens\r\n\t// or non-zero areas in Moment's localized format strings.\r\n\r\n\tseparator = separator || ' - ';\r\n\r\n\treturn formatRangeWithChunks(\r\n\t\tdate1,\r\n\t\tdate2,\r\n\t\tgetFormatStringChunks(formatStr),\r\n\t\tseparator,\r\n\t\tisRTL\r\n\t);\r\n}\r\nfc.formatRange = formatRange; // expose\r\n\r\n\r\nfunction formatRangeWithChunks(date1, date2, chunks, separator, isRTL) {\r\n\tvar chunkStr; // the rendering of the chunk\r\n\tvar leftI;\r\n\tvar leftStr = '';\r\n\tvar rightI;\r\n\tvar rightStr = '';\r\n\tvar middleI;\r\n\tvar middleStr1 = '';\r\n\tvar middleStr2 = '';\r\n\tvar middleStr = '';\r\n\r\n\t// Start at the leftmost side of the formatting string and continue until you hit a token\r\n\t// that is not the same between dates.\r\n\tfor (leftI=0; leftI<chunks.length; leftI++) {\r\n\t\tchunkStr = formatSimilarChunk(date1, date2, chunks[leftI]);\r\n\t\tif (chunkStr === false) {\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\tleftStr += chunkStr;\r\n\t}\r\n\r\n\t// Similarly, start at the rightmost side of the formatting string and move left\r\n\tfor (rightI=chunks.length-1; rightI>leftI; rightI--) {\r\n\t\tchunkStr = formatSimilarChunk(date1, date2, chunks[rightI]);\r\n\t\tif (chunkStr === false) {\r\n\t\t\tbreak;\r\n\t\t}\r\n\t\trightStr = chunkStr + rightStr;\r\n\t}\r\n\r\n\t// The area in the middle is different for both of the dates.\r\n\t// Collect them distinctly so we can jam them together later.\r\n\tfor (middleI=leftI; middleI<=rightI; middleI++) {\r\n\t\tmiddleStr1 += formatDateWithChunk(date1, chunks[middleI]);\r\n\t\tmiddleStr2 += formatDateWithChunk(date2, chunks[middleI]);\r\n\t}\r\n\r\n\tif (middleStr1 || middleStr2) {\r\n\t\tif (isRTL) {\r\n\t\t\tmiddleStr = middleStr2 + separator + middleStr1;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tmiddleStr = middleStr1 + separator + middleStr2;\r\n\t\t}\r\n\t}\r\n\r\n\treturn leftStr + middleStr + rightStr;\r\n}\r\n\r\n\r\nvar similarUnitMap = {\r\n\tY: 'year',\r\n\tM: 'month',\r\n\tD: 'day', // day of month\r\n\td: 'day', // day of week\r\n\t// prevents a separator between anything time-related...\r\n\tA: 'second', // AM/PM\r\n\ta: 'second', // am/pm\r\n\tT: 'second', // A/P\r\n\tt: 'second', // a/p\r\n\tH: 'second', // hour (24)\r\n\th: 'second', // hour (12)\r\n\tm: 'second', // minute\r\n\ts: 'second' // second\r\n};\r\n// TODO: week maybe?\r\n\r\n\r\n// Given a formatting chunk, and given that both dates are similar in the regard the\r\n// formatting chunk is concerned, format date1 against `chunk`. Otherwise, return `false`.\r\nfunction formatSimilarChunk(date1, date2, chunk) {\r\n\tvar token;\r\n\tvar unit;\r\n\r\n\tif (typeof chunk === 'string') { // a literal string\r\n\t\treturn chunk;\r\n\t}\r\n\telse if ((token = chunk.token)) {\r\n\t\tunit = similarUnitMap[token.charAt(0)];\r\n\t\t// are the dates the same for this unit of measurement?\r\n\t\tif (unit && date1.isSame(date2, unit)) {\r\n\t\t\treturn oldMomentFormat(date1, token); // would be the same if we used `date2`\r\n\t\t\t// BTW, don't support custom tokens\r\n\t\t}\r\n\t}\r\n\r\n\treturn false; // the chunk is NOT the same for the two dates\r\n\t// BTW, don't support splitting on non-zero areas\r\n}\r\n\r\n\r\n// Chunking Utils\r\n// -------------------------------------------------------------------------------------------------\r\n\r\n\r\nvar formatStringChunkCache = {};\r\n\r\n\r\nfunction getFormatStringChunks(formatStr) {\r\n\tif (formatStr in formatStringChunkCache) {\r\n\t\treturn formatStringChunkCache[formatStr];\r\n\t}\r\n\treturn (formatStringChunkCache[formatStr] = chunkFormatString(formatStr));\r\n}\r\n\r\n\r\n// Break the formatting string into an array of chunks\r\nfunction chunkFormatString(formatStr) {\r\n\tvar chunks = [];\r\n\tvar chunker = /\\[([^\\]]*)\\]|\\(([^\\)]*)\\)|(LTS|LT|(\\w)\\4*o?)|([^\\w\\[\\(]+)/g; // TODO: more descrimination\r\n\tvar match;\r\n\r\n\twhile ((match = chunker.exec(formatStr))) {\r\n\t\tif (match[1]) { // a literal string inside [ ... ]\r\n\t\t\tchunks.push(match[1]);\r\n\t\t}\r\n\t\telse if (match[2]) { // non-zero formatting inside ( ... )\r\n\t\t\tchunks.push({ maybe: chunkFormatString(match[2]) });\r\n\t\t}\r\n\t\telse if (match[3]) { // a formatting token\r\n\t\t\tchunks.push({ token: match[3] });\r\n\t\t}\r\n\t\telse if (match[5]) { // an unenclosed literal string\r\n\t\t\tchunks.push(match[5]);\r\n\t\t}\r\n\t}\r\n\r\n\treturn chunks;\r\n}\r\n\r\n;;\r\n\r\nfc.Class = Class; // export\r\n\r\n// class that all other classes will inherit from\r\nfunction Class() { }\r\n\r\n// called upon a class to create a subclass\r\nClass.extend = function(members) {\r\n\tvar superClass = this;\r\n\tvar subClass;\r\n\r\n\tmembers = members || {};\r\n\r\n\t// ensure a constructor for the subclass, forwarding all arguments to the super-constructor if it doesn't exist\r\n\tif (hasOwnProp(members, 'constructor')) {\r\n\t\tsubClass = members.constructor;\r\n\t}\r\n\tif (typeof subClass !== 'function') {\r\n\t\tsubClass = members.constructor = function() {\r\n\t\t\tsuperClass.apply(this, arguments);\r\n\t\t};\r\n\t}\r\n\r\n\t// build the base prototype for the subclass, which is an new object chained to the superclass's prototype\r\n\tsubClass.prototype = createObject(superClass.prototype);\r\n\r\n\t// copy each member variable/method onto the the subclass's prototype\r\n\tcopyOwnProps(members, subClass.prototype);\r\n\tcopyNativeMethods(members, subClass.prototype); // hack for IE8\r\n\r\n\t// copy over all class variables/methods to the subclass, such as `extend` and `mixin`\r\n\tcopyOwnProps(superClass, subClass);\r\n\r\n\treturn subClass;\r\n};\r\n\r\n// adds new member variables/methods to the class's prototype.\r\n// can be called with another class, or a plain object hash containing new members.\r\nClass.mixin = function(members) {\r\n\tcopyOwnProps(members.prototype || members, this.prototype);\r\n};\r\n;;\r\n\r\n/* A rectangular panel that is absolutely positioned over other content\r\n------------------------------------------------------------------------------------------------------------------------\r\nOptions:\r\n\t- className (string)\r\n\t- content (HTML string or jQuery element set)\r\n\t- parentEl\r\n\t- top\r\n\t- left\r\n\t- right (the x coord of where the right edge should be. not a \"CSS\" right)\r\n\t- autoHide (boolean)\r\n\t- show (callback)\r\n\t- hide (callback)\r\n*/\r\n\r\nvar Popover = Class.extend({\r\n\r\n\tisHidden: true,\r\n\toptions: null,\r\n\tel: null, // the container element for the popover. generated by this object\r\n\tdocumentMousedownProxy: null, // document mousedown handler bound to `this`\r\n\tmargin: 10, // the space required between the popover and the edges of the scroll container\r\n\r\n\r\n\tconstructor: function(options) {\r\n\t\tthis.options = options || {};\r\n\t},\r\n\r\n\r\n\t// Shows the popover on the specified position. Renders it if not already\r\n\tshow: function() {\r\n\t\tif (this.isHidden) {\r\n\t\t\tif (!this.el) {\r\n\t\t\t\tthis.render();\r\n\t\t\t}\r\n\t\t\tthis.el.show();\r\n\t\t\tthis.position();\r\n\t\t\tthis.isHidden = false;\r\n\t\t\tthis.trigger('show');\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Hides the popover, through CSS, but does not remove it from the DOM\r\n\thide: function() {\r\n\t\tif (!this.isHidden) {\r\n\t\t\tthis.el.hide();\r\n\t\t\tthis.isHidden = true;\r\n\t\t\tthis.trigger('hide');\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Creates `this.el` and renders content inside of it\r\n\trender: function() {\r\n\t\tvar _this = this;\r\n\t\tvar options = this.options;\r\n\r\n\t\tthis.el = $('<div class=\"fc-popover\"/>')\r\n\t\t\t.addClass(options.className || '')\r\n\t\t\t.css({\r\n\t\t\t\t// position initially to the top left to avoid creating scrollbars\r\n\t\t\t\ttop: 0,\r\n\t\t\t\tleft: 0\r\n\t\t\t})\r\n\t\t\t.append(options.content)\r\n\t\t\t.appendTo(options.parentEl);\r\n\r\n\t\t// when a click happens on anything inside with a 'fc-close' className, hide the popover\r\n\t\tthis.el.on('click', '.fc-close', function() {\r\n\t\t\t_this.hide();\r\n\t\t});\r\n\r\n\t\tif (options.autoHide) {\r\n\t\t\t$(document).on('mousedown', this.documentMousedownProxy = proxy(this, 'documentMousedown'));\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Triggered when the user clicks *anywhere* in the document, for the autoHide feature\r\n\tdocumentMousedown: function(ev) {\r\n\t\t// only hide the popover if the click happened outside the popover\r\n\t\tif (this.el && !$(ev.target).closest(this.el).length) {\r\n\t\t\tthis.hide();\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Hides and unregisters any handlers\r\n\tdestroy: function() {\r\n\t\tthis.hide();\r\n\r\n\t\tif (this.el) {\r\n\t\t\tthis.el.remove();\r\n\t\t\tthis.el = null;\r\n\t\t}\r\n\r\n\t\t$(document).off('mousedown', this.documentMousedownProxy);\r\n\t},\r\n\r\n\r\n\t// Positions the popover optimally, using the top/left/right options\r\n\tposition: function() {\r\n\t\tvar options = this.options;\r\n\t\tvar origin = this.el.offsetParent().offset();\r\n\t\tvar width = this.el.outerWidth();\r\n\t\tvar height = this.el.outerHeight();\r\n\t\tvar windowEl = $(window);\r\n\t\tvar viewportEl = getScrollParent(this.el);\r\n\t\tvar viewportTop;\r\n\t\tvar viewportLeft;\r\n\t\tvar viewportOffset;\r\n\t\tvar top; // the \"position\" (not \"offset\") values for the popover\r\n\t\tvar left; //\r\n\r\n\t\t// compute top and left\r\n\t\ttop = options.top || 0;\r\n\t\tif (options.left !== undefined) {\r\n\t\t\tleft = options.left;\r\n\t\t}\r\n\t\telse if (options.right !== undefined) {\r\n\t\t\tleft = options.right - width; // derive the left value from the right value\r\n\t\t}\r\n\t\telse {\r\n\t\t\tleft = 0;\r\n\t\t}\r\n\r\n\t\tif (viewportEl.is(window) || viewportEl.is(document)) { // normalize getScrollParent's result\r\n\t\t\tviewportEl = windowEl;\r\n\t\t\tviewportTop = 0; // the window is always at the top left\r\n\t\t\tviewportLeft = 0; // (and .offset() won't work if called here)\r\n\t\t}\r\n\t\telse {\r\n\t\t\tviewportOffset = viewportEl.offset();\r\n\t\t\tviewportTop = viewportOffset.top;\r\n\t\t\tviewportLeft = viewportOffset.left;\r\n\t\t}\r\n\r\n\t\t// if the window is scrolled, it causes the visible area to be further down\r\n\t\tviewportTop += windowEl.scrollTop();\r\n\t\tviewportLeft += windowEl.scrollLeft();\r\n\r\n\t\t// constrain to the view port. if constrained by two edges, give precedence to top/left\r\n\t\tif (options.viewportConstrain !== false) {\r\n\t\t\ttop = Math.min(top, viewportTop + viewportEl.outerHeight() - height - this.margin);\r\n\t\t\ttop = Math.max(top, viewportTop + this.margin);\r\n\t\t\tleft = Math.min(left, viewportLeft + viewportEl.outerWidth() - width - this.margin);\r\n\t\t\tleft = Math.max(left, viewportLeft + this.margin);\r\n\t\t}\r\n\r\n\t\tthis.el.css({\r\n\t\t\ttop: top - origin.top,\r\n\t\t\tleft: left - origin.left\r\n\t\t});\r\n\t},\r\n\r\n\r\n\t// Triggers a callback. Calls a function in the option hash of the same name.\r\n\t// Arguments beyond the first `name` are forwarded on.\r\n\t// TODO: better code reuse for this. Repeat code\r\n\ttrigger: function(name) {\r\n\t\tif (this.options[name]) {\r\n\t\t\tthis.options[name].apply(this, Array.prototype.slice.call(arguments, 1));\r\n\t\t}\r\n\t}\r\n\r\n});\r\n\r\n;;\r\n\r\n/* A \"coordinate map\" converts pixel coordinates into an associated cell, which has an associated date\r\n------------------------------------------------------------------------------------------------------------------------\r\nCommon interface:\r\n\r\n\tCoordMap.prototype = {\r\n\t\tbuild: function() {},\r\n\t\tgetCell: function(x, y) {}\r\n\t};\r\n\r\n*/\r\n\r\n/* Coordinate map for a grid component\r\n----------------------------------------------------------------------------------------------------------------------*/\r\n\r\nvar GridCoordMap = Class.extend({\r\n\r\n\tgrid: null, // reference to the Grid\r\n\trowCoords: null, // array of {top,bottom} objects\r\n\tcolCoords: null, // array of {left,right} objects\r\n\r\n\tcontainerEl: null, // container element that all coordinates are constrained to. optionally assigned\r\n\tbounds: null,\r\n\r\n\r\n\tconstructor: function(grid) {\r\n\t\tthis.grid = grid;\r\n\t},\r\n\r\n\r\n\t// Queries the grid for the coordinates of all the cells\r\n\tbuild: function() {\r\n\t\tthis.rowCoords = this.grid.computeRowCoords();\r\n\t\tthis.colCoords = this.grid.computeColCoords();\r\n\t\tthis.computeBounds();\r\n\t},\r\n\r\n\r\n\t// Clears the coordinates data to free up memory\r\n\tclear: function() {\r\n\t\tthis.rowCoords = null;\r\n\t\tthis.colCoords = null;\r\n\t},\r\n\r\n\r\n\t// Given a coordinate of the document, gets the associated cell. If no cell is underneath, returns null\r\n\tgetCell: function(x, y) {\r\n\t\tvar rowCoords = this.rowCoords;\r\n\t\tvar rowCnt = rowCoords.length;\r\n\t\tvar colCoords = this.colCoords;\r\n\t\tvar colCnt = colCoords.length;\r\n\t\tvar hitRow = null;\r\n\t\tvar hitCol = null;\r\n\t\tvar i, coords;\r\n\t\tvar cell;\r\n\r\n\t\tif (this.inBounds(x, y)) {\r\n\r\n\t\t\tfor (i = 0; i < rowCnt; i++) {\r\n\t\t\t\tcoords = rowCoords[i];\r\n\t\t\t\tif (y >= coords.top && y < coords.bottom) {\r\n\t\t\t\t\thitRow = i;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tfor (i = 0; i < colCnt; i++) {\r\n\t\t\t\tcoords = colCoords[i];\r\n\t\t\t\tif (x >= coords.left && x < coords.right) {\r\n\t\t\t\t\thitCol = i;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (hitRow !== null && hitCol !== null) {\r\n\r\n\t\t\t\tcell = this.grid.getCell(hitRow, hitCol); // expected to return a fresh object we can modify\r\n\t\t\t\tcell.grid = this.grid; // for CellDragListener's isCellsEqual. dragging between grids\r\n\r\n\t\t\t\t// make the coordinates available on the cell object\r\n\t\t\t\t$.extend(cell, rowCoords[hitRow], colCoords[hitCol]);\r\n\r\n\t\t\t\treturn cell;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn null;\r\n\t},\r\n\r\n\r\n\t// If there is a containerEl, compute the bounds into min/max values\r\n\tcomputeBounds: function() {\r\n\t\tthis.bounds = this.containerEl ?\r\n\t\t\tgetClientRect(this.containerEl) : // area within scrollbars\r\n\t\t\tnull;\r\n\t},\r\n\r\n\r\n\t// Determines if the given coordinates are in bounds. If no `containerEl`, always true\r\n\tinBounds: function(x, y) {\r\n\t\tvar bounds = this.bounds;\r\n\r\n\t\tif (bounds) {\r\n\t\t\treturn x >= bounds.left && x < bounds.right && y >= bounds.top && y < bounds.bottom;\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n});\r\n\r\n\r\n/* Coordinate map that is a combination of multiple other coordinate maps\r\n----------------------------------------------------------------------------------------------------------------------*/\r\n\r\nvar ComboCoordMap = Class.extend({\r\n\r\n\tcoordMaps: null, // an array of CoordMaps\r\n\r\n\r\n\tconstructor: function(coordMaps) {\r\n\t\tthis.coordMaps = coordMaps;\r\n\t},\r\n\r\n\r\n\t// Builds all coordMaps\r\n\tbuild: function() {\r\n\t\tvar coordMaps = this.coordMaps;\r\n\t\tvar i;\r\n\r\n\t\tfor (i = 0; i < coordMaps.length; i++) {\r\n\t\t\tcoordMaps[i].build();\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Queries all coordMaps for the cell underneath the given coordinates, returning the first result\r\n\tgetCell: function(x, y) {\r\n\t\tvar coordMaps = this.coordMaps;\r\n\t\tvar cell = null;\r\n\t\tvar i;\r\n\r\n\t\tfor (i = 0; i < coordMaps.length && !cell; i++) {\r\n\t\t\tcell = coordMaps[i].getCell(x, y);\r\n\t\t}\r\n\r\n\t\treturn cell;\r\n\t},\r\n\r\n\r\n\t// Clears all coordMaps\r\n\tclear: function() {\r\n\t\tvar coordMaps = this.coordMaps;\r\n\t\tvar i;\r\n\r\n\t\tfor (i = 0; i < coordMaps.length; i++) {\r\n\t\t\tcoordMaps[i].clear();\r\n\t\t}\r\n\t}\r\n\r\n});\r\n\r\n;;\r\n\r\n/* Tracks a drag's mouse movement, firing various handlers\r\n----------------------------------------------------------------------------------------------------------------------*/\r\n\r\nvar DragListener = fc.DragListener = Class.extend({\r\n\r\n\toptions: null,\r\n\r\n\tisListening: false,\r\n\tisDragging: false,\r\n\r\n\t// coordinates of the initial mousedown\r\n\toriginX: null,\r\n\toriginY: null,\r\n\r\n\t// handler attached to the document, bound to the DragListener's `this`\r\n\tmousemoveProxy: null,\r\n\tmouseupProxy: null,\r\n\r\n\t// for IE8 bug-fighting behavior, for now\r\n\tsubjectEl: null, // the element being draged. optional\r\n\tsubjectHref: null,\r\n\r\n\tscrollEl: null,\r\n\tscrollBounds: null, // { top, bottom, left, right }\r\n\tscrollTopVel: null, // pixels per second\r\n\tscrollLeftVel: null, // pixels per second\r\n\tscrollIntervalId: null, // ID of setTimeout for scrolling animation loop\r\n\tscrollHandlerProxy: null, // this-scoped function for handling when scrollEl is scrolled\r\n\r\n\tscrollSensitivity: 30, // pixels from edge for scrolling to start\r\n\tscrollSpeed: 200, // pixels per second, at maximum speed\r\n\tscrollIntervalMs: 50, // millisecond wait between scroll increment\r\n\r\n\r\n\tconstructor: function(options) {\r\n\t\toptions = options || {};\r\n\t\tthis.options = options;\r\n\t\tthis.subjectEl = options.subjectEl;\r\n\t},\r\n\r\n\r\n\t// Call this when the user does a mousedown. Will probably lead to startListening\r\n\tmousedown: function(ev) {\r\n\t\tif (isPrimaryMouseButton(ev)) {\r\n\r\n\t\t\tev.preventDefault(); // prevents native selection in most browsers\r\n\r\n\t\t\tthis.startListening(ev);\r\n\r\n\t\t\t// start the drag immediately if there is no minimum distance for a drag start\r\n\t\t\tif (!this.options.distance) {\r\n\t\t\t\tthis.startDrag(ev);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Call this to start tracking mouse movements\r\n\tstartListening: function(ev) {\r\n\t\tvar scrollParent;\r\n\r\n\t\tif (!this.isListening) {\r\n\r\n\t\t\t// grab scroll container and attach handler\r\n\t\t\tif (ev && this.options.scroll) {\r\n\t\t\t\tscrollParent = getScrollParent($(ev.target));\r\n\t\t\t\tif (!scrollParent.is(window) && !scrollParent.is(document)) {\r\n\t\t\t\t\tthis.scrollEl = scrollParent;\r\n\r\n\t\t\t\t\t// scope to `this`, and use `debounce` to make sure rapid calls don't happen\r\n\t\t\t\t\tthis.scrollHandlerProxy = debounce(proxy(this, 'scrollHandler'), 100);\r\n\t\t\t\t\tthis.scrollEl.on('scroll', this.scrollHandlerProxy);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t$(document)\r\n\t\t\t\t.on('mousemove', this.mousemoveProxy = proxy(this, 'mousemove'))\r\n\t\t\t\t.on('mouseup', this.mouseupProxy = proxy(this, 'mouseup'))\r\n\t\t\t\t.on('selectstart', this.preventDefault); // prevents native selection in IE<=8\r\n\r\n\t\t\tif (ev) {\r\n\t\t\t\tthis.originX = ev.pageX;\r\n\t\t\t\tthis.originY = ev.pageY;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\t// if no starting information was given, origin will be the topleft corner of the screen.\r\n\t\t\t\t// if so, dx/dy in the future will be the absolute coordinates.\r\n\t\t\t\tthis.originX = 0;\r\n\t\t\t\tthis.originY = 0;\r\n\t\t\t}\r\n\r\n\t\t\tthis.isListening = true;\r\n\t\t\tthis.listenStart(ev);\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Called when drag listening has started (but a real drag has not necessarily began)\r\n\tlistenStart: function(ev) {\r\n\t\tthis.trigger('listenStart', ev);\r\n\t},\r\n\r\n\r\n\t// Called when the user moves the mouse\r\n\tmousemove: function(ev) {\r\n\t\tvar dx = ev.pageX - this.originX;\r\n\t\tvar dy = ev.pageY - this.originY;\r\n\t\tvar minDistance;\r\n\t\tvar distanceSq; // current distance from the origin, squared\r\n\r\n\t\tif (!this.isDragging) { // if not already dragging...\r\n\t\t\t// then start the drag if the minimum distance criteria is met\r\n\t\t\tminDistance = this.options.distance || 1;\r\n\t\t\tdistanceSq = dx * dx + dy * dy;\r\n\t\t\tif (distanceSq >= minDistance * minDistance) { // use pythagorean theorem\r\n\t\t\t\tthis.startDrag(ev);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.isDragging) {\r\n\t\t\tthis.drag(dx, dy, ev); // report a drag, even if this mousemove initiated the drag\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Call this to initiate a legitimate drag.\r\n\t// This function is called internally from this class, but can also be called explicitly from outside\r\n\tstartDrag: function(ev) {\r\n\r\n\t\tif (!this.isListening) { // startDrag must have manually initiated\r\n\t\t\tthis.startListening();\r\n\t\t}\r\n\r\n\t\tif (!this.isDragging) {\r\n\t\t\tthis.isDragging = true;\r\n\t\t\tthis.dragStart(ev);\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Called when the actual drag has started (went beyond minDistance)\r\n\tdragStart: function(ev) {\r\n\t\tvar subjectEl = this.subjectEl;\r\n\r\n\t\tthis.trigger('dragStart', ev);\r\n\r\n\t\t// remove a mousedown'd <a>'s href so it is not visited (IE8 bug)\r\n\t\tif ((this.subjectHref = subjectEl ? subjectEl.attr('href') : null)) {\r\n\t\t\tsubjectEl.removeAttr('href');\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Called while the mouse is being moved and when we know a legitimate drag is taking place\r\n\tdrag: function(dx, dy, ev) {\r\n\t\tthis.trigger('drag', dx, dy, ev);\r\n\t\tthis.updateScroll(ev); // will possibly cause scrolling\r\n\t},\r\n\r\n\r\n\t// Called when the user does a mouseup\r\n\tmouseup: function(ev) {\r\n\t\tthis.stopListening(ev);\r\n\t},\r\n\r\n\r\n\t// Called when the drag is over. Will not cause listening to stop however.\r\n\t// A concluding 'cellOut' event will NOT be triggered.\r\n\tstopDrag: function(ev) {\r\n\t\tif (this.isDragging) {\r\n\t\t\tthis.stopScrolling();\r\n\t\t\tthis.dragStop(ev);\r\n\t\t\tthis.isDragging = false;\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Called when dragging has been stopped\r\n\tdragStop: function(ev) {\r\n\t\tvar _this = this;\r\n\r\n\t\tthis.trigger('dragStop', ev);\r\n\r\n\t\t// restore a mousedown'd <a>'s href (for IE8 bug)\r\n\t\tsetTimeout(function() { // must be outside of the click's execution\r\n\t\t\tif (_this.subjectHref) {\r\n\t\t\t\t_this.subjectEl.attr('href', _this.subjectHref);\r\n\t\t\t}\r\n\t\t}, 0);\r\n\t},\r\n\r\n\r\n\t// Call this to stop listening to the user's mouse events\r\n\tstopListening: function(ev) {\r\n\t\tthis.stopDrag(ev); // if there's a current drag, kill it\r\n\r\n\t\tif (this.isListening) {\r\n\r\n\t\t\t// remove the scroll handler if there is a scrollEl\r\n\t\t\tif (this.scrollEl) {\r\n\t\t\t\tthis.scrollEl.off('scroll', this.scrollHandlerProxy);\r\n\t\t\t\tthis.scrollHandlerProxy = null;\r\n\t\t\t}\r\n\r\n\t\t\t$(document)\r\n\t\t\t\t.off('mousemove', this.mousemoveProxy)\r\n\t\t\t\t.off('mouseup', this.mouseupProxy)\r\n\t\t\t\t.off('selectstart', this.preventDefault);\r\n\r\n\t\t\tthis.mousemoveProxy = null;\r\n\t\t\tthis.mouseupProxy = null;\r\n\r\n\t\t\tthis.isListening = false;\r\n\t\t\tthis.listenStop(ev);\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Called when drag listening has stopped\r\n\tlistenStop: function(ev) {\r\n\t\tthis.trigger('listenStop', ev);\r\n\t},\r\n\r\n\r\n\t// Triggers a callback. Calls a function in the option hash of the same name.\r\n\t// Arguments beyond the first `name` are forwarded on.\r\n\ttrigger: function(name) {\r\n\t\tif (this.options[name]) {\r\n\t\t\tthis.options[name].apply(this, Array.prototype.slice.call(arguments, 1));\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Stops a given mouse event from doing it's native browser action. In our case, text selection.\r\n\tpreventDefault: function(ev) {\r\n\t\tev.preventDefault();\r\n\t},\r\n\r\n\r\n\t/* Scrolling\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Computes and stores the bounding rectangle of scrollEl\r\n\tcomputeScrollBounds: function() {\r\n\t\tvar el = this.scrollEl;\r\n\r\n\t\tthis.scrollBounds = el ? getOuterRect(el) : null;\r\n\t\t\t// TODO: use getClientRect in future. but prevents auto scrolling when on top of scrollbars\r\n\t},\r\n\r\n\r\n\t// Called when the dragging is in progress and scrolling should be updated\r\n\tupdateScroll: function(ev) {\r\n\t\tvar sensitivity = this.scrollSensitivity;\r\n\t\tvar bounds = this.scrollBounds;\r\n\t\tvar topCloseness, bottomCloseness;\r\n\t\tvar leftCloseness, rightCloseness;\r\n\t\tvar topVel = 0;\r\n\t\tvar leftVel = 0;\r\n\r\n\t\tif (bounds) { // only scroll if scrollEl exists\r\n\r\n\t\t\t// compute closeness to edges. valid range is from 0.0 - 1.0\r\n\t\t\ttopCloseness = (sensitivity - (ev.pageY - bounds.top)) / sensitivity;\r\n\t\t\tbottomCloseness = (sensitivity - (bounds.bottom - ev.pageY)) / sensitivity;\r\n\t\t\tleftCloseness = (sensitivity - (ev.pageX - bounds.left)) / sensitivity;\r\n\t\t\trightCloseness = (sensitivity - (bounds.right - ev.pageX)) / sensitivity;\r\n\r\n\t\t\t// translate vertical closeness into velocity.\r\n\t\t\t// mouse must be completely in bounds for velocity to happen.\r\n\t\t\tif (topCloseness >= 0 && topCloseness <= 1) {\r\n\t\t\t\ttopVel = topCloseness * this.scrollSpeed * -1; // negative. for scrolling up\r\n\t\t\t}\r\n\t\t\telse if (bottomCloseness >= 0 && bottomCloseness <= 1) {\r\n\t\t\t\ttopVel = bottomCloseness * this.scrollSpeed;\r\n\t\t\t}\r\n\r\n\t\t\t// translate horizontal closeness into velocity\r\n\t\t\tif (leftCloseness >= 0 && leftCloseness <= 1) {\r\n\t\t\t\tleftVel = leftCloseness * this.scrollSpeed * -1; // negative. for scrolling left\r\n\t\t\t}\r\n\t\t\telse if (rightCloseness >= 0 && rightCloseness <= 1) {\r\n\t\t\t\tleftVel = rightCloseness * this.scrollSpeed;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.setScrollVel(topVel, leftVel);\r\n\t},\r\n\r\n\r\n\t// Sets the speed-of-scrolling for the scrollEl\r\n\tsetScrollVel: function(topVel, leftVel) {\r\n\r\n\t\tthis.scrollTopVel = topVel;\r\n\t\tthis.scrollLeftVel = leftVel;\r\n\r\n\t\tthis.constrainScrollVel(); // massages into realistic values\r\n\r\n\t\t// if there is non-zero velocity, and an animation loop hasn't already started, then START\r\n\t\tif ((this.scrollTopVel || this.scrollLeftVel) && !this.scrollIntervalId) {\r\n\t\t\tthis.scrollIntervalId = setInterval(\r\n\t\t\t\tproxy(this, 'scrollIntervalFunc'), // scope to `this`\r\n\t\t\t\tthis.scrollIntervalMs\r\n\t\t\t);\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Forces scrollTopVel and scrollLeftVel to be zero if scrolling has already gone all the way\r\n\tconstrainScrollVel: function() {\r\n\t\tvar el = this.scrollEl;\r\n\r\n\t\tif (this.scrollTopVel < 0) { // scrolling up?\r\n\t\t\tif (el.scrollTop() <= 0) { // already scrolled all the way up?\r\n\t\t\t\tthis.scrollTopVel = 0;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (this.scrollTopVel > 0) { // scrolling down?\r\n\t\t\tif (el.scrollTop() + el[0].clientHeight >= el[0].scrollHeight) { // already scrolled all the way down?\r\n\t\t\t\tthis.scrollTopVel = 0;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.scrollLeftVel < 0) { // scrolling left?\r\n\t\t\tif (el.scrollLeft() <= 0) { // already scrolled all the left?\r\n\t\t\t\tthis.scrollLeftVel = 0;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (this.scrollLeftVel > 0) { // scrolling right?\r\n\t\t\tif (el.scrollLeft() + el[0].clientWidth >= el[0].scrollWidth) { // already scrolled all the way right?\r\n\t\t\t\tthis.scrollLeftVel = 0;\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// This function gets called during every iteration of the scrolling animation loop\r\n\tscrollIntervalFunc: function() {\r\n\t\tvar el = this.scrollEl;\r\n\t\tvar frac = this.scrollIntervalMs / 1000; // considering animation frequency, what the vel should be mult'd by\r\n\r\n\t\t// change the value of scrollEl's scroll\r\n\t\tif (this.scrollTopVel) {\r\n\t\t\tel.scrollTop(el.scrollTop() + this.scrollTopVel * frac);\r\n\t\t}\r\n\t\tif (this.scrollLeftVel) {\r\n\t\t\tel.scrollLeft(el.scrollLeft() + this.scrollLeftVel * frac);\r\n\t\t}\r\n\r\n\t\tthis.constrainScrollVel(); // since the scroll values changed, recompute the velocities\r\n\r\n\t\t// if scrolled all the way, which causes the vels to be zero, stop the animation loop\r\n\t\tif (!this.scrollTopVel && !this.scrollLeftVel) {\r\n\t\t\tthis.stopScrolling();\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Kills any existing scrolling animation loop\r\n\tstopScrolling: function() {\r\n\t\tif (this.scrollIntervalId) {\r\n\t\t\tclearInterval(this.scrollIntervalId);\r\n\t\t\tthis.scrollIntervalId = null;\r\n\r\n\t\t\t// when all done with scrolling, recompute positions since they probably changed\r\n\t\t\tthis.scrollStop();\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Get called when the scrollEl is scrolled (NOTE: this is delayed via debounce)\r\n\tscrollHandler: function() {\r\n\t\t// recompute all coordinates, but *only* if this is *not* part of our scrolling animation\r\n\t\tif (!this.scrollIntervalId) {\r\n\t\t\tthis.scrollStop();\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Called when scrolling has stopped, whether through auto scroll, or the user scrolling\r\n\tscrollStop: function() {\r\n\t}\r\n\r\n});\r\n\r\n;;\r\n\r\n/* Tracks mouse movements over a CoordMap and raises events about which cell the mouse is over.\r\n------------------------------------------------------------------------------------------------------------------------\r\noptions:\r\n- subjectEl\r\n- subjectCenter\r\n*/\r\n\r\nvar CellDragListener = DragListener.extend({\r\n\r\n\tcoordMap: null, // converts coordinates to date cells\r\n\torigCell: null, // the cell the mouse was over when listening started\r\n\tcell: null, // the cell the mouse is over\r\n\tcoordAdjust: null, // delta that will be added to the mouse coordinates when computing collisions\r\n\r\n\r\n\tconstructor: function(coordMap, options) {\r\n\t\tDragListener.prototype.constructor.call(this, options); // call the super-constructor\r\n\r\n\t\tthis.coordMap = coordMap;\r\n\t},\r\n\r\n\r\n\t// Called when drag listening starts (but a real drag has not necessarily began).\r\n\t// ev might be undefined if dragging was started manually.\r\n\tlistenStart: function(ev) {\r\n\t\tvar subjectEl = this.subjectEl;\r\n\t\tvar subjectRect;\r\n\t\tvar origPoint;\r\n\t\tvar point;\r\n\r\n\t\tDragListener.prototype.listenStart.apply(this, arguments); // call the super-method\r\n\r\n\t\tthis.computeCoords();\r\n\r\n\t\tif (ev) {\r\n\t\t\torigPoint = { left: ev.pageX, top: ev.pageY };\r\n\t\t\tpoint = origPoint;\r\n\r\n\t\t\t// constrain the point to bounds of the element being dragged\r\n\t\t\tif (subjectEl) {\r\n\t\t\t\tsubjectRect = getOuterRect(subjectEl); // used for centering as well\r\n\t\t\t\tpoint = constrainPoint(point, subjectRect);\r\n\t\t\t}\r\n\r\n\t\t\tthis.origCell = this.getCell(point.left, point.top);\r\n\r\n\t\t\t// treat the center of the subject as the collision point?\r\n\t\t\tif (subjectEl && this.options.subjectCenter) {\r\n\r\n\t\t\t\t// only consider the area the subject overlaps the cell. best for large subjects\r\n\t\t\t\tif (this.origCell) {\r\n\t\t\t\t\tsubjectRect = intersectRects(this.origCell, subjectRect) ||\r\n\t\t\t\t\t\tsubjectRect; // in case there is no intersection\r\n\t\t\t\t}\r\n\r\n\t\t\t\tpoint = getRectCenter(subjectRect);\r\n\t\t\t}\r\n\r\n\t\t\tthis.coordAdjust = diffPoints(point, origPoint); // point - origPoint\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.origCell = null;\r\n\t\t\tthis.coordAdjust = null;\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Recomputes the drag-critical positions of elements\r\n\tcomputeCoords: function() {\r\n\t\tthis.coordMap.build();\r\n\t\tthis.computeScrollBounds();\r\n\t},\r\n\r\n\r\n\t// Called when the actual drag has started\r\n\tdragStart: function(ev) {\r\n\t\tvar cell;\r\n\r\n\t\tDragListener.prototype.dragStart.apply(this, arguments); // call the super-method\r\n\r\n\t\tcell = this.getCell(ev.pageX, ev.pageY); // might be different from this.origCell if the min-distance is large\r\n\r\n\t\t// report the initial cell the mouse is over\r\n\t\t// especially important if no min-distance and drag starts immediately\r\n\t\tif (cell) {\r\n\t\t\tthis.cellOver(cell);\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Called when the drag moves\r\n\tdrag: function(dx, dy, ev) {\r\n\t\tvar cell;\r\n\r\n\t\tDragListener.prototype.drag.apply(this, arguments); // call the super-method\r\n\r\n\t\tcell = this.getCell(ev.pageX, ev.pageY);\r\n\r\n\t\tif (!isCellsEqual(cell, this.cell)) { // a different cell than before?\r\n\t\t\tif (this.cell) {\r\n\t\t\t\tthis.cellOut();\r\n\t\t\t}\r\n\t\t\tif (cell) {\r\n\t\t\t\tthis.cellOver(cell);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Called when dragging has been stopped\r\n\tdragStop: function() {\r\n\t\tthis.cellDone();\r\n\t\tDragListener.prototype.dragStop.apply(this, arguments); // call the super-method\r\n\t},\r\n\r\n\r\n\t// Called when a the mouse has just moved over a new cell\r\n\tcellOver: function(cell) {\r\n\t\tthis.cell = cell;\r\n\t\tthis.trigger('cellOver', cell, isCellsEqual(cell, this.origCell), this.origCell);\r\n\t},\r\n\r\n\r\n\t// Called when the mouse has just moved out of a cell\r\n\tcellOut: function() {\r\n\t\tif (this.cell) {\r\n\t\t\tthis.trigger('cellOut', this.cell);\r\n\t\t\tthis.cellDone();\r\n\t\t\tthis.cell = null;\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Called after a cellOut. Also called before a dragStop\r\n\tcellDone: function() {\r\n\t\tif (this.cell) {\r\n\t\t\tthis.trigger('cellDone', this.cell);\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Called when drag listening has stopped\r\n\tlistenStop: function() {\r\n\t\tDragListener.prototype.listenStop.apply(this, arguments); // call the super-method\r\n\r\n\t\tthis.origCell = this.cell = null;\r\n\t\tthis.coordMap.clear();\r\n\t},\r\n\r\n\r\n\t// Called when scrolling has stopped, whether through auto scroll, or the user scrolling\r\n\tscrollStop: function() {\r\n\t\tDragListener.prototype.scrollStop.apply(this, arguments); // call the super-method\r\n\r\n\t\tthis.computeCoords(); // cells' absolute positions will be in new places. recompute\r\n\t},\r\n\r\n\r\n\t// Gets the cell underneath the coordinates for the given mouse event\r\n\tgetCell: function(left, top) {\r\n\r\n\t\tif (this.coordAdjust) {\r\n\t\t\tleft += this.coordAdjust.left;\r\n\t\t\ttop += this.coordAdjust.top;\r\n\t\t}\r\n\r\n\t\treturn this.coordMap.getCell(left, top);\r\n\t}\r\n\r\n});\r\n\r\n\r\n// Returns `true` if the cells are identically equal. `false` otherwise.\r\n// They must have the same row, col, and be from the same grid.\r\n// Two null values will be considered equal, as two \"out of the grid\" states are the same.\r\nfunction isCellsEqual(cell1, cell2) {\r\n\r\n\tif (!cell1 && !cell2) {\r\n\t\treturn true;\r\n\t}\r\n\r\n\tif (cell1 && cell2) {\r\n\t\treturn cell1.grid === cell2.grid &&\r\n\t\t\tcell1.row === cell2.row &&\r\n\t\t\tcell1.col === cell2.col;\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n\r\n;;\r\n\r\n/* Creates a clone of an element and lets it track the mouse as it moves\r\n----------------------------------------------------------------------------------------------------------------------*/\r\n\r\nvar MouseFollower = Class.extend({\r\n\r\n\toptions: null,\r\n\r\n\tsourceEl: null, // the element that will be cloned and made to look like it is dragging\r\n\tel: null, // the clone of `sourceEl` that will track the mouse\r\n\tparentEl: null, // the element that `el` (the clone) will be attached to\r\n\r\n\t// the initial position of el, relative to the offset parent. made to match the initial offset of sourceEl\r\n\ttop0: null,\r\n\tleft0: null,\r\n\r\n\t// the initial position of the mouse\r\n\tmouseY0: null,\r\n\tmouseX0: null,\r\n\r\n\t// the number of pixels the mouse has moved from its initial position\r\n\ttopDelta: null,\r\n\tleftDelta: null,\r\n\r\n\tmousemoveProxy: null, // document mousemove handler, bound to the MouseFollower's `this`\r\n\r\n\tisFollowing: false,\r\n\tisHidden: false,\r\n\tisAnimating: false, // doing the revert animation?\r\n\r\n\tconstructor: function(sourceEl, options) {\r\n\t\tthis.options = options = options || {};\r\n\t\tthis.sourceEl = sourceEl;\r\n\t\tthis.parentEl = options.parentEl ? $(options.parentEl) : sourceEl.parent(); // default to sourceEl's parent\r\n\t},\r\n\r\n\r\n\t// Causes the element to start following the mouse\r\n\tstart: function(ev) {\r\n\t\tif (!this.isFollowing) {\r\n\t\t\tthis.isFollowing = true;\r\n\r\n\t\t\tthis.mouseY0 = ev.pageY;\r\n\t\t\tthis.mouseX0 = ev.pageX;\r\n\t\t\tthis.topDelta = 0;\r\n\t\t\tthis.leftDelta = 0;\r\n\r\n\t\t\tif (!this.isHidden) {\r\n\t\t\t\tthis.updatePosition();\r\n\t\t\t}\r\n\r\n\t\t\t$(document).on('mousemove', this.mousemoveProxy = proxy(this, 'mousemove'));\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Causes the element to stop following the mouse. If shouldRevert is true, will animate back to original position.\r\n\t// `callback` gets invoked when the animation is complete. If no animation, it is invoked immediately.\r\n\tstop: function(shouldRevert, callback) {\r\n\t\tvar _this = this;\r\n\t\tvar revertDuration = this.options.revertDuration;\r\n\r\n\t\tfunction complete() {\r\n\t\t\tthis.isAnimating = false;\r\n\t\t\t_this.destroyEl();\r\n\r\n\t\t\tthis.top0 = this.left0 = null; // reset state for future updatePosition calls\r\n\r\n\t\t\tif (callback) {\r\n\t\t\t\tcallback();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (this.isFollowing && !this.isAnimating) { // disallow more than one stop animation at a time\r\n\t\t\tthis.isFollowing = false;\r\n\r\n\t\t\t$(document).off('mousemove', this.mousemoveProxy);\r\n\r\n\t\t\tif (shouldRevert && revertDuration && !this.isHidden) { // do a revert animation?\r\n\t\t\t\tthis.isAnimating = true;\r\n\t\t\t\tthis.el.animate({\r\n\t\t\t\t\ttop: this.top0,\r\n\t\t\t\t\tleft: this.left0\r\n\t\t\t\t}, {\r\n\t\t\t\t\tduration: revertDuration,\r\n\t\t\t\t\tcomplete: complete\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tcomplete();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Gets the tracking element. Create it if necessary\r\n\tgetEl: function() {\r\n\t\tvar el = this.el;\r\n\r\n\t\tif (!el) {\r\n\t\t\tthis.sourceEl.width(); // hack to force IE8 to compute correct bounding box\r\n\t\t\tel = this.el = this.sourceEl.clone()\r\n\t\t\t\t.css({\r\n\t\t\t\t\tposition: 'absolute',\r\n\t\t\t\t\tvisibility: '', // in case original element was hidden (commonly through hideEvents())\r\n\t\t\t\t\tdisplay: this.isHidden ? 'none' : '', // for when initially hidden\r\n\t\t\t\t\tmargin: 0,\r\n\t\t\t\t\tright: 'auto', // erase and set width instead\r\n\t\t\t\t\tbottom: 'auto', // erase and set height instead\r\n\t\t\t\t\twidth: this.sourceEl.width(), // explicit height in case there was a 'right' value\r\n\t\t\t\t\theight: this.sourceEl.height(), // explicit width in case there was a 'bottom' value\r\n\t\t\t\t\topacity: this.options.opacity || '',\r\n\t\t\t\t\tzIndex: this.options.zIndex\r\n\t\t\t\t})\r\n\t\t\t\t.appendTo(this.parentEl);\r\n\t\t}\r\n\r\n\t\treturn el;\r\n\t},\r\n\r\n\r\n\t// Removes the tracking element if it has already been created\r\n\tdestroyEl: function() {\r\n\t\tif (this.el) {\r\n\t\t\tthis.el.remove();\r\n\t\t\tthis.el = null;\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Update the CSS position of the tracking element\r\n\tupdatePosition: function() {\r\n\t\tvar sourceOffset;\r\n\t\tvar origin;\r\n\r\n\t\tthis.getEl(); // ensure this.el\r\n\r\n\t\t// make sure origin info was computed\r\n\t\tif (this.top0 === null) {\r\n\t\t\tthis.sourceEl.width(); // hack to force IE8 to compute correct bounding box\r\n\t\t\tsourceOffset = this.sourceEl.offset();\r\n\t\t\torigin = this.el.offsetParent().offset();\r\n\t\t\tthis.top0 = sourceOffset.top - origin.top;\r\n\t\t\tthis.left0 = sourceOffset.left - origin.left;\r\n\t\t}\r\n\r\n\t\tthis.el.css({\r\n\t\t\ttop: this.top0 + this.topDelta,\r\n\t\t\tleft: this.left0 + this.leftDelta\r\n\t\t});\r\n\t},\r\n\r\n\r\n\t// Gets called when the user moves the mouse\r\n\tmousemove: function(ev) {\r\n\t\tthis.topDelta = ev.pageY - this.mouseY0;\r\n\t\tthis.leftDelta = ev.pageX - this.mouseX0;\r\n\r\n\t\tif (!this.isHidden) {\r\n\t\t\tthis.updatePosition();\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Temporarily makes the tracking element invisible. Can be called before following starts\r\n\thide: function() {\r\n\t\tif (!this.isHidden) {\r\n\t\t\tthis.isHidden = true;\r\n\t\t\tif (this.el) {\r\n\t\t\t\tthis.el.hide();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Show the tracking element after it has been temporarily hidden\r\n\tshow: function() {\r\n\t\tif (this.isHidden) {\r\n\t\t\tthis.isHidden = false;\r\n\t\t\tthis.updatePosition();\r\n\t\t\tthis.getEl().show();\r\n\t\t}\r\n\t}\r\n\r\n});\r\n\r\n;;\r\n\r\n/* A utility class for rendering <tr> rows.\r\n----------------------------------------------------------------------------------------------------------------------*/\r\n// It leverages methods of the subclass and the View to determine custom rendering behavior for each row \"type\"\r\n// (such as highlight rows, day rows, helper rows, etc).\r\n\r\nvar RowRenderer = Class.extend({\r\n\r\n\tview: null, // a View object\r\n\tisRTL: null, // shortcut to the view's isRTL option\r\n\tcellHtml: '<td/>', // plain default HTML used for a cell when no other is available\r\n\r\n\r\n\tconstructor: function(view) {\r\n\t\tthis.view = view;\r\n\t\tthis.isRTL = view.opt('isRTL');\r\n\t},\r\n\r\n\r\n\t// Renders the HTML for a row, leveraging custom cell-HTML-renderers based on the `rowType`.\r\n\t// Also applies the \"intro\" and \"outro\" cells, which are specified by the subclass and views.\r\n\t// `row` is an optional row number.\r\n\trowHtml: function(rowType, row) {\r\n\t\tvar renderCell = this.getHtmlRenderer('cell', rowType);\r\n\t\tvar rowCellHtml = '';\r\n\t\tvar col;\r\n\t\tvar cell;\r\n\r\n\t\trow = row || 0;\r\n\r\n\t\tfor (col = 0; col < this.colCnt; col++) {\r\n\t\t\tcell = this.getCell(row, col);\r\n\t\t\trowCellHtml += renderCell(cell);\r\n\t\t}\r\n\r\n\t\trowCellHtml = this.bookendCells(rowCellHtml, rowType, row); // apply intro and outro\r\n\r\n\t\treturn '<tr>' + rowCellHtml + '</tr>';\r\n\t},\r\n\r\n\r\n\t// Applies the \"intro\" and \"outro\" HTML to the given cells.\r\n\t// Intro means the leftmost cell when the calendar is LTR and the rightmost cell when RTL. Vice-versa for outro.\r\n\t// `cells` can be an HTML string of <td>'s or a jQuery <tr> element\r\n\t// `row` is an optional row number.\r\n\tbookendCells: function(cells, rowType, row) {\r\n\t\tvar intro = this.getHtmlRenderer('intro', rowType)(row || 0);\r\n\t\tvar outro = this.getHtmlRenderer('outro', rowType)(row || 0);\r\n\t\tvar prependHtml = this.isRTL ? outro : intro;\r\n\t\tvar appendHtml = this.isRTL ? intro : outro;\r\n\r\n\t\tif (typeof cells === 'string') {\r\n\t\t\treturn prependHtml + cells + appendHtml;\r\n\t\t}\r\n\t\telse { // a jQuery <tr> element\r\n\t\t\treturn cells.prepend(prependHtml).append(appendHtml);\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Returns an HTML-rendering function given a specific `rendererName` (like cell, intro, or outro) and a specific\r\n\t// `rowType` (like day, eventSkeleton, helperSkeleton), which is optional.\r\n\t// If a renderer for the specific rowType doesn't exist, it will fall back to a generic renderer.\r\n\t// We will query the View object first for any custom rendering functions, then the methods of the subclass.\r\n\tgetHtmlRenderer: function(rendererName, rowType) {\r\n\t\tvar view = this.view;\r\n\t\tvar generalName; // like \"cellHtml\"\r\n\t\tvar specificName; // like \"dayCellHtml\". based on rowType\r\n\t\tvar provider; // either the View or the RowRenderer subclass, whichever provided the method\r\n\t\tvar renderer;\r\n\r\n\t\tgeneralName = rendererName + 'Html';\r\n\t\tif (rowType) {\r\n\t\t\tspecificName = rowType + capitaliseFirstLetter(rendererName) + 'Html';\r\n\t\t}\r\n\r\n\t\tif (specificName && (renderer = view[specificName])) {\r\n\t\t\tprovider = view;\r\n\t\t}\r\n\t\telse if (specificName && (renderer = this[specificName])) {\r\n\t\t\tprovider = this;\r\n\t\t}\r\n\t\telse if ((renderer = view[generalName])) {\r\n\t\t\tprovider = view;\r\n\t\t}\r\n\t\telse if ((renderer = this[generalName])) {\r\n\t\t\tprovider = this;\r\n\t\t}\r\n\r\n\t\tif (typeof renderer === 'function') {\r\n\t\t\treturn function() {\r\n\t\t\t\treturn renderer.apply(provider, arguments) || ''; // use correct `this` and always return a string\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// the rendered can be a plain string as well. if not specified, always an empty string.\r\n\t\treturn function() {\r\n\t\t\treturn renderer || '';\r\n\t\t};\r\n\t}\r\n\r\n});\r\n\r\n;;\r\n\r\n/* An abstract class comprised of a \"grid\" of cells that each represent a specific datetime\r\n----------------------------------------------------------------------------------------------------------------------*/\r\n\r\nvar Grid = fc.Grid = RowRenderer.extend({\r\n\r\n\tstart: null, // the date of the first cell\r\n\tend: null, // the date after the last cell\r\n\r\n\trowCnt: 0, // number of rows\r\n\tcolCnt: 0, // number of cols\r\n\trowData: null, // array of objects, holding misc data for each row\r\n\tcolData: null, // array of objects, holding misc data for each column\r\n\r\n\tel: null, // the containing element\r\n\tcoordMap: null, // a GridCoordMap that converts pixel values to datetimes\r\n\telsByFill: null, // a hash of jQuery element sets used for rendering each fill. Keyed by fill name.\r\n\r\n\texternalDragStartProxy: null, // binds the Grid's scope to externalDragStart (in DayGrid.events)\r\n\r\n\t// derived from options\r\n\tcolHeadFormat: null, // TODO: move to another class. not applicable to all Grids\r\n\teventTimeFormat: null,\r\n\tdisplayEventTime: null,\r\n\tdisplayEventEnd: null,\r\n\r\n\t// if all cells are the same length of time, the duration they all share. optional.\r\n\t// when defined, allows the computeCellRange shortcut, as well as improved resizing behavior.\r\n\tcellDuration: null,\r\n\r\n\t// if defined, holds the unit identified (ex: \"year\" or \"month\") that determines the level of granularity\r\n\t// of the date cells. if not defined, assumes to be day and time granularity.\r\n\tlargeUnit: null,\r\n\r\n\r\n\tconstructor: function() {\r\n\t\tRowRenderer.apply(this, arguments); // call the super-constructor\r\n\r\n\t\tthis.coordMap = new GridCoordMap(this);\r\n\t\tthis.elsByFill = {};\r\n\t\tthis.externalDragStartProxy = proxy(this, 'externalDragStart');\r\n\t},\r\n\r\n\r\n\t/* Options\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Generates the format string used for the text in column headers, if not explicitly defined by 'columnFormat'\r\n\t// TODO: move to another class. not applicable to all Grids\r\n\tcomputeColHeadFormat: function() {\r\n\t\t// subclasses must implement if they want to use headHtml()\r\n\t},\r\n\r\n\r\n\t// Generates the format string used for event time text, if not explicitly defined by 'timeFormat'\r\n\tcomputeEventTimeFormat: function() {\r\n\t\treturn this.view.opt('smallTimeFormat');\r\n\t},\r\n\r\n\r\n\t// Determines whether events should have their end times displayed, if not explicitly defined by 'displayEventTime'.\r\n\t// Only applies to non-all-day events.\r\n\tcomputeDisplayEventTime: function() {\r\n\t\treturn true;\r\n\t},\r\n\r\n\r\n\t// Determines whether events should have their end times displayed, if not explicitly defined by 'displayEventEnd'\r\n\tcomputeDisplayEventEnd: function() {\r\n\t\treturn true;\r\n\t},\r\n\r\n\r\n\t/* Dates\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Tells the grid about what period of time to display. Grid will subsequently compute dates for cell system.\r\n\tsetRange: function(range) {\r\n\t\tvar view = this.view;\r\n\t\tvar displayEventTime;\r\n\t\tvar displayEventEnd;\r\n\r\n\t\tthis.start = range.start.clone();\r\n\t\tthis.end = range.end.clone();\r\n\r\n\t\tthis.rowData = [];\r\n\t\tthis.colData = [];\r\n\t\tthis.updateCells();\r\n\r\n\t\t// Populate option-derived settings. Look for override first, then compute if necessary.\r\n\t\tthis.colHeadFormat = view.opt('columnFormat') || this.computeColHeadFormat();\r\n\r\n\t\tthis.eventTimeFormat =\r\n\t\t\tview.opt('eventTimeFormat') ||\r\n\t\t\tview.opt('timeFormat') || // deprecated\r\n\t\t\tthis.computeEventTimeFormat();\r\n\r\n\t\tdisplayEventTime = view.opt('displayEventTime');\r\n\t\tif (displayEventTime == null) {\r\n\t\t\tdisplayEventTime = this.computeDisplayEventTime(); // might be based off of range\r\n\t\t}\r\n\r\n\t\tdisplayEventEnd = view.opt('displayEventEnd');\r\n\t\tif (displayEventEnd == null) {\r\n\t\t\tdisplayEventEnd = this.computeDisplayEventEnd(); // might be based off of range\r\n\t\t}\r\n\r\n\t\tthis.displayEventTime = displayEventTime;\r\n\t\tthis.displayEventEnd = displayEventEnd;\r\n\t},\r\n\r\n\r\n\t// Responsible for setting rowCnt/colCnt and any other row/col data\r\n\tupdateCells: function() {\r\n\t\t// subclasses must implement\r\n\t},\r\n\r\n\r\n\t// Converts a range with an inclusive `start` and an exclusive `end` into an array of segment objects\r\n\trangeToSegs: function(range) {\r\n\t\t// subclasses must implement\r\n\t},\r\n\r\n\r\n\t// Diffs the two dates, returning a duration, based on granularity of the grid\r\n\tdiffDates: function(a, b) {\r\n\t\tif (this.largeUnit) {\r\n\t\t\treturn diffByUnit(a, b, this.largeUnit);\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn diffDayTime(a, b);\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t/* Cells\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\t// NOTE: columns are ordered left-to-right\r\n\r\n\r\n\t// Gets an object containing row/col number, misc data, and range information about the cell.\r\n\t// Accepts row/col values, an object with row/col properties, or a single-number offset from the first cell.\r\n\tgetCell: function(row, col) {\r\n\t\tvar cell;\r\n\r\n\t\tif (col == null) {\r\n\t\t\tif (typeof row === 'number') { // a single-number offset\r\n\t\t\t\tcol = row % this.colCnt;\r\n\t\t\t\trow = Math.floor(row / this.colCnt);\r\n\t\t\t}\r\n\t\t\telse { // an object with row/col properties\r\n\t\t\t\tcol = row.col;\r\n\t\t\t\trow = row.row;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tcell = { row: row, col: col };\r\n\r\n\t\t$.extend(cell, this.getRowData(row), this.getColData(col));\r\n\t\t$.extend(cell, this.computeCellRange(cell));\r\n\r\n\t\treturn cell;\r\n\t},\r\n\r\n\r\n\t// Given a cell object with index and misc data, generates a range object\r\n\t// If the grid is leveraging cellDuration, this doesn't need to be defined. Only computeCellDate does.\r\n\t// If being overridden, should return a range with reference-free date copies.\r\n\tcomputeCellRange: function(cell) {\r\n\t\tvar date = this.computeCellDate(cell);\r\n\r\n\t\treturn {\r\n\t\t\tstart: date,\r\n\t\t\tend: date.clone().add(this.cellDuration)\r\n\t\t};\r\n\t},\r\n\r\n\r\n\t// Given a cell, returns its start date. Should return a reference-free date copy.\r\n\tcomputeCellDate: function(cell) {\r\n\t\t// subclasses can implement\r\n\t},\r\n\r\n\r\n\t// Retrieves misc data about the given row\r\n\tgetRowData: function(row) {\r\n\t\treturn this.rowData[row] || {};\r\n\t},\r\n\r\n\r\n\t// Retrieves misc data baout the given column\r\n\tgetColData: function(col) {\r\n\t\treturn this.colData[col] || {};\r\n\t},\r\n\r\n\r\n\t// Retrieves the element representing the given row\r\n\tgetRowEl: function(row) {\r\n\t\t// subclasses should implement if leveraging the default getCellDayEl() or computeRowCoords()\r\n\t},\r\n\r\n\r\n\t// Retrieves the element representing the given column\r\n\tgetColEl: function(col) {\r\n\t\t// subclasses should implement if leveraging the default getCellDayEl() or computeColCoords()\r\n\t},\r\n\r\n\r\n\t// Given a cell object, returns the element that represents the cell's whole-day\r\n\tgetCellDayEl: function(cell) {\r\n\t\treturn this.getColEl(cell.col) || this.getRowEl(cell.row);\r\n\t},\r\n\r\n\r\n\t/* Cell Coordinates\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Computes the top/bottom coordinates of all rows.\r\n\t// By default, queries the dimensions of the element provided by getRowEl().\r\n\tcomputeRowCoords: function() {\r\n\t\tvar items = [];\r\n\t\tvar i, el;\r\n\t\tvar top;\r\n\r\n\t\tfor (i = 0; i < this.rowCnt; i++) {\r\n\t\t\tel = this.getRowEl(i);\r\n\t\t\ttop = el.offset().top;\r\n\t\t\titems.push({\r\n\t\t\t\ttop: top,\r\n\t\t\t\tbottom: top + el.outerHeight()\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn items;\r\n\t},\r\n\r\n\r\n\t// Computes the left/right coordinates of all rows.\r\n\t// By default, queries the dimensions of the element provided by getColEl(). Columns can be LTR or RTL.\r\n\tcomputeColCoords: function() {\r\n\t\tvar items = [];\r\n\t\tvar i, el;\r\n\t\tvar left;\r\n\r\n\t\tfor (i = 0; i < this.colCnt; i++) {\r\n\t\t\tel = this.getColEl(i);\r\n\t\t\tleft = el.offset().left;\r\n\t\t\titems.push({\r\n\t\t\t\tleft: left,\r\n\t\t\t\tright: left + el.outerWidth()\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn items;\r\n\t},\r\n\r\n\r\n\t/* Rendering\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Sets the container element that the grid should render inside of.\r\n\t// Does other DOM-related initializations.\r\n\tsetElement: function(el) {\r\n\t\tvar _this = this;\r\n\r\n\t\tthis.el = el;\r\n\r\n\t\t// attach a handler to the grid's root element.\r\n\t\t// jQuery will take care of unregistering them when removeElement gets called.\r\n\t\tel.on('mousedown', function(ev) {\r\n\t\t\tif (\r\n\t\t\t\t!$(ev.target).is('.fc-event-container *, .fc-more') && // not an an event element, or \"more..\" link\r\n\t\t\t\t!$(ev.target).closest('.fc-popover').length // not on a popover (like the \"more..\" events one)\r\n\t\t\t) {\r\n\t\t\t\t_this.dayMousedown(ev);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// attach event-element-related handlers. in Grid.events\r\n\t\t// same garbage collection note as above.\r\n\t\tthis.bindSegHandlers();\r\n\r\n\t\tthis.bindGlobalHandlers();\r\n\t},\r\n\r\n\r\n\t// Removes the grid's container element from the DOM. Undoes any other DOM-related attachments.\r\n\t// DOES NOT remove any content before hand (doens't clear events or call destroyDates), unlike View\r\n\tremoveElement: function() {\r\n\t\tthis.unbindGlobalHandlers();\r\n\r\n\t\tthis.el.remove();\r\n\r\n\t\t// NOTE: we don't null-out this.el for the same reasons we don't do it within View::removeElement\r\n\t},\r\n\r\n\r\n\t// Renders the basic structure of grid view before any content is rendered\r\n\trenderSkeleton: function() {\r\n\t\t// subclasses should implement\r\n\t},\r\n\r\n\r\n\t// Renders the grid's date-related content (like cells that represent days/times).\r\n\t// Assumes setRange has already been called and the skeleton has already been rendered.\r\n\trenderDates: function() {\r\n\t\t// subclasses should implement\r\n\t},\r\n\r\n\r\n\t// Unrenders the grid's date-related content\r\n\tdestroyDates: function() {\r\n\t\t// subclasses should implement\r\n\t},\r\n\r\n\r\n\t/* Handlers\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Binds DOM handlers to elements that reside outside the grid, such as the document\r\n\tbindGlobalHandlers: function() {\r\n\t\t$(document).on('dragstart sortstart', this.externalDragStartProxy); // jqui\r\n\t},\r\n\r\n\r\n\t// Unbinds DOM handlers from elements that reside outside the grid\r\n\tunbindGlobalHandlers: function() {\r\n\t\t$(document).off('dragstart sortstart', this.externalDragStartProxy); // jqui\r\n\t},\r\n\r\n\r\n\t// Process a mousedown on an element that represents a day. For day clicking and selecting.\r\n\tdayMousedown: function(ev) {\r\n\t\tvar _this = this;\r\n\t\tvar view = this.view;\r\n\t\tvar isSelectable = view.opt('selectable');\r\n\t\tvar dayClickCell; // null if invalid dayClick\r\n\t\tvar selectionRange; // null if invalid selection\r\n\r\n\t\t// this listener tracks a mousedown on a day element, and a subsequent drag.\r\n\t\t// if the drag ends on the same day, it is a 'dayClick'.\r\n\t\t// if 'selectable' is enabled, this listener also detects selections.\r\n\t\tvar dragListener = new CellDragListener(this.coordMap, {\r\n\t\t\t//distance: 5, // needs more work if we want dayClick to fire correctly\r\n\t\t\tscroll: view.opt('dragScroll'),\r\n\t\t\tdragStart: function() {\r\n\t\t\t\tview.unselect(); // since we could be rendering a new selection, we want to clear any old one\r\n\t\t\t},\r\n\t\t\tcellOver: function(cell, isOrig, origCell) {\r\n\t\t\t\tif (origCell) { // click needs to have started on a cell\r\n\t\t\t\t\tdayClickCell = isOrig ? cell : null; // single-cell selection is a day click\r\n\t\t\t\t\tif (isSelectable) {\r\n\t\t\t\t\t\tselectionRange = _this.computeSelection(origCell, cell);\r\n\t\t\t\t\t\tif (selectionRange) {\r\n\t\t\t\t\t\t\t_this.renderSelection(selectionRange);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tdisableCursor();\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tcellOut: function(cell) {\r\n\t\t\t\tdayClickCell = null;\r\n\t\t\t\tselectionRange = null;\r\n\t\t\t\t_this.destroySelection();\r\n\t\t\t\tenableCursor();\r\n\t\t\t},\r\n\t\t\tlistenStop: function(ev) {\r\n\t\t\t\tif (dayClickCell) {\r\n\t\t\t\t\tview.trigger('dayClick', _this.getCellDayEl(dayClickCell), dayClickCell.start, ev);\r\n\t\t\t\t}\r\n\t\t\t\tif (selectionRange) {\r\n\t\t\t\t\t// the selection will already have been rendered. just report it\r\n\t\t\t\t\tview.reportSelection(selectionRange, ev);\r\n\t\t\t\t}\r\n\t\t\t\tenableCursor();\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tdragListener.mousedown(ev); // start listening, which will eventually initiate a dragStart\r\n\t},\r\n\r\n\r\n\t/* Event Helper\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\t// TODO: should probably move this to Grid.events, like we did event dragging / resizing\r\n\r\n\r\n\t// Renders a mock event over the given range\r\n\trenderRangeHelper: function(range, sourceSeg) {\r\n\t\tvar fakeEvent = this.fabricateHelperEvent(range, sourceSeg);\r\n\r\n\t\tthis.renderHelper(fakeEvent, sourceSeg); // do the actual rendering\r\n\t},\r\n\r\n\r\n\t// Builds a fake event given a date range it should cover, and a segment is should be inspired from.\r\n\t// The range's end can be null, in which case the mock event that is rendered will have a null end time.\r\n\t// `sourceSeg` is the internal segment object involved in the drag. If null, something external is dragging.\r\n\tfabricateHelperEvent: function(range, sourceSeg) {\r\n\t\tvar fakeEvent = sourceSeg ? createObject(sourceSeg.event) : {}; // mask the original event object if possible\r\n\r\n\t\tfakeEvent.start = range.start.clone();\r\n\t\tfakeEvent.end = range.end ? range.end.clone() : null;\r\n\t\tfakeEvent.allDay = null; // force it to be freshly computed by normalizeEventRange\r\n\t\tthis.view.calendar.normalizeEventRange(fakeEvent);\r\n\r\n\t\t// this extra className will be useful for differentiating real events from mock events in CSS\r\n\t\tfakeEvent.className = (fakeEvent.className || []).concat('fc-helper');\r\n\r\n\t\t// if something external is being dragged in, don't render a resizer\r\n\t\tif (!sourceSeg) {\r\n\t\t\tfakeEvent.editable = false;\r\n\t\t}\r\n\r\n\t\treturn fakeEvent;\r\n\t},\r\n\r\n\r\n\t// Renders a mock event\r\n\trenderHelper: function(event, sourceSeg) {\r\n\t\t// subclasses must implement\r\n\t},\r\n\r\n\r\n\t// Unrenders a mock event\r\n\tdestroyHelper: function() {\r\n\t\t// subclasses must implement\r\n\t},\r\n\r\n\r\n\t/* Selection\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Renders a visual indication of a selection. Will highlight by default but can be overridden by subclasses.\r\n\trenderSelection: function(range) {\r\n\t\tthis.renderHighlight(range);\r\n\t},\r\n\r\n\r\n\t// Unrenders any visual indications of a selection. Will unrender a highlight by default.\r\n\tdestroySelection: function() {\r\n\t\tthis.destroyHighlight();\r\n\t},\r\n\r\n\r\n\t// Given the first and last cells of a selection, returns a range object.\r\n\t// Will return something falsy if the selection is invalid (when outside of selectionConstraint for example).\r\n\t// Subclasses can override and provide additional data in the range object. Will be passed to renderSelection().\r\n\tcomputeSelection: function(firstCell, lastCell) {\r\n\t\tvar dates = [\r\n\t\t\tfirstCell.start,\r\n\t\t\tfirstCell.end,\r\n\t\t\tlastCell.start,\r\n\t\t\tlastCell.end\r\n\t\t];\r\n\t\tvar range;\r\n\r\n\t\tdates.sort(compareNumbers); // sorts chronologically. works with Moments\r\n\r\n\t\trange = {\r\n\t\t\tstart: dates[0].clone(),\r\n\t\t\tend: dates[3].clone()\r\n\t\t};\r\n\r\n\t\tif (!this.view.calendar.isSelectionRangeAllowed(range)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn range;\r\n\t},\r\n\r\n\r\n\t/* Highlight\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Renders an emphasis on the given date range. `start` is inclusive. `end` is exclusive.\r\n\trenderHighlight: function(range) {\r\n\t\tthis.renderFill('highlight', this.rangeToSegs(range));\r\n\t},\r\n\r\n\r\n\t// Unrenders the emphasis on a date range\r\n\tdestroyHighlight: function() {\r\n\t\tthis.destroyFill('highlight');\r\n\t},\r\n\r\n\r\n\t// Generates an array of classNames for rendering the highlight. Used by the fill system.\r\n\thighlightSegClasses: function() {\r\n\t\treturn [ 'fc-highlight' ];\r\n\t},\r\n\r\n\r\n\t/* Fill System (highlight, background events, business hours)\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Renders a set of rectangles over the given segments of time.\r\n\t// Returns a subset of segs, the segs that were actually rendered.\r\n\t// Responsible for populating this.elsByFill. TODO: better API for expressing this requirement\r\n\trenderFill: function(type, segs) {\r\n\t\t// subclasses must implement\r\n\t},\r\n\r\n\r\n\t// Unrenders a specific type of fill that is currently rendered on the grid\r\n\tdestroyFill: function(type) {\r\n\t\tvar el = this.elsByFill[type];\r\n\r\n\t\tif (el) {\r\n\t\t\tel.remove();\r\n\t\t\tdelete this.elsByFill[type];\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Renders and assigns an `el` property for each fill segment. Generic enough to work with different types.\r\n\t// Only returns segments that successfully rendered.\r\n\t// To be harnessed by renderFill (implemented by subclasses).\r\n\t// Analagous to renderFgSegEls.\r\n\trenderFillSegEls: function(type, segs) {\r\n\t\tvar _this = this;\r\n\t\tvar segElMethod = this[type + 'SegEl'];\r\n\t\tvar html = '';\r\n\t\tvar renderedSegs = [];\r\n\t\tvar i;\r\n\r\n\t\tif (segs.length) {\r\n\r\n\t\t\t// build a large concatenation of segment HTML\r\n\t\t\tfor (i = 0; i < segs.length; i++) {\r\n\t\t\t\thtml += this.fillSegHtml(type, segs[i]);\r\n\t\t\t}\r\n\r\n\t\t\t// Grab individual elements from the combined HTML string. Use each as the default rendering.\r\n\t\t\t// Then, compute the 'el' for each segment.\r\n\t\t\t$(html).each(function(i, node) {\r\n\t\t\t\tvar seg = segs[i];\r\n\t\t\t\tvar el = $(node);\r\n\r\n\t\t\t\t// allow custom filter methods per-type\r\n\t\t\t\tif (segElMethod) {\r\n\t\t\t\t\tel = segElMethod.call(_this, seg, el);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (el) { // custom filters did not cancel the render\r\n\t\t\t\t\tel = $(el); // allow custom filter to return raw DOM node\r\n\r\n\t\t\t\t\t// correct element type? (would be bad if a non-TD were inserted into a table for example)\r\n\t\t\t\t\tif (el.is(_this.fillSegTag)) {\r\n\t\t\t\t\t\tseg.el = el;\r\n\t\t\t\t\t\trenderedSegs.push(seg);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn renderedSegs;\r\n\t},\r\n\r\n\r\n\tfillSegTag: 'div', // subclasses can override\r\n\r\n\r\n\t// Builds the HTML needed for one fill segment. Generic enought o work with different types.\r\n\tfillSegHtml: function(type, seg) {\r\n\r\n\t\t// custom hooks per-type\r\n\t\tvar classesMethod = this[type + 'SegClasses'];\r\n\t\tvar cssMethod = this[type + 'SegCss'];\r\n\r\n\t\tvar classes = classesMethod ? classesMethod.call(this, seg) : [];\r\n\t\tvar css = cssToStr(cssMethod ? cssMethod.call(this, seg) : {});\r\n\r\n\t\treturn '<' + this.fillSegTag +\r\n\t\t\t(classes.length ? ' class=\"' + classes.join(' ') + '\"' : '') +\r\n\t\t\t(css ? ' style=\"' + css + '\"' : '') +\r\n\t\t\t' />';\r\n\t},\r\n\r\n\r\n\t/* Generic rendering utilities for subclasses\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Renders a day-of-week header row.\r\n\t// TODO: move to another class. not applicable to all Grids\r\n\theadHtml: function() {\r\n\t\treturn '' +\r\n\t\t\t'<div class=\"fc-row ' + this.view.widgetHeaderClass + '\">' +\r\n\t\t\t\t'<table>' +\r\n\t\t\t\t\t'<thead>' +\r\n\t\t\t\t\t\tthis.rowHtml('head') + // leverages RowRenderer\r\n\t\t\t\t\t'</thead>' +\r\n\t\t\t\t'</table>' +\r\n\t\t\t'</div>';\r\n\t},\r\n\r\n\r\n\t// Used by the `headHtml` method, via RowRenderer, for rendering the HTML of a day-of-week header cell\r\n\t// TODO: move to another class. not applicable to all Grids\r\n\theadCellHtml: function(cell) {\r\n\t\tvar view = this.view;\r\n\t\tvar date = cell.start;\r\n\r\n\t\treturn '' +\r\n\t\t\t'<th class=\"fc-day-header ' + view.widgetHeaderClass + ' fc-' + dayIDs[date.day()] + '\">' +\r\n\t\t\t\thtmlEscape(date.format(this.colHeadFormat)) +\r\n\t\t\t'</th>';\r\n\t},\r\n\r\n\r\n\t// Renders the HTML for a single-day background cell\r\n\tbgCellHtml: function(cell) {\r\n\t\tvar view = this.view;\r\n\t\tvar date = cell.start;\r\n\t\tvar classes = this.getDayClasses(date);\r\n\r\n\t\tclasses.unshift('fc-day', view.widgetContentClass);\r\n\r\n\t\treturn '<td class=\"' + classes.join(' ') + '\"' +\r\n\t\t\t' data-date=\"' + date.format('YYYY-MM-DD') + '\"' + // if date has a time, won't format it\r\n\t\t\t'></td>';\r\n\t},\r\n\r\n\r\n\t// Computes HTML classNames for a single-day cell\r\n\tgetDayClasses: function(date) {\r\n\t\tvar view = this.view;\r\n\t\tvar today = view.calendar.getNow().stripTime();\r\n\t\tvar classes = [ 'fc-' + dayIDs[date.day()] ];\r\n\r\n\t\tif (\r\n\t\t\tview.intervalDuration.as('months') == 1 &&\r\n\t\t\tdate.month() != view.intervalStart.month()\r\n\t\t) {\r\n\t\t\tclasses.push('fc-other-month');\r\n\t\t}\r\n\r\n\t\tif (date.isSame(today, 'day')) {\r\n\t\t\tclasses.push(\r\n\t\t\t\t'fc-today',\r\n\t\t\t\tview.highlightStateClass\r\n\t\t\t);\r\n\t\t}\r\n\t\telse if (date < today) {\r\n\t\t\tclasses.push('fc-past');\r\n\t\t}\r\n\t\telse {\r\n\t\t\tclasses.push('fc-future');\r\n\t\t}\r\n\r\n\t\treturn classes;\r\n\t}\r\n\r\n});\r\n\r\n;;\r\n\r\n/* Event-rendering and event-interaction methods for the abstract Grid class\r\n----------------------------------------------------------------------------------------------------------------------*/\r\n\r\nGrid.mixin({\r\n\r\n\tmousedOverSeg: null, // the segment object the user's mouse is over. null if over nothing\r\n\tisDraggingSeg: false, // is a segment being dragged? boolean\r\n\tisResizingSeg: false, // is a segment being resized? boolean\r\n\tisDraggingExternal: false, // jqui-dragging an external element? boolean\r\n\tsegs: null, // the event segments currently rendered in the grid\r\n\r\n\r\n\t// Renders the given events onto the grid\r\n\trenderEvents: function(events) {\r\n\t\tvar segs = this.eventsToSegs(events);\r\n\t\tvar bgSegs = [];\r\n\t\tvar fgSegs = [];\r\n\t\tvar i, seg;\r\n\r\n\t\tfor (i = 0; i < segs.length; i++) {\r\n\t\t\tseg = segs[i];\r\n\r\n\t\t\tif (isBgEvent(seg.event)) {\r\n\t\t\t\tbgSegs.push(seg);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tfgSegs.push(seg);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Render each different type of segment.\r\n\t\t// Each function may return a subset of the segs, segs that were actually rendered.\r\n\t\tbgSegs = this.renderBgSegs(bgSegs) || bgSegs;\r\n\t\tfgSegs = this.renderFgSegs(fgSegs) || fgSegs;\r\n\r\n\t\tthis.segs = bgSegs.concat(fgSegs);\r\n\t},\r\n\r\n\r\n\t// Unrenders all events currently rendered on the grid\r\n\tdestroyEvents: function() {\r\n\t\tthis.triggerSegMouseout(); // trigger an eventMouseout if user's mouse is over an event\r\n\r\n\t\tthis.destroyFgSegs();\r\n\t\tthis.destroyBgSegs();\r\n\r\n\t\tthis.segs = null;\r\n\t},\r\n\r\n\r\n\t// Retrieves all rendered segment objects currently rendered on the grid\r\n\tgetEventSegs: function() {\r\n\t\treturn this.segs || [];\r\n\t},\r\n\r\n\r\n\t/* Foreground Segment Rendering\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Renders foreground event segments onto the grid. May return a subset of segs that were rendered.\r\n\trenderFgSegs: function(segs) {\r\n\t\t// subclasses must implement\r\n\t},\r\n\r\n\r\n\t// Unrenders all currently rendered foreground segments\r\n\tdestroyFgSegs: function() {\r\n\t\t// subclasses must implement\r\n\t},\r\n\r\n\r\n\t// Renders and assigns an `el` property for each foreground event segment.\r\n\t// Only returns segments that successfully rendered.\r\n\t// A utility that subclasses may use.\r\n\trenderFgSegEls: function(segs, disableResizing) {\r\n\t\tvar view = this.view;\r\n\t\tvar html = '';\r\n\t\tvar renderedSegs = [];\r\n\t\tvar i;\r\n\r\n\t\tif (segs.length) { // don't build an empty html string\r\n\r\n\t\t\t// build a large concatenation of event segment HTML\r\n\t\t\tfor (i = 0; i < segs.length; i++) {\r\n\t\t\t\thtml += this.fgSegHtml(segs[i], disableResizing);\r\n\t\t\t}\r\n\r\n\t\t\t// Grab individual elements from the combined HTML string. Use each as the default rendering.\r\n\t\t\t// Then, compute the 'el' for each segment. An el might be null if the eventRender callback returned false.\r\n\t\t\t$(html).each(function(i, node) {\r\n\t\t\t\tvar seg = segs[i];\r\n\t\t\t\tvar el = view.resolveEventEl(seg.event, $(node));\r\n\r\n\t\t\t\tif (el) {\r\n\t\t\t\t\tel.data('fc-seg', seg); // used by handlers\r\n\t\t\t\t\tseg.el = el;\r\n\t\t\t\t\trenderedSegs.push(seg);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn renderedSegs;\r\n\t},\r\n\r\n\r\n\t// Generates the HTML for the default rendering of a foreground event segment. Used by renderFgSegEls()\r\n\tfgSegHtml: function(seg, disableResizing) {\r\n\t\t// subclasses should implement\r\n\t},\r\n\r\n\r\n\t/* Background Segment Rendering\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Renders the given background event segments onto the grid.\r\n\t// Returns a subset of the segs that were actually rendered.\r\n\trenderBgSegs: function(segs) {\r\n\t\treturn this.renderFill('bgEvent', segs);\r\n\t},\r\n\r\n\r\n\t// Unrenders all the currently rendered background event segments\r\n\tdestroyBgSegs: function() {\r\n\t\tthis.destroyFill('bgEvent');\r\n\t},\r\n\r\n\r\n\t// Renders a background event element, given the default rendering. Called by the fill system.\r\n\tbgEventSegEl: function(seg, el) {\r\n\t\treturn this.view.resolveEventEl(seg.event, el); // will filter through eventRender\r\n\t},\r\n\r\n\r\n\t// Generates an array of classNames to be used for the default rendering of a background event.\r\n\t// Called by the fill system.\r\n\tbgEventSegClasses: function(seg) {\r\n\t\tvar event = seg.event;\r\n\t\tvar source = event.source || {};\r\n\r\n\t\treturn [ 'fc-bgevent' ].concat(\r\n\t\t\tevent.className,\r\n\t\t\tsource.className || []\r\n\t\t);\r\n\t},\r\n\r\n\r\n\t// Generates a semicolon-separated CSS string to be used for the default rendering of a background event.\r\n\t// Called by the fill system.\r\n\t// TODO: consolidate with getEventSkinCss?\r\n\tbgEventSegCss: function(seg) {\r\n\t\tvar view = this.view;\r\n\t\tvar event = seg.event;\r\n\t\tvar source = event.source || {};\r\n\r\n\t\treturn {\r\n\t\t\t'background-color':\r\n\t\t\t\tevent.backgroundColor ||\r\n\t\t\t\tevent.color ||\r\n\t\t\t\tsource.backgroundColor ||\r\n\t\t\t\tsource.color ||\r\n\t\t\t\tview.opt('eventBackgroundColor') ||\r\n\t\t\t\tview.opt('eventColor')\r\n\t\t};\r\n\t},\r\n\r\n\r\n\t// Generates an array of classNames to be used for the rendering business hours overlay. Called by the fill system.\r\n\tbusinessHoursSegClasses: function(seg) {\r\n\t\treturn [ 'fc-nonbusiness', 'fc-bgevent' ];\r\n\t},\r\n\r\n\r\n\t/* Handlers\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Attaches event-element-related handlers to the container element and leverage bubbling\r\n\tbindSegHandlers: function() {\r\n\t\tvar _this = this;\r\n\t\tvar view = this.view;\r\n\r\n\t\t$.each(\r\n\t\t\t{\r\n\t\t\t\tmouseenter: function(seg, ev) {\r\n\t\t\t\t\t_this.triggerSegMouseover(seg, ev);\r\n\t\t\t\t},\r\n\t\t\t\tmouseleave: function(seg, ev) {\r\n\t\t\t\t\t_this.triggerSegMouseout(seg, ev);\r\n\t\t\t\t},\r\n\t\t\t\tclick: function(seg, ev) {\r\n\t\t\t\t\treturn view.trigger('eventClick', this, seg.event, ev); // can return `false` to cancel\r\n\t\t\t\t},\r\n\t\t\t\tmousedown: function(seg, ev) {\r\n\t\t\t\t\tif ($(ev.target).is('.fc-resizer') && view.isEventResizable(seg.event)) {\r\n\t\t\t\t\t\t_this.segResizeMousedown(seg, ev, $(ev.target).is('.fc-start-resizer'));\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse if (view.isEventDraggable(seg.event)) {\r\n\t\t\t\t\t\t_this.segDragMousedown(seg, ev);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tfunction(name, func) {\r\n\t\t\t\t// attach the handler to the container element and only listen for real event elements via bubbling\r\n\t\t\t\t_this.el.on(name, '.fc-event-container > *', function(ev) {\r\n\t\t\t\t\tvar seg = $(this).data('fc-seg'); // grab segment data. put there by View::renderEvents\r\n\r\n\t\t\t\t\t// only call the handlers if there is not a drag/resize in progress\r\n\t\t\t\t\tif (seg && !_this.isDraggingSeg && !_this.isResizingSeg) {\r\n\t\t\t\t\t\treturn func.call(this, seg, ev); // `this` will be the event element\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t);\r\n\t},\r\n\r\n\r\n\t// Updates internal state and triggers handlers for when an event element is moused over\r\n\ttriggerSegMouseover: function(seg, ev) {\r\n\t\tif (!this.mousedOverSeg) {\r\n\t\t\tthis.mousedOverSeg = seg;\r\n\t\t\tthis.view.trigger('eventMouseover', seg.el[0], seg.event, ev);\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Updates internal state and triggers handlers for when an event element is moused out.\r\n\t// Can be given no arguments, in which case it will mouseout the segment that was previously moused over.\r\n\ttriggerSegMouseout: function(seg, ev) {\r\n\t\tev = ev || {}; // if given no args, make a mock mouse event\r\n\r\n\t\tif (this.mousedOverSeg) {\r\n\t\t\tseg = seg || this.mousedOverSeg; // if given no args, use the currently moused-over segment\r\n\t\t\tthis.mousedOverSeg = null;\r\n\t\t\tthis.view.trigger('eventMouseout', seg.el[0], seg.event, ev);\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t/* Event Dragging\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Called when the user does a mousedown on an event, which might lead to dragging.\r\n\t// Generic enough to work with any type of Grid.\r\n\tsegDragMousedown: function(seg, ev) {\r\n\t\tvar _this = this;\r\n\t\tvar view = this.view;\r\n\t\tvar calendar = view.calendar;\r\n\t\tvar el = seg.el;\r\n\t\tvar event = seg.event;\r\n\t\tvar dropLocation;\r\n\r\n\t\t// A clone of the original element that will move with the mouse\r\n\t\tvar mouseFollower = new MouseFollower(seg.el, {\r\n\t\t\tparentEl: view.el,\r\n\t\t\topacity: view.opt('dragOpacity'),\r\n\t\t\trevertDuration: view.opt('dragRevertDuration'),\r\n\t\t\tzIndex: 2 // one above the .fc-view\r\n\t\t});\r\n\r\n\t\t// Tracks mouse movement over the *view's* coordinate map. Allows dragging and dropping between subcomponents\r\n\t\t// of the view.\r\n\t\tvar dragListener = new CellDragListener(view.coordMap, {\r\n\t\t\tdistance: 5,\r\n\t\t\tscroll: view.opt('dragScroll'),\r\n\t\t\tsubjectEl: el,\r\n\t\t\tsubjectCenter: true,\r\n\t\t\tlistenStart: function(ev) {\r\n\t\t\t\tmouseFollower.hide(); // don't show until we know this is a real drag\r\n\t\t\t\tmouseFollower.start(ev);\r\n\t\t\t},\r\n\t\t\tdragStart: function(ev) {\r\n\t\t\t\t_this.triggerSegMouseout(seg, ev); // ensure a mouseout on the manipulated event has been reported\r\n\t\t\t\t_this.segDragStart(seg, ev);\r\n\t\t\t\tview.hideEvent(event); // hide all event segments. our mouseFollower will take over\r\n\t\t\t},\r\n\t\t\tcellOver: function(cell, isOrig, origCell) {\r\n\r\n\t\t\t\t// starting cell could be forced (DayGrid.limit)\r\n\t\t\t\tif (seg.cell) {\r\n\t\t\t\t\torigCell = seg.cell;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tdropLocation = _this.computeEventDrop(origCell, cell, event);\r\n\r\n\t\t\t\tif (dropLocation && !calendar.isEventRangeAllowed(dropLocation, event)) {\r\n\t\t\t\t\tdisableCursor();\r\n\t\t\t\t\tdropLocation = null;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// if a valid drop location, have the subclass render a visual indication\r\n\t\t\t\tif (dropLocation && view.renderDrag(dropLocation, seg)) {\r\n\t\t\t\t\tmouseFollower.hide(); // if the subclass is already using a mock event \"helper\", hide our own\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tmouseFollower.show(); // otherwise, have the helper follow the mouse (no snapping)\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (isOrig) {\r\n\t\t\t\t\tdropLocation = null; // needs to have moved cells to be a valid drop\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tcellOut: function() { // called before mouse moves to a different cell OR moved out of all cells\r\n\t\t\t\tview.destroyDrag(); // unrender whatever was done in renderDrag\r\n\t\t\t\tmouseFollower.show(); // show in case we are moving out of all cells\r\n\t\t\t\tdropLocation = null;\r\n\t\t\t},\r\n\t\t\tcellDone: function() { // Called after a cellOut OR before a dragStop\r\n\t\t\t\tenableCursor();\r\n\t\t\t},\r\n\t\t\tdragStop: function(ev) {\r\n\t\t\t\t// do revert animation if hasn't changed. calls a callback when finished (whether animation or not)\r\n\t\t\t\tmouseFollower.stop(!dropLocation, function() {\r\n\t\t\t\t\tview.destroyDrag();\r\n\t\t\t\t\tview.showEvent(event);\r\n\t\t\t\t\t_this.segDragStop(seg, ev);\r\n\r\n\t\t\t\t\tif (dropLocation) {\r\n\t\t\t\t\t\tview.reportEventDrop(event, dropLocation, this.largeUnit, el, ev);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t},\r\n\t\t\tlistenStop: function() {\r\n\t\t\t\tmouseFollower.stop(); // put in listenStop in case there was a mousedown but the drag never started\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tdragListener.mousedown(ev); // start listening, which will eventually lead to a dragStart\r\n\t},\r\n\r\n\r\n\t// Called before event segment dragging starts\r\n\tsegDragStart: function(seg, ev) {\r\n\t\tthis.isDraggingSeg = true;\r\n\t\tthis.view.trigger('eventDragStart', seg.el[0], seg.event, ev, {}); // last argument is jqui dummy\r\n\t},\r\n\r\n\r\n\t// Called after event segment dragging stops\r\n\tsegDragStop: function(seg, ev) {\r\n\t\tthis.isDraggingSeg = false;\r\n\t\tthis.view.trigger('eventDragStop', seg.el[0], seg.event, ev, {}); // last argument is jqui dummy\r\n\t},\r\n\r\n\r\n\t// Given the cell an event drag began, and the cell event was dropped, calculates the new start/end/allDay\r\n\t// values for the event. Subclasses may override and set additional properties to be used by renderDrag.\r\n\t// A falsy returned value indicates an invalid drop.\r\n\tcomputeEventDrop: function(startCell, endCell, event) {\r\n\t\tvar calendar = this.view.calendar;\r\n\t\tvar dragStart = startCell.start;\r\n\t\tvar dragEnd = endCell.start;\r\n\t\tvar delta;\r\n\t\tvar dropLocation;\r\n\r\n\t\tif (dragStart.hasTime() === dragEnd.hasTime()) {\r\n\t\t\tdelta = this.diffDates(dragEnd, dragStart);\r\n\r\n\t\t\t// if an all-day event was in a timed area and it was dragged to a different time,\r\n\t\t\t// guarantee an end and adjust start/end to have times\r\n\t\t\tif (event.allDay && durationHasTime(delta)) {\r\n\t\t\t\tdropLocation = {\r\n\t\t\t\t\tstart: event.start.clone(),\r\n\t\t\t\t\tend: calendar.getEventEnd(event), // will be an ambig day\r\n\t\t\t\t\tallDay: false // for normalizeEventRangeTimes\r\n\t\t\t\t};\r\n\t\t\t\tcalendar.normalizeEventRangeTimes(dropLocation);\r\n\t\t\t}\r\n\t\t\t// othewise, work off existing values\r\n\t\t\telse {\r\n\t\t\t\tdropLocation = {\r\n\t\t\t\t\tstart: event.start.clone(),\r\n\t\t\t\t\tend: event.end ? event.end.clone() : null,\r\n\t\t\t\t\tallDay: event.allDay // keep it the same\r\n\t\t\t\t};\r\n\t\t\t}\r\n\r\n\t\t\tdropLocation.start.add(delta);\r\n\t\t\tif (dropLocation.end) {\r\n\t\t\t\tdropLocation.end.add(delta);\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// if switching from day <-> timed, start should be reset to the dropped date, and the end cleared\r\n\t\t\tdropLocation = {\r\n\t\t\t\tstart: dragEnd.clone(),\r\n\t\t\t\tend: null, // end should be cleared\r\n\t\t\t\tallDay: !dragEnd.hasTime()\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\treturn dropLocation;\r\n\t},\r\n\r\n\r\n\t// Utility for apply dragOpacity to a jQuery set\r\n\tapplyDragOpacity: function(els) {\r\n\t\tvar opacity = this.view.opt('dragOpacity');\r\n\r\n\t\tif (opacity != null) {\r\n\t\t\tels.each(function(i, node) {\r\n\t\t\t\t// Don't use jQuery (will set an IE filter), do it the old fashioned way.\r\n\t\t\t\t// In IE8, a helper element will disappears if there's a filter.\r\n\t\t\t\tnode.style.opacity = opacity;\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t/* External Element Dragging\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Called when a jQuery UI drag is initiated anywhere in the DOM\r\n\texternalDragStart: function(ev, ui) {\r\n\t\tvar view = this.view;\r\n\t\tvar el;\r\n\t\tvar accept;\r\n\r\n\t\tif (view.opt('droppable')) { // only listen if this setting is on\r\n\t\t\tel = $((ui ? ui.item : null) || ev.target);\r\n\r\n\t\t\t// Test that the dragged element passes the dropAccept selector or filter function.\r\n\t\t\t// FYI, the default is \"*\" (matches all)\r\n\t\t\taccept = view.opt('dropAccept');\r\n\t\t\tif ($.isFunction(accept) ? accept.call(el[0], el) : el.is(accept)) {\r\n\t\t\t\tif (!this.isDraggingExternal) { // prevent double-listening if fired twice\r\n\t\t\t\t\tthis.listenToExternalDrag(el, ev, ui);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Called when a jQuery UI drag starts and it needs to be monitored for cell dropping\r\n\tlistenToExternalDrag: function(el, ev, ui) {\r\n\t\tvar _this = this;\r\n\t\tvar meta = getDraggedElMeta(el); // extra data about event drop, including possible event to create\r\n\t\tvar dragListener;\r\n\t\tvar dropLocation; // a null value signals an unsuccessful drag\r\n\r\n\t\t// listener that tracks mouse movement over date-associated pixel regions\r\n\t\tdragListener = new CellDragListener(this.coordMap, {\r\n\t\t\tlistenStart: function() {\r\n\t\t\t\t_this.isDraggingExternal = true;\r\n\t\t\t},\r\n\t\t\tcellOver: function(cell) {\r\n\t\t\t\tdropLocation = _this.computeExternalDrop(cell, meta);\r\n\t\t\t\tif (dropLocation) {\r\n\t\t\t\t\t_this.renderDrag(dropLocation); // called without a seg parameter\r\n\t\t\t\t}\r\n\t\t\t\telse { // invalid drop cell\r\n\t\t\t\t\tdisableCursor();\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tcellOut: function() {\r\n\t\t\t\tdropLocation = null; // signal unsuccessful\r\n\t\t\t\t_this.destroyDrag();\r\n\t\t\t\tenableCursor();\r\n\t\t\t},\r\n\t\t\tdragStop: function() {\r\n\t\t\t\t_this.destroyDrag();\r\n\t\t\t\tenableCursor();\r\n\r\n\t\t\t\tif (dropLocation) { // element was dropped on a valid date/time cell\r\n\t\t\t\t\t_this.view.reportExternalDrop(meta, dropLocation, el, ev, ui);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tlistenStop: function() {\r\n\t\t\t\t_this.isDraggingExternal = false;\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tdragListener.startDrag(ev); // start listening immediately\r\n\t},\r\n\r\n\r\n\t// Given a cell to be dropped upon, and misc data associated with the jqui drag (guaranteed to be a plain object),\r\n\t// returns start/end dates for the event that would result from the hypothetical drop. end might be null.\r\n\t// Returning a null value signals an invalid drop cell.\r\n\tcomputeExternalDrop: function(cell, meta) {\r\n\t\tvar dropLocation = {\r\n\t\t\tstart: cell.start.clone(),\r\n\t\t\tend: null\r\n\t\t};\r\n\r\n\t\t// if dropped on an all-day cell, and element's metadata specified a time, set it\r\n\t\tif (meta.startTime && !dropLocation.start.hasTime()) {\r\n\t\t\tdropLocation.start.time(meta.startTime);\r\n\t\t}\r\n\r\n\t\tif (meta.duration) {\r\n\t\t\tdropLocation.end = dropLocation.start.clone().add(meta.duration);\r\n\t\t}\r\n\r\n\t\tif (!this.view.calendar.isExternalDropRangeAllowed(dropLocation, meta.eventProps)) {\r\n\t\t\treturn null;\r\n\t\t}\r\n\r\n\t\treturn dropLocation;\r\n\t},\r\n\r\n\r\n\r\n\t/* Drag Rendering (for both events and an external elements)\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Renders a visual indication of an event or external element being dragged.\r\n\t// `dropLocation` contains hypothetical start/end/allDay values the event would have if dropped. end can be null.\r\n\t// `seg` is the internal segment object that is being dragged. If dragging an external element, `seg` is null.\r\n\t// A truthy returned value indicates this method has rendered a helper element.\r\n\trenderDrag: function(dropLocation, seg) {\r\n\t\t// subclasses must implement\r\n\t},\r\n\r\n\r\n\t// Unrenders a visual indication of an event or external element being dragged\r\n\tdestroyDrag: function() {\r\n\t\t// subclasses must implement\r\n\t},\r\n\r\n\r\n\t/* Resizing\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Called when the user does a mousedown on an event's resizer, which might lead to resizing.\r\n\t// Generic enough to work with any type of Grid.\r\n\tsegResizeMousedown: function(seg, ev, isStart) {\r\n\t\tvar _this = this;\r\n\t\tvar view = this.view;\r\n\t\tvar calendar = view.calendar;\r\n\t\tvar el = seg.el;\r\n\t\tvar event = seg.event;\r\n\t\tvar eventEnd = calendar.getEventEnd(event);\r\n\t\tvar dragListener;\r\n\t\tvar resizeLocation; // falsy if invalid resize\r\n\r\n\t\t// Tracks mouse movement over the *grid's* coordinate map\r\n\t\tdragListener = new CellDragListener(this.coordMap, {\r\n\t\t\tdistance: 5,\r\n\t\t\tscroll: view.opt('dragScroll'),\r\n\t\t\tsubjectEl: el,\r\n\t\t\tdragStart: function(ev) {\r\n\t\t\t\t_this.triggerSegMouseout(seg, ev); // ensure a mouseout on the manipulated event has been reported\r\n\t\t\t\t_this.segResizeStart(seg, ev);\r\n\t\t\t},\r\n\t\t\tcellOver: function(cell, isOrig, origCell) {\r\n\t\t\t\tresizeLocation = isStart ?\r\n\t\t\t\t\t_this.computeEventStartResize(origCell, cell, event) :\r\n\t\t\t\t\t_this.computeEventEndResize(origCell, cell, event);\r\n\r\n\t\t\t\tif (resizeLocation) {\r\n\t\t\t\t\tif (!calendar.isEventRangeAllowed(resizeLocation, event)) {\r\n\t\t\t\t\t\tdisableCursor();\r\n\t\t\t\t\t\tresizeLocation = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// no change? (TODO: how does this work with timezones?)\r\n\t\t\t\t\telse if (resizeLocation.start.isSame(event.start) && resizeLocation.end.isSame(eventEnd)) {\r\n\t\t\t\t\t\tresizeLocation = null;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (resizeLocation) {\r\n\t\t\t\t\tview.hideEvent(event);\r\n\t\t\t\t\t_this.renderEventResize(resizeLocation, seg);\r\n\t\t\t\t}\r\n\t\t\t},\r\n\t\t\tcellOut: function() { // called before mouse moves to a different cell OR moved out of all cells\r\n\t\t\t\tresizeLocation = null;\r\n\t\t\t},\r\n\t\t\tcellDone: function() { // resets the rendering to show the original event\r\n\t\t\t\t_this.destroyEventResize();\r\n\t\t\t\tview.showEvent(event);\r\n\t\t\t\tenableCursor();\r\n\t\t\t},\r\n\t\t\tdragStop: function(ev) {\r\n\t\t\t\t_this.segResizeStop(seg, ev);\r\n\r\n\t\t\t\tif (resizeLocation) { // valid date to resize to?\r\n\t\t\t\t\tview.reportEventResize(event, resizeLocation, this.largeUnit, el, ev);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\tdragListener.mousedown(ev); // start listening, which will eventually lead to a dragStart\r\n\t},\r\n\r\n\r\n\t// Called before event segment resizing starts\r\n\tsegResizeStart: function(seg, ev) {\r\n\t\tthis.isResizingSeg = true;\r\n\t\tthis.view.trigger('eventResizeStart', seg.el[0], seg.event, ev, {}); // last argument is jqui dummy\r\n\t},\r\n\r\n\r\n\t// Called after event segment resizing stops\r\n\tsegResizeStop: function(seg, ev) {\r\n\t\tthis.isResizingSeg = false;\r\n\t\tthis.view.trigger('eventResizeStop', seg.el[0], seg.event, ev, {}); // last argument is jqui dummy\r\n\t},\r\n\r\n\r\n\t// Returns new date-information for an event segment being resized from its start\r\n\tcomputeEventStartResize: function(startCell, endCell, event) {\r\n\t\treturn this.computeEventResize('start', startCell, endCell, event);\r\n\t},\r\n\r\n\r\n\t// Returns new date-information for an event segment being resized from its end\r\n\tcomputeEventEndResize: function(startCell, endCell, event) {\r\n\t\treturn this.computeEventResize('end', startCell, endCell, event);\r\n\t},\r\n\r\n\r\n\t// Returns new date-information for an event segment being resized from its start OR end\r\n\t// `type` is either 'start' or 'end'\r\n\tcomputeEventResize: function(type, startCell, endCell, event) {\r\n\t\tvar calendar = this.view.calendar;\r\n\t\tvar delta = this.diffDates(endCell[type], startCell[type]);\r\n\t\tvar range;\r\n\t\tvar defaultDuration;\r\n\r\n\t\t// build original values to work from, guaranteeing a start and end\r\n\t\trange = {\r\n\t\t\tstart: event.start.clone(),\r\n\t\t\tend: calendar.getEventEnd(event),\r\n\t\t\tallDay: event.allDay\r\n\t\t};\r\n\r\n\t\t// if an all-day event was in a timed area and was resized to a time, adjust start/end to have times\r\n\t\tif (range.allDay && durationHasTime(delta)) {\r\n\t\t\trange.allDay = false;\r\n\t\t\tcalendar.normalizeEventRangeTimes(range);\r\n\t\t}\r\n\r\n\t\trange[type].add(delta); // apply delta to start or end\r\n\r\n\t\t// if the event was compressed too small, find a new reasonable duration for it\r\n\t\tif (!range.start.isBefore(range.end)) {\r\n\r\n\t\t\tdefaultDuration = event.allDay ?\r\n\t\t\t\tcalendar.defaultAllDayEventDuration :\r\n\t\t\t\tcalendar.defaultTimedEventDuration;\r\n\r\n\t\t\t// between the cell's duration and the event's default duration, use the smaller of the two.\r\n\t\t\t// example: if year-length slots, and compressed to one slot, we don't want the event to be a year long\r\n\t\t\tif (this.cellDuration && this.cellDuration < defaultDuration) {\r\n\t\t\t\tdefaultDuration = this.cellDuration;\r\n\t\t\t}\r\n\r\n\t\t\tif (type == 'start') { // resizing the start?\r\n\t\t\t\trange.start = range.end.clone().subtract(defaultDuration);\r\n\t\t\t}\r\n\t\t\telse { // resizing the end?\r\n\t\t\t\trange.end = range.start.clone().add(defaultDuration);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn range;\r\n\t},\r\n\r\n\r\n\t// Renders a visual indication of an event being resized.\r\n\t// `range` has the updated dates of the event. `seg` is the original segment object involved in the drag.\r\n\trenderEventResize: function(range, seg) {\r\n\t\t// subclasses must implement\r\n\t},\r\n\r\n\r\n\t// Unrenders a visual indication of an event being resized.\r\n\tdestroyEventResize: function() {\r\n\t\t// subclasses must implement\r\n\t},\r\n\r\n\r\n\t/* Rendering Utils\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Compute the text that should be displayed on an event's element.\r\n\t// `range` can be the Event object itself, or something range-like, with at least a `start`.\r\n\t// If event times are disabled, or the event has no time, will return a blank string.\r\n\t// If not specified, formatStr will default to the eventTimeFormat setting,\r\n\t// and displayEnd will default to the displayEventEnd setting.\r\n\tgetEventTimeText: function(range, formatStr, displayEnd) {\r\n\r\n\t\tif (formatStr == null) {\r\n\t\t\tformatStr = this.eventTimeFormat;\r\n\t\t}\r\n\r\n\t\tif (displayEnd == null) {\r\n\t\t\tdisplayEnd = this.displayEventEnd;\r\n\t\t}\r\n\r\n\t\tif (this.displayEventTime && range.start.hasTime()) {\r\n\t\t\tif (displayEnd && range.end) {\r\n\t\t\t\treturn this.view.formatRange(range, formatStr);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\treturn range.start.format(formatStr);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn '';\r\n\t},\r\n\r\n\r\n\t// Generic utility for generating the HTML classNames for an event segment's element\r\n\tgetSegClasses: function(seg, isDraggable, isResizable) {\r\n\t\tvar event = seg.event;\r\n\t\tvar classes = [\r\n\t\t\t'fc-event',\r\n\t\t\tseg.isStart ? 'fc-start' : 'fc-not-start',\r\n\t\t\tseg.isEnd ? 'fc-end' : 'fc-not-end'\r\n\t\t].concat(\r\n\t\t\tevent.className,\r\n\t\t\tevent.source ? event.source.className : []\r\n\t\t);\r\n\r\n\t\tif (isDraggable) {\r\n\t\t\tclasses.push('fc-draggable');\r\n\t\t}\r\n\t\tif (isResizable) {\r\n\t\t\tclasses.push('fc-resizable');\r\n\t\t}\r\n\r\n\t\treturn classes;\r\n\t},\r\n\r\n\r\n\t// Utility for generating event skin-related CSS properties\r\n\tgetEventSkinCss: function(event) {\r\n\t\tvar view = this.view;\r\n\t\tvar source = event.source || {};\r\n\t\tvar eventColor = event.color;\r\n\t\tvar sourceColor = source.color;\r\n\t\tvar optionColor = view.opt('eventColor');\r\n\r\n\t\treturn {\r\n\t\t\t'background-color':\r\n\t\t\t\tevent.backgroundColor ||\r\n\t\t\t\teventColor ||\r\n\t\t\t\tsource.backgroundColor ||\r\n\t\t\t\tsourceColor ||\r\n\t\t\t\tview.opt('eventBackgroundColor') ||\r\n\t\t\t\toptionColor,\r\n\t\t\t'border-color':\r\n\t\t\t\tevent.borderColor ||\r\n\t\t\t\teventColor ||\r\n\t\t\t\tsource.borderColor ||\r\n\t\t\t\tsourceColor ||\r\n\t\t\t\tview.opt('eventBorderColor') ||\r\n\t\t\t\toptionColor,\r\n\t\t\tcolor:\r\n\t\t\t\tevent.textColor ||\r\n\t\t\t\tsource.textColor ||\r\n\t\t\t\tview.opt('eventTextColor')\r\n\t\t};\r\n\t},\r\n\r\n\r\n\t/* Converting events -> ranges -> segs\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Converts an array of event objects into an array of event segment objects.\r\n\t// A custom `rangeToSegsFunc` may be given for arbitrarily slicing up events.\r\n\t// Doesn't guarantee an order for the resulting array.\r\n\teventsToSegs: function(events, rangeToSegsFunc) {\r\n\t\tvar eventRanges = this.eventsToRanges(events);\r\n\t\tvar segs = [];\r\n\t\tvar i;\r\n\r\n\t\tfor (i = 0; i < eventRanges.length; i++) {\r\n\t\t\tsegs.push.apply(\r\n\t\t\t\tsegs,\r\n\t\t\t\tthis.eventRangeToSegs(eventRanges[i], rangeToSegsFunc)\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\treturn segs;\r\n\t},\r\n\r\n\r\n\t// Converts an array of events into an array of \"range\" objects.\r\n\t// A \"range\" object is a plain object with start/end properties denoting the time it covers. Also an event property.\r\n\t// For \"normal\" events, this will be identical to the event's start/end, but for \"inverse-background\" events,\r\n\t// will create an array of ranges that span the time *not* covered by the given event.\r\n\t// Doesn't guarantee an order for the resulting array.\r\n\teventsToRanges: function(events) {\r\n\t\tvar _this = this;\r\n\t\tvar eventsById = groupEventsById(events);\r\n\t\tvar ranges = [];\r\n\r\n\t\t// group by ID so that related inverse-background events can be rendered together\r\n\t\t$.each(eventsById, function(id, eventGroup) {\r\n\t\t\tif (eventGroup.length) {\r\n\t\t\t\tranges.push.apply(\r\n\t\t\t\t\tranges,\r\n\t\t\t\t\tisInverseBgEvent(eventGroup[0]) ?\r\n\t\t\t\t\t\t_this.eventsToInverseRanges(eventGroup) :\r\n\t\t\t\t\t\t_this.eventsToNormalRanges(eventGroup)\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn ranges;\r\n\t},\r\n\r\n\r\n\t// Converts an array of \"normal\" events (not inverted rendering) into a parallel array of ranges\r\n\teventsToNormalRanges: function(events) {\r\n\t\tvar calendar = this.view.calendar;\r\n\t\tvar ranges = [];\r\n\t\tvar i, event;\r\n\t\tvar eventStart, eventEnd;\r\n\r\n\t\tfor (i = 0; i < events.length; i++) {\r\n\t\t\tevent = events[i];\r\n\r\n\t\t\t// make copies and normalize by stripping timezone\r\n\t\t\teventStart = event.start.clone().stripZone();\r\n\t\t\teventEnd = calendar.getEventEnd(event).stripZone();\r\n\r\n\t\t\tranges.push({\r\n\t\t\t\tevent: event,\r\n\t\t\t\tstart: eventStart,\r\n\t\t\t\tend: eventEnd,\r\n\t\t\t\teventStartMS: +eventStart,\r\n\t\t\t\teventDurationMS: eventEnd - eventStart\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn ranges;\r\n\t},\r\n\r\n\r\n\t// Converts an array of events, with inverse-background rendering, into an array of range objects.\r\n\t// The range objects will cover all the time NOT covered by the events.\r\n\teventsToInverseRanges: function(events) {\r\n\t\tvar view = this.view;\r\n\t\tvar viewStart = view.start.clone().stripZone(); // normalize timezone\r\n\t\tvar viewEnd = view.end.clone().stripZone(); // normalize timezone\r\n\t\tvar normalRanges = this.eventsToNormalRanges(events); // will give us normalized dates we can use w/o copies\r\n\t\tvar inverseRanges = [];\r\n\t\tvar event0 = events[0]; // assign this to each range's `.event`\r\n\t\tvar start = viewStart; // the end of the previous range. the start of the new range\r\n\t\tvar i, normalRange;\r\n\r\n\t\t// ranges need to be in order. required for our date-walking algorithm\r\n\t\tnormalRanges.sort(compareNormalRanges);\r\n\r\n\t\tfor (i = 0; i < normalRanges.length; i++) {\r\n\t\t\tnormalRange = normalRanges[i];\r\n\r\n\t\t\t// add the span of time before the event (if there is any)\r\n\t\t\tif (normalRange.start > start) { // compare millisecond time (skip any ambig logic)\r\n\t\t\t\tinverseRanges.push({\r\n\t\t\t\t\tevent: event0,\r\n\t\t\t\t\tstart: start,\r\n\t\t\t\t\tend: normalRange.start\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tstart = normalRange.end;\r\n\t\t}\r\n\r\n\t\t// add the span of time after the last event (if there is any)\r\n\t\tif (start < viewEnd) { // compare millisecond time (skip any ambig logic)\r\n\t\t\tinverseRanges.push({\r\n\t\t\t\tevent: event0,\r\n\t\t\t\tstart: start,\r\n\t\t\t\tend: viewEnd\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn inverseRanges;\r\n\t},\r\n\r\n\r\n\t// Slices the given event range into one or more segment objects.\r\n\t// A `rangeToSegsFunc` custom slicing function can be given.\r\n\teventRangeToSegs: function(eventRange, rangeToSegsFunc) {\r\n\t\tvar segs;\r\n\t\tvar i, seg;\r\n\r\n\t\tif (rangeToSegsFunc) {\r\n\t\t\tsegs = rangeToSegsFunc(eventRange);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tsegs = this.rangeToSegs(eventRange); // defined by the subclass\r\n\t\t}\r\n\r\n\t\tfor (i = 0; i < segs.length; i++) {\r\n\t\t\tseg = segs[i];\r\n\t\t\tseg.event = eventRange.event;\r\n\t\t\tseg.eventStartMS = eventRange.eventStartMS;\r\n\t\t\tseg.eventDurationMS = eventRange.eventDurationMS;\r\n\t\t}\r\n\r\n\t\treturn segs;\r\n\t}\r\n\r\n});\r\n\r\n\r\n/* Utilities\r\n----------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\nfunction isBgEvent(event) { // returns true if background OR inverse-background\r\n\tvar rendering = getEventRendering(event);\r\n\treturn rendering === 'background' || rendering === 'inverse-background';\r\n}\r\n\r\n\r\nfunction isInverseBgEvent(event) {\r\n\treturn getEventRendering(event) === 'inverse-background';\r\n}\r\n\r\n\r\nfunction getEventRendering(event) {\r\n\treturn firstDefined((event.source || {}).rendering, event.rendering);\r\n}\r\n\r\n\r\nfunction groupEventsById(events) {\r\n\tvar eventsById = {};\r\n\tvar i, event;\r\n\r\n\tfor (i = 0; i < events.length; i++) {\r\n\t\tevent = events[i];\r\n\t\t(eventsById[event._id] || (eventsById[event._id] = [])).push(event);\r\n\t}\r\n\r\n\treturn eventsById;\r\n}\r\n\r\n\r\n// A cmp function for determining which non-inverted \"ranges\" (see above) happen earlier\r\nfunction compareNormalRanges(range1, range2) {\r\n\treturn range1.eventStartMS - range2.eventStartMS; // earlier ranges go first\r\n}\r\n\r\n\r\n// A cmp function for determining which segments should take visual priority\r\n// DOES NOT WORK ON INVERTED BACKGROUND EVENTS because they have no eventStartMS/eventDurationMS\r\nfunction compareSegs(seg1, seg2) {\r\n\treturn seg1.eventStartMS - seg2.eventStartMS || // earlier events go first\r\n\t\tseg2.eventDurationMS - seg1.eventDurationMS || // tie? longer events go first\r\n\t\tseg2.event.allDay - seg1.event.allDay || // tie? put all-day events first (booleans cast to 0/1)\r\n\t\t(seg1.event.title || '').localeCompare(seg2.event.title); // tie? alphabetically by title\r\n}\r\n\r\nfc.compareSegs = compareSegs; // export\r\n\r\n\r\n/* External-Dragging-Element Data\r\n----------------------------------------------------------------------------------------------------------------------*/\r\n\r\n// Require all HTML5 data-* attributes used by FullCalendar to have this prefix.\r\n// A value of '' will query attributes like data-event. A value of 'fc' will query attributes like data-fc-event.\r\nfc.dataAttrPrefix = '';\r\n\r\n// Given a jQuery element that might represent a dragged FullCalendar event, returns an intermediate data structure\r\n// to be used for Event Object creation.\r\n// A defined `.eventProps`, even when empty, indicates that an event should be created.\r\nfunction getDraggedElMeta(el) {\r\n\tvar prefix = fc.dataAttrPrefix;\r\n\tvar eventProps; // properties for creating the event, not related to date/time\r\n\tvar startTime; // a Duration\r\n\tvar duration;\r\n\tvar stick;\r\n\r\n\tif (prefix) { prefix += '-'; }\r\n\teventProps = el.data(prefix + 'event') || null;\r\n\r\n\tif (eventProps) {\r\n\t\tif (typeof eventProps === 'object') {\r\n\t\t\teventProps = $.extend({}, eventProps); // make a copy\r\n\t\t}\r\n\t\telse { // something like 1 or true. still signal event creation\r\n\t\t\teventProps = {};\r\n\t\t}\r\n\r\n\t\t// pluck special-cased date/time properties\r\n\t\tstartTime = eventProps.start;\r\n\t\tif (startTime == null) { startTime = eventProps.time; } // accept 'time' as well\r\n\t\tduration = eventProps.duration;\r\n\t\tstick = eventProps.stick;\r\n\t\tdelete eventProps.start;\r\n\t\tdelete eventProps.time;\r\n\t\tdelete eventProps.duration;\r\n\t\tdelete eventProps.stick;\r\n\t}\r\n\r\n\t// fallback to standalone attribute values for each of the date/time properties\r\n\tif (startTime == null) { startTime = el.data(prefix + 'start'); }\r\n\tif (startTime == null) { startTime = el.data(prefix + 'time'); } // accept 'time' as well\r\n\tif (duration == null) { duration = el.data(prefix + 'duration'); }\r\n\tif (stick == null) { stick = el.data(prefix + 'stick'); }\r\n\r\n\t// massage into correct data types\r\n\tstartTime = startTime != null ? moment.duration(startTime) : null;\r\n\tduration = duration != null ? moment.duration(duration) : null;\r\n\tstick = Boolean(stick);\r\n\r\n\treturn { eventProps: eventProps, startTime: startTime, duration: duration, stick: stick };\r\n}\r\n\r\n\r\n;;\r\n\r\n/* A component that renders a grid of whole-days that runs horizontally. There can be multiple rows, one per week.\r\n----------------------------------------------------------------------------------------------------------------------*/\r\n\r\nvar DayGrid = Grid.extend({\r\n\r\n\tnumbersVisible: false, // should render a row for day/week numbers? set by outside view. TODO: make internal\r\n\tbottomCoordPadding: 0, // hack for extending the hit area for the last row of the coordinate grid\r\n\tbreakOnWeeks: null, // should create a new row for each week? set by outside view\r\n\r\n\tcellDates: null, // flat chronological array of each cell's dates\r\n\tdayToCellOffsets: null, // maps days offsets from grid's start date, to cell offsets\r\n\r\n\trowEls: null, // set of fake row elements\r\n\tdayEls: null, // set of whole-day elements comprising the row's background\r\n\thelperEls: null, // set of cell skeleton elements for rendering the mock event \"helper\"\r\n\r\n\r\n\tconstructor: function() {\r\n\t\tGrid.apply(this, arguments);\r\n\r\n\t\tthis.cellDuration = moment.duration(1, 'day'); // for Grid system\r\n\t},\r\n\r\n\r\n\t// Renders the rows and columns into the component's `this.el`, which should already be assigned.\r\n\t// isRigid determins whether the individual rows should ignore the contents and be a constant height.\r\n\t// Relies on the view's colCnt and rowCnt. In the future, this component should probably be self-sufficient.\r\n\trenderDates: function(isRigid) {\r\n\t\tvar view = this.view;\r\n\t\tvar rowCnt = this.rowCnt;\r\n\t\tvar colCnt = this.colCnt;\r\n\t\tvar cellCnt = rowCnt * colCnt;\r\n\t\tvar html = '';\r\n\t\tvar row;\r\n\t\tvar i, cell;\r\n\r\n\t\tfor (row = 0; row < rowCnt; row++) {\r\n\t\t\thtml += this.dayRowHtml(row, isRigid);\r\n\t\t}\r\n\t\tthis.el.html(html);\r\n\r\n\t\tthis.rowEls = this.el.find('.fc-row');\r\n\t\tthis.dayEls = this.el.find('.fc-day');\r\n\r\n\t\t// trigger dayRender with each cell's element\r\n\t\tfor (i = 0; i < cellCnt; i++) {\r\n\t\t\tcell = this.getCell(i);\r\n\t\t\tview.trigger('dayRender', null, cell.start, this.dayEls.eq(i));\r\n\t\t}\r\n\t},\r\n\r\n\r\n\tdestroyDates: function() {\r\n\t\tthis.destroySegPopover();\r\n\t},\r\n\r\n\r\n\trenderBusinessHours: function() {\r\n\t\tvar events = this.view.calendar.getBusinessHoursEvents(true); // wholeDay=true\r\n\t\tvar segs = this.eventsToSegs(events);\r\n\r\n\t\tthis.renderFill('businessHours', segs, 'bgevent');\r\n\t},\r\n\r\n\r\n\t// Generates the HTML for a single row. `row` is the row number.\r\n\tdayRowHtml: function(row, isRigid) {\r\n\t\tvar view = this.view;\r\n\t\tvar classes = [ 'fc-row', 'fc-week', view.widgetContentClass ];\r\n\r\n\t\tif (isRigid) {\r\n\t\t\tclasses.push('fc-rigid');\r\n\t\t}\r\n\r\n\t\treturn '' +\r\n\t\t\t'<div class=\"' + classes.join(' ') + '\">' +\r\n\t\t\t\t'<div class=\"fc-bg\">' +\r\n\t\t\t\t\t'<table>' +\r\n\t\t\t\t\t\tthis.rowHtml('day', row) + // leverages RowRenderer. calls dayCellHtml()\r\n\t\t\t\t\t'</table>' +\r\n\t\t\t\t'</div>' +\r\n\t\t\t\t'<div class=\"fc-content-skeleton\">' +\r\n\t\t\t\t\t'<table>' +\r\n\t\t\t\t\t\t(this.numbersVisible ?\r\n\t\t\t\t\t\t\t'<thead>' +\r\n\t\t\t\t\t\t\t\tthis.rowHtml('number', row) + // leverages RowRenderer. View will define render method\r\n\t\t\t\t\t\t\t'</thead>' :\r\n\t\t\t\t\t\t\t''\r\n\t\t\t\t\t\t\t) +\r\n\t\t\t\t\t'</table>' +\r\n\t\t\t\t'</div>' +\r\n\t\t\t'</div>';\r\n\t},\r\n\r\n\r\n\t// Renders the HTML for a whole-day cell. Will eventually end up in the day-row's background.\r\n\t// We go through a 'day' row type instead of just doing a 'bg' row type so that the View can do custom rendering\r\n\t// specifically for whole-day rows, whereas a 'bg' might also be used for other purposes (TimeGrid bg for example).\r\n\tdayCellHtml: function(cell) {\r\n\t\treturn this.bgCellHtml(cell);\r\n\t},\r\n\r\n\r\n\t/* Options\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Computes a default column header formatting string if `colFormat` is not explicitly defined\r\n\tcomputeColHeadFormat: function() {\r\n\t\tif (this.rowCnt > 1) { // more than one week row. day numbers will be in each cell\r\n\t\t\treturn 'ddd'; // \"Sat\"\r\n\t\t}\r\n\t\telse if (this.colCnt > 1) { // multiple days, so full single date string WON'T be in title text\r\n\t\t\treturn this.view.opt('dayOfMonthFormat'); // \"Sat 12/10\"\r\n\t\t}\r\n\t\telse { // single day, so full single date string will probably be in title text\r\n\t\t\treturn 'dddd'; // \"Saturday\"\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Computes a default event time formatting string if `timeFormat` is not explicitly defined\r\n\tcomputeEventTimeFormat: function() {\r\n\t\treturn this.view.opt('extraSmallTimeFormat'); // like \"6p\" or \"6:30p\"\r\n\t},\r\n\r\n\r\n\t// Computes a default `displayEventEnd` value if one is not expliclty defined\r\n\tcomputeDisplayEventEnd: function() {\r\n\t\treturn this.colCnt == 1; // we'll likely have space if there's only one day\r\n\t},\r\n\r\n\r\n\t/* Cell System\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Initializes row/col information\r\n\tupdateCells: function() {\r\n\t\tvar cellDates;\r\n\t\tvar firstDay;\r\n\t\tvar rowCnt;\r\n\t\tvar colCnt;\r\n\r\n\t\tthis.updateCellDates(); // populates cellDates and dayToCellOffsets\r\n\t\tcellDates = this.cellDates;\r\n\r\n\t\tif (this.breakOnWeeks) {\r\n\t\t\t// count columns until the day-of-week repeats\r\n\t\t\tfirstDay = cellDates[0].day();\r\n\t\t\tfor (colCnt = 1; colCnt < cellDates.length; colCnt++) {\r\n\t\t\t\tif (cellDates[colCnt].day() == firstDay) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\trowCnt = Math.ceil(cellDates.length / colCnt);\r\n\t\t}\r\n\t\telse {\r\n\t\t\trowCnt = 1;\r\n\t\t\tcolCnt = cellDates.length;\r\n\t\t}\r\n\r\n\t\tthis.rowCnt = rowCnt;\r\n\t\tthis.colCnt = colCnt;\r\n\t},\r\n\r\n\r\n\t// Populates cellDates and dayToCellOffsets\r\n\tupdateCellDates: function() {\r\n\t\tvar view = this.view;\r\n\t\tvar date = this.start.clone();\r\n\t\tvar dates = [];\r\n\t\tvar offset = -1;\r\n\t\tvar offsets = [];\r\n\r\n\t\twhile (date.isBefore(this.end)) { // loop each day from start to end\r\n\t\t\tif (view.isHiddenDay(date)) {\r\n\t\t\t\toffsets.push(offset + 0.5); // mark that it's between offsets\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\toffset++;\r\n\t\t\t\toffsets.push(offset);\r\n\t\t\t\tdates.push(date.clone());\r\n\t\t\t}\r\n\t\t\tdate.add(1, 'days');\r\n\t\t}\r\n\r\n\t\tthis.cellDates = dates;\r\n\t\tthis.dayToCellOffsets = offsets;\r\n\t},\r\n\r\n\r\n\t// Given a cell object, generates its start date. Returns a reference-free copy.\r\n\tcomputeCellDate: function(cell) {\r\n\t\tvar colCnt = this.colCnt;\r\n\t\tvar index = cell.row * colCnt + (this.isRTL ? colCnt - cell.col - 1 : cell.col);\r\n\r\n\t\treturn this.cellDates[index].clone();\r\n\t},\r\n\r\n\r\n\t// Retrieves the element representing the given row\r\n\tgetRowEl: function(row) {\r\n\t\treturn this.rowEls.eq(row);\r\n\t},\r\n\r\n\r\n\t// Retrieves the element representing the given column\r\n\tgetColEl: function(col) {\r\n\t\treturn this.dayEls.eq(col);\r\n\t},\r\n\r\n\r\n\t// Gets the whole-day element associated with the cell\r\n\tgetCellDayEl: function(cell) {\r\n\t\treturn this.dayEls.eq(cell.row * this.colCnt + cell.col);\r\n\t},\r\n\r\n\r\n\t// Overrides Grid's method for when row coordinates are computed\r\n\tcomputeRowCoords: function() {\r\n\t\tvar rowCoords = Grid.prototype.computeRowCoords.call(this); // call the super-method\r\n\r\n\t\t// hack for extending last row (used by AgendaView)\r\n\t\trowCoords[rowCoords.length - 1].bottom += this.bottomCoordPadding;\r\n\r\n\t\treturn rowCoords;\r\n\t},\r\n\r\n\r\n\t/* Dates\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Slices up a date range by row into an array of segments\r\n\trangeToSegs: function(range) {\r\n\t\tvar isRTL = this.isRTL;\r\n\t\tvar rowCnt = this.rowCnt;\r\n\t\tvar colCnt = this.colCnt;\r\n\t\tvar segs = [];\r\n\t\tvar first, last; // inclusive cell-offset range for given range\r\n\t\tvar row;\r\n\t\tvar rowFirst, rowLast; // inclusive cell-offset range for current row\r\n\t\tvar isStart, isEnd;\r\n\t\tvar segFirst, segLast; // inclusive cell-offset range for segment\r\n\t\tvar seg;\r\n\r\n\t\trange = this.view.computeDayRange(range); // make whole-day range, considering nextDayThreshold\r\n\t\tfirst = this.dateToCellOffset(range.start);\r\n\t\tlast = this.dateToCellOffset(range.end.subtract(1, 'days')); // offset of inclusive end date\r\n\r\n\t\tfor (row = 0; row < rowCnt; row++) {\r\n\t\t\trowFirst = row * colCnt;\r\n\t\t\trowLast = rowFirst + colCnt - 1;\r\n\r\n\t\t\t// intersect segment's offset range with the row's\r\n\t\t\tsegFirst = Math.max(rowFirst, first);\r\n\t\t\tsegLast = Math.min(rowLast, last);\r\n\r\n\t\t\t// deal with in-between indices\r\n\t\t\tsegFirst = Math.ceil(segFirst); // in-between starts round to next cell\r\n\t\t\tsegLast = Math.floor(segLast); // in-between ends round to prev cell\r\n\r\n\t\t\tif (segFirst <= segLast) { // was there any intersection with the current row?\r\n\r\n\t\t\t\t// must be matching integers to be the segment's start/end\r\n\t\t\t\tisStart = segFirst === first;\r\n\t\t\t\tisEnd = segLast === last;\r\n\r\n\t\t\t\t// translate offsets to be relative to start-of-row\r\n\t\t\t\tsegFirst -= rowFirst;\r\n\t\t\t\tsegLast -= rowFirst;\r\n\r\n\t\t\t\tseg = { row: row, isStart: isStart, isEnd: isEnd };\r\n\t\t\t\tif (isRTL) {\r\n\t\t\t\t\tseg.leftCol = colCnt - segLast - 1;\r\n\t\t\t\t\tseg.rightCol = colCnt - segFirst - 1;\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tseg.leftCol = segFirst;\r\n\t\t\t\t\tseg.rightCol = segLast;\r\n\t\t\t\t}\r\n\t\t\t\tsegs.push(seg);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn segs;\r\n\t},\r\n\r\n\r\n\t// Given a date, returns its chronolocial cell-offset from the first cell of the grid.\r\n\t// If the date lies between cells (because of hiddenDays), returns a floating-point value between offsets.\r\n\t// If before the first offset, returns a negative number.\r\n\t// If after the last offset, returns an offset past the last cell offset.\r\n\t// Only works for *start* dates of cells. Will not work for exclusive end dates for cells.\r\n\tdateToCellOffset: function(date) {\r\n\t\tvar offsets = this.dayToCellOffsets;\r\n\t\tvar day = date.diff(this.start, 'days');\r\n\r\n\t\tif (day < 0) {\r\n\t\t\treturn offsets[0] - 1;\r\n\t\t}\r\n\t\telse if (day >= offsets.length) {\r\n\t\t\treturn offsets[offsets.length - 1] + 1;\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn offsets[day];\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t/* Event Drag Visualization\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\t// TODO: move to DayGrid.event, similar to what we did with Grid's drag methods\r\n\r\n\r\n\t// Renders a visual indication of an event or external element being dragged.\r\n\t// The dropLocation's end can be null. seg can be null. See Grid::renderDrag for more info.\r\n\trenderDrag: function(dropLocation, seg) {\r\n\r\n\t\t// always render a highlight underneath\r\n\t\tthis.renderHighlight(\r\n\t\t\tthis.view.calendar.ensureVisibleEventRange(dropLocation) // needs to be a proper range\r\n\t\t);\r\n\r\n\t\t// if a segment from the same calendar but another component is being dragged, render a helper event\r\n\t\tif (seg && !seg.el.closest(this.el).length) {\r\n\r\n\t\t\tthis.renderRangeHelper(dropLocation, seg);\r\n\t\t\tthis.applyDragOpacity(this.helperEls);\r\n\r\n\t\t\treturn true; // a helper has been rendered\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Unrenders any visual indication of a hovering event\r\n\tdestroyDrag: function() {\r\n\t\tthis.destroyHighlight();\r\n\t\tthis.destroyHelper();\r\n\t},\r\n\r\n\r\n\t/* Event Resize Visualization\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Renders a visual indication of an event being resized\r\n\trenderEventResize: function(range, seg) {\r\n\t\tthis.renderHighlight(range);\r\n\t\tthis.renderRangeHelper(range, seg);\r\n\t},\r\n\r\n\r\n\t// Unrenders a visual indication of an event being resized\r\n\tdestroyEventResize: function() {\r\n\t\tthis.destroyHighlight();\r\n\t\tthis.destroyHelper();\r\n\t},\r\n\r\n\r\n\t/* Event Helper\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Renders a mock \"helper\" event. `sourceSeg` is the associated internal segment object. It can be null.\r\n\trenderHelper: function(event, sourceSeg) {\r\n\t\tvar helperNodes = [];\r\n\t\tvar segs = this.eventsToSegs([ event ]);\r\n\t\tvar rowStructs;\r\n\r\n\t\tsegs = this.renderFgSegEls(segs); // assigns each seg's el and returns a subset of segs that were rendered\r\n\t\trowStructs = this.renderSegRows(segs);\r\n\r\n\t\t// inject each new event skeleton into each associated row\r\n\t\tthis.rowEls.each(function(row, rowNode) {\r\n\t\t\tvar rowEl = $(rowNode); // the .fc-row\r\n\t\t\tvar skeletonEl = $('<div class=\"fc-helper-skeleton\"><table/></div>'); // will be absolutely positioned\r\n\t\t\tvar skeletonTop;\r\n\r\n\t\t\t// If there is an original segment, match the top position. Otherwise, put it at the row's top level\r\n\t\t\tif (sourceSeg && sourceSeg.row === row) {\r\n\t\t\t\tskeletonTop = sourceSeg.el.position().top;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tskeletonTop = rowEl.find('.fc-content-skeleton tbody').position().top;\r\n\t\t\t}\r\n\r\n\t\t\tskeletonEl.css('top', skeletonTop)\r\n\t\t\t\t.find('table')\r\n\t\t\t\t\t.append(rowStructs[row].tbodyEl);\r\n\r\n\t\t\trowEl.append(skeletonEl);\r\n\t\t\thelperNodes.push(skeletonEl[0]);\r\n\t\t});\r\n\r\n\t\tthis.helperEls = $(helperNodes); // array -> jQuery set\r\n\t},\r\n\r\n\r\n\t// Unrenders any visual indication of a mock helper event\r\n\tdestroyHelper: function() {\r\n\t\tif (this.helperEls) {\r\n\t\t\tthis.helperEls.remove();\r\n\t\t\tthis.helperEls = null;\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t/* Fill System (highlight, background events, business hours)\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\tfillSegTag: 'td', // override the default tag name\r\n\r\n\r\n\t// Renders a set of rectangles over the given segments of days.\r\n\t// Only returns segments that successfully rendered.\r\n\trenderFill: function(type, segs, className) {\r\n\t\tvar nodes = [];\r\n\t\tvar i, seg;\r\n\t\tvar skeletonEl;\r\n\r\n\t\tsegs = this.renderFillSegEls(type, segs); // assignes `.el` to each seg. returns successfully rendered segs\r\n\r\n\t\tfor (i = 0; i < segs.length; i++) {\r\n\t\t\tseg = segs[i];\r\n\t\t\tskeletonEl = this.renderFillRow(type, seg, className);\r\n\t\t\tthis.rowEls.eq(seg.row).append(skeletonEl);\r\n\t\t\tnodes.push(skeletonEl[0]);\r\n\t\t}\r\n\r\n\t\tthis.elsByFill[type] = $(nodes);\r\n\r\n\t\treturn segs;\r\n\t},\r\n\r\n\r\n\t// Generates the HTML needed for one row of a fill. Requires the seg's el to be rendered.\r\n\trenderFillRow: function(type, seg, className) {\r\n\t\tvar colCnt = this.colCnt;\r\n\t\tvar startCol = seg.leftCol;\r\n\t\tvar endCol = seg.rightCol + 1;\r\n\t\tvar skeletonEl;\r\n\t\tvar trEl;\r\n\r\n\t\tclassName = className || type.toLowerCase();\r\n\r\n\t\tskeletonEl = $(\r\n\t\t\t'<div class=\"fc-' + className + '-skeleton\">' +\r\n\t\t\t\t'<table><tr/></table>' +\r\n\t\t\t'</div>'\r\n\t\t);\r\n\t\ttrEl = skeletonEl.find('tr');\r\n\r\n\t\tif (startCol > 0) {\r\n\t\t\ttrEl.append('<td colspan=\"' + startCol + '\"/>');\r\n\t\t}\r\n\r\n\t\ttrEl.append(\r\n\t\t\tseg.el.attr('colspan', endCol - startCol)\r\n\t\t);\r\n\r\n\t\tif (endCol < colCnt) {\r\n\t\t\ttrEl.append('<td colspan=\"' + (colCnt - endCol) + '\"/>');\r\n\t\t}\r\n\r\n\t\tthis.bookendCells(trEl, type);\r\n\r\n\t\treturn skeletonEl;\r\n\t}\r\n\r\n});\r\n\r\n;;\r\n\r\n/* Event-rendering methods for the DayGrid class\r\n----------------------------------------------------------------------------------------------------------------------*/\r\n\r\nDayGrid.mixin({\r\n\r\n\trowStructs: null, // an array of objects, each holding information about a row's foreground event-rendering\r\n\r\n\r\n\t// Unrenders all events currently rendered on the grid\r\n\tdestroyEvents: function() {\r\n\t\tthis.destroySegPopover(); // removes the \"more..\" events popover\r\n\t\tGrid.prototype.destroyEvents.apply(this, arguments); // calls the super-method\r\n\t},\r\n\r\n\r\n\t// Retrieves all rendered segment objects currently rendered on the grid\r\n\tgetEventSegs: function() {\r\n\t\treturn Grid.prototype.getEventSegs.call(this) // get the segments from the super-method\r\n\t\t\t.concat(this.popoverSegs || []); // append the segments from the \"more...\" popover\r\n\t},\r\n\r\n\r\n\t// Renders the given background event segments onto the grid\r\n\trenderBgSegs: function(segs) {\r\n\r\n\t\t// don't render timed background events\r\n\t\tvar allDaySegs = $.grep(segs, function(seg) {\r\n\t\t\treturn seg.event.allDay;\r\n\t\t});\r\n\r\n\t\treturn Grid.prototype.renderBgSegs.call(this, allDaySegs); // call the super-method\r\n\t},\r\n\r\n\r\n\t// Renders the given foreground event segments onto the grid\r\n\trenderFgSegs: function(segs) {\r\n\t\tvar rowStructs;\r\n\r\n\t\t// render an `.el` on each seg\r\n\t\t// returns a subset of the segs. segs that were actually rendered\r\n\t\tsegs = this.renderFgSegEls(segs);\r\n\r\n\t\trowStructs = this.rowStructs = this.renderSegRows(segs);\r\n\r\n\t\t// append to each row's content skeleton\r\n\t\tthis.rowEls.each(function(i, rowNode) {\r\n\t\t\t$(rowNode).find('.fc-content-skeleton > table').append(\r\n\t\t\t\trowStructs[i].tbodyEl\r\n\t\t\t);\r\n\t\t});\r\n\r\n\t\treturn segs; // return only the segs that were actually rendered\r\n\t},\r\n\r\n\r\n\t// Unrenders all currently rendered foreground event segments\r\n\tdestroyFgSegs: function() {\r\n\t\tvar rowStructs = this.rowStructs || [];\r\n\t\tvar rowStruct;\r\n\r\n\t\twhile ((rowStruct = rowStructs.pop())) {\r\n\t\t\trowStruct.tbodyEl.remove();\r\n\t\t}\r\n\r\n\t\tthis.rowStructs = null;\r\n\t},\r\n\r\n\r\n\t// Uses the given events array to generate <tbody> elements that should be appended to each row's content skeleton.\r\n\t// Returns an array of rowStruct objects (see the bottom of `renderSegRow`).\r\n\t// PRECONDITION: each segment shoud already have a rendered and assigned `.el`\r\n\trenderSegRows: function(segs) {\r\n\t\tvar rowStructs = [];\r\n\t\tvar segRows;\r\n\t\tvar row;\r\n\r\n\t\tsegRows = this.groupSegRows(segs); // group into nested arrays\r\n\r\n\t\t// iterate each row of segment groupings\r\n\t\tfor (row = 0; row < segRows.length; row++) {\r\n\t\t\trowStructs.push(\r\n\t\t\t\tthis.renderSegRow(row, segRows[row])\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\treturn rowStructs;\r\n\t},\r\n\r\n\r\n\t// Builds the HTML to be used for the default element for an individual segment\r\n\tfgSegHtml: function(seg, disableResizing) {\r\n\t\tvar view = this.view;\r\n\t\tvar event = seg.event;\r\n\t\tvar isDraggable = view.isEventDraggable(event);\r\n\t\tvar isResizableFromStart = !disableResizing && event.allDay &&\r\n\t\t\tseg.isStart && view.isEventResizableFromStart(event);\r\n\t\tvar isResizableFromEnd = !disableResizing && event.allDay &&\r\n\t\t\tseg.isEnd && view.isEventResizableFromEnd(event);\r\n\t\tvar classes = this.getSegClasses(seg, isDraggable, isResizableFromStart || isResizableFromEnd);\r\n\t\tvar skinCss = cssToStr(this.getEventSkinCss(event));\r\n\t\tvar timeHtml = '';\r\n\t\tvar timeText;\r\n\t\tvar titleHtml;\r\n\r\n\t\tclasses.unshift('fc-day-grid-event', 'fc-h-event');\r\n\r\n\t\t// Only display a timed events time if it is the starting segment\r\n\t\tif (seg.isStart) {\r\n\t\t\ttimeText = this.getEventTimeText(event);\r\n\t\t\tif (timeText) {\r\n\t\t\t\ttimeHtml = '<span class=\"fc-time\">' + htmlEscape(timeText) + '</span>';\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\ttitleHtml =\r\n\t\t\t'<span class=\"fc-title\">' +\r\n\t\t\t\t(htmlEscape(event.title || '') || '&nbsp;') + // we always want one line of height\r\n\t\t\t'</span>';\r\n\t\t\r\n\t\treturn '<a class=\"' + classes.join(' ') + '\"' +\r\n\t\t\t\t(event.url ?\r\n\t\t\t\t\t' href=\"' + htmlEscape(event.url) + '\"' :\r\n\t\t\t\t\t''\r\n\t\t\t\t\t) +\r\n\t\t\t\t(skinCss ?\r\n\t\t\t\t\t' style=\"' + skinCss + '\"' :\r\n\t\t\t\t\t''\r\n\t\t\t\t\t) +\r\n\t\t\t'>' +\r\n\t\t\t\t'<div class=\"fc-content\">' +\r\n\t\t\t\t\t(this.isRTL ?\r\n\t\t\t\t\t\ttitleHtml + ' ' + timeHtml : // put a natural space in between\r\n\t\t\t\t\t\ttimeHtml + ' ' + titleHtml   //\r\n\t\t\t\t\t\t) +\r\n\t\t\t\t'</div>' +\r\n\t\t\t\t(isResizableFromStart ?\r\n\t\t\t\t\t'<div class=\"fc-resizer fc-start-resizer\" />' :\r\n\t\t\t\t\t''\r\n\t\t\t\t\t) +\r\n\t\t\t\t(isResizableFromEnd ?\r\n\t\t\t\t\t'<div class=\"fc-resizer fc-end-resizer\" />' :\r\n\t\t\t\t\t''\r\n\t\t\t\t\t) +\r\n\t\t\t'</a>';\r\n\t},\r\n\r\n\r\n\t// Given a row # and an array of segments all in the same row, render a <tbody> element, a skeleton that contains\r\n\t// the segments. Returns object with a bunch of internal data about how the render was calculated.\r\n\t// NOTE: modifies rowSegs\r\n\trenderSegRow: function(row, rowSegs) {\r\n\t\tvar colCnt = this.colCnt;\r\n\t\tvar segLevels = this.buildSegLevels(rowSegs); // group into sub-arrays of levels\r\n\t\tvar levelCnt = Math.max(1, segLevels.length); // ensure at least one level\r\n\t\tvar tbody = $('<tbody/>');\r\n\t\tvar segMatrix = []; // lookup for which segments are rendered into which level+col cells\r\n\t\tvar cellMatrix = []; // lookup for all <td> elements of the level+col matrix\r\n\t\tvar loneCellMatrix = []; // lookup for <td> elements that only take up a single column\r\n\t\tvar i, levelSegs;\r\n\t\tvar col;\r\n\t\tvar tr;\r\n\t\tvar j, seg;\r\n\t\tvar td;\r\n\r\n\t\t// populates empty cells from the current column (`col`) to `endCol`\r\n\t\tfunction emptyCellsUntil(endCol) {\r\n\t\t\twhile (col < endCol) {\r\n\t\t\t\t// try to grab a cell from the level above and extend its rowspan. otherwise, create a fresh cell\r\n\t\t\t\ttd = (loneCellMatrix[i - 1] || [])[col];\r\n\t\t\t\tif (td) {\r\n\t\t\t\t\ttd.attr(\r\n\t\t\t\t\t\t'rowspan',\r\n\t\t\t\t\t\tparseInt(td.attr('rowspan') || 1, 10) + 1\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\ttd = $('<td/>');\r\n\t\t\t\t\ttr.append(td);\r\n\t\t\t\t}\r\n\t\t\t\tcellMatrix[i][col] = td;\r\n\t\t\t\tloneCellMatrix[i][col] = td;\r\n\t\t\t\tcol++;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfor (i = 0; i < levelCnt; i++) { // iterate through all levels\r\n\t\t\tlevelSegs = segLevels[i];\r\n\t\t\tcol = 0;\r\n\t\t\ttr = $('<tr/>');\r\n\r\n\t\t\tsegMatrix.push([]);\r\n\t\t\tcellMatrix.push([]);\r\n\t\t\tloneCellMatrix.push([]);\r\n\r\n\t\t\t// levelCnt might be 1 even though there are no actual levels. protect against this.\r\n\t\t\t// this single empty row is useful for styling.\r\n\t\t\tif (levelSegs) {\r\n\t\t\t\tfor (j = 0; j < levelSegs.length; j++) { // iterate through segments in level\r\n\t\t\t\t\tseg = levelSegs[j];\r\n\r\n\t\t\t\t\temptyCellsUntil(seg.leftCol);\r\n\r\n\t\t\t\t\t// create a container that occupies or more columns. append the event element.\r\n\t\t\t\t\ttd = $('<td class=\"fc-event-container\"/>').append(seg.el);\r\n\t\t\t\t\tif (seg.leftCol != seg.rightCol) {\r\n\t\t\t\t\t\ttd.attr('colspan', seg.rightCol - seg.leftCol + 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse { // a single-column segment\r\n\t\t\t\t\t\tloneCellMatrix[i][col] = td;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\twhile (col <= seg.rightCol) {\r\n\t\t\t\t\t\tcellMatrix[i][col] = td;\r\n\t\t\t\t\t\tsegMatrix[i][col] = seg;\r\n\t\t\t\t\t\tcol++;\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttr.append(td);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\temptyCellsUntil(colCnt); // finish off the row\r\n\t\t\tthis.bookendCells(tr, 'eventSkeleton');\r\n\t\t\ttbody.append(tr);\r\n\t\t}\r\n\r\n\t\treturn { // a \"rowStruct\"\r\n\t\t\trow: row, // the row number\r\n\t\t\ttbodyEl: tbody,\r\n\t\t\tcellMatrix: cellMatrix,\r\n\t\t\tsegMatrix: segMatrix,\r\n\t\t\tsegLevels: segLevels,\r\n\t\t\tsegs: rowSegs\r\n\t\t};\r\n\t},\r\n\r\n\r\n\t// Stacks a flat array of segments, which are all assumed to be in the same row, into subarrays of vertical levels.\r\n\t// NOTE: modifies segs\r\n\tbuildSegLevels: function(segs) {\r\n\t\tvar levels = [];\r\n\t\tvar i, seg;\r\n\t\tvar j;\r\n\r\n\t\t// Give preference to elements with certain criteria, so they have\r\n\t\t// a chance to be closer to the top.\r\n\t\tsegs.sort(compareSegs);\r\n\t\t\r\n\t\tfor (i = 0; i < segs.length; i++) {\r\n\t\t\tseg = segs[i];\r\n\r\n\t\t\t// loop through levels, starting with the topmost, until the segment doesn't collide with other segments\r\n\t\t\tfor (j = 0; j < levels.length; j++) {\r\n\t\t\t\tif (!isDaySegCollision(seg, levels[j])) {\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// `j` now holds the desired subrow index\r\n\t\t\tseg.level = j;\r\n\r\n\t\t\t// create new level array if needed and append segment\r\n\t\t\t(levels[j] || (levels[j] = [])).push(seg);\r\n\t\t}\r\n\r\n\t\t// order segments left-to-right. very important if calendar is RTL\r\n\t\tfor (j = 0; j < levels.length; j++) {\r\n\t\t\tlevels[j].sort(compareDaySegCols);\r\n\t\t}\r\n\r\n\t\treturn levels;\r\n\t},\r\n\r\n\r\n\t// Given a flat array of segments, return an array of sub-arrays, grouped by each segment's row\r\n\tgroupSegRows: function(segs) {\r\n\t\tvar segRows = [];\r\n\t\tvar i;\r\n\r\n\t\tfor (i = 0; i < this.rowCnt; i++) {\r\n\t\t\tsegRows.push([]);\r\n\t\t}\r\n\r\n\t\tfor (i = 0; i < segs.length; i++) {\r\n\t\t\tsegRows[segs[i].row].push(segs[i]);\r\n\t\t}\r\n\r\n\t\treturn segRows;\r\n\t}\r\n\r\n});\r\n\r\n\r\n// Computes whether two segments' columns collide. They are assumed to be in the same row.\r\nfunction isDaySegCollision(seg, otherSegs) {\r\n\tvar i, otherSeg;\r\n\r\n\tfor (i = 0; i < otherSegs.length; i++) {\r\n\t\totherSeg = otherSegs[i];\r\n\r\n\t\tif (\r\n\t\t\totherSeg.leftCol <= seg.rightCol &&\r\n\t\t\totherSeg.rightCol >= seg.leftCol\r\n\t\t) {\r\n\t\t\treturn true;\r\n\t\t}\r\n\t}\r\n\r\n\treturn false;\r\n}\r\n\r\n\r\n// A cmp function for determining the leftmost event\r\nfunction compareDaySegCols(a, b) {\r\n\treturn a.leftCol - b.leftCol;\r\n}\r\n\r\n;;\r\n\r\n/* Methods relate to limiting the number events for a given day on a DayGrid\r\n----------------------------------------------------------------------------------------------------------------------*/\r\n// NOTE: all the segs being passed around in here are foreground segs\r\n\r\nDayGrid.mixin({\r\n\r\n\tsegPopover: null, // the Popover that holds events that can't fit in a cell. null when not visible\r\n\tpopoverSegs: null, // an array of segment objects that the segPopover holds. null when not visible\r\n\r\n\r\n\tdestroySegPopover: function() {\r\n\t\tif (this.segPopover) {\r\n\t\t\tthis.segPopover.hide(); // will trigger destruction of `segPopover` and `popoverSegs`\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Limits the number of \"levels\" (vertically stacking layers of events) for each row of the grid.\r\n\t// `levelLimit` can be false (don't limit), a number, or true (should be computed).\r\n\tlimitRows: function(levelLimit) {\r\n\t\tvar rowStructs = this.rowStructs || [];\r\n\t\tvar row; // row #\r\n\t\tvar rowLevelLimit;\r\n\r\n\t\tfor (row = 0; row < rowStructs.length; row++) {\r\n\t\t\tthis.unlimitRow(row);\r\n\r\n\t\t\tif (!levelLimit) {\r\n\t\t\t\trowLevelLimit = false;\r\n\t\t\t}\r\n\t\t\telse if (typeof levelLimit === 'number') {\r\n\t\t\t\trowLevelLimit = levelLimit;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\trowLevelLimit = this.computeRowLevelLimit(row);\r\n\t\t\t}\r\n\r\n\t\t\tif (rowLevelLimit !== false) {\r\n\t\t\t\tthis.limitRow(row, rowLevelLimit);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Computes the number of levels a row will accomodate without going outside its bounds.\r\n\t// Assumes the row is \"rigid\" (maintains a constant height regardless of what is inside).\r\n\t// `row` is the row number.\r\n\tcomputeRowLevelLimit: function(row) {\r\n\t\tvar rowEl = this.rowEls.eq(row); // the containing \"fake\" row div\r\n\t\tvar rowHeight = rowEl.height(); // TODO: cache somehow?\r\n\t\tvar trEls = this.rowStructs[row].tbodyEl.children();\r\n\t\tvar i, trEl;\r\n\t\tvar trHeight;\r\n\r\n\t\tfunction iterInnerHeights(i, childNode) {\r\n\t\t\ttrHeight = Math.max(trHeight, $(childNode).outerHeight());\r\n\t\t}\r\n\r\n\t\t// Reveal one level <tr> at a time and stop when we find one out of bounds\r\n\t\tfor (i = 0; i < trEls.length; i++) {\r\n\t\t\ttrEl = trEls.eq(i).removeClass('fc-limited'); // reset to original state (reveal)\r\n\r\n\t\t\t// with rowspans>1 and IE8, trEl.outerHeight() would return the height of the largest cell,\r\n\t\t\t// so instead, find the tallest inner content element.\r\n\t\t\ttrHeight = 0;\r\n\t\t\ttrEl.find('> td > :first-child').each(iterInnerHeights);\r\n\r\n\t\t\tif (trEl.position().top + trHeight > rowHeight) {\r\n\t\t\t\treturn i;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn false; // should not limit at all\r\n\t},\r\n\r\n\r\n\t// Limits the given grid row to the maximum number of levels and injects \"more\" links if necessary.\r\n\t// `row` is the row number.\r\n\t// `levelLimit` is a number for the maximum (inclusive) number of levels allowed.\r\n\tlimitRow: function(row, levelLimit) {\r\n\t\tvar _this = this;\r\n\t\tvar rowStruct = this.rowStructs[row];\r\n\t\tvar moreNodes = []; // array of \"more\" <a> links and <td> DOM nodes\r\n\t\tvar col = 0; // col #, left-to-right (not chronologically)\r\n\t\tvar cell;\r\n\t\tvar levelSegs; // array of segment objects in the last allowable level, ordered left-to-right\r\n\t\tvar cellMatrix; // a matrix (by level, then column) of all <td> jQuery elements in the row\r\n\t\tvar limitedNodes; // array of temporarily hidden level <tr> and segment <td> DOM nodes\r\n\t\tvar i, seg;\r\n\t\tvar segsBelow; // array of segment objects below `seg` in the current `col`\r\n\t\tvar totalSegsBelow; // total number of segments below `seg` in any of the columns `seg` occupies\r\n\t\tvar colSegsBelow; // array of segment arrays, below seg, one for each column (offset from segs's first column)\r\n\t\tvar td, rowspan;\r\n\t\tvar segMoreNodes; // array of \"more\" <td> cells that will stand-in for the current seg's cell\r\n\t\tvar j;\r\n\t\tvar moreTd, moreWrap, moreLink;\r\n\r\n\t\t// Iterates through empty level cells and places \"more\" links inside if need be\r\n\t\tfunction emptyCellsUntil(endCol) { // goes from current `col` to `endCol`\r\n\t\t\twhile (col < endCol) {\r\n\t\t\t\tcell = _this.getCell(row, col);\r\n\t\t\t\tsegsBelow = _this.getCellSegs(cell, levelLimit);\r\n\t\t\t\tif (segsBelow.length) {\r\n\t\t\t\t\ttd = cellMatrix[levelLimit - 1][col];\r\n\t\t\t\t\tmoreLink = _this.renderMoreLink(cell, segsBelow);\r\n\t\t\t\t\tmoreWrap = $('<div/>').append(moreLink);\r\n\t\t\t\t\ttd.append(moreWrap);\r\n\t\t\t\t\tmoreNodes.push(moreWrap[0]);\r\n\t\t\t\t}\r\n\t\t\t\tcol++;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (levelLimit && levelLimit < rowStruct.segLevels.length) { // is it actually over the limit?\r\n\t\t\tlevelSegs = rowStruct.segLevels[levelLimit - 1];\r\n\t\t\tcellMatrix = rowStruct.cellMatrix;\r\n\r\n\t\t\tlimitedNodes = rowStruct.tbodyEl.children().slice(levelLimit) // get level <tr> elements past the limit\r\n\t\t\t\t.addClass('fc-limited').get(); // hide elements and get a simple DOM-nodes array\r\n\r\n\t\t\t// iterate though segments in the last allowable level\r\n\t\t\tfor (i = 0; i < levelSegs.length; i++) {\r\n\t\t\t\tseg = levelSegs[i];\r\n\t\t\t\temptyCellsUntil(seg.leftCol); // process empty cells before the segment\r\n\r\n\t\t\t\t// determine *all* segments below `seg` that occupy the same columns\r\n\t\t\t\tcolSegsBelow = [];\r\n\t\t\t\ttotalSegsBelow = 0;\r\n\t\t\t\twhile (col <= seg.rightCol) {\r\n\t\t\t\t\tcell = this.getCell(row, col);\r\n\t\t\t\t\tsegsBelow = this.getCellSegs(cell, levelLimit);\r\n\t\t\t\t\tcolSegsBelow.push(segsBelow);\r\n\t\t\t\t\ttotalSegsBelow += segsBelow.length;\r\n\t\t\t\t\tcol++;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (totalSegsBelow) { // do we need to replace this segment with one or many \"more\" links?\r\n\t\t\t\t\ttd = cellMatrix[levelLimit - 1][seg.leftCol]; // the segment's parent cell\r\n\t\t\t\t\trowspan = td.attr('rowspan') || 1;\r\n\t\t\t\t\tsegMoreNodes = [];\r\n\r\n\t\t\t\t\t// make a replacement <td> for each column the segment occupies. will be one for each colspan\r\n\t\t\t\t\tfor (j = 0; j < colSegsBelow.length; j++) {\r\n\t\t\t\t\t\tmoreTd = $('<td class=\"fc-more-cell\"/>').attr('rowspan', rowspan);\r\n\t\t\t\t\t\tsegsBelow = colSegsBelow[j];\r\n\t\t\t\t\t\tcell = this.getCell(row, seg.leftCol + j);\r\n\t\t\t\t\t\tmoreLink = this.renderMoreLink(cell, [ seg ].concat(segsBelow)); // count seg as hidden too\r\n\t\t\t\t\t\tmoreWrap = $('<div/>').append(moreLink);\r\n\t\t\t\t\t\tmoreTd.append(moreWrap);\r\n\t\t\t\t\t\tsegMoreNodes.push(moreTd[0]);\r\n\t\t\t\t\t\tmoreNodes.push(moreTd[0]);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\ttd.addClass('fc-limited').after($(segMoreNodes)); // hide original <td> and inject replacements\r\n\t\t\t\t\tlimitedNodes.push(td[0]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\temptyCellsUntil(this.colCnt); // finish off the level\r\n\t\t\trowStruct.moreEls = $(moreNodes); // for easy undoing later\r\n\t\t\trowStruct.limitedEls = $(limitedNodes); // for easy undoing later\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Reveals all levels and removes all \"more\"-related elements for a grid's row.\r\n\t// `row` is a row number.\r\n\tunlimitRow: function(row) {\r\n\t\tvar rowStruct = this.rowStructs[row];\r\n\r\n\t\tif (rowStruct.moreEls) {\r\n\t\t\trowStruct.moreEls.remove();\r\n\t\t\trowStruct.moreEls = null;\r\n\t\t}\r\n\r\n\t\tif (rowStruct.limitedEls) {\r\n\t\t\trowStruct.limitedEls.removeClass('fc-limited');\r\n\t\t\trowStruct.limitedEls = null;\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Renders an <a> element that represents hidden event element for a cell.\r\n\t// Responsible for attaching click handler as well.\r\n\trenderMoreLink: function(cell, hiddenSegs) {\r\n\t\tvar _this = this;\r\n\t\tvar view = this.view;\r\n\r\n\t\treturn $('<a class=\"fc-more\"/>')\r\n\t\t\t.text(\r\n\t\t\t\tthis.getMoreLinkText(hiddenSegs.length)\r\n\t\t\t)\r\n\t\t\t.on('click', function(ev) {\r\n\t\t\t\tvar clickOption = view.opt('eventLimitClick');\r\n\t\t\t\tvar date = cell.start;\r\n\t\t\t\tvar moreEl = $(this);\r\n\t\t\t\tvar dayEl = _this.getCellDayEl(cell);\r\n\t\t\t\tvar allSegs = _this.getCellSegs(cell);\r\n\r\n\t\t\t\t// rescope the segments to be within the cell's date\r\n\t\t\t\tvar reslicedAllSegs = _this.resliceDaySegs(allSegs, date);\r\n\t\t\t\tvar reslicedHiddenSegs = _this.resliceDaySegs(hiddenSegs, date);\r\n\r\n\t\t\t\tif (typeof clickOption === 'function') {\r\n\t\t\t\t\t// the returned value can be an atomic option\r\n\t\t\t\t\tclickOption = view.trigger('eventLimitClick', null, {\r\n\t\t\t\t\t\tdate: date,\r\n\t\t\t\t\t\tdayEl: dayEl,\r\n\t\t\t\t\t\tmoreEl: moreEl,\r\n\t\t\t\t\t\tsegs: reslicedAllSegs,\r\n\t\t\t\t\t\thiddenSegs: reslicedHiddenSegs\r\n\t\t\t\t\t}, ev);\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (clickOption === 'popover') {\r\n\t\t\t\t\t_this.showSegPopover(cell, moreEl, reslicedAllSegs);\r\n\t\t\t\t}\r\n\t\t\t\telse if (typeof clickOption === 'string') { // a view name\r\n\t\t\t\t\tview.calendar.zoomTo(date, clickOption);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t},\r\n\r\n\r\n\t// Reveals the popover that displays all events within a cell\r\n\tshowSegPopover: function(cell, moreLink, segs) {\r\n\t\tvar _this = this;\r\n\t\tvar view = this.view;\r\n\t\tvar moreWrap = moreLink.parent(); // the <div> wrapper around the <a>\r\n\t\tvar topEl; // the element we want to match the top coordinate of\r\n\t\tvar options;\r\n\r\n\t\tif (this.rowCnt == 1) {\r\n\t\t\ttopEl = view.el; // will cause the popover to cover any sort of header\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttopEl = this.rowEls.eq(cell.row); // will align with top of row\r\n\t\t}\r\n\r\n\t\toptions = {\r\n\t\t\tclassName: 'fc-more-popover',\r\n\t\t\tcontent: this.renderSegPopoverContent(cell, segs),\r\n\t\t\tparentEl: this.el,\r\n\t\t\ttop: topEl.offset().top,\r\n\t\t\tautoHide: true, // when the user clicks elsewhere, hide the popover\r\n\t\t\tviewportConstrain: view.opt('popoverViewportConstrain'),\r\n\t\t\thide: function() {\r\n\t\t\t\t// destroy everything when the popover is hidden\r\n\t\t\t\t_this.segPopover.destroy();\r\n\t\t\t\t_this.segPopover = null;\r\n\t\t\t\t_this.popoverSegs = null;\r\n\t\t\t}\r\n\t\t};\r\n\r\n\t\t// Determine horizontal coordinate.\r\n\t\t// We use the moreWrap instead of the <td> to avoid border confusion.\r\n\t\tif (this.isRTL) {\r\n\t\t\toptions.right = moreWrap.offset().left + moreWrap.outerWidth() + 1; // +1 to be over cell border\r\n\t\t}\r\n\t\telse {\r\n\t\t\toptions.left = moreWrap.offset().left - 1; // -1 to be over cell border\r\n\t\t}\r\n\r\n\t\tthis.segPopover = new Popover(options);\r\n\t\tthis.segPopover.show();\r\n\t},\r\n\r\n\r\n\t// Builds the inner DOM contents of the segment popover\r\n\trenderSegPopoverContent: function(cell, segs) {\r\n\t\tvar view = this.view;\r\n\t\tvar isTheme = view.opt('theme');\r\n\t\tvar title = cell.start.format(view.opt('dayPopoverFormat'));\r\n\t\tvar content = $(\r\n\t\t\t'<div class=\"fc-header ' + view.widgetHeaderClass + '\">' +\r\n\t\t\t\t'<span class=\"fc-close ' +\r\n\t\t\t\t\t(isTheme ? 'ui-icon ui-icon-closethick' : 'fc-icon fc-icon-x') +\r\n\t\t\t\t'\"></span>' +\r\n\t\t\t\t'<span class=\"fc-title\">' +\r\n\t\t\t\t\thtmlEscape(title) +\r\n\t\t\t\t'</span>' +\r\n\t\t\t\t'<div class=\"fc-clear\"/>' +\r\n\t\t\t'</div>' +\r\n\t\t\t'<div class=\"fc-body ' + view.widgetContentClass + '\">' +\r\n\t\t\t\t'<div class=\"fc-event-container\"></div>' +\r\n\t\t\t'</div>'\r\n\t\t);\r\n\t\tvar segContainer = content.find('.fc-event-container');\r\n\t\tvar i;\r\n\r\n\t\t// render each seg's `el` and only return the visible segs\r\n\t\tsegs = this.renderFgSegEls(segs, true); // disableResizing=true\r\n\t\tthis.popoverSegs = segs;\r\n\r\n\t\tfor (i = 0; i < segs.length; i++) {\r\n\r\n\t\t\t// because segments in the popover are not part of a grid coordinate system, provide a hint to any\r\n\t\t\t// grids that want to do drag-n-drop about which cell it came from\r\n\t\t\tsegs[i].cell = cell;\r\n\r\n\t\t\tsegContainer.append(segs[i].el);\r\n\t\t}\r\n\r\n\t\treturn content;\r\n\t},\r\n\r\n\r\n\t// Given the events within an array of segment objects, reslice them to be in a single day\r\n\tresliceDaySegs: function(segs, dayDate) {\r\n\r\n\t\t// build an array of the original events\r\n\t\tvar events = $.map(segs, function(seg) {\r\n\t\t\treturn seg.event;\r\n\t\t});\r\n\r\n\t\tvar dayStart = dayDate.clone().stripTime();\r\n\t\tvar dayEnd = dayStart.clone().add(1, 'days');\r\n\t\tvar dayRange = { start: dayStart, end: dayEnd };\r\n\r\n\t\t// slice the events with a custom slicing function\r\n\t\tsegs = this.eventsToSegs(\r\n\t\t\tevents,\r\n\t\t\tfunction(range) {\r\n\t\t\t\tvar seg = intersectionToSeg(range, dayRange); // undefind if no intersection\r\n\t\t\t\treturn seg ? [ seg ] : []; // must return an array of segments\r\n\t\t\t}\r\n\t\t);\r\n\r\n\t\t// force an order because eventsToSegs doesn't guarantee one\r\n\t\tsegs.sort(compareSegs);\r\n\r\n\t\treturn segs;\r\n\t},\r\n\r\n\r\n\t// Generates the text that should be inside a \"more\" link, given the number of events it represents\r\n\tgetMoreLinkText: function(num) {\r\n\t\tvar opt = this.view.opt('eventLimitText');\r\n\r\n\t\tif (typeof opt === 'function') {\r\n\t\t\treturn opt(num);\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn '+' + num + ' ' + opt;\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Returns segments within a given cell.\r\n\t// If `startLevel` is specified, returns only events including and below that level. Otherwise returns all segs.\r\n\tgetCellSegs: function(cell, startLevel) {\r\n\t\tvar segMatrix = this.rowStructs[cell.row].segMatrix;\r\n\t\tvar level = startLevel || 0;\r\n\t\tvar segs = [];\r\n\t\tvar seg;\r\n\r\n\t\twhile (level < segMatrix.length) {\r\n\t\t\tseg = segMatrix[level][cell.col];\r\n\t\t\tif (seg) {\r\n\t\t\t\tsegs.push(seg);\r\n\t\t\t}\r\n\t\t\tlevel++;\r\n\t\t}\r\n\r\n\t\treturn segs;\r\n\t}\r\n\r\n});\r\n\r\n;;\r\n\r\n/* A component that renders one or more columns of vertical time slots\r\n----------------------------------------------------------------------------------------------------------------------*/\r\n\r\nvar TimeGrid = Grid.extend({\r\n\r\n\tslotDuration: null, // duration of a \"slot\", a distinct time segment on given day, visualized by lines\r\n\tsnapDuration: null, // granularity of time for dragging and selecting\r\n\r\n\tminTime: null, // Duration object that denotes the first visible time of any given day\r\n\tmaxTime: null, // Duration object that denotes the exclusive visible end time of any given day\r\n\r\n\taxisFormat: null, // formatting string for times running along vertical axis\r\n\r\n\tdayEls: null, // cells elements in the day-row background\r\n\tslatEls: null, // elements running horizontally across all columns\r\n\r\n\tslatTops: null, // an array of top positions, relative to the container. last item holds bottom of last slot\r\n\r\n\thelperEl: null, // cell skeleton element for rendering the mock event \"helper\"\r\n\r\n\tbusinessHourSegs: null,\r\n\r\n\r\n\tconstructor: function() {\r\n\t\tGrid.apply(this, arguments); // call the super-constructor\r\n\t\tthis.processOptions();\r\n\t},\r\n\r\n\r\n\t// Renders the time grid into `this.el`, which should already be assigned.\r\n\t// Relies on the view's colCnt. In the future, this component should probably be self-sufficient.\r\n\trenderDates: function() {\r\n\t\tthis.el.html(this.renderHtml());\r\n\t\tthis.dayEls = this.el.find('.fc-day');\r\n\t\tthis.slatEls = this.el.find('.fc-slats tr');\r\n\t},\r\n\r\n\r\n\trenderBusinessHours: function() {\r\n\t\tvar events = this.view.calendar.getBusinessHoursEvents();\r\n\t\tthis.businessHourSegs = this.renderFill('businessHours', this.eventsToSegs(events), 'bgevent');\r\n\t},\r\n\r\n\r\n\t// Renders the basic HTML skeleton for the grid\r\n\trenderHtml: function() {\r\n\t\treturn '' +\r\n\t\t\t'<div class=\"fc-bg\">' +\r\n\t\t\t\t'<table>' +\r\n\t\t\t\t\tthis.rowHtml('slotBg') + // leverages RowRenderer, which will call slotBgCellHtml\r\n\t\t\t\t'</table>' +\r\n\t\t\t'</div>' +\r\n\t\t\t'<div class=\"fc-slats\">' +\r\n\t\t\t\t'<table>' +\r\n\t\t\t\t\tthis.slatRowHtml() +\r\n\t\t\t\t'</table>' +\r\n\t\t\t'</div>';\r\n\t},\r\n\r\n\r\n\t// Renders the HTML for a vertical background cell behind the slots.\r\n\t// This method is distinct from 'bg' because we wanted a new `rowType` so the View could customize the rendering.\r\n\tslotBgCellHtml: function(cell) {\r\n\t\treturn this.bgCellHtml(cell);\r\n\t},\r\n\r\n\r\n\t// Generates the HTML for the horizontal \"slats\" that run width-wise. Has a time axis on a side. Depends on RTL.\r\n\tslatRowHtml: function() {\r\n\t\tvar view = this.view;\r\n\t\tvar isRTL = this.isRTL;\r\n\t\tvar html = '';\r\n\t\tvar slotNormal = this.slotDuration.asMinutes() % 15 === 0;\r\n\t\tvar slotTime = moment.duration(+this.minTime); // wish there was .clone() for durations\r\n\t\tvar slotDate; // will be on the view's first day, but we only care about its time\r\n\t\tvar minutes;\r\n\t\tvar axisHtml;\r\n\r\n\t\t// Calculate the time for each slot\r\n\t\twhile (slotTime < this.maxTime) {\r\n\t\t\tslotDate = this.start.clone().time(slotTime); // will be in UTC but that's good. to avoid DST issues\r\n\t\t\tminutes = slotDate.minutes();\r\n\r\n\t\t\taxisHtml =\r\n\t\t\t\t'<td class=\"fc-axis fc-time ' + view.widgetContentClass + '\" ' + view.axisStyleAttr() + '>' +\r\n\t\t\t\t\t((!slotNormal || !minutes) ? // if irregular slot duration, or on the hour, then display the time\r\n\t\t\t\t\t\t'<span>' + // for matchCellWidths\r\n\t\t\t\t\t\t\thtmlEscape(slotDate.format(this.axisFormat)) +\r\n\t\t\t\t\t\t'</span>' :\r\n\t\t\t\t\t\t''\r\n\t\t\t\t\t\t) +\r\n\t\t\t\t'</td>';\r\n\r\n\t\t\thtml +=\r\n\t\t\t\t'<tr ' + (!minutes ? '' : 'class=\"fc-minor\"') + '>' +\r\n\t\t\t\t\t(!isRTL ? axisHtml : '') +\r\n\t\t\t\t\t'<td class=\"' + view.widgetContentClass + '\"/>' +\r\n\t\t\t\t\t(isRTL ? axisHtml : '') +\r\n\t\t\t\t\"</tr>\";\r\n\r\n\t\t\tslotTime.add(this.slotDuration);\r\n\t\t}\r\n\r\n\t\treturn html;\r\n\t},\r\n\r\n\r\n\t/* Options\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Parses various options into properties of this object\r\n\tprocessOptions: function() {\r\n\t\tvar view = this.view;\r\n\t\tvar slotDuration = view.opt('slotDuration');\r\n\t\tvar snapDuration = view.opt('snapDuration');\r\n\r\n\t\tslotDuration = moment.duration(slotDuration);\r\n\t\tsnapDuration = snapDuration ? moment.duration(snapDuration) : slotDuration;\r\n\r\n\t\tthis.slotDuration = slotDuration;\r\n\t\tthis.snapDuration = snapDuration;\r\n\t\tthis.cellDuration = snapDuration; // for Grid system\r\n\r\n\t\tthis.minTime = moment.duration(view.opt('minTime'));\r\n\t\tthis.maxTime = moment.duration(view.opt('maxTime'));\r\n\r\n\t\tthis.axisFormat = view.opt('axisFormat') || view.opt('smallTimeFormat');\r\n\t},\r\n\r\n\r\n\t// Computes a default column header formatting string if `colFormat` is not explicitly defined\r\n\tcomputeColHeadFormat: function() {\r\n\t\tif (this.colCnt > 1) { // multiple days, so full single date string WON'T be in title text\r\n\t\t\treturn this.view.opt('dayOfMonthFormat'); // \"Sat 12/10\"\r\n\t\t}\r\n\t\telse { // single day, so full single date string will probably be in title text\r\n\t\t\treturn 'dddd'; // \"Saturday\"\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Computes a default event time formatting string if `timeFormat` is not explicitly defined\r\n\tcomputeEventTimeFormat: function() {\r\n\t\treturn this.view.opt('noMeridiemTimeFormat'); // like \"6:30\" (no AM/PM)\r\n\t},\r\n\r\n\r\n\t// Computes a default `displayEventEnd` value if one is not expliclty defined\r\n\tcomputeDisplayEventEnd: function() {\r\n\t\treturn true;\r\n\t},\r\n\r\n\r\n\t/* Cell System\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Initializes row/col information\r\n\tupdateCells: function() {\r\n\t\tvar view = this.view;\r\n\t\tvar colData = [];\r\n\t\tvar date;\r\n\r\n\t\tdate = this.start.clone();\r\n\t\twhile (date.isBefore(this.end)) {\r\n\t\t\tcolData.push({\r\n\t\t\t\tday: date.clone()\r\n\t\t\t});\r\n\t\t\tdate.add(1, 'day');\r\n\t\t\tdate = view.skipHiddenDays(date);\r\n\t\t}\r\n\r\n\t\tif (this.isRTL) {\r\n\t\t\tcolData.reverse();\r\n\t\t}\r\n\r\n\t\tthis.colData = colData;\r\n\t\tthis.colCnt = colData.length;\r\n\t\tthis.rowCnt = Math.ceil((this.maxTime - this.minTime) / this.snapDuration); // # of vertical snaps\r\n\t},\r\n\r\n\r\n\t// Given a cell object, generates its start date. Returns a reference-free copy.\r\n\tcomputeCellDate: function(cell) {\r\n\t\tvar time = this.computeSnapTime(cell.row);\r\n\r\n\t\treturn this.view.calendar.rezoneDate(cell.day).time(time);\r\n\t},\r\n\r\n\r\n\t// Retrieves the element representing the given column\r\n\tgetColEl: function(col) {\r\n\t\treturn this.dayEls.eq(col);\r\n\t},\r\n\r\n\r\n\t/* Dates\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Given a row number of the grid, representing a \"snap\", returns a time (Duration) from its start-of-day\r\n\tcomputeSnapTime: function(row) {\r\n\t\treturn moment.duration(this.minTime + this.snapDuration * row);\r\n\t},\r\n\r\n\r\n\t// Slices up a date range by column into an array of segments\r\n\trangeToSegs: function(range) {\r\n\t\tvar colCnt = this.colCnt;\r\n\t\tvar segs = [];\r\n\t\tvar seg;\r\n\t\tvar col;\r\n\t\tvar colDate;\r\n\t\tvar colRange;\r\n\r\n\t\t// normalize :(\r\n\t\trange = {\r\n\t\t\tstart: range.start.clone().stripZone(),\r\n\t\t\tend: range.end.clone().stripZone()\r\n\t\t};\r\n\r\n\t\tfor (col = 0; col < colCnt; col++) {\r\n\t\t\tcolDate = this.colData[col].day; // will be ambig time/timezone\r\n\t\t\tcolRange = {\r\n\t\t\t\tstart: colDate.clone().time(this.minTime),\r\n\t\t\t\tend: colDate.clone().time(this.maxTime)\r\n\t\t\t};\r\n\t\t\tseg = intersectionToSeg(range, colRange); // both will be ambig timezone\r\n\t\t\tif (seg) {\r\n\t\t\t\tseg.col = col;\r\n\t\t\t\tsegs.push(seg);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn segs;\r\n\t},\r\n\r\n\r\n\t/* Coordinates\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\tupdateSize: function(isResize) { // NOT a standard Grid method\r\n\t\tthis.computeSlatTops();\r\n\r\n\t\tif (isResize) {\r\n\t\t\tthis.updateSegVerticals();\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Computes the top/bottom coordinates of each \"snap\" rows\r\n\tcomputeRowCoords: function() {\r\n\t\tvar originTop = this.el.offset().top;\r\n\t\tvar items = [];\r\n\t\tvar i;\r\n\t\tvar item;\r\n\r\n\t\tfor (i = 0; i < this.rowCnt; i++) {\r\n\t\t\titem = {\r\n\t\t\t\ttop: originTop + this.computeTimeTop(this.computeSnapTime(i))\r\n\t\t\t};\r\n\t\t\tif (i > 0) {\r\n\t\t\t\titems[i - 1].bottom = item.top;\r\n\t\t\t}\r\n\t\t\titems.push(item);\r\n\t\t}\r\n\t\titem.bottom = item.top + this.computeTimeTop(this.computeSnapTime(i));\r\n\r\n\t\treturn items;\r\n\t},\r\n\r\n\r\n\t// Computes the top coordinate, relative to the bounds of the grid, of the given date.\r\n\t// A `startOfDayDate` must be given for avoiding ambiguity over how to treat midnight.\r\n\tcomputeDateTop: function(date, startOfDayDate) {\r\n\t\treturn this.computeTimeTop(\r\n\t\t\tmoment.duration(\r\n\t\t\t\tdate.clone().stripZone() - startOfDayDate.clone().stripTime()\r\n\t\t\t)\r\n\t\t);\r\n\t},\r\n\r\n\r\n\t// Computes the top coordinate, relative to the bounds of the grid, of the given time (a Duration).\r\n\tcomputeTimeTop: function(time) {\r\n\t\tvar slatCoverage = (time - this.minTime) / this.slotDuration; // floating-point value of # of slots covered\r\n\t\tvar slatIndex;\r\n\t\tvar slatRemainder;\r\n\t\tvar slatTop;\r\n\t\tvar slatBottom;\r\n\r\n\t\t// constrain. because minTime/maxTime might be customized\r\n\t\tslatCoverage = Math.max(0, slatCoverage);\r\n\t\tslatCoverage = Math.min(this.slatEls.length, slatCoverage);\r\n\r\n\t\tslatIndex = Math.floor(slatCoverage); // an integer index of the furthest whole slot\r\n\t\tslatRemainder = slatCoverage - slatIndex;\r\n\t\tslatTop = this.slatTops[slatIndex]; // the top position of the furthest whole slot\r\n\r\n\t\tif (slatRemainder) { // time spans part-way into the slot\r\n\t\t\tslatBottom = this.slatTops[slatIndex + 1];\r\n\t\t\treturn slatTop + (slatBottom - slatTop) * slatRemainder; // part-way between slots\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn slatTop;\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Queries each `slatEl` for its position relative to the grid's container and stores it in `slatTops`.\r\n\t// Includes the the bottom of the last slat as the last item in the array.\r\n\tcomputeSlatTops: function() {\r\n\t\tvar tops = [];\r\n\t\tvar top;\r\n\r\n\t\tthis.slatEls.each(function(i, node) {\r\n\t\t\ttop = $(node).position().top;\r\n\t\t\ttops.push(top);\r\n\t\t});\r\n\r\n\t\ttops.push(top + this.slatEls.last().outerHeight()); // bottom of the last slat\r\n\r\n\t\tthis.slatTops = tops;\r\n\t},\r\n\r\n\r\n\t/* Event Drag Visualization\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Renders a visual indication of an event being dragged over the specified date(s).\r\n\t// dropLocation's end might be null, as well as `seg`. See Grid::renderDrag for more info.\r\n\t// A returned value of `true` signals that a mock \"helper\" event has been rendered.\r\n\trenderDrag: function(dropLocation, seg) {\r\n\r\n\t\tif (seg) { // if there is event information for this drag, render a helper event\r\n\t\t\tthis.renderRangeHelper(dropLocation, seg);\r\n\t\t\tthis.applyDragOpacity(this.helperEl);\r\n\r\n\t\t\treturn true; // signal that a helper has been rendered\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// otherwise, just render a highlight\r\n\t\t\tthis.renderHighlight(\r\n\t\t\t\tthis.view.calendar.ensureVisibleEventRange(dropLocation) // needs to be a proper range\r\n\t\t\t);\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Unrenders any visual indication of an event being dragged\r\n\tdestroyDrag: function() {\r\n\t\tthis.destroyHelper();\r\n\t\tthis.destroyHighlight();\r\n\t},\r\n\r\n\r\n\t/* Event Resize Visualization\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Renders a visual indication of an event being resized\r\n\trenderEventResize: function(range, seg) {\r\n\t\tthis.renderRangeHelper(range, seg);\r\n\t},\r\n\r\n\r\n\t// Unrenders any visual indication of an event being resized\r\n\tdestroyEventResize: function() {\r\n\t\tthis.destroyHelper();\r\n\t},\r\n\r\n\r\n\t/* Event Helper\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Renders a mock \"helper\" event. `sourceSeg` is the original segment object and might be null (an external drag)\r\n\trenderHelper: function(event, sourceSeg) {\r\n\t\tvar segs = this.eventsToSegs([ event ]);\r\n\t\tvar tableEl;\r\n\t\tvar i, seg;\r\n\t\tvar sourceEl;\r\n\r\n\t\tsegs = this.renderFgSegEls(segs); // assigns each seg's el and returns a subset of segs that were rendered\r\n\t\ttableEl = this.renderSegTable(segs);\r\n\r\n\t\t// Try to make the segment that is in the same row as sourceSeg look the same\r\n\t\tfor (i = 0; i < segs.length; i++) {\r\n\t\t\tseg = segs[i];\r\n\t\t\tif (sourceSeg && sourceSeg.col === seg.col) {\r\n\t\t\t\tsourceEl = sourceSeg.el;\r\n\t\t\t\tseg.el.css({\r\n\t\t\t\t\tleft: sourceEl.css('left'),\r\n\t\t\t\t\tright: sourceEl.css('right'),\r\n\t\t\t\t\t'margin-left': sourceEl.css('margin-left'),\r\n\t\t\t\t\t'margin-right': sourceEl.css('margin-right')\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tthis.helperEl = $('<div class=\"fc-helper-skeleton\"/>')\r\n\t\t\t.append(tableEl)\r\n\t\t\t\t.appendTo(this.el);\r\n\t},\r\n\r\n\r\n\t// Unrenders any mock helper event\r\n\tdestroyHelper: function() {\r\n\t\tif (this.helperEl) {\r\n\t\t\tthis.helperEl.remove();\r\n\t\t\tthis.helperEl = null;\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t/* Selection\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Renders a visual indication of a selection. Overrides the default, which was to simply render a highlight.\r\n\trenderSelection: function(range) {\r\n\t\tif (this.view.opt('selectHelper')) { // this setting signals that a mock helper event should be rendered\r\n\t\t\tthis.renderRangeHelper(range);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.renderHighlight(range);\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Unrenders any visual indication of a selection\r\n\tdestroySelection: function() {\r\n\t\tthis.destroyHelper();\r\n\t\tthis.destroyHighlight();\r\n\t},\r\n\r\n\r\n\t/* Fill System (highlight, background events, business hours)\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Renders a set of rectangles over the given time segments.\r\n\t// Only returns segments that successfully rendered.\r\n\trenderFill: function(type, segs, className) {\r\n\t\tvar segCols;\r\n\t\tvar skeletonEl;\r\n\t\tvar trEl;\r\n\t\tvar col, colSegs;\r\n\t\tvar tdEl;\r\n\t\tvar containerEl;\r\n\t\tvar dayDate;\r\n\t\tvar i, seg;\r\n\r\n\t\tif (segs.length) {\r\n\r\n\t\t\tsegs = this.renderFillSegEls(type, segs); // assignes `.el` to each seg. returns successfully rendered segs\r\n\t\t\tsegCols = this.groupSegCols(segs); // group into sub-arrays, and assigns 'col' to each seg\r\n\r\n\t\t\tclassName = className || type.toLowerCase();\r\n\t\t\tskeletonEl = $(\r\n\t\t\t\t'<div class=\"fc-' + className + '-skeleton\">' +\r\n\t\t\t\t\t'<table><tr/></table>' +\r\n\t\t\t\t'</div>'\r\n\t\t\t);\r\n\t\t\ttrEl = skeletonEl.find('tr');\r\n\r\n\t\t\tfor (col = 0; col < segCols.length; col++) {\r\n\t\t\t\tcolSegs = segCols[col];\r\n\t\t\t\ttdEl = $('<td/>').appendTo(trEl);\r\n\r\n\t\t\t\tif (colSegs.length) {\r\n\t\t\t\t\tcontainerEl = $('<div class=\"fc-' + className + '-container\"/>').appendTo(tdEl);\r\n\t\t\t\t\tdayDate = this.colData[col].day;\r\n\r\n\t\t\t\t\tfor (i = 0; i < colSegs.length; i++) {\r\n\t\t\t\t\t\tseg = colSegs[i];\r\n\t\t\t\t\t\tcontainerEl.append(\r\n\t\t\t\t\t\t\tseg.el.css({\r\n\t\t\t\t\t\t\t\ttop: this.computeDateTop(seg.start, dayDate),\r\n\t\t\t\t\t\t\t\tbottom: -this.computeDateTop(seg.end, dayDate) // the y position of the bottom edge\r\n\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tthis.bookendCells(trEl, type);\r\n\r\n\t\t\tthis.el.append(skeletonEl);\r\n\t\t\tthis.elsByFill[type] = skeletonEl;\r\n\t\t}\r\n\r\n\t\treturn segs;\r\n\t}\r\n\r\n});\r\n\r\n;;\r\n\r\n/* Event-rendering methods for the TimeGrid class\r\n----------------------------------------------------------------------------------------------------------------------*/\r\n\r\nTimeGrid.mixin({\r\n\r\n\teventSkeletonEl: null, // has cells with event-containers, which contain absolutely positioned event elements\r\n\r\n\r\n\t// Renders the given foreground event segments onto the grid\r\n\trenderFgSegs: function(segs) {\r\n\t\tsegs = this.renderFgSegEls(segs); // returns a subset of the segs. segs that were actually rendered\r\n\r\n\t\tthis.el.append(\r\n\t\t\tthis.eventSkeletonEl = $('<div class=\"fc-content-skeleton\"/>')\r\n\t\t\t\t.append(this.renderSegTable(segs))\r\n\t\t);\r\n\r\n\t\treturn segs; // return only the segs that were actually rendered\r\n\t},\r\n\r\n\r\n\t// Unrenders all currently rendered foreground event segments\r\n\tdestroyFgSegs: function(segs) {\r\n\t\tif (this.eventSkeletonEl) {\r\n\t\t\tthis.eventSkeletonEl.remove();\r\n\t\t\tthis.eventSkeletonEl = null;\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Renders and returns the <table> portion of the event-skeleton.\r\n\t// Returns an object with properties 'tbodyEl' and 'segs'.\r\n\trenderSegTable: function(segs) {\r\n\t\tvar tableEl = $('<table><tr/></table>');\r\n\t\tvar trEl = tableEl.find('tr');\r\n\t\tvar segCols;\r\n\t\tvar i, seg;\r\n\t\tvar col, colSegs;\r\n\t\tvar containerEl;\r\n\r\n\t\tsegCols = this.groupSegCols(segs); // group into sub-arrays, and assigns 'col' to each seg\r\n\r\n\t\tthis.computeSegVerticals(segs); // compute and assign top/bottom\r\n\r\n\t\tfor (col = 0; col < segCols.length; col++) { // iterate each column grouping\r\n\t\t\tcolSegs = segCols[col];\r\n\t\t\tplaceSlotSegs(colSegs); // compute horizontal coordinates, z-index's, and reorder the array\r\n\r\n\t\t\tcontainerEl = $('<div class=\"fc-event-container\"/>');\r\n\r\n\t\t\t// assign positioning CSS and insert into container\r\n\t\t\tfor (i = 0; i < colSegs.length; i++) {\r\n\t\t\t\tseg = colSegs[i];\r\n\t\t\t\tseg.el.css(this.generateSegPositionCss(seg));\r\n\r\n\t\t\t\t// if the height is short, add a className for alternate styling\r\n\t\t\t\tif (seg.bottom - seg.top < 30) {\r\n\t\t\t\t\tseg.el.addClass('fc-short');\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcontainerEl.append(seg.el);\r\n\t\t\t}\r\n\r\n\t\t\ttrEl.append($('<td/>').append(containerEl));\r\n\t\t}\r\n\r\n\t\tthis.bookendCells(trEl, 'eventSkeleton');\r\n\r\n\t\treturn tableEl;\r\n\t},\r\n\r\n\r\n\t// Refreshes the CSS top/bottom coordinates for each segment element. Probably after a window resize/zoom.\r\n\t// Repositions business hours segs too, so not just for events. Maybe shouldn't be here.\r\n\tupdateSegVerticals: function() {\r\n\t\tvar allSegs = (this.segs || []).concat(this.businessHourSegs || []);\r\n\t\tvar i;\r\n\r\n\t\tthis.computeSegVerticals(allSegs);\r\n\r\n\t\tfor (i = 0; i < allSegs.length; i++) {\r\n\t\t\tallSegs[i].el.css(\r\n\t\t\t\tthis.generateSegVerticalCss(allSegs[i])\r\n\t\t\t);\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// For each segment in an array, computes and assigns its top and bottom properties\r\n\tcomputeSegVerticals: function(segs) {\r\n\t\tvar i, seg;\r\n\r\n\t\tfor (i = 0; i < segs.length; i++) {\r\n\t\t\tseg = segs[i];\r\n\t\t\tseg.top = this.computeDateTop(seg.start, seg.start);\r\n\t\t\tseg.bottom = this.computeDateTop(seg.end, seg.start);\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Renders the HTML for a single event segment's default rendering\r\n\tfgSegHtml: function(seg, disableResizing) {\r\n\t\tvar view = this.view;\r\n\t\tvar event = seg.event;\r\n\t\tvar isDraggable = view.isEventDraggable(event);\r\n\t\tvar isResizableFromStart = !disableResizing && seg.isStart && view.isEventResizableFromStart(event);\r\n\t\tvar isResizableFromEnd = !disableResizing && seg.isEnd && view.isEventResizableFromEnd(event);\r\n\t\tvar classes = this.getSegClasses(seg, isDraggable, isResizableFromStart || isResizableFromEnd);\r\n\t\tvar skinCss = cssToStr(this.getEventSkinCss(event));\r\n\t\tvar timeText;\r\n\t\tvar fullTimeText; // more verbose time text. for the print stylesheet\r\n\t\tvar startTimeText; // just the start time text\r\n\r\n\t\tclasses.unshift('fc-time-grid-event', 'fc-v-event');\r\n\r\n\t\tif (view.isMultiDayEvent(event)) { // if the event appears to span more than one day...\r\n\t\t\t// Don't display time text on segments that run entirely through a day.\r\n\t\t\t// That would appear as midnight-midnight and would look dumb.\r\n\t\t\t// Otherwise, display the time text for the *segment's* times (like 6pm-midnight or midnight-10am)\r\n\t\t\tif (seg.isStart || seg.isEnd) {\r\n\t\t\t\ttimeText = this.getEventTimeText(seg);\r\n\t\t\t\tfullTimeText = this.getEventTimeText(seg, 'LT');\r\n\t\t\t\tstartTimeText = this.getEventTimeText(seg, null, false); // displayEnd=false\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\t// Display the normal time text for the *event's* times\r\n\t\t\ttimeText = this.getEventTimeText(event);\r\n\t\t\tfullTimeText = this.getEventTimeText(event, 'LT');\r\n\t\t\tstartTimeText = this.getEventTimeText(event, null, false); // displayEnd=false\r\n\t\t}\r\n\r\n\t\treturn '<a class=\"' + classes.join(' ') + '\"' +\r\n\t\t\t(event.url ?\r\n\t\t\t\t' href=\"' + htmlEscape(event.url) + '\"' :\r\n\t\t\t\t''\r\n\t\t\t\t) +\r\n\t\t\t(skinCss ?\r\n\t\t\t\t' style=\"' + skinCss + '\"' :\r\n\t\t\t\t''\r\n\t\t\t\t) +\r\n\t\t\t'>' +\r\n\t\t\t\t'<div class=\"fc-content\">' +\r\n\t\t\t\t\t(timeText ?\r\n\t\t\t\t\t\t'<div class=\"fc-time\"' +\r\n\t\t\t\t\t\t' data-start=\"' + htmlEscape(startTimeText) + '\"' +\r\n\t\t\t\t\t\t' data-full=\"' + htmlEscape(fullTimeText) + '\"' +\r\n\t\t\t\t\t\t'>' +\r\n\t\t\t\t\t\t\t'<span>' + htmlEscape(timeText) + '</span>' +\r\n\t\t\t\t\t\t'</div>' :\r\n\t\t\t\t\t\t''\r\n\t\t\t\t\t\t) +\r\n\t\t\t\t\t(event.title ?\r\n\t\t\t\t\t\t'<div class=\"fc-title\">' +\r\n\t\t\t\t\t\t\thtmlEscape(event.title) +\r\n\t\t\t\t\t\t'</div>' :\r\n\t\t\t\t\t\t''\r\n\t\t\t\t\t\t) +\r\n\t\t\t\t'</div>' +\r\n\t\t\t\t'<div class=\"fc-bg\"/>' +\r\n\t\t\t\t/* TODO: write CSS for this\r\n\t\t\t\t(isResizableFromStart ?\r\n\t\t\t\t\t'<div class=\"fc-resizer fc-start-resizer\" />' :\r\n\t\t\t\t\t''\r\n\t\t\t\t\t) +\r\n\t\t\t\t*/\r\n\t\t\t\t(isResizableFromEnd ?\r\n\t\t\t\t\t'<div class=\"fc-resizer fc-end-resizer\" />' :\r\n\t\t\t\t\t''\r\n\t\t\t\t\t) +\r\n\t\t\t'</a>';\r\n\t},\r\n\r\n\r\n\t// Generates an object with CSS properties/values that should be applied to an event segment element.\r\n\t// Contains important positioning-related properties that should be applied to any event element, customized or not.\r\n\tgenerateSegPositionCss: function(seg) {\r\n\t\tvar shouldOverlap = this.view.opt('slotEventOverlap');\r\n\t\tvar backwardCoord = seg.backwardCoord; // the left side if LTR. the right side if RTL. floating-point\r\n\t\tvar forwardCoord = seg.forwardCoord; // the right side if LTR. the left side if RTL. floating-point\r\n\t\tvar props = this.generateSegVerticalCss(seg); // get top/bottom first\r\n\t\tvar left; // amount of space from left edge, a fraction of the total width\r\n\t\tvar right; // amount of space from right edge, a fraction of the total width\r\n\r\n\t\tif (shouldOverlap) {\r\n\t\t\t// double the width, but don't go beyond the maximum forward coordinate (1.0)\r\n\t\t\tforwardCoord = Math.min(1, backwardCoord + (forwardCoord - backwardCoord) * 2);\r\n\t\t}\r\n\r\n\t\tif (this.isRTL) {\r\n\t\t\tleft = 1 - forwardCoord;\r\n\t\t\tright = backwardCoord;\r\n\t\t}\r\n\t\telse {\r\n\t\t\tleft = backwardCoord;\r\n\t\t\tright = 1 - forwardCoord;\r\n\t\t}\r\n\r\n\t\tprops.zIndex = seg.level + 1; // convert from 0-base to 1-based\r\n\t\tprops.left = left * 100 + '%';\r\n\t\tprops.right = right * 100 + '%';\r\n\r\n\t\tif (shouldOverlap && seg.forwardPressure) {\r\n\t\t\t// add padding to the edge so that forward stacked events don't cover the resizer's icon\r\n\t\t\tprops[this.isRTL ? 'marginLeft' : 'marginRight'] = 10 * 2; // 10 is a guesstimate of the icon's width\r\n\t\t}\r\n\r\n\t\treturn props;\r\n\t},\r\n\r\n\r\n\t// Generates an object with CSS properties for the top/bottom coordinates of a segment element\r\n\tgenerateSegVerticalCss: function(seg) {\r\n\t\treturn {\r\n\t\t\ttop: seg.top,\r\n\t\t\tbottom: -seg.bottom // flipped because needs to be space beyond bottom edge of event container\r\n\t\t};\r\n\t},\r\n\r\n\r\n\t// Given a flat array of segments, return an array of sub-arrays, grouped by each segment's col\r\n\tgroupSegCols: function(segs) {\r\n\t\tvar segCols = [];\r\n\t\tvar i;\r\n\r\n\t\tfor (i = 0; i < this.colCnt; i++) {\r\n\t\t\tsegCols.push([]);\r\n\t\t}\r\n\r\n\t\tfor (i = 0; i < segs.length; i++) {\r\n\t\t\tsegCols[segs[i].col].push(segs[i]);\r\n\t\t}\r\n\r\n\t\treturn segCols;\r\n\t}\r\n\r\n});\r\n\r\n\r\n// Given an array of segments that are all in the same column, sets the backwardCoord and forwardCoord on each.\r\n// NOTE: Also reorders the given array by date!\r\nfunction placeSlotSegs(segs) {\r\n\tvar levels;\r\n\tvar level0;\r\n\tvar i;\r\n\r\n\tsegs.sort(compareSegs); // order by date\r\n\tlevels = buildSlotSegLevels(segs);\r\n\tcomputeForwardSlotSegs(levels);\r\n\r\n\tif ((level0 = levels[0])) {\r\n\r\n\t\tfor (i = 0; i < level0.length; i++) {\r\n\t\t\tcomputeSlotSegPressures(level0[i]);\r\n\t\t}\r\n\r\n\t\tfor (i = 0; i < level0.length; i++) {\r\n\t\t\tcomputeSlotSegCoords(level0[i], 0, 0);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\n// Builds an array of segments \"levels\". The first level will be the leftmost tier of segments if the calendar is\r\n// left-to-right, or the rightmost if the calendar is right-to-left. Assumes the segments are already ordered by date.\r\nfunction buildSlotSegLevels(segs) {\r\n\tvar levels = [];\r\n\tvar i, seg;\r\n\tvar j;\r\n\r\n\tfor (i=0; i<segs.length; i++) {\r\n\t\tseg = segs[i];\r\n\r\n\t\t// go through all the levels and stop on the first level where there are no collisions\r\n\t\tfor (j=0; j<levels.length; j++) {\r\n\t\t\tif (!computeSlotSegCollisions(seg, levels[j]).length) {\r\n\t\t\t\tbreak;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tseg.level = j;\r\n\r\n\t\t(levels[j] || (levels[j] = [])).push(seg);\r\n\t}\r\n\r\n\treturn levels;\r\n}\r\n\r\n\r\n// For every segment, figure out the other segments that are in subsequent\r\n// levels that also occupy the same vertical space. Accumulate in seg.forwardSegs\r\nfunction computeForwardSlotSegs(levels) {\r\n\tvar i, level;\r\n\tvar j, seg;\r\n\tvar k;\r\n\r\n\tfor (i=0; i<levels.length; i++) {\r\n\t\tlevel = levels[i];\r\n\r\n\t\tfor (j=0; j<level.length; j++) {\r\n\t\t\tseg = level[j];\r\n\r\n\t\t\tseg.forwardSegs = [];\r\n\t\t\tfor (k=i+1; k<levels.length; k++) {\r\n\t\t\t\tcomputeSlotSegCollisions(seg, levels[k], seg.forwardSegs);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\n// Figure out which path forward (via seg.forwardSegs) results in the longest path until\r\n// the furthest edge is reached. The number of segments in this path will be seg.forwardPressure\r\nfunction computeSlotSegPressures(seg) {\r\n\tvar forwardSegs = seg.forwardSegs;\r\n\tvar forwardPressure = 0;\r\n\tvar i, forwardSeg;\r\n\r\n\tif (seg.forwardPressure === undefined) { // not already computed\r\n\r\n\t\tfor (i=0; i<forwardSegs.length; i++) {\r\n\t\t\tforwardSeg = forwardSegs[i];\r\n\r\n\t\t\t// figure out the child's maximum forward path\r\n\t\t\tcomputeSlotSegPressures(forwardSeg);\r\n\r\n\t\t\t// either use the existing maximum, or use the child's forward pressure\r\n\t\t\t// plus one (for the forwardSeg itself)\r\n\t\t\tforwardPressure = Math.max(\r\n\t\t\t\tforwardPressure,\r\n\t\t\t\t1 + forwardSeg.forwardPressure\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tseg.forwardPressure = forwardPressure;\r\n\t}\r\n}\r\n\r\n\r\n// Calculate seg.forwardCoord and seg.backwardCoord for the segment, where both values range\r\n// from 0 to 1. If the calendar is left-to-right, the seg.backwardCoord maps to \"left\" and\r\n// seg.forwardCoord maps to \"right\" (via percentage). Vice-versa if the calendar is right-to-left.\r\n//\r\n// The segment might be part of a \"series\", which means consecutive segments with the same pressure\r\n// who's width is unknown until an edge has been hit. `seriesBackwardPressure` is the number of\r\n// segments behind this one in the current series, and `seriesBackwardCoord` is the starting\r\n// coordinate of the first segment in the series.\r\nfunction computeSlotSegCoords(seg, seriesBackwardPressure, seriesBackwardCoord) {\r\n\tvar forwardSegs = seg.forwardSegs;\r\n\tvar i;\r\n\r\n\tif (seg.forwardCoord === undefined) { // not already computed\r\n\r\n\t\tif (!forwardSegs.length) {\r\n\r\n\t\t\t// if there are no forward segments, this segment should butt up against the edge\r\n\t\t\tseg.forwardCoord = 1;\r\n\t\t}\r\n\t\telse {\r\n\r\n\t\t\t// sort highest pressure first\r\n\t\t\tforwardSegs.sort(compareForwardSlotSegs);\r\n\r\n\t\t\t// this segment's forwardCoord will be calculated from the backwardCoord of the\r\n\t\t\t// highest-pressure forward segment.\r\n\t\t\tcomputeSlotSegCoords(forwardSegs[0], seriesBackwardPressure + 1, seriesBackwardCoord);\r\n\t\t\tseg.forwardCoord = forwardSegs[0].backwardCoord;\r\n\t\t}\r\n\r\n\t\t// calculate the backwardCoord from the forwardCoord. consider the series\r\n\t\tseg.backwardCoord = seg.forwardCoord -\r\n\t\t\t(seg.forwardCoord - seriesBackwardCoord) / // available width for series\r\n\t\t\t(seriesBackwardPressure + 1); // # of segments in the series\r\n\r\n\t\t// use this segment's coordinates to computed the coordinates of the less-pressurized\r\n\t\t// forward segments\r\n\t\tfor (i=0; i<forwardSegs.length; i++) {\r\n\t\t\tcomputeSlotSegCoords(forwardSegs[i], 0, seg.forwardCoord);\r\n\t\t}\r\n\t}\r\n}\r\n\r\n\r\n// Find all the segments in `otherSegs` that vertically collide with `seg`.\r\n// Append into an optionally-supplied `results` array and return.\r\nfunction computeSlotSegCollisions(seg, otherSegs, results) {\r\n\tresults = results || [];\r\n\r\n\tfor (var i=0; i<otherSegs.length; i++) {\r\n\t\tif (isSlotSegCollision(seg, otherSegs[i])) {\r\n\t\t\tresults.push(otherSegs[i]);\r\n\t\t}\r\n\t}\r\n\r\n\treturn results;\r\n}\r\n\r\n\r\n// Do these segments occupy the same vertical space?\r\nfunction isSlotSegCollision(seg1, seg2) {\r\n\treturn seg1.bottom > seg2.top && seg1.top < seg2.bottom;\r\n}\r\n\r\n\r\n// A cmp function for determining which forward segment to rely on more when computing coordinates.\r\nfunction compareForwardSlotSegs(seg1, seg2) {\r\n\t// put higher-pressure first\r\n\treturn seg2.forwardPressure - seg1.forwardPressure ||\r\n\t\t// put segments that are closer to initial edge first (and favor ones with no coords yet)\r\n\t\t(seg1.backwardCoord || 0) - (seg2.backwardCoord || 0) ||\r\n\t\t// do normal sorting...\r\n\t\tcompareSegs(seg1, seg2);\r\n}\r\n\r\n;;\r\n\r\n/* An abstract class from which other views inherit from\r\n----------------------------------------------------------------------------------------------------------------------*/\r\n\r\nvar View = fc.View = Class.extend({\r\n\r\n\ttype: null, // subclass' view name (string)\r\n\tname: null, // deprecated. use `type` instead\r\n\ttitle: null, // the text that will be displayed in the header's title\r\n\r\n\tcalendar: null, // owner Calendar object\r\n\toptions: null, // hash containing all options. already merged with view-specific-options\r\n\tcoordMap: null, // a CoordMap object for converting pixel regions to dates\r\n\tel: null, // the view's containing element. set by Calendar\r\n\r\n\tisDisplayed: false,\r\n\tisSkeletonRendered: false,\r\n\tisEventsRendered: false,\r\n\r\n\t// range the view is actually displaying (moments)\r\n\tstart: null,\r\n\tend: null, // exclusive\r\n\r\n\t// range the view is formally responsible for (moments)\r\n\t// may be different from start/end. for example, a month view might have 1st-31st, excluding padded dates\r\n\tintervalStart: null,\r\n\tintervalEnd: null, // exclusive\r\n\tintervalDuration: null,\r\n\tintervalUnit: null, // name of largest unit being displayed, like \"month\" or \"week\"\r\n\r\n\tisSelected: false, // boolean whether a range of time is user-selected or not\r\n\r\n\t// subclasses can optionally use a scroll container\r\n\tscrollerEl: null, // the element that will most likely scroll when content is too tall\r\n\tscrollTop: null, // cached vertical scroll value\r\n\r\n\t// classNames styled by jqui themes\r\n\twidgetHeaderClass: null,\r\n\twidgetContentClass: null,\r\n\thighlightStateClass: null,\r\n\r\n\t// for date utils, computed from options\r\n\tnextDayThreshold: null,\r\n\tisHiddenDayHash: null,\r\n\r\n\t// document handlers, bound to `this` object\r\n\tdocumentMousedownProxy: null, // TODO: doesn't work with touch\r\n\r\n\r\n\tconstructor: function(calendar, type, options, intervalDuration) {\r\n\r\n\t\tthis.calendar = calendar;\r\n\t\tthis.type = this.name = type; // .name is deprecated\r\n\t\tthis.options = options;\r\n\t\tthis.intervalDuration = intervalDuration || moment.duration(1, 'day');\r\n\r\n\t\tthis.nextDayThreshold = moment.duration(this.opt('nextDayThreshold'));\r\n\t\tthis.initThemingProps();\r\n\t\tthis.initHiddenDays();\r\n\r\n\t\tthis.documentMousedownProxy = proxy(this, 'documentMousedown');\r\n\r\n\t\tthis.initialize();\r\n\t},\r\n\r\n\r\n\t// A good place for subclasses to initialize member variables\r\n\tinitialize: function() {\r\n\t\t// subclasses can implement\r\n\t},\r\n\r\n\r\n\t// Retrieves an option with the given name\r\n\topt: function(name) {\r\n\t\treturn this.options[name];\r\n\t},\r\n\r\n\r\n\t// Triggers handlers that are view-related. Modifies args before passing to calendar.\r\n\ttrigger: function(name, thisObj) { // arguments beyond thisObj are passed along\r\n\t\tvar calendar = this.calendar;\r\n\r\n\t\treturn calendar.trigger.apply(\r\n\t\t\tcalendar,\r\n\t\t\t[name, thisObj || this].concat(\r\n\t\t\t\tArray.prototype.slice.call(arguments, 2), // arguments beyond thisObj\r\n\t\t\t\t[ this ] // always make the last argument a reference to the view. TODO: deprecate\r\n\t\t\t)\r\n\t\t);\r\n\t},\r\n\r\n\r\n\t/* Dates\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Updates all internal dates to center around the given current date\r\n\tsetDate: function(date) {\r\n\t\tthis.setRange(this.computeRange(date));\r\n\t},\r\n\r\n\r\n\t// Updates all internal dates for displaying the given range.\r\n\t// Expects all values to be normalized (like what computeRange does).\r\n\tsetRange: function(range) {\r\n\t\t$.extend(this, range);\r\n\t\tthis.updateTitle();\r\n\t},\r\n\r\n\r\n\t// Given a single current date, produce information about what range to display.\r\n\t// Subclasses can override. Must return all properties.\r\n\tcomputeRange: function(date) {\r\n\t\tvar intervalUnit = computeIntervalUnit(this.intervalDuration);\r\n\t\tvar intervalStart = date.clone().startOf(intervalUnit);\r\n\t\tvar intervalEnd = intervalStart.clone().add(this.intervalDuration);\r\n\t\tvar start, end;\r\n\r\n\t\t// normalize the range's time-ambiguity\r\n\t\tif (/year|month|week|day/.test(intervalUnit)) { // whole-days?\r\n\t\t\tintervalStart.stripTime();\r\n\t\t\tintervalEnd.stripTime();\r\n\t\t}\r\n\t\telse { // needs to have a time?\r\n\t\t\tif (!intervalStart.hasTime()) {\r\n\t\t\t\tintervalStart = this.calendar.rezoneDate(intervalStart); // convert to current timezone, with 00:00\r\n\t\t\t}\r\n\t\t\tif (!intervalEnd.hasTime()) {\r\n\t\t\t\tintervalEnd = this.calendar.rezoneDate(intervalEnd); // convert to current timezone, with 00:00\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tstart = intervalStart.clone();\r\n\t\tstart = this.skipHiddenDays(start);\r\n\t\tend = intervalEnd.clone();\r\n\t\tend = this.skipHiddenDays(end, -1, true); // exclusively move backwards\r\n\r\n\t\treturn {\r\n\t\t\tintervalUnit: intervalUnit,\r\n\t\t\tintervalStart: intervalStart,\r\n\t\t\tintervalEnd: intervalEnd,\r\n\t\t\tstart: start,\r\n\t\t\tend: end\r\n\t\t};\r\n\t},\r\n\r\n\r\n\t// Computes the new date when the user hits the prev button, given the current date\r\n\tcomputePrevDate: function(date) {\r\n\t\treturn this.massageCurrentDate(\r\n\t\t\tdate.clone().startOf(this.intervalUnit).subtract(this.intervalDuration), -1\r\n\t\t);\r\n\t},\r\n\r\n\r\n\t// Computes the new date when the user hits the next button, given the current date\r\n\tcomputeNextDate: function(date) {\r\n\t\treturn this.massageCurrentDate(\r\n\t\t\tdate.clone().startOf(this.intervalUnit).add(this.intervalDuration)\r\n\t\t);\r\n\t},\r\n\r\n\r\n\t// Given an arbitrarily calculated current date of the calendar, returns a date that is ensured to be completely\r\n\t// visible. `direction` is optional and indicates which direction the current date was being\r\n\t// incremented or decremented (1 or -1).\r\n\tmassageCurrentDate: function(date, direction) {\r\n\t\tif (this.intervalDuration.as('days') <= 1) { // if the view displays a single day or smaller\r\n\t\t\tif (this.isHiddenDay(date)) {\r\n\t\t\t\tdate = this.skipHiddenDays(date, direction);\r\n\t\t\t\tdate.startOf('day');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn date;\r\n\t},\r\n\r\n\r\n\t/* Title and Date Formatting\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Sets the view's title property to the most updated computed value\r\n\tupdateTitle: function() {\r\n\t\tthis.title = this.computeTitle();\r\n\t},\r\n\r\n\r\n\t// Computes what the title at the top of the calendar should be for this view\r\n\tcomputeTitle: function() {\r\n\t\treturn this.formatRange(\r\n\t\t\t{ start: this.intervalStart, end: this.intervalEnd },\r\n\t\t\tthis.opt('titleFormat') || this.computeTitleFormat(),\r\n\t\t\tthis.opt('titleRangeSeparator')\r\n\t\t);\r\n\t},\r\n\r\n\r\n\t// Generates the format string that should be used to generate the title for the current date range.\r\n\t// Attempts to compute the most appropriate format if not explicitly specified with `titleFormat`.\r\n\tcomputeTitleFormat: function() {\r\n\t\tif (this.intervalUnit == 'year') {\r\n\t\t\treturn 'YYYY';\r\n\t\t}\r\n\t\telse if (this.intervalUnit == 'month') {\r\n\t\t\treturn this.opt('monthYearFormat'); // like \"September 2014\"\r\n\t\t}\r\n\t\telse if (this.intervalDuration.as('days') > 1) {\r\n\t\t\treturn 'll'; // multi-day range. shorter, like \"Sep 9 - 10 2014\"\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn 'LL'; // one day. longer, like \"September 9 2014\"\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Utility for formatting a range. Accepts a range object, formatting string, and optional separator.\r\n\t// Displays all-day ranges naturally, with an inclusive end. Takes the current isRTL into account.\r\n\tformatRange: function(range, formatStr, separator) {\r\n\t\tvar end = range.end;\r\n\r\n\t\tif (!end.hasTime()) { // all-day?\r\n\t\t\tend = end.clone().subtract(1); // convert to inclusive. last ms of previous day\r\n\t\t}\r\n\r\n\t\treturn formatRange(range.start, end, formatStr, separator, this.opt('isRTL'));\r\n\t},\r\n\r\n\r\n\t/* Rendering\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Sets the container element that the view should render inside of.\r\n\t// Does other DOM-related initializations.\r\n\tsetElement: function(el) {\r\n\t\tthis.el = el;\r\n\t\tthis.bindGlobalHandlers();\r\n\t},\r\n\r\n\r\n\t// Removes the view's container element from the DOM, clearing any content beforehand.\r\n\t// Undoes any other DOM-related attachments.\r\n\tremoveElement: function() {\r\n\t\tthis.clear(); // clears all content\r\n\r\n\t\t// clean up the skeleton\r\n\t\tif (this.isSkeletonRendered) {\r\n\t\t\tthis.destroySkeleton();\r\n\t\t\tthis.isSkeletonRendered = false;\r\n\t\t}\r\n\r\n\t\tthis.unbindGlobalHandlers();\r\n\r\n\t\tthis.el.remove();\r\n\r\n\t\t// NOTE: don't null-out this.el in case the View was destroyed within an API callback.\r\n\t\t// We don't null-out the View's other jQuery element references upon destroy, so why should we kill this.el?\r\n\t},\r\n\r\n\r\n\t// Does everything necessary to display the view centered around the given date.\r\n\t// Does every type of rendering EXCEPT rendering events.\r\n\tdisplay: function(date) {\r\n\t\tvar scrollState = null;\r\n\r\n\t\tif (this.isDisplayed) {\r\n\t\t\tscrollState = this.queryScroll();\r\n\t\t}\r\n\r\n\t\tthis.clear(); // clear the old content\r\n\t\tthis.setDate(date);\r\n\t\tthis.render();\r\n\t\tthis.updateSize();\r\n\t\tthis.renderBusinessHours(); // might need coordinates, so should go after updateSize()\r\n\t\tthis.isDisplayed = true;\r\n\r\n\t\tscrollState = this.computeInitialScroll(scrollState);\r\n\t\tthis.forceScroll(scrollState);\r\n\r\n\t\tthis.triggerRender();\r\n\t},\r\n\r\n\r\n\t// Does everything necessary to clear the content of the view.\r\n\t// Clears dates and events. Does not clear the skeleton.\r\n\tclear: function() { // clears the view of *content* but not the skeleton\r\n\t\tif (this.isDisplayed) {\r\n\t\t\tthis.unselect();\r\n\t\t\tthis.clearEvents();\r\n\t\t\tthis.triggerDestroy();\r\n\t\t\tthis.destroyBusinessHours();\r\n\t\t\tthis.destroy();\r\n\t\t\tthis.isDisplayed = false;\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Renders the view's date-related content, rendering the view's non-content skeleton if necessary\r\n\trender: function() {\r\n\t\tif (!this.isSkeletonRendered) {\r\n\t\t\tthis.renderSkeleton();\r\n\t\t\tthis.isSkeletonRendered = true;\r\n\t\t}\r\n\t\tthis.renderDates();\r\n\t},\r\n\r\n\r\n\t// Unrenders the view's date-related content.\r\n\t// Call this instead of destroyDates directly in case the View subclass wants to use a render/destroy pattern\r\n\t// where both the skeleton and the content always get rendered/unrendered together.\r\n\tdestroy: function() {\r\n\t\tthis.destroyDates();\r\n\t},\r\n\r\n\r\n\t// Renders the basic structure of the view before any content is rendered\r\n\trenderSkeleton: function() {\r\n\t\t// subclasses should implement\r\n\t},\r\n\r\n\r\n\t// Unrenders the basic structure of the view\r\n\tdestroySkeleton: function() {\r\n\t\t// subclasses should implement\r\n\t},\r\n\r\n\r\n\t// Renders the view's date-related content (like cells that represent days/times).\r\n\t// Assumes setRange has already been called and the skeleton has already been rendered.\r\n\trenderDates: function() {\r\n\t\t// subclasses should implement\r\n\t},\r\n\r\n\r\n\t// Unrenders the view's date-related content\r\n\tdestroyDates: function() {\r\n\t\t// subclasses should override\r\n\t},\r\n\r\n\r\n\t// Renders business-hours onto the view. Assumes updateSize has already been called.\r\n\trenderBusinessHours: function() {\r\n\t\t// subclasses should implement\r\n\t},\r\n\r\n\r\n\t// Unrenders previously-rendered business-hours\r\n\tdestroyBusinessHours: function() {\r\n\t\t// subclasses should implement\r\n\t},\r\n\r\n\r\n\t// Signals that the view's content has been rendered\r\n\ttriggerRender: function() {\r\n\t\tthis.trigger('viewRender', this, this, this.el);\r\n\t},\r\n\r\n\r\n\t// Signals that the view's content is about to be unrendered\r\n\ttriggerDestroy: function() {\r\n\t\tthis.trigger('viewDestroy', this, this, this.el);\r\n\t},\r\n\r\n\r\n\t// Binds DOM handlers to elements that reside outside the view container, such as the document\r\n\tbindGlobalHandlers: function() {\r\n\t\t$(document).on('mousedown', this.documentMousedownProxy);\r\n\t},\r\n\r\n\r\n\t// Unbinds DOM handlers from elements that reside outside the view container\r\n\tunbindGlobalHandlers: function() {\r\n\t\t$(document).off('mousedown', this.documentMousedownProxy);\r\n\t},\r\n\r\n\r\n\t// Initializes internal variables related to theming\r\n\tinitThemingProps: function() {\r\n\t\tvar tm = this.opt('theme') ? 'ui' : 'fc';\r\n\r\n\t\tthis.widgetHeaderClass = tm + '-widget-header';\r\n\t\tthis.widgetContentClass = tm + '-widget-content';\r\n\t\tthis.highlightStateClass = tm + '-state-highlight';\r\n\t},\r\n\r\n\r\n\t/* Dimensions\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Refreshes anything dependant upon sizing of the container element of the grid\r\n\tupdateSize: function(isResize) {\r\n\t\tvar scrollState;\r\n\r\n\t\tif (isResize) {\r\n\t\t\tscrollState = this.queryScroll();\r\n\t\t}\r\n\r\n\t\tthis.updateHeight();\r\n\t\tthis.updateWidth();\r\n\r\n\t\tif (isResize) {\r\n\t\t\tthis.setScroll(scrollState);\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Refreshes the horizontal dimensions of the calendar\r\n\tupdateWidth: function() {\r\n\t\t// subclasses should implement\r\n\t},\r\n\r\n\r\n\t// Refreshes the vertical dimensions of the calendar\r\n\tupdateHeight: function() {\r\n\t\tvar calendar = this.calendar; // we poll the calendar for height information\r\n\r\n\t\tthis.setHeight(\r\n\t\t\tcalendar.getSuggestedViewHeight(),\r\n\t\t\tcalendar.isHeightAuto()\r\n\t\t);\r\n\t},\r\n\r\n\r\n\t// Updates the vertical dimensions of the calendar to the specified height.\r\n\t// if `isAuto` is set to true, height becomes merely a suggestion and the view should use its \"natural\" height.\r\n\tsetHeight: function(height, isAuto) {\r\n\t\t// subclasses should implement\r\n\t},\r\n\r\n\r\n\t/* Scroller\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Given the total height of the view, return the number of pixels that should be used for the scroller.\r\n\t// Utility for subclasses.\r\n\tcomputeScrollerHeight: function(totalHeight) {\r\n\t\tvar scrollerEl = this.scrollerEl;\r\n\t\tvar both;\r\n\t\tvar otherHeight; // cumulative height of everything that is not the scrollerEl in the view (header+borders)\r\n\r\n\t\tboth = this.el.add(scrollerEl);\r\n\r\n\t\t// fuckin IE8/9/10/11 sometimes returns 0 for dimensions. this weird hack was the only thing that worked\r\n\t\tboth.css({\r\n\t\t\tposition: 'relative', // cause a reflow, which will force fresh dimension recalculation\r\n\t\t\tleft: -1 // ensure reflow in case the el was already relative. negative is less likely to cause new scroll\r\n\t\t});\r\n\t\totherHeight = this.el.outerHeight() - scrollerEl.height(); // grab the dimensions\r\n\t\tboth.css({ position: '', left: '' }); // undo hack\r\n\r\n\t\treturn totalHeight - otherHeight;\r\n\t},\r\n\r\n\r\n\t// Computes the initial pre-configured scroll state prior to allowing the user to change it.\r\n\t// Given the scroll state from the previous rendering. If first time rendering, given null.\r\n\tcomputeInitialScroll: function(previousScrollState) {\r\n\t\treturn 0;\r\n\t},\r\n\r\n\r\n\t// Retrieves the view's current natural scroll state. Can return an arbitrary format.\r\n\tqueryScroll: function() {\r\n\t\tif (this.scrollerEl) {\r\n\t\t\treturn this.scrollerEl.scrollTop(); // operates on scrollerEl by default\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Sets the view's scroll state. Will accept the same format computeInitialScroll and queryScroll produce.\r\n\tsetScroll: function(scrollState) {\r\n\t\tif (this.scrollerEl) {\r\n\t\t\treturn this.scrollerEl.scrollTop(scrollState); // operates on scrollerEl by default\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Sets the scroll state, making sure to overcome any predefined scroll value the browser has in mind\r\n\tforceScroll: function(scrollState) {\r\n\t\tvar _this = this;\r\n\r\n\t\tthis.setScroll(scrollState);\r\n\t\tsetTimeout(function() {\r\n\t\t\t_this.setScroll(scrollState);\r\n\t\t}, 0);\r\n\t},\r\n\r\n\r\n\t/* Event Elements / Segments\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Does everything necessary to display the given events onto the current view\r\n\tdisplayEvents: function(events) {\r\n\t\tvar scrollState = this.queryScroll();\r\n\r\n\t\tthis.clearEvents();\r\n\t\tthis.renderEvents(events);\r\n\t\tthis.isEventsRendered = true;\r\n\t\tthis.setScroll(scrollState);\r\n\t\tthis.triggerEventRender();\r\n\t},\r\n\r\n\r\n\t// Does everything necessary to clear the view's currently-rendered events\r\n\tclearEvents: function() {\r\n\t\tif (this.isEventsRendered) {\r\n\t\t\tthis.triggerEventDestroy();\r\n\t\t\tthis.destroyEvents();\r\n\t\t\tthis.isEventsRendered = false;\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Renders the events onto the view.\r\n\trenderEvents: function(events) {\r\n\t\t// subclasses should implement\r\n\t},\r\n\r\n\r\n\t// Removes event elements from the view.\r\n\tdestroyEvents: function() {\r\n\t\t// subclasses should implement\r\n\t},\r\n\r\n\r\n\t// Signals that all events have been rendered\r\n\ttriggerEventRender: function() {\r\n\t\tthis.renderedEventSegEach(function(seg) {\r\n\t\t\tthis.trigger('eventAfterRender', seg.event, seg.event, seg.el);\r\n\t\t});\r\n\t\tthis.trigger('eventAfterAllRender');\r\n\t},\r\n\r\n\r\n\t// Signals that all event elements are about to be removed\r\n\ttriggerEventDestroy: function() {\r\n\t\tthis.renderedEventSegEach(function(seg) {\r\n\t\t\tthis.trigger('eventDestroy', seg.event, seg.event, seg.el);\r\n\t\t});\r\n\t},\r\n\r\n\r\n\t// Given an event and the default element used for rendering, returns the element that should actually be used.\r\n\t// Basically runs events and elements through the eventRender hook.\r\n\tresolveEventEl: function(event, el) {\r\n\t\tvar custom = this.trigger('eventRender', event, event, el);\r\n\r\n\t\tif (custom === false) { // means don't render at all\r\n\t\t\tel = null;\r\n\t\t}\r\n\t\telse if (custom && custom !== true) {\r\n\t\t\tel = $(custom);\r\n\t\t}\r\n\r\n\t\treturn el;\r\n\t},\r\n\r\n\r\n\t// Hides all rendered event segments linked to the given event\r\n\tshowEvent: function(event) {\r\n\t\tthis.renderedEventSegEach(function(seg) {\r\n\t\t\tseg.el.css('visibility', '');\r\n\t\t}, event);\r\n\t},\r\n\r\n\r\n\t// Shows all rendered event segments linked to the given event\r\n\thideEvent: function(event) {\r\n\t\tthis.renderedEventSegEach(function(seg) {\r\n\t\t\tseg.el.css('visibility', 'hidden');\r\n\t\t}, event);\r\n\t},\r\n\r\n\r\n\t// Iterates through event segments that have been rendered (have an el). Goes through all by default.\r\n\t// If the optional `event` argument is specified, only iterates through segments linked to that event.\r\n\t// The `this` value of the callback function will be the view.\r\n\trenderedEventSegEach: function(func, event) {\r\n\t\tvar segs = this.getEventSegs();\r\n\t\tvar i;\r\n\r\n\t\tfor (i = 0; i < segs.length; i++) {\r\n\t\t\tif (!event || segs[i].event._id === event._id) {\r\n\t\t\t\tif (segs[i].el) {\r\n\t\t\t\t\tfunc.call(this, segs[i]);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Retrieves all the rendered segment objects for the view\r\n\tgetEventSegs: function() {\r\n\t\t// subclasses must implement\r\n\t\treturn [];\r\n\t},\r\n\r\n\r\n\t/* Event Drag-n-Drop\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Computes if the given event is allowed to be dragged by the user\r\n\tisEventDraggable: function(event) {\r\n\t\tvar source = event.source || {};\r\n\r\n\t\treturn firstDefined(\r\n\t\t\tevent.startEditable,\r\n\t\t\tsource.startEditable,\r\n\t\t\tthis.opt('eventStartEditable'),\r\n\t\t\tevent.editable,\r\n\t\t\tsource.editable,\r\n\t\t\tthis.opt('editable')\r\n\t\t);\r\n\t},\r\n\r\n\r\n\t// Must be called when an event in the view is dropped onto new location.\r\n\t// `dropLocation` is an object that contains the new start/end/allDay values for the event.\r\n\treportEventDrop: function(event, dropLocation, largeUnit, el, ev) {\r\n\t\tvar calendar = this.calendar;\r\n\t\tvar mutateResult = calendar.mutateEvent(event, dropLocation, largeUnit);\r\n\t\tvar undoFunc = function() {\r\n\t\t\tmutateResult.undo();\r\n\t\t\tcalendar.reportEventChange();\r\n\t\t};\r\n\r\n\t\tthis.triggerEventDrop(event, mutateResult.dateDelta, undoFunc, el, ev);\r\n\t\tcalendar.reportEventChange(); // will rerender events\r\n\t},\r\n\r\n\r\n\t// Triggers event-drop handlers that have subscribed via the API\r\n\ttriggerEventDrop: function(event, dateDelta, undoFunc, el, ev) {\r\n\t\tthis.trigger('eventDrop', el[0], event, dateDelta, undoFunc, ev, {}); // {} = jqui dummy\r\n\t},\r\n\r\n\r\n\t/* External Element Drag-n-Drop\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Must be called when an external element, via jQuery UI, has been dropped onto the calendar.\r\n\t// `meta` is the parsed data that has been embedded into the dragging event.\r\n\t// `dropLocation` is an object that contains the new start/end/allDay values for the event.\r\n\treportExternalDrop: function(meta, dropLocation, el, ev, ui) {\r\n\t\tvar eventProps = meta.eventProps;\r\n\t\tvar eventInput;\r\n\t\tvar event;\r\n\r\n\t\t// Try to build an event object and render it. TODO: decouple the two\r\n\t\tif (eventProps) {\r\n\t\t\teventInput = $.extend({}, eventProps, dropLocation);\r\n\t\t\tevent = this.calendar.renderEvent(eventInput, meta.stick)[0]; // renderEvent returns an array\r\n\t\t}\r\n\r\n\t\tthis.triggerExternalDrop(event, dropLocation, el, ev, ui);\r\n\t},\r\n\r\n\r\n\t// Triggers external-drop handlers that have subscribed via the API\r\n\ttriggerExternalDrop: function(event, dropLocation, el, ev, ui) {\r\n\r\n\t\t// trigger 'drop' regardless of whether element represents an event\r\n\t\tthis.trigger('drop', el[0], dropLocation.start, ev, ui);\r\n\r\n\t\tif (event) {\r\n\t\t\tthis.trigger('eventReceive', null, event); // signal an external event landed\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t/* Drag-n-Drop Rendering (for both events and external elements)\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Renders a visual indication of a event or external-element drag over the given drop zone.\r\n\t// If an external-element, seg will be `null`\r\n\trenderDrag: function(dropLocation, seg) {\r\n\t\t// subclasses must implement\r\n\t},\r\n\r\n\r\n\t// Unrenders a visual indication of an event or external-element being dragged.\r\n\tdestroyDrag: function() {\r\n\t\t// subclasses must implement\r\n\t},\r\n\r\n\r\n\t/* Event Resizing\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Computes if the given event is allowed to be resized from its starting edge\r\n\tisEventResizableFromStart: function(event) {\r\n\t\treturn this.opt('eventResizableFromStart') && this.isEventResizable(event);\r\n\t},\r\n\r\n\r\n\t// Computes if the given event is allowed to be resized from its ending edge\r\n\tisEventResizableFromEnd: function(event) {\r\n\t\treturn this.isEventResizable(event);\r\n\t},\r\n\r\n\r\n\t// Computes if the given event is allowed to be resized by the user at all\r\n\tisEventResizable: function(event) {\r\n\t\tvar source = event.source || {};\r\n\r\n\t\treturn firstDefined(\r\n\t\t\tevent.durationEditable,\r\n\t\t\tsource.durationEditable,\r\n\t\t\tthis.opt('eventDurationEditable'),\r\n\t\t\tevent.editable,\r\n\t\t\tsource.editable,\r\n\t\t\tthis.opt('editable')\r\n\t\t);\r\n\t},\r\n\r\n\r\n\t// Must be called when an event in the view has been resized to a new length\r\n\treportEventResize: function(event, resizeLocation, largeUnit, el, ev) {\r\n\t\tvar calendar = this.calendar;\r\n\t\tvar mutateResult = calendar.mutateEvent(event, resizeLocation, largeUnit);\r\n\t\tvar undoFunc = function() {\r\n\t\t\tmutateResult.undo();\r\n\t\t\tcalendar.reportEventChange();\r\n\t\t};\r\n\r\n\t\tthis.triggerEventResize(event, mutateResult.durationDelta, undoFunc, el, ev);\r\n\t\tcalendar.reportEventChange(); // will rerender events\r\n\t},\r\n\r\n\r\n\t// Triggers event-resize handlers that have subscribed via the API\r\n\ttriggerEventResize: function(event, durationDelta, undoFunc, el, ev) {\r\n\t\tthis.trigger('eventResize', el[0], event, durationDelta, undoFunc, ev, {}); // {} = jqui dummy\r\n\t},\r\n\r\n\r\n\t/* Selection\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Selects a date range on the view. `start` and `end` are both Moments.\r\n\t// `ev` is the native mouse event that begin the interaction.\r\n\tselect: function(range, ev) {\r\n\t\tthis.unselect(ev);\r\n\t\tthis.renderSelection(range);\r\n\t\tthis.reportSelection(range, ev);\r\n\t},\r\n\r\n\r\n\t// Renders a visual indication of the selection\r\n\trenderSelection: function(range) {\r\n\t\t// subclasses should implement\r\n\t},\r\n\r\n\r\n\t// Called when a new selection is made. Updates internal state and triggers handlers.\r\n\treportSelection: function(range, ev) {\r\n\t\tthis.isSelected = true;\r\n\t\tthis.trigger('select', null, range.start, range.end, ev);\r\n\t},\r\n\r\n\r\n\t// Undoes a selection. updates in the internal state and triggers handlers.\r\n\t// `ev` is the native mouse event that began the interaction.\r\n\tunselect: function(ev) {\r\n\t\tif (this.isSelected) {\r\n\t\t\tthis.isSelected = false;\r\n\t\t\tthis.destroySelection();\r\n\t\t\tthis.trigger('unselect', null, ev);\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Unrenders a visual indication of selection\r\n\tdestroySelection: function() {\r\n\t\t// subclasses should implement\r\n\t},\r\n\r\n\r\n\t// Handler for unselecting when the user clicks something and the 'unselectAuto' setting is on\r\n\tdocumentMousedown: function(ev) {\r\n\t\tvar ignore;\r\n\r\n\t\t// is there a selection, and has the user made a proper left click?\r\n\t\tif (this.isSelected && this.opt('unselectAuto') && isPrimaryMouseButton(ev)) {\r\n\r\n\t\t\t// only unselect if the clicked element is not identical to or inside of an 'unselectCancel' element\r\n\t\t\tignore = this.opt('unselectCancel');\r\n\t\t\tif (!ignore || !$(ev.target).closest(ignore).length) {\r\n\t\t\t\tthis.unselect(ev);\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t/* Date Utils\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Initializes internal variables related to calculating hidden days-of-week\r\n\tinitHiddenDays: function() {\r\n\t\tvar hiddenDays = this.opt('hiddenDays') || []; // array of day-of-week indices that are hidden\r\n\t\tvar isHiddenDayHash = []; // is the day-of-week hidden? (hash with day-of-week-index -> bool)\r\n\t\tvar dayCnt = 0;\r\n\t\tvar i;\r\n\r\n\t\tif (this.opt('weekends') === false) {\r\n\t\t\thiddenDays.push(0, 6); // 0=sunday, 6=saturday\r\n\t\t}\r\n\r\n\t\tfor (i = 0; i < 7; i++) {\r\n\t\t\tif (\r\n\t\t\t\t!(isHiddenDayHash[i] = $.inArray(i, hiddenDays) !== -1)\r\n\t\t\t) {\r\n\t\t\t\tdayCnt++;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!dayCnt) {\r\n\t\t\tthrow 'invalid hiddenDays'; // all days were hidden? bad.\r\n\t\t}\r\n\r\n\t\tthis.isHiddenDayHash = isHiddenDayHash;\r\n\t},\r\n\r\n\r\n\t// Is the current day hidden?\r\n\t// `day` is a day-of-week index (0-6), or a Moment\r\n\tisHiddenDay: function(day) {\r\n\t\tif (moment.isMoment(day)) {\r\n\t\t\tday = day.day();\r\n\t\t}\r\n\t\treturn this.isHiddenDayHash[day];\r\n\t},\r\n\r\n\r\n\t// Incrementing the current day until it is no longer a hidden day, returning a copy.\r\n\t// If the initial value of `date` is not a hidden day, don't do anything.\r\n\t// Pass `isExclusive` as `true` if you are dealing with an end date.\r\n\t// `inc` defaults to `1` (increment one day forward each time)\r\n\tskipHiddenDays: function(date, inc, isExclusive) {\r\n\t\tvar out = date.clone();\r\n\t\tinc = inc || 1;\r\n\t\twhile (\r\n\t\t\tthis.isHiddenDayHash[(out.day() + (isExclusive ? inc : 0) + 7) % 7]\r\n\t\t) {\r\n\t\t\tout.add(inc, 'days');\r\n\t\t}\r\n\t\treturn out;\r\n\t},\r\n\r\n\r\n\t// Returns the date range of the full days the given range visually appears to occupy.\r\n\t// Returns a new range object.\r\n\tcomputeDayRange: function(range) {\r\n\t\tvar startDay = range.start.clone().stripTime(); // the beginning of the day the range starts\r\n\t\tvar end = range.end;\r\n\t\tvar endDay = null;\r\n\t\tvar endTimeMS;\r\n\r\n\t\tif (end) {\r\n\t\t\tendDay = end.clone().stripTime(); // the beginning of the day the range exclusively ends\r\n\t\t\tendTimeMS = +end.time(); // # of milliseconds into `endDay`\r\n\r\n\t\t\t// If the end time is actually inclusively part of the next day and is equal to or\r\n\t\t\t// beyond the next day threshold, adjust the end to be the exclusive end of `endDay`.\r\n\t\t\t// Otherwise, leaving it as inclusive will cause it to exclude `endDay`.\r\n\t\t\tif (endTimeMS && endTimeMS >= this.nextDayThreshold) {\r\n\t\t\t\tendDay.add(1, 'days');\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// If no end was specified, or if it is within `startDay` but not past nextDayThreshold,\r\n\t\t// assign the default duration of one day.\r\n\t\tif (!end || endDay <= startDay) {\r\n\t\t\tendDay = startDay.clone().add(1, 'days');\r\n\t\t}\r\n\r\n\t\treturn { start: startDay, end: endDay };\r\n\t},\r\n\r\n\r\n\t// Does the given event visually appear to occupy more than one day?\r\n\tisMultiDayEvent: function(event) {\r\n\t\tvar range = this.computeDayRange(event); // event is range-ish\r\n\r\n\t\treturn range.end.diff(range.start, 'days') > 1;\r\n\t}\r\n\r\n});\r\n\r\n;;\r\n\r\nvar Calendar = fc.Calendar = fc.CalendarBase = Class.extend({\r\n\r\n\tdirDefaults: null, // option defaults related to LTR or RTL\r\n\tlangDefaults: null, // option defaults related to current locale\r\n\toverrides: null, // option overrides given to the fullCalendar constructor\r\n\toptions: null, // all defaults combined with overrides\r\n\tviewSpecCache: null, // cache of view definitions\r\n\tview: null, // current View object\r\n\theader: null,\r\n\r\n\r\n\t// a lot of this class' OOP logic is scoped within this constructor function,\r\n\t// but in the future, write individual methods on the prototype.\r\n\tconstructor: Calendar_constructor,\r\n\r\n\r\n\t// Initializes `this.options` and other important options-related objects\r\n\tinitOptions: function(overrides) {\r\n\t\tvar lang, langDefaults;\r\n\t\tvar isRTL, dirDefaults;\r\n\r\n\t\t// converts legacy options into non-legacy ones.\r\n\t\t// in the future, when this is removed, don't use `overrides` reference. make a copy.\r\n\t\toverrides = massageOverrides(overrides);\r\n\r\n\t\tlang = overrides.lang;\r\n\t\tlangDefaults = langOptionHash[lang];\r\n\t\tif (!langDefaults) {\r\n\t\t\tlang = Calendar.defaults.lang;\r\n\t\t\tlangDefaults = langOptionHash[lang] || {};\r\n\t\t}\r\n\r\n\t\tisRTL = firstDefined(\r\n\t\t\toverrides.isRTL,\r\n\t\t\tlangDefaults.isRTL,\r\n\t\t\tCalendar.defaults.isRTL\r\n\t\t);\r\n\t\tdirDefaults = isRTL ? Calendar.rtlDefaults : {};\r\n\r\n\t\tthis.dirDefaults = dirDefaults;\r\n\t\tthis.langDefaults = langDefaults;\r\n\t\tthis.overrides = overrides;\r\n\t\tthis.options = mergeOptions( // merge defaults and overrides. lowest to highest precedence\r\n\t\t\tCalendar.defaults, // global defaults\r\n\t\t\tdirDefaults,\r\n\t\t\tlangDefaults,\r\n\t\t\toverrides\r\n\t\t);\r\n\t\tpopulateInstanceComputableOptions(this.options);\r\n\r\n\t\tthis.viewSpecCache = {}; // somewhat unrelated\r\n\t},\r\n\r\n\r\n\t// Gets information about how to create a view. Will use a cache.\r\n\tgetViewSpec: function(viewType) {\r\n\t\tvar cache = this.viewSpecCache;\r\n\r\n\t\treturn cache[viewType] || (cache[viewType] = this.buildViewSpec(viewType));\r\n\t},\r\n\r\n\r\n\t// Given a duration singular unit, like \"week\" or \"day\", finds a matching view spec.\r\n\t// Preference is given to views that have corresponding buttons.\r\n\tgetUnitViewSpec: function(unit) {\r\n\t\tvar viewTypes;\r\n\t\tvar i;\r\n\t\tvar spec;\r\n\r\n\t\tif ($.inArray(unit, intervalUnits) != -1) {\r\n\r\n\t\t\t// put views that have buttons first. there will be duplicates, but oh well\r\n\t\t\tviewTypes = this.header.getViewsWithButtons();\r\n\t\t\t$.each(fc.views, function(viewType) { // all views\r\n\t\t\t\tviewTypes.push(viewType);\r\n\t\t\t});\r\n\r\n\t\t\tfor (i = 0; i < viewTypes.length; i++) {\r\n\t\t\t\tspec = this.getViewSpec(viewTypes[i]);\r\n\t\t\t\tif (spec) {\r\n\t\t\t\t\tif (spec.singleUnit == unit) {\r\n\t\t\t\t\t\treturn spec;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Builds an object with information on how to create a given view\r\n\tbuildViewSpec: function(requestedViewType) {\r\n\t\tvar viewOverrides = this.overrides.views || {};\r\n\t\tvar defaultsChain = []; // for the view. lowest to highest priority\r\n\t\tvar overridesChain = []; // for the view. lowest to highest priority\r\n\t\tvar viewType = requestedViewType;\r\n\t\tvar viewClass;\r\n\t\tvar defaults; // for the view\r\n\t\tvar overrides; // for the view\r\n\t\tvar duration;\r\n\t\tvar unit;\r\n\t\tvar spec;\r\n\r\n\t\t// iterate from the specific view definition to a more general one until we hit an actual View class\r\n\t\twhile (viewType && !viewClass) {\r\n\t\t\tdefaults = fcViews[viewType] || {};\r\n\t\t\toverrides = viewOverrides[viewType] || {};\r\n\t\t\tduration = duration || overrides.duration || defaults.duration;\r\n\t\t\tviewType = overrides.type || defaults.type; // for next iteration\r\n\r\n\t\t\tif (typeof defaults === 'function') { // a class\r\n\t\t\t\tviewClass = defaults;\r\n\t\t\t\tdefaultsChain.unshift(viewClass.defaults || {});\r\n\t\t\t}\r\n\t\t\telse { // an options object\r\n\t\t\t\tdefaultsChain.unshift(defaults);\r\n\t\t\t}\r\n\t\t\toverridesChain.unshift(overrides);\r\n\t\t}\r\n\r\n\t\tif (viewClass) {\r\n\t\t\tspec = { 'class': viewClass, type: requestedViewType };\r\n\r\n\t\t\tif (duration) {\r\n\t\t\t\tduration = moment.duration(duration);\r\n\t\t\t\tif (!duration.valueOf()) { // invalid?\r\n\t\t\t\t\tduration = null;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tif (duration) {\r\n\t\t\t\tspec.duration = duration;\r\n\t\t\t\tunit = computeIntervalUnit(duration);\r\n\r\n\t\t\t\t// view is a single-unit duration, like \"week\" or \"day\"\r\n\t\t\t\t// incorporate options for this. lowest priority\r\n\t\t\t\tif (duration.as(unit) === 1) {\r\n\t\t\t\t\tspec.singleUnit = unit;\r\n\t\t\t\t\toverridesChain.unshift(viewOverrides[unit] || {});\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// collapse into single objects\r\n\t\t\tspec.defaults = mergeOptions.apply(null, defaultsChain);\r\n\t\t\tspec.overrides = mergeOptions.apply(null, overridesChain);\r\n\r\n\t\t\tthis.buildViewSpecOptions(spec);\r\n\t\t\tthis.buildViewSpecButtonText(spec, requestedViewType);\r\n\r\n\t\t\treturn spec;\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Builds and assigns a view spec's options object from its already-assigned defaults and overrides\r\n\tbuildViewSpecOptions: function(spec) {\r\n\t\tspec.options = mergeOptions( // lowest to highest priority\r\n\t\t\tCalendar.defaults, // global defaults\r\n\t\t\tspec.defaults, // view's defaults (from ViewSubclass.defaults)\r\n\t\t\tthis.dirDefaults,\r\n\t\t\tthis.langDefaults, // locale and dir take precedence over view's defaults!\r\n\t\t\tthis.overrides, // calendar's overrides (options given to constructor)\r\n\t\t\tspec.overrides // view's overrides (view-specific options)\r\n\t\t);\r\n\t\tpopulateInstanceComputableOptions(spec.options);\r\n\t},\r\n\r\n\r\n\t// Computes and assigns a view spec's buttonText-related options\r\n\tbuildViewSpecButtonText: function(spec, requestedViewType) {\r\n\r\n\t\t// given an options object with a possible `buttonText` hash, lookup the buttonText for the\r\n\t\t// requested view, falling back to a generic unit entry like \"week\" or \"day\"\r\n\t\tfunction queryButtonText(options) {\r\n\t\t\tvar buttonText = options.buttonText || {};\r\n\t\t\treturn buttonText[requestedViewType] ||\r\n\t\t\t\t(spec.singleUnit ? buttonText[spec.singleUnit] : null);\r\n\t\t}\r\n\r\n\t\t// highest to lowest priority\r\n\t\tspec.buttonTextOverride =\r\n\t\t\tqueryButtonText(this.overrides) || // constructor-specified buttonText lookup hash takes precedence\r\n\t\t\tspec.overrides.buttonText; // `buttonText` for view-specific options is a string\r\n\r\n\t\t// highest to lowest priority. mirrors buildViewSpecOptions\r\n\t\tspec.buttonTextDefault =\r\n\t\t\tqueryButtonText(this.langDefaults) ||\r\n\t\t\tqueryButtonText(this.dirDefaults) ||\r\n\t\t\tspec.defaults.buttonText || // a single string. from ViewSubclass.defaults\r\n\t\t\tqueryButtonText(Calendar.defaults) ||\r\n\t\t\t(spec.duration ? this.humanizeDuration(spec.duration) : null) || // like \"3 days\"\r\n\t\t\trequestedViewType; // fall back to given view name\r\n\t},\r\n\r\n\r\n\t// Given a view name for a custom view or a standard view, creates a ready-to-go View object\r\n\tinstantiateView: function(viewType) {\r\n\t\tvar spec = this.getViewSpec(viewType);\r\n\r\n\t\treturn new spec['class'](this, viewType, spec.options, spec.duration);\r\n\t},\r\n\r\n\r\n\t// Returns a boolean about whether the view is okay to instantiate at some point\r\n\tisValidViewType: function(viewType) {\r\n\t\treturn Boolean(this.getViewSpec(viewType));\r\n\t}\r\n\r\n});\r\n\r\n\r\nfunction Calendar_constructor(element, overrides) {\r\n\tvar t = this;\r\n\r\n\r\n\tt.initOptions(overrides || {});\r\n\tvar options = this.options;\r\n\r\n\t\r\n\t// Exports\r\n\t// -----------------------------------------------------------------------------------\r\n\r\n\tt.render = render;\r\n\tt.destroy = destroy;\r\n\tt.refetchEvents = refetchEvents;\r\n\tt.reportEvents = reportEvents;\r\n\tt.reportEventChange = reportEventChange;\r\n\tt.rerenderEvents = renderEvents; // `renderEvents` serves as a rerender. an API method\r\n\tt.changeView = renderView; // `renderView` will switch to another view\r\n\tt.select = select;\r\n\tt.unselect = unselect;\r\n\tt.prev = prev;\r\n\tt.next = next;\r\n\tt.prevYear = prevYear;\r\n\tt.nextYear = nextYear;\r\n\tt.today = today;\r\n\tt.gotoDate = gotoDate;\r\n\tt.incrementDate = incrementDate;\r\n\tt.zoomTo = zoomTo;\r\n\tt.getDate = getDate;\r\n\tt.getCalendar = getCalendar;\r\n\tt.getView = getView;\r\n\tt.option = option;\r\n\tt.trigger = trigger;\r\n\r\n\r\n\r\n\t// Language-data Internals\r\n\t// -----------------------------------------------------------------------------------\r\n\t// Apply overrides to the current language's data\r\n\r\n\r\n\tvar localeData = createObject( // make a cheap copy\r\n\t\tgetMomentLocaleData(options.lang) // will fall back to en\r\n\t);\r\n\r\n\tif (options.monthNames) {\r\n\t\tlocaleData._months = options.monthNames;\r\n\t}\r\n\tif (options.monthNamesShort) {\r\n\t\tlocaleData._monthsShort = options.monthNamesShort;\r\n\t}\r\n\tif (options.dayNames) {\r\n\t\tlocaleData._weekdays = options.dayNames;\r\n\t}\r\n\tif (options.dayNamesShort) {\r\n\t\tlocaleData._weekdaysShort = options.dayNamesShort;\r\n\t}\r\n\tif (options.firstDay != null) {\r\n\t\tvar _week = createObject(localeData._week); // _week: { dow: # }\r\n\t\t_week.dow = options.firstDay;\r\n\t\tlocaleData._week = _week;\r\n\t}\r\n\r\n\t// assign a normalized value, to be used by our .week() moment extension\r\n\tlocaleData._fullCalendar_weekCalc = (function(weekCalc) {\r\n\t\tif (typeof weekCalc === 'function') {\r\n\t\t\treturn weekCalc;\r\n\t\t}\r\n\t\telse if (weekCalc === 'local') {\r\n\t\t\treturn weekCalc;\r\n\t\t}\r\n\t\telse if (weekCalc === 'iso' || weekCalc === 'ISO') {\r\n\t\t\treturn 'ISO';\r\n\t\t}\r\n\t})(options.weekNumberCalculation);\r\n\r\n\r\n\r\n\t// Calendar-specific Date Utilities\r\n\t// -----------------------------------------------------------------------------------\r\n\r\n\r\n\tt.defaultAllDayEventDuration = moment.duration(options.defaultAllDayEventDuration);\r\n\tt.defaultTimedEventDuration = moment.duration(options.defaultTimedEventDuration);\r\n\r\n\r\n\t// Builds a moment using the settings of the current calendar: timezone and language.\r\n\t// Accepts anything the vanilla moment() constructor accepts.\r\n\tt.moment = function() {\r\n\t\tvar mom;\r\n\r\n\t\tif (options.timezone === 'local') {\r\n\t\t\tmom = fc.moment.apply(null, arguments);\r\n\r\n\t\t\t// Force the moment to be local, because fc.moment doesn't guarantee it.\r\n\t\t\tif (mom.hasTime()) { // don't give ambiguously-timed moments a local zone\r\n\t\t\t\tmom.local();\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if (options.timezone === 'UTC') {\r\n\t\t\tmom = fc.moment.utc.apply(null, arguments); // process as UTC\r\n\t\t}\r\n\t\telse {\r\n\t\t\tmom = fc.moment.parseZone.apply(null, arguments); // let the input decide the zone\r\n\t\t}\r\n\r\n\t\tif ('_locale' in mom) { // moment 2.8 and above\r\n\t\t\tmom._locale = localeData;\r\n\t\t}\r\n\t\telse { // pre-moment-2.8\r\n\t\t\tmom._lang = localeData;\r\n\t\t}\r\n\r\n\t\treturn mom;\r\n\t};\r\n\r\n\r\n\t// Returns a boolean about whether or not the calendar knows how to calculate\r\n\t// the timezone offset of arbitrary dates in the current timezone.\r\n\tt.getIsAmbigTimezone = function() {\r\n\t\treturn options.timezone !== 'local' && options.timezone !== 'UTC';\r\n\t};\r\n\r\n\r\n\t// Returns a copy of the given date in the current timezone of it is ambiguously zoned.\r\n\t// This will also give the date an unambiguous time.\r\n\tt.rezoneDate = function(date) {\r\n\t\treturn t.moment(date.toArray());\r\n\t};\r\n\r\n\r\n\t// Returns a moment for the current date, as defined by the client's computer,\r\n\t// or overridden by the `now` option.\r\n\tt.getNow = function() {\r\n\t\tvar now = options.now;\r\n\t\tif (typeof now === 'function') {\r\n\t\t\tnow = now();\r\n\t\t}\r\n\t\treturn t.moment(now);\r\n\t};\r\n\r\n\r\n\t// Get an event's normalized end date. If not present, calculate it from the defaults.\r\n\tt.getEventEnd = function(event) {\r\n\t\tif (event.end) {\r\n\t\t\treturn event.end.clone();\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn t.getDefaultEventEnd(event.allDay, event.start);\r\n\t\t}\r\n\t};\r\n\r\n\r\n\t// Given an event's allDay status and start date, return swhat its fallback end date should be.\r\n\tt.getDefaultEventEnd = function(allDay, start) { // TODO: rename to computeDefaultEventEnd\r\n\t\tvar end = start.clone();\r\n\r\n\t\tif (allDay) {\r\n\t\t\tend.stripTime().add(t.defaultAllDayEventDuration);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tend.add(t.defaultTimedEventDuration);\r\n\t\t}\r\n\r\n\t\tif (t.getIsAmbigTimezone()) {\r\n\t\t\tend.stripZone(); // we don't know what the tzo should be\r\n\t\t}\r\n\r\n\t\treturn end;\r\n\t};\r\n\r\n\r\n\t// Produces a human-readable string for the given duration.\r\n\t// Side-effect: changes the locale of the given duration.\r\n\tt.humanizeDuration = function(duration) {\r\n\t\treturn (duration.locale || duration.lang).call(duration, options.lang) // works moment-pre-2.8\r\n\t\t\t.humanize();\r\n\t};\r\n\r\n\r\n\t\r\n\t// Imports\r\n\t// -----------------------------------------------------------------------------------\r\n\r\n\r\n\tEventManager.call(t, options);\r\n\tvar isFetchNeeded = t.isFetchNeeded;\r\n\tvar fetchEvents = t.fetchEvents;\r\n\r\n\r\n\r\n\t// Locals\r\n\t// -----------------------------------------------------------------------------------\r\n\r\n\r\n\tvar _element = element[0];\r\n\tvar header;\r\n\tvar headerElement;\r\n\tvar content;\r\n\tvar tm; // for making theme classes\r\n\tvar currentView; // NOTE: keep this in sync with this.view\r\n\tvar viewsByType = {}; // holds all instantiated view instances, current or not\r\n\tvar suggestedViewHeight;\r\n\tvar windowResizeProxy; // wraps the windowResize function\r\n\tvar ignoreWindowResize = 0;\r\n\tvar date;\r\n\tvar events = [];\r\n\t\r\n\t\r\n\t\r\n\t// Main Rendering\r\n\t// -----------------------------------------------------------------------------------\r\n\r\n\r\n\tif (options.defaultDate != null) {\r\n\t\tdate = t.moment(options.defaultDate);\r\n\t}\r\n\telse {\r\n\t\tdate = t.getNow();\r\n\t}\r\n\t\r\n\t\r\n\tfunction render() {\r\n\t\tif (!content) {\r\n\t\t\tinitialRender();\r\n\t\t}\r\n\t\telse if (elementVisible()) {\r\n\t\t\t// mainly for the public API\r\n\t\t\tcalcSize();\r\n\t\t\trenderView();\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\tfunction initialRender() {\r\n\t\ttm = options.theme ? 'ui' : 'fc';\r\n\t\telement.addClass('fc');\r\n\r\n\t\tif (options.isRTL) {\r\n\t\t\telement.addClass('fc-rtl');\r\n\t\t}\r\n\t\telse {\r\n\t\t\telement.addClass('fc-ltr');\r\n\t\t}\r\n\r\n\t\tif (options.theme) {\r\n\t\t\telement.addClass('ui-widget');\r\n\t\t}\r\n\t\telse {\r\n\t\t\telement.addClass('fc-unthemed');\r\n\t\t}\r\n\r\n\t\tcontent = $(\"<div class='fc-view-container'/>\").prependTo(element);\r\n\r\n\t\theader = t.header = new Header(t, options);\r\n\t\theaderElement = header.render();\r\n\t\tif (headerElement) {\r\n\t\t\telement.prepend(headerElement);\r\n\t\t}\r\n\r\n\t\trenderView(options.defaultView);\r\n\r\n\t\tif (options.handleWindowResize) {\r\n\t\t\twindowResizeProxy = debounce(windowResize, options.windowResizeDelay); // prevents rapid calls\r\n\t\t\t$(window).resize(windowResizeProxy);\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\tfunction destroy() {\r\n\r\n\t\tif (currentView) {\r\n\t\t\tcurrentView.removeElement();\r\n\r\n\t\t\t// NOTE: don't null-out currentView/t.view in case API methods are called after destroy.\r\n\t\t\t// It is still the \"current\" view, just not rendered.\r\n\t\t}\r\n\r\n\t\theader.destroy();\r\n\t\tcontent.remove();\r\n\t\telement.removeClass('fc fc-ltr fc-rtl fc-unthemed ui-widget');\r\n\r\n\t\tif (windowResizeProxy) {\r\n\t\t\t$(window).unbind('resize', windowResizeProxy);\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\tfunction elementVisible() {\r\n\t\treturn element.is(':visible');\r\n\t}\r\n\t\r\n\t\r\n\r\n\t// View Rendering\r\n\t// -----------------------------------------------------------------------------------\r\n\r\n\r\n\t// Renders a view because of a date change, view-type change, or for the first time.\r\n\t// If not given a viewType, keep the current view but render different dates.\r\n\tfunction renderView(viewType) {\r\n\t\tignoreWindowResize++;\r\n\r\n\t\t// if viewType is changing, destroy the old view\r\n\t\tif (currentView && viewType && currentView.type !== viewType) {\r\n\t\t\theader.deactivateButton(currentView.type);\r\n\t\t\tfreezeContentHeight(); // prevent a scroll jump when view element is removed\r\n\t\t\tcurrentView.removeElement();\r\n\t\t\tcurrentView = t.view = null;\r\n\t\t}\r\n\r\n\t\t// if viewType changed, or the view was never created, create a fresh view\r\n\t\tif (!currentView && viewType) {\r\n\t\t\tcurrentView = t.view =\r\n\t\t\t\tviewsByType[viewType] ||\r\n\t\t\t\t(viewsByType[viewType] = t.instantiateView(viewType));\r\n\r\n\t\t\tcurrentView.setElement(\r\n\t\t\t\t$(\"<div class='fc-view fc-\" + viewType + \"-view' />\").appendTo(content)\r\n\t\t\t);\r\n\t\t\theader.activateButton(viewType);\r\n\t\t}\r\n\r\n\t\tif (currentView) {\r\n\r\n\t\t\t// in case the view should render a period of time that is completely hidden\r\n\t\t\tdate = currentView.massageCurrentDate(date);\r\n\r\n\t\t\t// render or rerender the view\r\n\t\t\tif (\r\n\t\t\t\t!currentView.isDisplayed ||\r\n\t\t\t\t!date.isWithin(currentView.intervalStart, currentView.intervalEnd) // implicit date window change\r\n\t\t\t) {\r\n\t\t\t\tif (elementVisible()) {\r\n\r\n\t\t\t\t\tfreezeContentHeight();\r\n\t\t\t\t\tcurrentView.display(date);\r\n\t\t\t\t\tunfreezeContentHeight();\r\n\r\n\t\t\t\t\t// need to do this after View::render, so dates are calculated\r\n\t\t\t\t\tupdateHeaderTitle();\r\n\t\t\t\t\tupdateTodayButton();\r\n\r\n\t\t\t\t\tgetAndRenderEvents();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tunfreezeContentHeight(); // undo any lone freezeContentHeight calls\r\n\t\tignoreWindowResize--;\r\n\t}\r\n\r\n\t\r\n\r\n\t// Resizing\r\n\t// -----------------------------------------------------------------------------------\r\n\r\n\r\n\tt.getSuggestedViewHeight = function() {\r\n\t\tif (suggestedViewHeight === undefined) {\r\n\t\t\tcalcSize();\r\n\t\t}\r\n\t\treturn suggestedViewHeight;\r\n\t};\r\n\r\n\r\n\tt.isHeightAuto = function() {\r\n\t\treturn options.contentHeight === 'auto' || options.height === 'auto';\r\n\t};\r\n\t\r\n\t\r\n\tfunction updateSize(shouldRecalc) {\r\n\t\tif (elementVisible()) {\r\n\r\n\t\t\tif (shouldRecalc) {\r\n\t\t\t\t_calcSize();\r\n\t\t\t}\r\n\r\n\t\t\tignoreWindowResize++;\r\n\t\t\tcurrentView.updateSize(true); // isResize=true. will poll getSuggestedViewHeight() and isHeightAuto()\r\n\t\t\tignoreWindowResize--;\r\n\r\n\t\t\treturn true; // signal success\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tfunction calcSize() {\r\n\t\tif (elementVisible()) {\r\n\t\t\t_calcSize();\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\tfunction _calcSize() { // assumes elementVisible\r\n\t\tif (typeof options.contentHeight === 'number') { // exists and not 'auto'\r\n\t\t\tsuggestedViewHeight = options.contentHeight;\r\n\t\t}\r\n\t\telse if (typeof options.height === 'number') { // exists and not 'auto'\r\n\t\t\tsuggestedViewHeight = options.height - (headerElement ? headerElement.outerHeight(true) : 0);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tsuggestedViewHeight = Math.round(content.width() / Math.max(options.aspectRatio, .5));\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\tfunction windowResize(ev) {\r\n\t\tif (\r\n\t\t\t!ignoreWindowResize &&\r\n\t\t\tev.target === window && // so we don't process jqui \"resize\" events that have bubbled up\r\n\t\t\tcurrentView.start // view has already been rendered\r\n\t\t) {\r\n\t\t\tif (updateSize(true)) {\r\n\t\t\t\tcurrentView.trigger('windowResize', _element);\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\t\r\n\t/* Event Fetching/Rendering\r\n\t-----------------------------------------------------------------------------*/\r\n\t// TODO: going forward, most of this stuff should be directly handled by the view\r\n\r\n\r\n\tfunction refetchEvents() { // can be called as an API method\r\n\t\tdestroyEvents(); // so that events are cleared before user starts waiting for AJAX\r\n\t\tfetchAndRenderEvents();\r\n\t}\r\n\r\n\r\n\tfunction renderEvents() { // destroys old events if previously rendered\r\n\t\tif (elementVisible()) {\r\n\t\t\tfreezeContentHeight();\r\n\t\t\tcurrentView.displayEvents(events);\r\n\t\t\tunfreezeContentHeight();\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tfunction destroyEvents() {\r\n\t\tfreezeContentHeight();\r\n\t\tcurrentView.clearEvents();\r\n\t\tunfreezeContentHeight();\r\n\t}\r\n\t\r\n\r\n\tfunction getAndRenderEvents() {\r\n\t\tif (!options.lazyFetching || isFetchNeeded(currentView.start, currentView.end)) {\r\n\t\t\tfetchAndRenderEvents();\r\n\t\t}\r\n\t\telse {\r\n\t\t\trenderEvents();\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tfunction fetchAndRenderEvents() {\r\n\t\tfetchEvents(currentView.start, currentView.end);\r\n\t\t\t// ... will call reportEvents\r\n\t\t\t// ... which will call renderEvents\r\n\t}\r\n\r\n\t\r\n\t// called when event data arrives\r\n\tfunction reportEvents(_events) {\r\n\t\tevents = _events;\r\n\t\trenderEvents();\r\n\t}\r\n\r\n\r\n\t// called when a single event's data has been changed\r\n\tfunction reportEventChange() {\r\n\t\trenderEvents();\r\n\t}\r\n\r\n\r\n\r\n\t/* Header Updating\r\n\t-----------------------------------------------------------------------------*/\r\n\r\n\r\n\tfunction updateHeaderTitle() {\r\n\t\theader.updateTitle(currentView.title);\r\n\t}\r\n\r\n\r\n\tfunction updateTodayButton() {\r\n\t\tvar now = t.getNow();\r\n\t\tif (now.isWithin(currentView.intervalStart, currentView.intervalEnd)) {\r\n\t\t\theader.disableButton('today');\r\n\t\t}\r\n\t\telse {\r\n\t\t\theader.enableButton('today');\r\n\t\t}\r\n\t}\r\n\t\r\n\r\n\r\n\t/* Selection\r\n\t-----------------------------------------------------------------------------*/\r\n\t\r\n\r\n\tfunction select(start, end) {\r\n\r\n\t\tstart = t.moment(start);\r\n\t\tif (end) {\r\n\t\t\tend = t.moment(end);\r\n\t\t}\r\n\t\telse if (start.hasTime()) {\r\n\t\t\tend = start.clone().add(t.defaultTimedEventDuration);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tend = start.clone().add(t.defaultAllDayEventDuration);\r\n\t\t}\r\n\r\n\t\tcurrentView.select({ start: start, end: end }); // accepts a range\r\n\t}\r\n\t\r\n\r\n\tfunction unselect() { // safe to be called before renderView\r\n\t\tif (currentView) {\r\n\t\t\tcurrentView.unselect();\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\t\r\n\t/* Date\r\n\t-----------------------------------------------------------------------------*/\r\n\t\r\n\t\r\n\tfunction prev() {\r\n\t\tdate = currentView.computePrevDate(date);\r\n\t\trenderView();\r\n\t}\r\n\t\r\n\t\r\n\tfunction next() {\r\n\t\tdate = currentView.computeNextDate(date);\r\n\t\trenderView();\r\n\t}\r\n\t\r\n\t\r\n\tfunction prevYear() {\r\n\t\tdate.add(-1, 'years');\r\n\t\trenderView();\r\n\t}\r\n\t\r\n\t\r\n\tfunction nextYear() {\r\n\t\tdate.add(1, 'years');\r\n\t\trenderView();\r\n\t}\r\n\t\r\n\t\r\n\tfunction today() {\r\n\t\tdate = t.getNow();\r\n\t\trenderView();\r\n\t}\r\n\t\r\n\t\r\n\tfunction gotoDate(dateInput) {\r\n\t\tdate = t.moment(dateInput);\r\n\t\trenderView();\r\n\t}\r\n\t\r\n\t\r\n\tfunction incrementDate(delta) {\r\n\t\tdate.add(moment.duration(delta));\r\n\t\trenderView();\r\n\t}\r\n\r\n\r\n\t// Forces navigation to a view for the given date.\r\n\t// `viewType` can be a specific view name or a generic one like \"week\" or \"day\".\r\n\tfunction zoomTo(newDate, viewType) {\r\n\t\tvar spec;\r\n\r\n\t\tviewType = viewType || 'day'; // day is default zoom\r\n\t\tspec = t.getViewSpec(viewType) || t.getUnitViewSpec(viewType);\r\n\r\n\t\tdate = newDate;\r\n\t\trenderView(spec ? spec.type : null);\r\n\t}\r\n\t\r\n\t\r\n\tfunction getDate() {\r\n\t\treturn date.clone();\r\n\t}\r\n\r\n\r\n\r\n\t/* Height \"Freezing\"\r\n\t-----------------------------------------------------------------------------*/\r\n\t// TODO: move this into the view\r\n\r\n\r\n\tfunction freezeContentHeight() {\r\n\t\tcontent.css({\r\n\t\t\twidth: '100%',\r\n\t\t\theight: content.height(),\r\n\t\t\toverflow: 'hidden'\r\n\t\t});\r\n\t}\r\n\r\n\r\n\tfunction unfreezeContentHeight() {\r\n\t\tcontent.css({\r\n\t\t\twidth: '',\r\n\t\t\theight: '',\r\n\t\t\toverflow: ''\r\n\t\t});\r\n\t}\r\n\t\r\n\t\r\n\t\r\n\t/* Misc\r\n\t-----------------------------------------------------------------------------*/\r\n\t\r\n\r\n\tfunction getCalendar() {\r\n\t\treturn t;\r\n\t}\r\n\r\n\t\r\n\tfunction getView() {\r\n\t\treturn currentView;\r\n\t}\r\n\t\r\n\t\r\n\tfunction option(name, value) {\r\n\t\tif (value === undefined) {\r\n\t\t\treturn options[name];\r\n\t\t}\r\n\t\tif (name == 'height' || name == 'contentHeight' || name == 'aspectRatio') {\r\n\t\t\toptions[name] = value;\r\n\t\t\tupdateSize(true); // true = allow recalculation of height\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\tfunction trigger(name, thisObj) {\r\n\t\tif (options[name]) {\r\n\t\t\treturn options[name].apply(\r\n\t\t\t\tthisObj || _element,\r\n\t\t\t\tArray.prototype.slice.call(arguments, 2)\r\n\t\t\t);\r\n\t\t}\r\n\t}\r\n\r\n}\r\n\r\n;;\r\n\r\nCalendar.defaults = {\r\n\r\n\ttitleRangeSeparator: ' \\u2014 ', // emphasized dash\r\n\tmonthYearFormat: 'MMMM YYYY', // required for en. other languages rely on datepicker computable option\r\n\r\n\tdefaultTimedEventDuration: '02:00:00',\r\n\tdefaultAllDayEventDuration: { days: 1 },\r\n\tforceEventDuration: false,\r\n\tnextDayThreshold: '09:00:00', // 9am\r\n\r\n\t// display\r\n\tdefaultView: 'month',\r\n\taspectRatio: 1.35,\r\n\theader: {\r\n\t\tleft: 'title',\r\n\t\tcenter: '',\r\n\t\tright: 'today prev,next'\r\n\t},\r\n\tweekends: true,\r\n\tweekNumbers: false,\r\n\r\n\tweekNumberTitle: 'W',\r\n\tweekNumberCalculation: 'local',\r\n\t\r\n\t//editable: false,\r\n\t\r\n\t// event ajax\r\n\tlazyFetching: true,\r\n\tstartParam: 'start',\r\n\tendParam: 'end',\r\n\ttimezoneParam: 'timezone',\r\n\r\n\ttimezone: false,\r\n\r\n\t//allDayDefault: undefined,\r\n\r\n\t// locale\r\n\tisRTL: false,\r\n\tbuttonText: {\r\n\t\tprev: \"prev\",\r\n\t\tnext: \"next\",\r\n\t\tprevYear: \"prev year\",\r\n\t\tnextYear: \"next year\",\r\n\t\tyear: 'year', // TODO: locale files need to specify this\r\n\t\ttoday: 'today',\r\n\t\tmonth: 'month',\r\n\t\tweek: 'week',\r\n\t\tday: 'day'\r\n\t},\r\n\r\n\tbuttonIcons: {\r\n\t\tprev: 'left-single-arrow',\r\n\t\tnext: 'right-single-arrow',\r\n\t\tprevYear: 'left-double-arrow',\r\n\t\tnextYear: 'right-double-arrow'\r\n\t},\r\n\t\r\n\t// jquery-ui theming\r\n\ttheme: false,\r\n\tthemeButtonIcons: {\r\n\t\tprev: 'circle-triangle-w',\r\n\t\tnext: 'circle-triangle-e',\r\n\t\tprevYear: 'seek-prev',\r\n\t\tnextYear: 'seek-next'\r\n\t},\r\n\r\n\t//eventResizableFromStart: false,\r\n\tdragOpacity: .75,\r\n\tdragRevertDuration: 500,\r\n\tdragScroll: true,\r\n\t\r\n\t//selectable: false,\r\n\tunselectAuto: true,\r\n\t\r\n\tdropAccept: '*',\r\n\r\n\teventLimit: false,\r\n\teventLimitText: 'more',\r\n\teventLimitClick: 'popover',\r\n\tdayPopoverFormat: 'LL',\r\n\t\r\n\thandleWindowResize: true,\r\n\twindowResizeDelay: 200 // milliseconds before an updateSize happens\r\n\t\r\n};\r\n\r\n\r\nCalendar.englishDefaults = { // used by lang.js\r\n\tdayPopoverFormat: 'dddd, MMMM D'\r\n};\r\n\r\n\r\nCalendar.rtlDefaults = { // right-to-left defaults\r\n\theader: { // TODO: smarter solution (first/center/last ?)\r\n\t\tleft: 'next,prev today',\r\n\t\tcenter: '',\r\n\t\tright: 'title'\r\n\t},\r\n\tbuttonIcons: {\r\n\t\tprev: 'right-single-arrow',\r\n\t\tnext: 'left-single-arrow',\r\n\t\tprevYear: 'right-double-arrow',\r\n\t\tnextYear: 'left-double-arrow'\r\n\t},\r\n\tthemeButtonIcons: {\r\n\t\tprev: 'circle-triangle-e',\r\n\t\tnext: 'circle-triangle-w',\r\n\t\tnextYear: 'seek-prev',\r\n\t\tprevYear: 'seek-next'\r\n\t}\r\n};\r\n\r\n;;\r\n\r\nvar langOptionHash = fc.langs = {}; // initialize and expose\r\n\r\n\r\n// TODO: document the structure and ordering of a FullCalendar lang file\r\n// TODO: rename everything \"lang\" to \"locale\", like what the moment project did\r\n\r\n\r\n// Initialize jQuery UI datepicker translations while using some of the translations\r\n// Will set this as the default language for datepicker.\r\nfc.datepickerLang = function(langCode, dpLangCode, dpOptions) {\r\n\r\n\t// get the FullCalendar internal option hash for this language. create if necessary\r\n\tvar fcOptions = langOptionHash[langCode] || (langOptionHash[langCode] = {});\r\n\r\n\t// transfer some simple options from datepicker to fc\r\n\tfcOptions.isRTL = dpOptions.isRTL;\r\n\tfcOptions.weekNumberTitle = dpOptions.weekHeader;\r\n\r\n\t// compute some more complex options from datepicker\r\n\t$.each(dpComputableOptions, function(name, func) {\r\n\t\tfcOptions[name] = func(dpOptions);\r\n\t});\r\n\r\n\t// is jQuery UI Datepicker is on the page?\r\n\tif ($.datepicker) {\r\n\r\n\t\t// Register the language data.\r\n\t\t// FullCalendar and MomentJS use language codes like \"pt-br\" but Datepicker\r\n\t\t// does it like \"pt-BR\" or if it doesn't have the language, maybe just \"pt\".\r\n\t\t// Make an alias so the language can be referenced either way.\r\n\t\t$.datepicker.regional[dpLangCode] =\r\n\t\t\t$.datepicker.regional[langCode] = // alias\r\n\t\t\t\tdpOptions;\r\n\r\n\t\t// Alias 'en' to the default language data. Do this every time.\r\n\t\t$.datepicker.regional.en = $.datepicker.regional[''];\r\n\r\n\t\t// Set as Datepicker's global defaults.\r\n\t\t$.datepicker.setDefaults(dpOptions);\r\n\t}\r\n};\r\n\r\n\r\n// Sets FullCalendar-specific translations. Will set the language as the global default.\r\nfc.lang = function(langCode, newFcOptions) {\r\n\tvar fcOptions;\r\n\tvar momOptions;\r\n\r\n\t// get the FullCalendar internal option hash for this language. create if necessary\r\n\tfcOptions = langOptionHash[langCode] || (langOptionHash[langCode] = {});\r\n\r\n\t// provided new options for this language? merge them in\r\n\tif (newFcOptions) {\r\n\t\tfcOptions = langOptionHash[langCode] = mergeOptions(fcOptions, newFcOptions);\r\n\t}\r\n\r\n\t// compute language options that weren't defined.\r\n\t// always do this. newFcOptions can be undefined when initializing from i18n file,\r\n\t// so no way to tell if this is an initialization or a default-setting.\r\n\tmomOptions = getMomentLocaleData(langCode); // will fall back to en\r\n\t$.each(momComputableOptions, function(name, func) {\r\n\t\tif (fcOptions[name] == null) {\r\n\t\t\tfcOptions[name] = func(momOptions, fcOptions);\r\n\t\t}\r\n\t});\r\n\r\n\t// set it as the default language for FullCalendar\r\n\tCalendar.defaults.lang = langCode;\r\n};\r\n\r\n\r\n// NOTE: can't guarantee any of these computations will run because not every language has datepicker\r\n// configs, so make sure there are English fallbacks for these in the defaults file.\r\nvar dpComputableOptions = {\r\n\r\n\tbuttonText: function(dpOptions) {\r\n\t\treturn {\r\n\t\t\t// the translations sometimes wrongly contain HTML entities\r\n\t\t\tprev: stripHtmlEntities(dpOptions.prevText),\r\n\t\t\tnext: stripHtmlEntities(dpOptions.nextText),\r\n\t\t\ttoday: stripHtmlEntities(dpOptions.currentText)\r\n\t\t};\r\n\t},\r\n\r\n\t// Produces format strings like \"MMMM YYYY\" -> \"September 2014\"\r\n\tmonthYearFormat: function(dpOptions) {\r\n\t\treturn dpOptions.showMonthAfterYear ?\r\n\t\t\t'YYYY[' + dpOptions.yearSuffix + '] MMMM' :\r\n\t\t\t'MMMM YYYY[' + dpOptions.yearSuffix + ']';\r\n\t}\r\n\r\n};\r\n\r\nvar momComputableOptions = {\r\n\r\n\t// Produces format strings like \"ddd M/D\" -> \"Fri 9/15\"\r\n\tdayOfMonthFormat: function(momOptions, fcOptions) {\r\n\t\tvar format = momOptions.longDateFormat('l'); // for the format like \"M/D/YYYY\"\r\n\r\n\t\t// strip the year off the edge, as well as other misc non-whitespace chars\r\n\t\tformat = format.replace(/^Y+[^\\w\\s]*|[^\\w\\s]*Y+$/g, '');\r\n\r\n\t\tif (fcOptions.isRTL) {\r\n\t\t\tformat += ' ddd'; // for RTL, add day-of-week to end\r\n\t\t}\r\n\t\telse {\r\n\t\t\tformat = 'ddd ' + format; // for LTR, add day-of-week to beginning\r\n\t\t}\r\n\t\treturn format;\r\n\t},\r\n\r\n\t// Produces format strings like \"h:mma\" -> \"6:00pm\"\r\n\tmediumTimeFormat: function(momOptions) { // can't be called `timeFormat` because collides with option\r\n\t\treturn momOptions.longDateFormat('LT')\r\n\t\t\t.replace(/\\s*a$/i, 'a'); // convert AM/PM/am/pm to lowercase. remove any spaces beforehand\r\n\t},\r\n\r\n\t// Produces format strings like \"h(:mm)a\" -> \"6pm\" / \"6:30pm\"\r\n\tsmallTimeFormat: function(momOptions) {\r\n\t\treturn momOptions.longDateFormat('LT')\r\n\t\t\t.replace(':mm', '(:mm)')\r\n\t\t\t.replace(/(\\Wmm)$/, '($1)') // like above, but for foreign langs\r\n\t\t\t.replace(/\\s*a$/i, 'a'); // convert AM/PM/am/pm to lowercase. remove any spaces beforehand\r\n\t},\r\n\r\n\t// Produces format strings like \"h(:mm)t\" -> \"6p\" / \"6:30p\"\r\n\textraSmallTimeFormat: function(momOptions) {\r\n\t\treturn momOptions.longDateFormat('LT')\r\n\t\t\t.replace(':mm', '(:mm)')\r\n\t\t\t.replace(/(\\Wmm)$/, '($1)') // like above, but for foreign langs\r\n\t\t\t.replace(/\\s*a$/i, 't'); // convert to AM/PM/am/pm to lowercase one-letter. remove any spaces beforehand\r\n\t},\r\n\r\n\t// Produces format strings like \"ha\" / \"H\" -> \"6pm\" / \"18\"\r\n\thourFormat: function(momOptions) {\r\n\t\treturn momOptions.longDateFormat('LT')\r\n\t\t\t.replace(':mm', '')\r\n\t\t\t.replace(/(\\Wmm)$/, '') // like above, but for foreign langs\r\n\t\t\t.replace(/\\s*a$/i, 'a'); // convert AM/PM/am/pm to lowercase. remove any spaces beforehand\r\n\t},\r\n\r\n\t// Produces format strings like \"h:mm\" -> \"6:30\" (with no AM/PM)\r\n\tnoMeridiemTimeFormat: function(momOptions) {\r\n\t\treturn momOptions.longDateFormat('LT')\r\n\t\t\t.replace(/\\s*a$/i, ''); // remove trailing AM/PM\r\n\t}\r\n\r\n};\r\n\r\n\r\n// options that should be computed off live calendar options (considers override options)\r\nvar instanceComputableOptions = { // TODO: best place for this? related to lang?\r\n\r\n\t// Produces format strings for results like \"Mo 16\"\r\n\tsmallDayDateFormat: function(options) {\r\n\t\treturn options.isRTL ?\r\n\t\t\t'D dd' :\r\n\t\t\t'dd D';\r\n\t},\r\n\r\n\t// Produces format strings for results like \"Wk 5\"\r\n\tweekFormat: function(options) {\r\n\t\treturn options.isRTL ?\r\n\t\t\t'w[ ' + options.weekNumberTitle + ']' :\r\n\t\t\t'[' + options.weekNumberTitle + ' ]w';\r\n\t},\r\n\r\n\t// Produces format strings for results like \"Wk5\"\r\n\tsmallWeekFormat: function(options) {\r\n\t\treturn options.isRTL ?\r\n\t\t\t'w[' + options.weekNumberTitle + ']' :\r\n\t\t\t'[' + options.weekNumberTitle + ']w';\r\n\t}\r\n\r\n};\r\n\r\nfunction populateInstanceComputableOptions(options) {\r\n\t$.each(instanceComputableOptions, function(name, func) {\r\n\t\tif (options[name] == null) {\r\n\t\t\toptions[name] = func(options);\r\n\t\t}\r\n\t});\r\n}\r\n\r\n\r\n// Returns moment's internal locale data. If doesn't exist, returns English.\r\n// Works with moment-pre-2.8\r\nfunction getMomentLocaleData(langCode) {\r\n\tvar func = moment.localeData || moment.langData;\r\n\treturn func.call(moment, langCode) ||\r\n\t\tfunc.call(moment, 'en'); // the newer localData could return null, so fall back to en\r\n}\r\n\r\n\r\n// Initialize English by forcing computation of moment-derived options.\r\n// Also, sets it as the default.\r\nfc.lang('en', Calendar.englishDefaults);\r\n\r\n;;\r\n\r\n/* Top toolbar area with buttons and title\r\n----------------------------------------------------------------------------------------------------------------------*/\r\n// TODO: rename all header-related things to \"toolbar\"\r\n\r\nfunction Header(calendar, options) {\r\n\tvar t = this;\r\n\t\r\n\t// exports\r\n\tt.render = render;\r\n\tt.destroy = destroy;\r\n\tt.updateTitle = updateTitle;\r\n\tt.activateButton = activateButton;\r\n\tt.deactivateButton = deactivateButton;\r\n\tt.disableButton = disableButton;\r\n\tt.enableButton = enableButton;\r\n\tt.getViewsWithButtons = getViewsWithButtons;\r\n\t\r\n\t// locals\r\n\tvar el = $();\r\n\tvar viewsWithButtons = [];\r\n\tvar tm;\r\n\r\n\r\n\tfunction render() {\r\n\t\tvar sections = options.header;\r\n\r\n\t\ttm = options.theme ? 'ui' : 'fc';\r\n\r\n\t\tif (sections) {\r\n\t\t\tel = $(\"<div class='fc-toolbar'/>\")\r\n\t\t\t\t.append(renderSection('left'))\r\n\t\t\t\t.append(renderSection('right'))\r\n\t\t\t\t.append(renderSection('center'))\r\n\t\t\t\t.append('<div class=\"fc-clear\"/>');\r\n\r\n\t\t\treturn el;\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\tfunction destroy() {\r\n\t\tel.remove();\r\n\t}\r\n\t\r\n\t\r\n\tfunction renderSection(position) {\r\n\t\tvar sectionEl = $('<div class=\"fc-' + position + '\"/>');\r\n\t\tvar buttonStr = options.header[position];\r\n\r\n\t\tif (buttonStr) {\r\n\t\t\t$.each(buttonStr.split(' '), function(i) {\r\n\t\t\t\tvar groupChildren = $();\r\n\t\t\t\tvar isOnlyButtons = true;\r\n\t\t\t\tvar groupEl;\r\n\r\n\t\t\t\t$.each(this.split(','), function(j, buttonName) {\r\n\t\t\t\t\tvar viewSpec;\r\n\t\t\t\t\tvar buttonClick;\r\n\t\t\t\t\tvar overrideText; // text explicitly set by calendar's constructor options. overcomes icons\r\n\t\t\t\t\tvar defaultText;\r\n\t\t\t\t\tvar themeIcon;\r\n\t\t\t\t\tvar normalIcon;\r\n\t\t\t\t\tvar innerHtml;\r\n\t\t\t\t\tvar classes;\r\n\t\t\t\t\tvar button;\r\n\r\n\t\t\t\t\tif (buttonName == 'title') {\r\n\t\t\t\t\t\tgroupChildren = groupChildren.add($('<h2>&nbsp;</h2>')); // we always want it to take up height\r\n\t\t\t\t\t\tisOnlyButtons = false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\telse {\r\n\t\t\t\t\t\tviewSpec = calendar.getViewSpec(buttonName);\r\n\r\n\t\t\t\t\t\tif (viewSpec) {\r\n\t\t\t\t\t\t\tbuttonClick = function() {\r\n\t\t\t\t\t\t\t\tcalendar.changeView(buttonName);\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\tviewsWithButtons.push(buttonName);\r\n\t\t\t\t\t\t\toverrideText = viewSpec.buttonTextOverride;\r\n\t\t\t\t\t\t\tdefaultText = viewSpec.buttonTextDefault;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse if (calendar[buttonName]) { // a calendar method\r\n\t\t\t\t\t\t\tbuttonClick = function() {\r\n\t\t\t\t\t\t\t\tcalendar[buttonName]();\r\n\t\t\t\t\t\t\t};\r\n\t\t\t\t\t\t\toverrideText = (calendar.overrides.buttonText || {})[buttonName];\r\n\t\t\t\t\t\t\tdefaultText = options.buttonText[buttonName]; // everything else is considered default\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (buttonClick) {\r\n\r\n\t\t\t\t\t\t\tthemeIcon = options.themeButtonIcons[buttonName];\r\n\t\t\t\t\t\t\tnormalIcon = options.buttonIcons[buttonName];\r\n\r\n\t\t\t\t\t\t\tif (overrideText) {\r\n\t\t\t\t\t\t\t\tinnerHtml = htmlEscape(overrideText);\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse if (themeIcon && options.theme) {\r\n\t\t\t\t\t\t\t\tinnerHtml = \"<span class='ui-icon ui-icon-\" + themeIcon + \"'></span>\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse if (normalIcon && !options.theme) {\r\n\t\t\t\t\t\t\t\tinnerHtml = \"<span class='fc-icon fc-icon-\" + normalIcon + \"'></span>\";\r\n\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\t\tinnerHtml = htmlEscape(defaultText);\r\n\t\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\t\tclasses = [\r\n\t\t\t\t\t\t\t\t'fc-' + buttonName + '-button',\r\n\t\t\t\t\t\t\t\ttm + '-button',\r\n\t\t\t\t\t\t\t\ttm + '-state-default'\r\n\t\t\t\t\t\t\t];\r\n\r\n\t\t\t\t\t\t\tbutton = $( // type=\"button\" so that it doesn't submit a form\r\n\t\t\t\t\t\t\t\t'<button type=\"button\" class=\"' + classes.join(' ') + '\">' +\r\n\t\t\t\t\t\t\t\t\tinnerHtml +\r\n\t\t\t\t\t\t\t\t'</button>'\r\n\t\t\t\t\t\t\t\t)\r\n\t\t\t\t\t\t\t\t.click(function() {\r\n\t\t\t\t\t\t\t\t\t// don't process clicks for disabled buttons\r\n\t\t\t\t\t\t\t\t\tif (!button.hasClass(tm + '-state-disabled')) {\r\n\r\n\t\t\t\t\t\t\t\t\t\tbuttonClick();\r\n\r\n\t\t\t\t\t\t\t\t\t\t// after the click action, if the button becomes the \"active\" tab, or disabled,\r\n\t\t\t\t\t\t\t\t\t\t// it should never have a hover class, so remove it now.\r\n\t\t\t\t\t\t\t\t\t\tif (\r\n\t\t\t\t\t\t\t\t\t\t\tbutton.hasClass(tm + '-state-active') ||\r\n\t\t\t\t\t\t\t\t\t\t\tbutton.hasClass(tm + '-state-disabled')\r\n\t\t\t\t\t\t\t\t\t\t) {\r\n\t\t\t\t\t\t\t\t\t\t\tbutton.removeClass(tm + '-state-hover');\r\n\t\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.mousedown(function() {\r\n\t\t\t\t\t\t\t\t\t// the *down* effect (mouse pressed in).\r\n\t\t\t\t\t\t\t\t\t// only on buttons that are not the \"active\" tab, or disabled\r\n\t\t\t\t\t\t\t\t\tbutton\r\n\t\t\t\t\t\t\t\t\t\t.not('.' + tm + '-state-active')\r\n\t\t\t\t\t\t\t\t\t\t.not('.' + tm + '-state-disabled')\r\n\t\t\t\t\t\t\t\t\t\t.addClass(tm + '-state-down');\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.mouseup(function() {\r\n\t\t\t\t\t\t\t\t\t// undo the *down* effect\r\n\t\t\t\t\t\t\t\t\tbutton.removeClass(tm + '-state-down');\r\n\t\t\t\t\t\t\t\t})\r\n\t\t\t\t\t\t\t\t.hover(\r\n\t\t\t\t\t\t\t\t\tfunction() {\r\n\t\t\t\t\t\t\t\t\t\t// the *hover* effect.\r\n\t\t\t\t\t\t\t\t\t\t// only on buttons that are not the \"active\" tab, or disabled\r\n\t\t\t\t\t\t\t\t\t\tbutton\r\n\t\t\t\t\t\t\t\t\t\t\t.not('.' + tm + '-state-active')\r\n\t\t\t\t\t\t\t\t\t\t\t.not('.' + tm + '-state-disabled')\r\n\t\t\t\t\t\t\t\t\t\t\t.addClass(tm + '-state-hover');\r\n\t\t\t\t\t\t\t\t\t},\r\n\t\t\t\t\t\t\t\t\tfunction() {\r\n\t\t\t\t\t\t\t\t\t\t// undo the *hover* effect\r\n\t\t\t\t\t\t\t\t\t\tbutton\r\n\t\t\t\t\t\t\t\t\t\t\t.removeClass(tm + '-state-hover')\r\n\t\t\t\t\t\t\t\t\t\t\t.removeClass(tm + '-state-down'); // if mouseleave happens before mouseup\r\n\t\t\t\t\t\t\t\t\t}\r\n\t\t\t\t\t\t\t\t);\r\n\r\n\t\t\t\t\t\t\tgroupChildren = groupChildren.add(button);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\tif (isOnlyButtons) {\r\n\t\t\t\t\tgroupChildren\r\n\t\t\t\t\t\t.first().addClass(tm + '-corner-left').end()\r\n\t\t\t\t\t\t.last().addClass(tm + '-corner-right').end();\r\n\t\t\t\t}\r\n\r\n\t\t\t\tif (groupChildren.length > 1) {\r\n\t\t\t\t\tgroupEl = $('<div/>');\r\n\t\t\t\t\tif (isOnlyButtons) {\r\n\t\t\t\t\t\tgroupEl.addClass('fc-button-group');\r\n\t\t\t\t\t}\r\n\t\t\t\t\tgroupEl.append(groupChildren);\r\n\t\t\t\t\tsectionEl.append(groupEl);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\tsectionEl.append(groupChildren); // 1 or 0 children\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\treturn sectionEl;\r\n\t}\r\n\t\r\n\t\r\n\tfunction updateTitle(text) {\r\n\t\tel.find('h2').text(text);\r\n\t}\r\n\t\r\n\t\r\n\tfunction activateButton(buttonName) {\r\n\t\tel.find('.fc-' + buttonName + '-button')\r\n\t\t\t.addClass(tm + '-state-active');\r\n\t}\r\n\t\r\n\t\r\n\tfunction deactivateButton(buttonName) {\r\n\t\tel.find('.fc-' + buttonName + '-button')\r\n\t\t\t.removeClass(tm + '-state-active');\r\n\t}\r\n\t\r\n\t\r\n\tfunction disableButton(buttonName) {\r\n\t\tel.find('.fc-' + buttonName + '-button')\r\n\t\t\t.attr('disabled', 'disabled')\r\n\t\t\t.addClass(tm + '-state-disabled');\r\n\t}\r\n\t\r\n\t\r\n\tfunction enableButton(buttonName) {\r\n\t\tel.find('.fc-' + buttonName + '-button')\r\n\t\t\t.removeAttr('disabled')\r\n\t\t\t.removeClass(tm + '-state-disabled');\r\n\t}\r\n\r\n\r\n\tfunction getViewsWithButtons() {\r\n\t\treturn viewsWithButtons;\r\n\t}\r\n\r\n}\r\n\r\n;;\r\n\r\nfc.sourceNormalizers = [];\r\nfc.sourceFetchers = [];\r\n\r\nvar ajaxDefaults = {\r\n\tdataType: 'json',\r\n\tcache: false\r\n};\r\n\r\nvar eventGUID = 1;\r\n\r\n\r\nfunction EventManager(options) { // assumed to be a calendar\r\n\tvar t = this;\r\n\t\r\n\t\r\n\t// exports\r\n\tt.isFetchNeeded = isFetchNeeded;\r\n\tt.fetchEvents = fetchEvents;\r\n\tt.addEventSource = addEventSource;\r\n\tt.removeEventSource = removeEventSource;\r\n\tt.updateEvent = updateEvent;\r\n\tt.renderEvent = renderEvent;\r\n\tt.removeEvents = removeEvents;\r\n\tt.clientEvents = clientEvents;\r\n\tt.mutateEvent = mutateEvent;\r\n\tt.normalizeEventRange = normalizeEventRange;\r\n\tt.normalizeEventRangeTimes = normalizeEventRangeTimes;\r\n\tt.ensureVisibleEventRange = ensureVisibleEventRange;\r\n\t\r\n\t\r\n\t// imports\r\n\tvar trigger = t.trigger;\r\n\tvar getView = t.getView;\r\n\tvar reportEvents = t.reportEvents;\r\n\t\r\n\t\r\n\t// locals\r\n\tvar stickySource = { events: [] };\r\n\tvar sources = [ stickySource ];\r\n\tvar rangeStart, rangeEnd;\r\n\tvar currentFetchID = 0;\r\n\tvar pendingSourceCnt = 0;\r\n\tvar loadingLevel = 0;\r\n\tvar cache = []; // holds events that have already been expanded\r\n\r\n\r\n\t$.each(\r\n\t\t(options.events ? [ options.events ] : []).concat(options.eventSources || []),\r\n\t\tfunction(i, sourceInput) {\r\n\t\t\tvar source = buildEventSource(sourceInput);\r\n\t\t\tif (source) {\r\n\t\t\t\tsources.push(source);\r\n\t\t\t}\r\n\t\t}\r\n\t);\r\n\t\r\n\t\r\n\t\r\n\t/* Fetching\r\n\t-----------------------------------------------------------------------------*/\r\n\t\r\n\t\r\n\tfunction isFetchNeeded(start, end) {\r\n\t\treturn !rangeStart || // nothing has been fetched yet?\r\n\t\t\t// or, a part of the new range is outside of the old range? (after normalizing)\r\n\t\t\tstart.clone().stripZone() < rangeStart.clone().stripZone() ||\r\n\t\t\tend.clone().stripZone() > rangeEnd.clone().stripZone();\r\n\t}\r\n\t\r\n\t\r\n\tfunction fetchEvents(start, end) {\r\n\t\trangeStart = start;\r\n\t\trangeEnd = end;\r\n\t\tcache = [];\r\n\t\tvar fetchID = ++currentFetchID;\r\n\t\tvar len = sources.length;\r\n\t\tpendingSourceCnt = len;\r\n\t\tfor (var i=0; i<len; i++) {\r\n\t\t\tfetchEventSource(sources[i], fetchID);\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\tfunction fetchEventSource(source, fetchID) {\r\n\t\t_fetchEventSource(source, function(eventInputs) {\r\n\t\t\tvar isArraySource = $.isArray(source.events);\r\n\t\t\tvar i, eventInput;\r\n\t\t\tvar abstractEvent;\r\n\r\n\t\t\tif (fetchID == currentFetchID) {\r\n\r\n\t\t\t\tif (eventInputs) {\r\n\t\t\t\t\tfor (i = 0; i < eventInputs.length; i++) {\r\n\t\t\t\t\t\teventInput = eventInputs[i];\r\n\r\n\t\t\t\t\t\tif (isArraySource) { // array sources have already been convert to Event Objects\r\n\t\t\t\t\t\t\tabstractEvent = eventInput;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\telse {\r\n\t\t\t\t\t\t\tabstractEvent = buildEventFromInput(eventInput, source);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tif (abstractEvent) { // not false (an invalid event)\r\n\t\t\t\t\t\t\tcache.push.apply(\r\n\t\t\t\t\t\t\t\tcache,\r\n\t\t\t\t\t\t\t\texpandEvent(abstractEvent) // add individual expanded events to the cache\r\n\t\t\t\t\t\t\t);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\tpendingSourceCnt--;\r\n\t\t\t\tif (!pendingSourceCnt) {\r\n\t\t\t\t\treportEvents(cache);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\t\r\n\t\r\n\tfunction _fetchEventSource(source, callback) {\r\n\t\tvar i;\r\n\t\tvar fetchers = fc.sourceFetchers;\r\n\t\tvar res;\r\n\r\n\t\tfor (i=0; i<fetchers.length; i++) {\r\n\t\t\tres = fetchers[i].call(\r\n\t\t\t\tt, // this, the Calendar object\r\n\t\t\t\tsource,\r\n\t\t\t\trangeStart.clone(),\r\n\t\t\t\trangeEnd.clone(),\r\n\t\t\t\toptions.timezone,\r\n\t\t\t\tcallback\r\n\t\t\t);\r\n\r\n\t\t\tif (res === true) {\r\n\t\t\t\t// the fetcher is in charge. made its own async request\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t\telse if (typeof res == 'object') {\r\n\t\t\t\t// the fetcher returned a new source. process it\r\n\t\t\t\t_fetchEventSource(res, callback);\r\n\t\t\t\treturn;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tvar events = source.events;\r\n\t\tif (events) {\r\n\t\t\tif ($.isFunction(events)) {\r\n\t\t\t\tpushLoading();\r\n\t\t\t\tevents.call(\r\n\t\t\t\t\tt, // this, the Calendar object\r\n\t\t\t\t\trangeStart.clone(),\r\n\t\t\t\t\trangeEnd.clone(),\r\n\t\t\t\t\toptions.timezone,\r\n\t\t\t\t\tfunction(events) {\r\n\t\t\t\t\t\tcallback(events);\r\n\t\t\t\t\t\tpopLoading();\r\n\t\t\t\t\t}\r\n\t\t\t\t);\r\n\t\t\t}\r\n\t\t\telse if ($.isArray(events)) {\r\n\t\t\t\tcallback(events);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tcallback();\r\n\t\t\t}\r\n\t\t}else{\r\n\t\t\tvar url = source.url;\r\n\t\t\tif (url) {\r\n\t\t\t\tvar success = source.success;\r\n\t\t\t\tvar error = source.error;\r\n\t\t\t\tvar complete = source.complete;\r\n\r\n\t\t\t\t// retrieve any outbound GET/POST $.ajax data from the options\r\n\t\t\t\tvar customData;\r\n\t\t\t\tif ($.isFunction(source.data)) {\r\n\t\t\t\t\t// supplied as a function that returns a key/value object\r\n\t\t\t\t\tcustomData = source.data();\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\t// supplied as a straight key/value object\r\n\t\t\t\t\tcustomData = source.data;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// use a copy of the custom data so we can modify the parameters\r\n\t\t\t\t// and not affect the passed-in object.\r\n\t\t\t\tvar data = $.extend({}, customData || {});\r\n\r\n\t\t\t\tvar startParam = firstDefined(source.startParam, options.startParam);\r\n\t\t\t\tvar endParam = firstDefined(source.endParam, options.endParam);\r\n\t\t\t\tvar timezoneParam = firstDefined(source.timezoneParam, options.timezoneParam);\r\n\r\n\t\t\t\tif (startParam) {\r\n\t\t\t\t\tdata[startParam] = rangeStart.format();\r\n\t\t\t\t}\r\n\t\t\t\tif (endParam) {\r\n\t\t\t\t\tdata[endParam] = rangeEnd.format();\r\n\t\t\t\t}\r\n\t\t\t\tif (options.timezone && options.timezone != 'local') {\r\n\t\t\t\t\tdata[timezoneParam] = options.timezone;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tpushLoading();\r\n\t\t\t\t$.ajax($.extend({}, ajaxDefaults, source, {\r\n\t\t\t\t\tdata: data,\r\n\t\t\t\t\tsuccess: function(events) {\r\n\t\t\t\t\t\tevents = events || [];\r\n\t\t\t\t\t\tvar res = applyAll(success, this, arguments);\r\n\t\t\t\t\t\tif ($.isArray(res)) {\r\n\t\t\t\t\t\t\tevents = res;\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tcallback(events);\r\n\t\t\t\t\t},\r\n\t\t\t\t\terror: function() {\r\n\t\t\t\t\t\tapplyAll(error, this, arguments);\r\n\t\t\t\t\t\tcallback();\r\n\t\t\t\t\t},\r\n\t\t\t\t\tcomplete: function() {\r\n\t\t\t\t\t\tapplyAll(complete, this, arguments);\r\n\t\t\t\t\t\tpopLoading();\r\n\t\t\t\t\t}\r\n\t\t\t\t}));\r\n\t\t\t}else{\r\n\t\t\t\tcallback();\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\t\r\n\t/* Sources\r\n\t-----------------------------------------------------------------------------*/\r\n\t\r\n\r\n\tfunction addEventSource(sourceInput) {\r\n\t\tvar source = buildEventSource(sourceInput);\r\n\t\tif (source) {\r\n\t\t\tsources.push(source);\r\n\t\t\tpendingSourceCnt++;\r\n\t\t\tfetchEventSource(source, currentFetchID); // will eventually call reportEvents\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tfunction buildEventSource(sourceInput) { // will return undefined if invalid source\r\n\t\tvar normalizers = fc.sourceNormalizers;\r\n\t\tvar source;\r\n\t\tvar i;\r\n\r\n\t\tif ($.isFunction(sourceInput) || $.isArray(sourceInput)) {\r\n\t\t\tsource = { events: sourceInput };\r\n\t\t}\r\n\t\telse if (typeof sourceInput === 'string') {\r\n\t\t\tsource = { url: sourceInput };\r\n\t\t}\r\n\t\telse if (typeof sourceInput === 'object') {\r\n\t\t\tsource = $.extend({}, sourceInput); // shallow copy\r\n\t\t}\r\n\r\n\t\tif (source) {\r\n\r\n\t\t\t// TODO: repeat code, same code for event classNames\r\n\t\t\tif (source.className) {\r\n\t\t\t\tif (typeof source.className === 'string') {\r\n\t\t\t\t\tsource.className = source.className.split(/\\s+/);\r\n\t\t\t\t}\r\n\t\t\t\t// otherwise, assumed to be an array\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tsource.className = [];\r\n\t\t\t}\r\n\r\n\t\t\t// for array sources, we convert to standard Event Objects up front\r\n\t\t\tif ($.isArray(source.events)) {\r\n\t\t\t\tsource.origArray = source.events; // for removeEventSource\r\n\t\t\t\tsource.events = $.map(source.events, function(eventInput) {\r\n\t\t\t\t\treturn buildEventFromInput(eventInput, source);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\tfor (i=0; i<normalizers.length; i++) {\r\n\t\t\t\tnormalizers[i].call(t, source);\r\n\t\t\t}\r\n\r\n\t\t\treturn source;\r\n\t\t}\r\n\t}\r\n\r\n\r\n\tfunction removeEventSource(source) {\r\n\t\tsources = $.grep(sources, function(src) {\r\n\t\t\treturn !isSourcesEqual(src, source);\r\n\t\t});\r\n\t\t// remove all client events from that source\r\n\t\tcache = $.grep(cache, function(e) {\r\n\t\t\treturn !isSourcesEqual(e.source, source);\r\n\t\t});\r\n\t\treportEvents(cache);\r\n\t}\r\n\r\n\r\n\tfunction isSourcesEqual(source1, source2) {\r\n\t\treturn source1 && source2 && getSourcePrimitive(source1) == getSourcePrimitive(source2);\r\n\t}\r\n\r\n\r\n\tfunction getSourcePrimitive(source) {\r\n\t\treturn (\r\n\t\t\t(typeof source === 'object') ? // a normalized event source?\r\n\t\t\t\t(source.origArray || source.googleCalendarId || source.url || source.events) : // get the primitive\r\n\t\t\t\tnull\r\n\t\t) ||\r\n\t\tsource; // the given argument *is* the primitive\r\n\t}\r\n\t\r\n\t\r\n\t\r\n\t/* Manipulation\r\n\t-----------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Only ever called from the externally-facing API\r\n\tfunction updateEvent(event) {\r\n\r\n\t\t// massage start/end values, even if date string values\r\n\t\tevent.start = t.moment(event.start);\r\n\t\tif (event.end) {\r\n\t\t\tevent.end = t.moment(event.end);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tevent.end = null;\r\n\t\t}\r\n\r\n\t\tmutateEvent(event, getMiscEventProps(event)); // will handle start/end/allDay normalization\r\n\t\treportEvents(cache); // reports event modifications (so we can redraw)\r\n\t}\r\n\r\n\r\n\t// Returns a hash of misc event properties that should be copied over to related events.\r\n\tfunction getMiscEventProps(event) {\r\n\t\tvar props = {};\r\n\r\n\t\t$.each(event, function(name, val) {\r\n\t\t\tif (isMiscEventPropName(name)) {\r\n\t\t\t\tif (val !== undefined && isAtomic(val)) { // a defined non-object\r\n\t\t\t\t\tprops[name] = val;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn props;\r\n\t}\r\n\r\n\t// non-date-related, non-id-related, non-secret\r\n\tfunction isMiscEventPropName(name) {\r\n\t\treturn !/^_|^(id|allDay|start|end)$/.test(name);\r\n\t}\r\n\r\n\t\r\n\t// returns the expanded events that were created\r\n\tfunction renderEvent(eventInput, stick) {\r\n\t\tvar abstractEvent = buildEventFromInput(eventInput);\r\n\t\tvar events;\r\n\t\tvar i, event;\r\n\r\n\t\tif (abstractEvent) { // not false (a valid input)\r\n\t\t\tevents = expandEvent(abstractEvent);\r\n\r\n\t\t\tfor (i = 0; i < events.length; i++) {\r\n\t\t\t\tevent = events[i];\r\n\r\n\t\t\t\tif (!event.source) {\r\n\t\t\t\t\tif (stick) {\r\n\t\t\t\t\t\tstickySource.events.push(event);\r\n\t\t\t\t\t\tevent.source = stickySource;\r\n\t\t\t\t\t}\r\n\t\t\t\t\tcache.push(event);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\treportEvents(cache);\r\n\r\n\t\t\treturn events;\r\n\t\t}\r\n\r\n\t\treturn [];\r\n\t}\r\n\t\r\n\t\r\n\tfunction removeEvents(filter) {\r\n\t\tvar eventID;\r\n\t\tvar i;\r\n\r\n\t\tif (filter == null) { // null or undefined. remove all events\r\n\t\t\tfilter = function() { return true; }; // will always match\r\n\t\t}\r\n\t\telse if (!$.isFunction(filter)) { // an event ID\r\n\t\t\teventID = filter + '';\r\n\t\t\tfilter = function(event) {\r\n\t\t\t\treturn event._id == eventID;\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\t// Purge event(s) from our local cache\r\n\t\tcache = $.grep(cache, filter, true); // inverse=true\r\n\r\n\t\t// Remove events from array sources.\r\n\t\t// This works because they have been converted to official Event Objects up front.\r\n\t\t// (and as a result, event._id has been calculated).\r\n\t\tfor (i=0; i<sources.length; i++) {\r\n\t\t\tif ($.isArray(sources[i].events)) {\r\n\t\t\t\tsources[i].events = $.grep(sources[i].events, filter, true);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treportEvents(cache);\r\n\t}\r\n\t\r\n\t\r\n\tfunction clientEvents(filter) {\r\n\t\tif ($.isFunction(filter)) {\r\n\t\t\treturn $.grep(cache, filter);\r\n\t\t}\r\n\t\telse if (filter != null) { // not null, not undefined. an event ID\r\n\t\t\tfilter += '';\r\n\t\t\treturn $.grep(cache, function(e) {\r\n\t\t\t\treturn e._id == filter;\r\n\t\t\t});\r\n\t\t}\r\n\t\treturn cache; // else, return all\r\n\t}\r\n\t\r\n\t\r\n\t\r\n\t/* Loading State\r\n\t-----------------------------------------------------------------------------*/\r\n\t\r\n\t\r\n\tfunction pushLoading() {\r\n\t\tif (!(loadingLevel++)) {\r\n\t\t\ttrigger('loading', null, true, getView());\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\tfunction popLoading() {\r\n\t\tif (!(--loadingLevel)) {\r\n\t\t\ttrigger('loading', null, false, getView());\r\n\t\t}\r\n\t}\r\n\t\r\n\t\r\n\t\r\n\t/* Event Normalization\r\n\t-----------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Given a raw object with key/value properties, returns an \"abstract\" Event object.\r\n\t// An \"abstract\" event is an event that, if recurring, will not have been expanded yet.\r\n\t// Will return `false` when input is invalid.\r\n\t// `source` is optional\r\n\tfunction buildEventFromInput(input, source) {\r\n\t\tvar out = {};\r\n\t\tvar start, end;\r\n\t\tvar allDay;\r\n\r\n\t\tif (options.eventDataTransform) {\r\n\t\t\tinput = options.eventDataTransform(input);\r\n\t\t}\r\n\t\tif (source && source.eventDataTransform) {\r\n\t\t\tinput = source.eventDataTransform(input);\r\n\t\t}\r\n\r\n\t\t// Copy all properties over to the resulting object.\r\n\t\t// The special-case properties will be copied over afterwards.\r\n\t\t$.extend(out, input);\r\n\r\n\t\tif (source) {\r\n\t\t\tout.source = source;\r\n\t\t}\r\n\r\n\t\tout._id = input._id || (input.id === undefined ? '_fc' + eventGUID++ : input.id + '');\r\n\r\n\t\tif (input.className) {\r\n\t\t\tif (typeof input.className == 'string') {\r\n\t\t\t\tout.className = input.className.split(/\\s+/);\r\n\t\t\t}\r\n\t\t\telse { // assumed to be an array\r\n\t\t\t\tout.className = input.className;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tout.className = [];\r\n\t\t}\r\n\r\n\t\tstart = input.start || input.date; // \"date\" is an alias for \"start\"\r\n\t\tend = input.end;\r\n\r\n\t\t// parse as a time (Duration) if applicable\r\n\t\tif (isTimeString(start)) {\r\n\t\t\tstart = moment.duration(start);\r\n\t\t}\r\n\t\tif (isTimeString(end)) {\r\n\t\t\tend = moment.duration(end);\r\n\t\t}\r\n\r\n\t\tif (input.dow || moment.isDuration(start) || moment.isDuration(end)) {\r\n\r\n\t\t\t// the event is \"abstract\" (recurring) so don't calculate exact start/end dates just yet\r\n\t\t\tout.start = start ? moment.duration(start) : null; // will be a Duration or null\r\n\t\t\tout.end = end ? moment.duration(end) : null; // will be a Duration or null\r\n\t\t\tout._recurring = true; // our internal marker\r\n\t\t}\r\n\t\telse {\r\n\r\n\t\t\tif (start) {\r\n\t\t\t\tstart = t.moment(start);\r\n\t\t\t\tif (!start.isValid()) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (end) {\r\n\t\t\t\tend = t.moment(end);\r\n\t\t\t\tif (!end.isValid()) {\r\n\t\t\t\t\tend = null; // let defaults take over\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tallDay = input.allDay;\r\n\t\t\tif (allDay === undefined) { // still undefined? fallback to default\r\n\t\t\t\tallDay = firstDefined(\r\n\t\t\t\t\tsource ? source.allDayDefault : undefined,\r\n\t\t\t\t\toptions.allDayDefault\r\n\t\t\t\t);\r\n\t\t\t\t// still undefined? normalizeEventRange will calculate it\r\n\t\t\t}\r\n\r\n\t\t\tassignDatesToEvent(start, end, allDay, out);\r\n\t\t}\r\n\r\n\t\treturn out;\r\n\t}\r\n\r\n\r\n\t// Normalizes and assigns the given dates to the given partially-formed event object.\r\n\t// NOTE: mutates the given start/end moments. does not make a copy.\r\n\tfunction assignDatesToEvent(start, end, allDay, event) {\r\n\t\tevent.start = start;\r\n\t\tevent.end = end;\r\n\t\tevent.allDay = allDay;\r\n\t\tnormalizeEventRange(event);\r\n\t\tbackupEventDates(event);\r\n\t}\r\n\r\n\r\n\t// Ensures proper values for allDay/start/end. Accepts an Event object, or a plain object with event-ish properties.\r\n\t// NOTE: Will modify the given object.\r\n\tfunction normalizeEventRange(props) {\r\n\r\n\t\tnormalizeEventRangeTimes(props);\r\n\r\n\t\tif (props.end && !props.end.isAfter(props.start)) {\r\n\t\t\tprops.end = null;\r\n\t\t}\r\n\r\n\t\tif (!props.end) {\r\n\t\t\tif (options.forceEventDuration) {\r\n\t\t\t\tprops.end = t.getDefaultEventEnd(props.allDay, props.start);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tprops.end = null;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t// Ensures the allDay property exists and the timeliness of the start/end dates are consistent\r\n\tfunction normalizeEventRangeTimes(range) {\r\n\t\tif (range.allDay == null) {\r\n\t\t\trange.allDay = !(range.start.hasTime() || (range.end && range.end.hasTime()));\r\n\t\t}\r\n\r\n\t\tif (range.allDay) {\r\n\t\t\trange.start.stripTime();\r\n\t\t\tif (range.end) {\r\n\t\t\t\t// TODO: consider nextDayThreshold here? If so, will require a lot of testing and adjustment\r\n\t\t\t\trange.end.stripTime();\r\n\t\t\t}\r\n\t\t}\r\n\t\telse {\r\n\t\t\tif (!range.start.hasTime()) {\r\n\t\t\t\trange.start = t.rezoneDate(range.start); // will assign a 00:00 time\r\n\t\t\t}\r\n\t\t\tif (range.end && !range.end.hasTime()) {\r\n\t\t\t\trange.end = t.rezoneDate(range.end); // will assign a 00:00 time\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t// If `range` is a proper range with a start and end, returns the original object.\r\n\t// If missing an end, computes a new range with an end, computing it as if it were an event.\r\n\t// TODO: make this a part of the event -> eventRange system\r\n\tfunction ensureVisibleEventRange(range) {\r\n\t\tvar allDay;\r\n\r\n\t\tif (!range.end) {\r\n\r\n\t\t\tallDay = range.allDay; // range might be more event-ish than we think\r\n\t\t\tif (allDay == null) {\r\n\t\t\t\tallDay = !range.start.hasTime();\r\n\t\t\t}\r\n\r\n\t\t\trange = $.extend({}, range); // make a copy, copying over other misc properties\r\n\t\t\trange.end = t.getDefaultEventEnd(allDay, range.start);\r\n\t\t}\r\n\t\treturn range;\r\n\t}\r\n\r\n\r\n\t// If the given event is a recurring event, break it down into an array of individual instances.\r\n\t// If not a recurring event, return an array with the single original event.\r\n\t// If given a falsy input (probably because of a failed buildEventFromInput call), returns an empty array.\r\n\t// HACK: can override the recurring window by providing custom rangeStart/rangeEnd (for businessHours).\r\n\tfunction expandEvent(abstractEvent, _rangeStart, _rangeEnd) {\r\n\t\tvar events = [];\r\n\t\tvar dowHash;\r\n\t\tvar dow;\r\n\t\tvar i;\r\n\t\tvar date;\r\n\t\tvar startTime, endTime;\r\n\t\tvar start, end;\r\n\t\tvar event;\r\n\r\n\t\t_rangeStart = _rangeStart || rangeStart;\r\n\t\t_rangeEnd = _rangeEnd || rangeEnd;\r\n\r\n\t\tif (abstractEvent) {\r\n\t\t\tif (abstractEvent._recurring) {\r\n\r\n\t\t\t\t// make a boolean hash as to whether the event occurs on each day-of-week\r\n\t\t\t\tif ((dow = abstractEvent.dow)) {\r\n\t\t\t\t\tdowHash = {};\r\n\t\t\t\t\tfor (i = 0; i < dow.length; i++) {\r\n\t\t\t\t\t\tdowHash[dow[i]] = true;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// iterate through every day in the current range\r\n\t\t\t\tdate = _rangeStart.clone().stripTime(); // holds the date of the current day\r\n\t\t\t\twhile (date.isBefore(_rangeEnd)) {\r\n\r\n\t\t\t\t\tif (!dowHash || dowHash[date.day()]) { // if everyday, or this particular day-of-week\r\n\r\n\t\t\t\t\t\tstartTime = abstractEvent.start; // the stored start and end properties are times (Durations)\r\n\t\t\t\t\t\tendTime = abstractEvent.end; // \"\r\n\t\t\t\t\t\tstart = date.clone();\r\n\t\t\t\t\t\tend = null;\r\n\r\n\t\t\t\t\t\tif (startTime) {\r\n\t\t\t\t\t\t\tstart = start.time(startTime);\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\tif (endTime) {\r\n\t\t\t\t\t\t\tend = date.clone().time(endTime);\r\n\t\t\t\t\t\t}\r\n\r\n\t\t\t\t\t\tevent = $.extend({}, abstractEvent); // make a copy of the original\r\n\t\t\t\t\t\tassignDatesToEvent(\r\n\t\t\t\t\t\t\tstart, end,\r\n\t\t\t\t\t\t\t!startTime && !endTime, // allDay?\r\n\t\t\t\t\t\t\tevent\r\n\t\t\t\t\t\t);\r\n\t\t\t\t\t\tevents.push(event);\r\n\t\t\t\t\t}\r\n\r\n\t\t\t\t\tdate.add(1, 'days');\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tevents.push(abstractEvent); // return the original event. will be a one-item array\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn events;\r\n\t}\r\n\r\n\r\n\r\n\t/* Event Modification Math\r\n\t-----------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Modifies an event and all related events by applying the given properties.\r\n\t// Special date-diffing logic is used for manipulation of dates.\r\n\t// If `props` does not contain start/end dates, the updated values are assumed to be the event's current start/end.\r\n\t// All date comparisons are done against the event's pristine _start and _end dates.\r\n\t// Returns an object with delta information and a function to undo all operations.\r\n\t// For making computations in a granularity greater than day/time, specify largeUnit.\r\n\t// NOTE: The given `newProps` might be mutated for normalization purposes.\r\n\tfunction mutateEvent(event, newProps, largeUnit) {\r\n\t\tvar miscProps = {};\r\n\t\tvar oldProps;\r\n\t\tvar clearEnd;\r\n\t\tvar startDelta;\r\n\t\tvar endDelta;\r\n\t\tvar durationDelta;\r\n\t\tvar undoFunc;\r\n\r\n\t\t// diffs the dates in the appropriate way, returning a duration\r\n\t\tfunction diffDates(date1, date0) { // date1 - date0\r\n\t\t\tif (largeUnit) {\r\n\t\t\t\treturn diffByUnit(date1, date0, largeUnit);\r\n\t\t\t}\r\n\t\t\telse if (newProps.allDay) {\r\n\t\t\t\treturn diffDay(date1, date0);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\treturn diffDayTime(date1, date0);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tnewProps = newProps || {};\r\n\r\n\t\t// normalize new date-related properties\r\n\t\tif (!newProps.start) {\r\n\t\t\tnewProps.start = event.start.clone();\r\n\t\t}\r\n\t\tif (newProps.end === undefined) {\r\n\t\t\tnewProps.end = event.end ? event.end.clone() : null;\r\n\t\t}\r\n\t\tif (newProps.allDay == null) { // is null or undefined?\r\n\t\t\tnewProps.allDay = event.allDay;\r\n\t\t}\r\n\t\tnormalizeEventRange(newProps);\r\n\r\n\t\t// create normalized versions of the original props to compare against\r\n\t\t// need a real end value, for diffing\r\n\t\toldProps = {\r\n\t\t\tstart: event._start.clone(),\r\n\t\t\tend: event._end ? event._end.clone() : t.getDefaultEventEnd(event._allDay, event._start),\r\n\t\t\tallDay: newProps.allDay // normalize the dates in the same regard as the new properties\r\n\t\t};\r\n\t\tnormalizeEventRange(oldProps);\r\n\r\n\t\t// need to clear the end date if explicitly changed to null\r\n\t\tclearEnd = event._end !== null && newProps.end === null;\r\n\r\n\t\t// compute the delta for moving the start date\r\n\t\tstartDelta = diffDates(newProps.start, oldProps.start);\r\n\r\n\t\t// compute the delta for moving the end date\r\n\t\tif (newProps.end) {\r\n\t\t\tendDelta = diffDates(newProps.end, oldProps.end);\r\n\t\t\tdurationDelta = endDelta.subtract(startDelta);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdurationDelta = null;\r\n\t\t}\r\n\r\n\t\t// gather all non-date-related properties\r\n\t\t$.each(newProps, function(name, val) {\r\n\t\t\tif (isMiscEventPropName(name)) {\r\n\t\t\t\tif (val !== undefined) {\r\n\t\t\t\t\tmiscProps[name] = val;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// apply the operations to the event and all related events\r\n\t\tundoFunc = mutateEvents(\r\n\t\t\tclientEvents(event._id), // get events with this ID\r\n\t\t\tclearEnd,\r\n\t\t\tnewProps.allDay,\r\n\t\t\tstartDelta,\r\n\t\t\tdurationDelta,\r\n\t\t\tmiscProps\r\n\t\t);\r\n\r\n\t\treturn {\r\n\t\t\tdateDelta: startDelta,\r\n\t\t\tdurationDelta: durationDelta,\r\n\t\t\tundo: undoFunc\r\n\t\t};\r\n\t}\r\n\r\n\r\n\t// Modifies an array of events in the following ways (operations are in order):\r\n\t// - clear the event's `end`\r\n\t// - convert the event to allDay\r\n\t// - add `dateDelta` to the start and end\r\n\t// - add `durationDelta` to the event's duration\r\n\t// - assign `miscProps` to the event\r\n\t//\r\n\t// Returns a function that can be called to undo all the operations.\r\n\t//\r\n\t// TODO: don't use so many closures. possible memory issues when lots of events with same ID.\r\n\t//\r\n\tfunction mutateEvents(events, clearEnd, allDay, dateDelta, durationDelta, miscProps) {\r\n\t\tvar isAmbigTimezone = t.getIsAmbigTimezone();\r\n\t\tvar undoFunctions = [];\r\n\r\n\t\t// normalize zero-length deltas to be null\r\n\t\tif (dateDelta && !dateDelta.valueOf()) { dateDelta = null; }\r\n\t\tif (durationDelta && !durationDelta.valueOf()) { durationDelta = null; }\r\n\r\n\t\t$.each(events, function(i, event) {\r\n\t\t\tvar oldProps;\r\n\t\t\tvar newProps;\r\n\r\n\t\t\t// build an object holding all the old values, both date-related and misc.\r\n\t\t\t// for the undo function.\r\n\t\t\toldProps = {\r\n\t\t\t\tstart: event.start.clone(),\r\n\t\t\t\tend: event.end ? event.end.clone() : null,\r\n\t\t\t\tallDay: event.allDay\r\n\t\t\t};\r\n\t\t\t$.each(miscProps, function(name) {\r\n\t\t\t\toldProps[name] = event[name];\r\n\t\t\t});\r\n\r\n\t\t\t// new date-related properties. work off the original date snapshot.\r\n\t\t\t// ok to use references because they will be thrown away when backupEventDates is called.\r\n\t\t\tnewProps = {\r\n\t\t\t\tstart: event._start,\r\n\t\t\t\tend: event._end,\r\n\t\t\t\tallDay: allDay // normalize the dates in the same regard as the new properties\r\n\t\t\t};\r\n\t\t\tnormalizeEventRange(newProps); // massages start/end/allDay\r\n\r\n\t\t\t// strip or ensure the end date\r\n\t\t\tif (clearEnd) {\r\n\t\t\t\tnewProps.end = null;\r\n\t\t\t}\r\n\t\t\telse if (durationDelta && !newProps.end) { // the duration translation requires an end date\r\n\t\t\t\tnewProps.end = t.getDefaultEventEnd(newProps.allDay, newProps.start);\r\n\t\t\t}\r\n\r\n\t\t\tif (dateDelta) {\r\n\t\t\t\tnewProps.start.add(dateDelta);\r\n\t\t\t\tif (newProps.end) {\r\n\t\t\t\t\tnewProps.end.add(dateDelta);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (durationDelta) {\r\n\t\t\t\tnewProps.end.add(durationDelta); // end already ensured above\r\n\t\t\t}\r\n\r\n\t\t\t// if the dates have changed, and we know it is impossible to recompute the\r\n\t\t\t// timezone offsets, strip the zone.\r\n\t\t\tif (\r\n\t\t\t\tisAmbigTimezone &&\r\n\t\t\t\t!newProps.allDay &&\r\n\t\t\t\t(dateDelta || durationDelta)\r\n\t\t\t) {\r\n\t\t\t\tnewProps.start.stripZone();\r\n\t\t\t\tif (newProps.end) {\r\n\t\t\t\t\tnewProps.end.stripZone();\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t$.extend(event, miscProps, newProps); // copy over misc props, then date-related props\r\n\t\t\tbackupEventDates(event); // regenerate internal _start/_end/_allDay\r\n\r\n\t\t\tundoFunctions.push(function() {\r\n\t\t\t\t$.extend(event, oldProps);\r\n\t\t\t\tbackupEventDates(event); // regenerate internal _start/_end/_allDay\r\n\t\t\t});\r\n\t\t});\r\n\r\n\t\treturn function() {\r\n\t\t\tfor (var i = 0; i < undoFunctions.length; i++) {\r\n\t\t\t\tundoFunctions[i]();\r\n\t\t\t}\r\n\t\t};\r\n\t}\r\n\r\n\r\n\t/* Business Hours\r\n\t-----------------------------------------------------------------------------------------*/\r\n\r\n\tt.getBusinessHoursEvents = getBusinessHoursEvents;\r\n\r\n\r\n\t// Returns an array of events as to when the business hours occur in the given view.\r\n\t// Abuse of our event system :(\r\n\tfunction getBusinessHoursEvents(wholeDay) {\r\n\t\tvar optionVal = options.businessHours;\r\n\t\tvar defaultVal = {\r\n\t\t\tclassName: 'fc-nonbusiness',\r\n\t\t\tstart: '09:00',\r\n\t\t\tend: '17:00',\r\n\t\t\tdow: [ 1, 2, 3, 4, 5 ], // monday - friday\r\n\t\t\trendering: 'inverse-background'\r\n\t\t};\r\n\t\tvar view = t.getView();\r\n\t\tvar eventInput;\r\n\r\n\t\tif (optionVal) { // `true` (which means \"use the defaults\") or an override object\r\n\t\t\teventInput = $.extend(\r\n\t\t\t\t{}, // copy to a new object in either case\r\n\t\t\t\tdefaultVal,\r\n\t\t\t\ttypeof optionVal === 'object' ? optionVal : {} // override the defaults\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\tif (eventInput) {\r\n\r\n\t\t\t// if a whole-day series is requested, clear the start/end times\r\n\t\t\tif (wholeDay) {\r\n\t\t\t\teventInput.start = null;\r\n\t\t\t\teventInput.end = null;\r\n\t\t\t}\r\n\r\n\t\t\treturn expandEvent(\r\n\t\t\t\tbuildEventFromInput(eventInput),\r\n\t\t\t\tview.start,\r\n\t\t\t\tview.end\r\n\t\t\t);\r\n\t\t}\r\n\r\n\t\treturn [];\r\n\t}\r\n\r\n\r\n\t/* Overlapping / Constraining\r\n\t-----------------------------------------------------------------------------------------*/\r\n\r\n\tt.isEventRangeAllowed = isEventRangeAllowed;\r\n\tt.isSelectionRangeAllowed = isSelectionRangeAllowed;\r\n\tt.isExternalDropRangeAllowed = isExternalDropRangeAllowed;\r\n\r\n\r\n\tfunction isEventRangeAllowed(range, event) {\r\n\t\tvar source = event.source || {};\r\n\t\tvar constraint = firstDefined(\r\n\t\t\tevent.constraint,\r\n\t\t\tsource.constraint,\r\n\t\t\toptions.eventConstraint\r\n\t\t);\r\n\t\tvar overlap = firstDefined(\r\n\t\t\tevent.overlap,\r\n\t\t\tsource.overlap,\r\n\t\t\toptions.eventOverlap\r\n\t\t);\r\n\r\n\t\trange = ensureVisibleEventRange(range); // ensure a proper range with an end for isRangeAllowed\r\n\r\n\t\treturn isRangeAllowed(range, constraint, overlap, event);\r\n\t}\r\n\r\n\r\n\tfunction isSelectionRangeAllowed(range) {\r\n\t\treturn isRangeAllowed(range, options.selectConstraint, options.selectOverlap);\r\n\t}\r\n\r\n\r\n\t// when `eventProps` is defined, consider this an event.\r\n\t// `eventProps` can contain misc non-date-related info about the event.\r\n\tfunction isExternalDropRangeAllowed(range, eventProps) {\r\n\t\tvar eventInput;\r\n\t\tvar event;\r\n\r\n\t\t// note: very similar logic is in View's reportExternalDrop\r\n\t\tif (eventProps) {\r\n\t\t\teventInput = $.extend({}, eventProps, range);\r\n\t\t\tevent = expandEvent(buildEventFromInput(eventInput))[0];\r\n\t\t}\r\n\r\n\t\tif (event) {\r\n\t\t\treturn isEventRangeAllowed(range, event);\r\n\t\t}\r\n\t\telse { // treat it as a selection\r\n\r\n\t\t\trange = ensureVisibleEventRange(range); // ensure a proper range with an end for isSelectionRangeAllowed\r\n\r\n\t\t\treturn isSelectionRangeAllowed(range);\r\n\t\t}\r\n\t}\r\n\r\n\r\n\t// Returns true if the given range (caused by an event drop/resize or a selection) is allowed to exist\r\n\t// according to the constraint/overlap settings.\r\n\t// `event` is not required if checking a selection.\r\n\tfunction isRangeAllowed(range, constraint, overlap, event) {\r\n\t\tvar constraintEvents;\r\n\t\tvar anyContainment;\r\n\t\tvar peerEvents;\r\n\t\tvar i, peerEvent;\r\n\t\tvar peerOverlap;\r\n\r\n\t\t// normalize. fyi, we're normalizing in too many places :(\r\n\t\trange = $.extend({}, range); // copy all properties in case there are misc non-date properties\r\n\t\trange.start = range.start.clone().stripZone();\r\n\t\trange.end = range.end.clone().stripZone();\r\n\r\n\t\t// the range must be fully contained by at least one of produced constraint events\r\n\t\tif (constraint != null) {\r\n\r\n\t\t\t// not treated as an event! intermediate data structure\r\n\t\t\t// TODO: use ranges in the future\r\n\t\t\tconstraintEvents = constraintToEvents(constraint);\r\n\r\n\t\t\tanyContainment = false;\r\n\t\t\tfor (i = 0; i < constraintEvents.length; i++) {\r\n\t\t\t\tif (eventContainsRange(constraintEvents[i], range)) {\r\n\t\t\t\t\tanyContainment = true;\r\n\t\t\t\t\tbreak;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!anyContainment) {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tpeerEvents = t.getPeerEvents(event, range);\r\n\r\n\t\tfor (i = 0; i < peerEvents.length; i++)  {\r\n\t\t\tpeerEvent = peerEvents[i];\r\n\r\n\t\t\t// there needs to be an actual intersection before disallowing anything\r\n\t\t\tif (eventIntersectsRange(peerEvent, range)) {\r\n\r\n\t\t\t\t// evaluate overlap for the given range and short-circuit if necessary\r\n\t\t\t\tif (overlap === false) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\t\t\t\t// if the event's overlap is a test function, pass the peer event in question as the first param\r\n\t\t\t\telse if (typeof overlap === 'function' && !overlap(peerEvent, event)) {\r\n\t\t\t\t\treturn false;\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// if we are computing if the given range is allowable for an event, consider the other event's\r\n\t\t\t\t// EventObject-specific or Source-specific `overlap` property\r\n\t\t\t\tif (event) {\r\n\t\t\t\t\tpeerOverlap = firstDefined(\r\n\t\t\t\t\t\tpeerEvent.overlap,\r\n\t\t\t\t\t\t(peerEvent.source || {}).overlap\r\n\t\t\t\t\t\t// we already considered the global `eventOverlap`\r\n\t\t\t\t\t);\r\n\t\t\t\t\tif (peerOverlap === false) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t\t// if the peer event's overlap is a test function, pass the subject event as the first param\r\n\t\t\t\t\tif (typeof peerOverlap === 'function' && !peerOverlap(event, peerEvent)) {\r\n\t\t\t\t\t\treturn false;\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn true;\r\n\t}\r\n\r\n\r\n\t// Given an event input from the API, produces an array of event objects. Possible event inputs:\r\n\t// 'businessHours'\r\n\t// An event ID (number or string)\r\n\t// An object with specific start/end dates or a recurring event (like what businessHours accepts)\r\n\tfunction constraintToEvents(constraintInput) {\r\n\r\n\t\tif (constraintInput === 'businessHours') {\r\n\t\t\treturn getBusinessHoursEvents();\r\n\t\t}\r\n\r\n\t\tif (typeof constraintInput === 'object') {\r\n\t\t\treturn expandEvent(buildEventFromInput(constraintInput));\r\n\t\t}\r\n\r\n\t\treturn clientEvents(constraintInput); // probably an ID\r\n\t}\r\n\r\n\r\n\t// Does the event's date range fully contain the given range?\r\n\t// start/end already assumed to have stripped zones :(\r\n\tfunction eventContainsRange(event, range) {\r\n\t\tvar eventStart = event.start.clone().stripZone();\r\n\t\tvar eventEnd = t.getEventEnd(event).stripZone();\r\n\r\n\t\treturn range.start >= eventStart && range.end <= eventEnd;\r\n\t}\r\n\r\n\r\n\t// Does the event's date range intersect with the given range?\r\n\t// start/end already assumed to have stripped zones :(\r\n\tfunction eventIntersectsRange(event, range) {\r\n\t\tvar eventStart = event.start.clone().stripZone();\r\n\t\tvar eventEnd = t.getEventEnd(event).stripZone();\r\n\r\n\t\treturn range.start < eventEnd && range.end > eventStart;\r\n\t}\r\n\r\n\r\n\tt.getEventCache = function() {\r\n\t\treturn cache;\r\n\t};\r\n\r\n}\r\n\r\n\r\n// Returns a list of events that the given event should be compared against when being considered for a move to\r\n// the specified range. Attached to the Calendar's prototype because EventManager is a mixin for a Calendar.\r\nCalendar.prototype.getPeerEvents = function(event, range) {\r\n\tvar cache = this.getEventCache();\r\n\tvar peerEvents = [];\r\n\tvar i, otherEvent;\r\n\r\n\tfor (i = 0; i < cache.length; i++) {\r\n\t\totherEvent = cache[i];\r\n\t\tif (\r\n\t\t\t!event ||\r\n\t\t\tevent._id !== otherEvent._id // don't compare the event to itself or other related [repeating] events\r\n\t\t) {\r\n\t\t\tpeerEvents.push(otherEvent);\r\n\t\t}\r\n\t}\r\n\r\n\treturn peerEvents;\r\n};\r\n\r\n\r\n// updates the \"backup\" properties, which are preserved in order to compute diffs later on.\r\nfunction backupEventDates(event) {\r\n\tevent._allDay = event.allDay;\r\n\tevent._start = event.start.clone();\r\n\tevent._end = event.end ? event.end.clone() : null;\r\n}\r\n\r\n;;\r\n\r\n/* An abstract class for the \"basic\" views, as well as month view. Renders one or more rows of day cells.\r\n----------------------------------------------------------------------------------------------------------------------*/\r\n// It is a manager for a DayGrid subcomponent, which does most of the heavy lifting.\r\n// It is responsible for managing width/height.\r\n\r\nvar BasicView = fcViews.basic = View.extend({\r\n\r\n\tdayGrid: null, // the main subcomponent that does most of the heavy lifting\r\n\r\n\tdayNumbersVisible: false, // display day numbers on each day cell?\r\n\tweekNumbersVisible: false, // display week numbers along the side?\r\n\r\n\tweekNumberWidth: null, // width of all the week-number cells running down the side\r\n\r\n\theadRowEl: null, // the fake row element of the day-of-week header\r\n\r\n\r\n\tinitialize: function() {\r\n\t\tthis.dayGrid = new DayGrid(this);\r\n\t\tthis.coordMap = this.dayGrid.coordMap; // the view's date-to-cell mapping is identical to the subcomponent's\r\n\t},\r\n\r\n\r\n\t// Sets the display range and computes all necessary dates\r\n\tsetRange: function(range) {\r\n\t\tView.prototype.setRange.call(this, range); // call the super-method\r\n\r\n\t\tthis.dayGrid.breakOnWeeks = /year|month|week/.test(this.intervalUnit); // do before setRange\r\n\t\tthis.dayGrid.setRange(range);\r\n\t},\r\n\r\n\r\n\t// Compute the value to feed into setRange. Overrides superclass.\r\n\tcomputeRange: function(date) {\r\n\t\tvar range = View.prototype.computeRange.call(this, date); // get value from the super-method\r\n\r\n\t\t// year and month views should be aligned with weeks. this is already done for week\r\n\t\tif (/year|month/.test(range.intervalUnit)) {\r\n\t\t\trange.start.startOf('week');\r\n\t\t\trange.start = this.skipHiddenDays(range.start);\r\n\r\n\t\t\t// make end-of-week if not already\r\n\t\t\tif (range.end.weekday()) {\r\n\t\t\t\trange.end.add(1, 'week').startOf('week');\r\n\t\t\t\trange.end = this.skipHiddenDays(range.end, -1, true); // exclusively move backwards\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn range;\r\n\t},\r\n\r\n\r\n\t// Renders the view into `this.el`, which should already be assigned\r\n\trender: function() {\r\n\r\n\t\tthis.dayNumbersVisible = this.dayGrid.rowCnt > 1; // TODO: make grid responsible\r\n\t\tthis.weekNumbersVisible = this.opt('weekNumbers');\r\n\t\tthis.dayGrid.numbersVisible = this.dayNumbersVisible || this.weekNumbersVisible;\r\n\r\n\t\tthis.el.addClass('fc-basic-view').html(this.renderHtml());\r\n\r\n\t\tthis.headRowEl = this.el.find('thead .fc-row');\r\n\r\n\t\tthis.scrollerEl = this.el.find('.fc-day-grid-container');\r\n\t\tthis.dayGrid.coordMap.containerEl = this.scrollerEl; // constrain clicks/etc to the dimensions of the scroller\r\n\r\n\t\tthis.dayGrid.setElement(this.el.find('.fc-day-grid'));\r\n\t\tthis.dayGrid.renderDates(this.hasRigidRows());\r\n\t},\r\n\r\n\r\n\t// Unrenders the content of the view. Since we haven't separated skeleton rendering from date rendering,\r\n\t// always completely kill the dayGrid's rendering.\r\n\tdestroy: function() {\r\n\t\tthis.dayGrid.destroyDates();\r\n\t\tthis.dayGrid.removeElement();\r\n\t},\r\n\r\n\r\n\trenderBusinessHours: function() {\r\n\t\tthis.dayGrid.renderBusinessHours();\r\n\t},\r\n\r\n\r\n\t// Builds the HTML skeleton for the view.\r\n\t// The day-grid component will render inside of a container defined by this HTML.\r\n\trenderHtml: function() {\r\n\t\treturn '' +\r\n\t\t\t'<table>' +\r\n\t\t\t\t'<thead class=\"fc-head\">' +\r\n\t\t\t\t\t'<tr>' +\r\n\t\t\t\t\t\t'<td class=\"' + this.widgetHeaderClass + '\">' +\r\n\t\t\t\t\t\t\tthis.dayGrid.headHtml() + // render the day-of-week headers\r\n\t\t\t\t\t\t'</td>' +\r\n\t\t\t\t\t'</tr>' +\r\n\t\t\t\t'</thead>' +\r\n\t\t\t\t'<tbody class=\"fc-body\">' +\r\n\t\t\t\t\t'<tr>' +\r\n\t\t\t\t\t\t'<td class=\"' + this.widgetContentClass + '\">' +\r\n\t\t\t\t\t\t\t'<div class=\"fc-day-grid-container\">' +\r\n\t\t\t\t\t\t\t\t'<div class=\"fc-day-grid\"/>' +\r\n\t\t\t\t\t\t\t'</div>' +\r\n\t\t\t\t\t\t'</td>' +\r\n\t\t\t\t\t'</tr>' +\r\n\t\t\t\t'</tbody>' +\r\n\t\t\t'</table>';\r\n\t},\r\n\r\n\r\n\t// Generates the HTML that will go before the day-of week header cells.\r\n\t// Queried by the DayGrid subcomponent when generating rows. Ordering depends on isRTL.\r\n\theadIntroHtml: function() {\r\n\t\tif (this.weekNumbersVisible) {\r\n\t\t\treturn '' +\r\n\t\t\t\t'<th class=\"fc-week-number ' + this.widgetHeaderClass + '\" ' + this.weekNumberStyleAttr() + '>' +\r\n\t\t\t\t\t'<span>' + // needed for matchCellWidths\r\n\t\t\t\t\t\thtmlEscape(this.opt('weekNumberTitle')) +\r\n\t\t\t\t\t'</span>' +\r\n\t\t\t\t'</th>';\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Generates the HTML that will go before content-skeleton cells that display the day/week numbers.\r\n\t// Queried by the DayGrid subcomponent. Ordering depends on isRTL.\r\n\tnumberIntroHtml: function(row) {\r\n\t\tif (this.weekNumbersVisible) {\r\n\t\t\treturn '' +\r\n\t\t\t\t'<td class=\"fc-week-number\" ' + this.weekNumberStyleAttr() + '>' +\r\n\t\t\t\t\t'<span>' + // needed for matchCellWidths\r\n\t\t\t\t\t\tthis.dayGrid.getCell(row, 0).start.format('w') +\r\n\t\t\t\t\t'</span>' +\r\n\t\t\t\t'</td>';\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Generates the HTML that goes before the day bg cells for each day-row.\r\n\t// Queried by the DayGrid subcomponent. Ordering depends on isRTL.\r\n\tdayIntroHtml: function() {\r\n\t\tif (this.weekNumbersVisible) {\r\n\t\t\treturn '<td class=\"fc-week-number ' + this.widgetContentClass + '\" ' +\r\n\t\t\t\tthis.weekNumberStyleAttr() + '></td>';\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Generates the HTML that goes before every other type of row generated by DayGrid. Ordering depends on isRTL.\r\n\t// Affects helper-skeleton and highlight-skeleton rows.\r\n\tintroHtml: function() {\r\n\t\tif (this.weekNumbersVisible) {\r\n\t\t\treturn '<td class=\"fc-week-number\" ' + this.weekNumberStyleAttr() + '></td>';\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Generates the HTML for the <td>s of the \"number\" row in the DayGrid's content skeleton.\r\n\t// The number row will only exist if either day numbers or week numbers are turned on.\r\n\tnumberCellHtml: function(cell) {\r\n\t\tvar date = cell.start;\r\n\t\tvar classes;\r\n\r\n\t\tif (!this.dayNumbersVisible) { // if there are week numbers but not day numbers\r\n\t\t\treturn '<td/>'; //  will create an empty space above events :(\r\n\t\t}\r\n\r\n\t\tclasses = this.dayGrid.getDayClasses(date);\r\n\t\tclasses.unshift('fc-day-number');\r\n\r\n\t\treturn '' +\r\n\t\t\t'<td class=\"' + classes.join(' ') + '\" data-date=\"' + date.format() + '\">' +\r\n\t\t\t\tdate.date() +\r\n\t\t\t'</td>';\r\n\t},\r\n\r\n\r\n\t// Generates an HTML attribute string for setting the width of the week number column, if it is known\r\n\tweekNumberStyleAttr: function() {\r\n\t\tif (this.weekNumberWidth !== null) {\r\n\t\t\treturn 'style=\"width:' + this.weekNumberWidth + 'px\"';\r\n\t\t}\r\n\t\treturn '';\r\n\t},\r\n\r\n\r\n\t// Determines whether each row should have a constant height\r\n\thasRigidRows: function() {\r\n\t\tvar eventLimit = this.opt('eventLimit');\r\n\t\treturn eventLimit && typeof eventLimit !== 'number';\r\n\t},\r\n\r\n\r\n\t/* Dimensions\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Refreshes the horizontal dimensions of the view\r\n\tupdateWidth: function() {\r\n\t\tif (this.weekNumbersVisible) {\r\n\t\t\t// Make sure all week number cells running down the side have the same width.\r\n\t\t\t// Record the width for cells created later.\r\n\t\t\tthis.weekNumberWidth = matchCellWidths(\r\n\t\t\t\tthis.el.find('.fc-week-number')\r\n\t\t\t);\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Adjusts the vertical dimensions of the view to the specified values\r\n\tsetHeight: function(totalHeight, isAuto) {\r\n\t\tvar eventLimit = this.opt('eventLimit');\r\n\t\tvar scrollerHeight;\r\n\r\n\t\t// reset all heights to be natural\r\n\t\tunsetScroller(this.scrollerEl);\r\n\t\tuncompensateScroll(this.headRowEl);\r\n\r\n\t\tthis.dayGrid.destroySegPopover(); // kill the \"more\" popover if displayed\r\n\r\n\t\t// is the event limit a constant level number?\r\n\t\tif (eventLimit && typeof eventLimit === 'number') {\r\n\t\t\tthis.dayGrid.limitRows(eventLimit); // limit the levels first so the height can redistribute after\r\n\t\t}\r\n\r\n\t\tscrollerHeight = this.computeScrollerHeight(totalHeight);\r\n\t\tthis.setGridHeight(scrollerHeight, isAuto);\r\n\r\n\t\t// is the event limit dynamically calculated?\r\n\t\tif (eventLimit && typeof eventLimit !== 'number') {\r\n\t\t\tthis.dayGrid.limitRows(eventLimit); // limit the levels after the grid's row heights have been set\r\n\t\t}\r\n\r\n\t\tif (!isAuto && setPotentialScroller(this.scrollerEl, scrollerHeight)) { // using scrollbars?\r\n\r\n\t\t\tcompensateScroll(this.headRowEl, getScrollbarWidths(this.scrollerEl));\r\n\r\n\t\t\t// doing the scrollbar compensation might have created text overflow which created more height. redo\r\n\t\t\tscrollerHeight = this.computeScrollerHeight(totalHeight);\r\n\t\t\tthis.scrollerEl.height(scrollerHeight);\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Sets the height of just the DayGrid component in this view\r\n\tsetGridHeight: function(height, isAuto) {\r\n\t\tif (isAuto) {\r\n\t\t\tundistributeHeight(this.dayGrid.rowEls); // let the rows be their natural height with no expanding\r\n\t\t}\r\n\t\telse {\r\n\t\t\tdistributeHeight(this.dayGrid.rowEls, height, true); // true = compensate for height-hogging rows\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t/* Events\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Renders the given events onto the view and populates the segments array\r\n\trenderEvents: function(events) {\r\n\t\tthis.dayGrid.renderEvents(events);\r\n\r\n\t\tthis.updateHeight(); // must compensate for events that overflow the row\r\n\t},\r\n\r\n\r\n\t// Retrieves all segment objects that are rendered in the view\r\n\tgetEventSegs: function() {\r\n\t\treturn this.dayGrid.getEventSegs();\r\n\t},\r\n\r\n\r\n\t// Unrenders all event elements and clears internal segment data\r\n\tdestroyEvents: function() {\r\n\t\tthis.dayGrid.destroyEvents();\r\n\r\n\t\t// we DON'T need to call updateHeight() because:\r\n\t\t// A) a renderEvents() call always happens after this, which will eventually call updateHeight()\r\n\t\t// B) in IE8, this causes a flash whenever events are rerendered\r\n\t},\r\n\r\n\r\n\t/* Dragging (for both events and external elements)\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// A returned value of `true` signals that a mock \"helper\" event has been rendered.\r\n\trenderDrag: function(dropLocation, seg) {\r\n\t\treturn this.dayGrid.renderDrag(dropLocation, seg);\r\n\t},\r\n\r\n\r\n\tdestroyDrag: function() {\r\n\t\tthis.dayGrid.destroyDrag();\r\n\t},\r\n\r\n\r\n\t/* Selection\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Renders a visual indication of a selection\r\n\trenderSelection: function(range) {\r\n\t\tthis.dayGrid.renderSelection(range);\r\n\t},\r\n\r\n\r\n\t// Unrenders a visual indications of a selection\r\n\tdestroySelection: function() {\r\n\t\tthis.dayGrid.destroySelection();\r\n\t}\r\n\r\n});\r\n\r\n;;\r\n\r\n/* A month view with day cells running in rows (one-per-week) and columns\r\n----------------------------------------------------------------------------------------------------------------------*/\r\n\r\nvar MonthView = fcViews.month = BasicView.extend({\r\n\r\n\t// Produces information about what range to display\r\n\tcomputeRange: function(date) {\r\n\t\tvar range = BasicView.prototype.computeRange.call(this, date); // get value from super-method\r\n\t\tvar rowCnt;\r\n\r\n\t\t// ensure 6 weeks\r\n\t\tif (this.isFixedWeeks()) {\r\n\t\t\trowCnt = Math.ceil(range.end.diff(range.start, 'weeks', true)); // could be partial weeks due to hiddenDays\r\n\t\t\trange.end.add(6 - rowCnt, 'weeks');\r\n\t\t}\r\n\r\n\t\treturn range;\r\n\t},\r\n\r\n\r\n\t// Overrides the default BasicView behavior to have special multi-week auto-height logic\r\n\tsetGridHeight: function(height, isAuto) {\r\n\r\n\t\tisAuto = isAuto || this.opt('weekMode') === 'variable'; // LEGACY: weekMode is deprecated\r\n\r\n\t\t// if auto, make the height of each row the height that it would be if there were 6 weeks\r\n\t\tif (isAuto) {\r\n\t\t\theight *= this.rowCnt / 6;\r\n\t\t}\r\n\r\n\t\tdistributeHeight(this.dayGrid.rowEls, height, !isAuto); // if auto, don't compensate for height-hogging rows\r\n\t},\r\n\r\n\r\n\tisFixedWeeks: function() {\r\n\t\tvar weekMode = this.opt('weekMode'); // LEGACY: weekMode is deprecated\r\n\t\tif (weekMode) {\r\n\t\t\treturn weekMode === 'fixed'; // if any other type of weekMode, assume NOT fixed\r\n\t\t}\r\n\r\n\t\treturn this.opt('fixedWeekCount');\r\n\t}\r\n\r\n});\r\n\r\nMonthView.duration = { months: 1 }; // important for prev/next\r\n\r\nMonthView.defaults = {\r\n\tfixedWeekCount: true\r\n};\r\n;;\r\n\r\n/* A week view with simple day cells running horizontally\r\n----------------------------------------------------------------------------------------------------------------------*/\r\n\r\nfcViews.basicWeek = {\r\n\ttype: 'basic',\r\n\tduration: { weeks: 1 }\r\n};\r\n;;\r\n\r\n/* A view with a single simple day cell\r\n----------------------------------------------------------------------------------------------------------------------*/\r\n\r\nfcViews.basicDay = {\r\n\ttype: 'basic',\r\n\tduration: { days: 1 }\r\n};\r\n;;\r\n\r\n/* An abstract class for all agenda-related views. Displays one more columns with time slots running vertically.\r\n----------------------------------------------------------------------------------------------------------------------*/\r\n// Is a manager for the TimeGrid subcomponent and possibly the DayGrid subcomponent (if allDaySlot is on).\r\n// Responsible for managing width/height.\r\n\r\nvar AGENDA_DEFAULTS = {\r\n\tallDaySlot: true,\r\n\tallDayText: 'all-day',\r\n\tscrollTime: '06:00:00',\r\n\tslotDuration: '00:30:00',\r\n\tminTime: '00:00:00',\r\n\tmaxTime: '24:00:00',\r\n\tslotEventOverlap: true // a bad name. confused with overlap/constraint system\r\n};\r\n\r\nvar AGENDA_ALL_DAY_EVENT_LIMIT = 5;\r\n\r\nvar AgendaView = fcViews.agenda = View.extend({\r\n\r\n\ttimeGrid: null, // the main time-grid subcomponent of this view\r\n\tdayGrid: null, // the \"all-day\" subcomponent. if all-day is turned off, this will be null\r\n\r\n\taxisWidth: null, // the width of the time axis running down the side\r\n\r\n\tnoScrollRowEls: null, // set of fake row elements that must compensate when scrollerEl has scrollbars\r\n\r\n\t// when the time-grid isn't tall enough to occupy the given height, we render an <hr> underneath\r\n\tbottomRuleEl: null,\r\n\tbottomRuleHeight: null,\r\n\r\n\r\n\tinitialize: function() {\r\n\t\tthis.timeGrid = new TimeGrid(this);\r\n\r\n\t\tif (this.opt('allDaySlot')) { // should we display the \"all-day\" area?\r\n\t\t\tthis.dayGrid = new DayGrid(this); // the all-day subcomponent of this view\r\n\r\n\t\t\t// the coordinate grid will be a combination of both subcomponents' grids\r\n\t\t\tthis.coordMap = new ComboCoordMap([\r\n\t\t\t\tthis.dayGrid.coordMap,\r\n\t\t\t\tthis.timeGrid.coordMap\r\n\t\t\t]);\r\n\t\t}\r\n\t\telse {\r\n\t\t\tthis.coordMap = this.timeGrid.coordMap;\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t/* Rendering\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Sets the display range and computes all necessary dates\r\n\tsetRange: function(range) {\r\n\t\tView.prototype.setRange.call(this, range); // call the super-method\r\n\r\n\t\tthis.timeGrid.setRange(range);\r\n\t\tif (this.dayGrid) {\r\n\t\t\tthis.dayGrid.setRange(range);\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Renders the view into `this.el`, which has already been assigned\r\n\trender: function() {\r\n\r\n\t\tthis.el.addClass('fc-agenda-view').html(this.renderHtml());\r\n\r\n\t\t// the element that wraps the time-grid that will probably scroll\r\n\t\tthis.scrollerEl = this.el.find('.fc-time-grid-container');\r\n\t\tthis.timeGrid.coordMap.containerEl = this.scrollerEl; // don't accept clicks/etc outside of this\r\n\r\n\t\tthis.timeGrid.setElement(this.el.find('.fc-time-grid'));\r\n\t\tthis.timeGrid.renderDates();\r\n\r\n\t\t// the <hr> that sometimes displays under the time-grid\r\n\t\tthis.bottomRuleEl = $('<hr class=\"fc-divider ' + this.widgetHeaderClass + '\"/>')\r\n\t\t\t.appendTo(this.timeGrid.el); // inject it into the time-grid\r\n\r\n\t\tif (this.dayGrid) {\r\n\t\t\tthis.dayGrid.setElement(this.el.find('.fc-day-grid'));\r\n\t\t\tthis.dayGrid.renderDates();\r\n\r\n\t\t\t// have the day-grid extend it's coordinate area over the <hr> dividing the two grids\r\n\t\t\tthis.dayGrid.bottomCoordPadding = this.dayGrid.el.next('hr').outerHeight();\r\n\t\t}\r\n\r\n\t\tthis.noScrollRowEls = this.el.find('.fc-row:not(.fc-scroller *)'); // fake rows not within the scroller\r\n\t},\r\n\r\n\r\n\t// Unrenders the content of the view. Since we haven't separated skeleton rendering from date rendering,\r\n\t// always completely kill each grid's rendering.\r\n\tdestroy: function() {\r\n\t\tthis.timeGrid.destroyDates();\r\n\t\tthis.timeGrid.removeElement();\r\n\r\n\t\tif (this.dayGrid) {\r\n\t\t\tthis.dayGrid.destroyDates();\r\n\t\t\tthis.dayGrid.removeElement();\r\n\t\t}\r\n\t},\r\n\r\n\r\n\trenderBusinessHours: function() {\r\n\t\tthis.timeGrid.renderBusinessHours();\r\n\r\n\t\tif (this.dayGrid) {\r\n\t\t\tthis.dayGrid.renderBusinessHours();\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Builds the HTML skeleton for the view.\r\n\t// The day-grid and time-grid components will render inside containers defined by this HTML.\r\n\trenderHtml: function() {\r\n\t\treturn '' +\r\n\t\t\t'<table>' +\r\n\t\t\t\t'<thead class=\"fc-head\">' +\r\n\t\t\t\t\t'<tr>' +\r\n\t\t\t\t\t\t'<td class=\"' + this.widgetHeaderClass + '\">' +\r\n\t\t\t\t\t\t\tthis.timeGrid.headHtml() + // render the day-of-week headers\r\n\t\t\t\t\t\t'</td>' +\r\n\t\t\t\t\t'</tr>' +\r\n\t\t\t\t'</thead>' +\r\n\t\t\t\t'<tbody class=\"fc-body\">' +\r\n\t\t\t\t\t'<tr>' +\r\n\t\t\t\t\t\t'<td class=\"' + this.widgetContentClass + '\">' +\r\n\t\t\t\t\t\t\t(this.dayGrid ?\r\n\t\t\t\t\t\t\t\t'<div class=\"fc-day-grid\"/>' +\r\n\t\t\t\t\t\t\t\t'<hr class=\"fc-divider ' + this.widgetHeaderClass + '\"/>' :\r\n\t\t\t\t\t\t\t\t''\r\n\t\t\t\t\t\t\t\t) +\r\n\t\t\t\t\t\t\t'<div class=\"fc-time-grid-container\">' +\r\n\t\t\t\t\t\t\t\t'<div class=\"fc-time-grid\"/>' +\r\n\t\t\t\t\t\t\t'</div>' +\r\n\t\t\t\t\t\t'</td>' +\r\n\t\t\t\t\t'</tr>' +\r\n\t\t\t\t'</tbody>' +\r\n\t\t\t'</table>';\r\n\t},\r\n\r\n\r\n\t// Generates the HTML that will go before the day-of week header cells.\r\n\t// Queried by the TimeGrid subcomponent when generating rows. Ordering depends on isRTL.\r\n\theadIntroHtml: function() {\r\n\t\tvar date;\r\n\t\tvar weekText;\r\n\r\n\t\tif (this.opt('weekNumbers')) {\r\n\t\t\tdate = this.timeGrid.getCell(0).start;\r\n\t\t\tweekText = date.format(this.opt('smallWeekFormat'));\r\n\r\n\t\t\treturn '' +\r\n\t\t\t\t'<th class=\"fc-axis fc-week-number ' + this.widgetHeaderClass + '\" ' + this.axisStyleAttr() + '>' +\r\n\t\t\t\t\t'<span>' + // needed for matchCellWidths\r\n\t\t\t\t\t\thtmlEscape(weekText) +\r\n\t\t\t\t\t'</span>' +\r\n\t\t\t\t'</th>';\r\n\t\t}\r\n\t\telse {\r\n\t\t\treturn '<th class=\"fc-axis ' + this.widgetHeaderClass + '\" ' + this.axisStyleAttr() + '></th>';\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Generates the HTML that goes before the all-day cells.\r\n\t// Queried by the DayGrid subcomponent when generating rows. Ordering depends on isRTL.\r\n\tdayIntroHtml: function() {\r\n\t\treturn '' +\r\n\t\t\t'<td class=\"fc-axis ' + this.widgetContentClass + '\" ' + this.axisStyleAttr() + '>' +\r\n\t\t\t\t'<span>' + // needed for matchCellWidths\r\n\t\t\t\t\t(this.opt('allDayHtml') || htmlEscape(this.opt('allDayText'))) +\r\n\t\t\t\t'</span>' +\r\n\t\t\t'</td>';\r\n\t},\r\n\r\n\r\n\t// Generates the HTML that goes before the bg of the TimeGrid slot area. Long vertical column.\r\n\tslotBgIntroHtml: function() {\r\n\t\treturn '<td class=\"fc-axis ' + this.widgetContentClass + '\" ' + this.axisStyleAttr() + '></td>';\r\n\t},\r\n\r\n\r\n\t// Generates the HTML that goes before all other types of cells.\r\n\t// Affects content-skeleton, helper-skeleton, highlight-skeleton for both the time-grid and day-grid.\r\n\t// Queried by the TimeGrid and DayGrid subcomponents when generating rows. Ordering depends on isRTL.\r\n\tintroHtml: function() {\r\n\t\treturn '<td class=\"fc-axis\" ' + this.axisStyleAttr() + '></td>';\r\n\t},\r\n\r\n\r\n\t// Generates an HTML attribute string for setting the width of the axis, if it is known\r\n\taxisStyleAttr: function() {\r\n\t\tif (this.axisWidth !== null) {\r\n\t\t\t return 'style=\"width:' + this.axisWidth + 'px\"';\r\n\t\t}\r\n\t\treturn '';\r\n\t},\r\n\r\n\r\n\t/* Dimensions\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\tupdateSize: function(isResize) {\r\n\t\tthis.timeGrid.updateSize(isResize);\r\n\r\n\t\tView.prototype.updateSize.call(this, isResize); // call the super-method\r\n\t},\r\n\r\n\r\n\t// Refreshes the horizontal dimensions of the view\r\n\tupdateWidth: function() {\r\n\t\t// make all axis cells line up, and record the width so newly created axis cells will have it\r\n\t\tthis.axisWidth = matchCellWidths(this.el.find('.fc-axis'));\r\n\t},\r\n\r\n\r\n\t// Adjusts the vertical dimensions of the view to the specified values\r\n\tsetHeight: function(totalHeight, isAuto) {\r\n\t\tvar eventLimit;\r\n\t\tvar scrollerHeight;\r\n\r\n\t\tif (this.bottomRuleHeight === null) {\r\n\t\t\t// calculate the height of the rule the very first time\r\n\t\t\tthis.bottomRuleHeight = this.bottomRuleEl.outerHeight();\r\n\t\t}\r\n\t\tthis.bottomRuleEl.hide(); // .show() will be called later if this <hr> is necessary\r\n\r\n\t\t// reset all dimensions back to the original state\r\n\t\tthis.scrollerEl.css('overflow', '');\r\n\t\tunsetScroller(this.scrollerEl);\r\n\t\tuncompensateScroll(this.noScrollRowEls);\r\n\r\n\t\t// limit number of events in the all-day area\r\n\t\tif (this.dayGrid) {\r\n\t\t\tthis.dayGrid.destroySegPopover(); // kill the \"more\" popover if displayed\r\n\r\n\t\t\teventLimit = this.opt('eventLimit');\r\n\t\t\tif (eventLimit && typeof eventLimit !== 'number') {\r\n\t\t\t\teventLimit = AGENDA_ALL_DAY_EVENT_LIMIT; // make sure \"auto\" goes to a real number\r\n\t\t\t}\r\n\t\t\tif (eventLimit) {\r\n\t\t\t\tthis.dayGrid.limitRows(eventLimit);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tif (!isAuto) { // should we force dimensions of the scroll container, or let the contents be natural height?\r\n\r\n\t\t\tscrollerHeight = this.computeScrollerHeight(totalHeight);\r\n\t\t\tif (setPotentialScroller(this.scrollerEl, scrollerHeight)) { // using scrollbars?\r\n\r\n\t\t\t\t// make the all-day and header rows lines up\r\n\t\t\t\tcompensateScroll(this.noScrollRowEls, getScrollbarWidths(this.scrollerEl));\r\n\r\n\t\t\t\t// the scrollbar compensation might have changed text flow, which might affect height, so recalculate\r\n\t\t\t\t// and reapply the desired height to the scroller.\r\n\t\t\t\tscrollerHeight = this.computeScrollerHeight(totalHeight);\r\n\t\t\t\tthis.scrollerEl.height(scrollerHeight);\r\n\t\t\t}\r\n\t\t\telse { // no scrollbars\r\n\t\t\t\t// still, force a height and display the bottom rule (marks the end of day)\r\n\t\t\t\tthis.scrollerEl.height(scrollerHeight).css('overflow', 'hidden'); // in case <hr> goes outside\r\n\t\t\t\tthis.bottomRuleEl.show();\r\n\t\t\t}\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Computes the initial pre-configured scroll state prior to allowing the user to change it\r\n\tcomputeInitialScroll: function() {\r\n\t\tvar scrollTime = moment.duration(this.opt('scrollTime'));\r\n\t\tvar top = this.timeGrid.computeTimeTop(scrollTime);\r\n\r\n\t\t// zoom can give weird floating-point values. rather scroll a little bit further\r\n\t\ttop = Math.ceil(top);\r\n\r\n\t\tif (top) {\r\n\t\t\ttop++; // to overcome top border that slots beyond the first have. looks better\r\n\t\t}\r\n\r\n\t\treturn top;\r\n\t},\r\n\r\n\r\n\t/* Events\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Renders events onto the view and populates the View's segment array\r\n\trenderEvents: function(events) {\r\n\t\tvar dayEvents = [];\r\n\t\tvar timedEvents = [];\r\n\t\tvar daySegs = [];\r\n\t\tvar timedSegs;\r\n\t\tvar i;\r\n\r\n\t\t// separate the events into all-day and timed\r\n\t\tfor (i = 0; i < events.length; i++) {\r\n\t\t\tif (events[i].allDay) {\r\n\t\t\t\tdayEvents.push(events[i]);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\ttimedEvents.push(events[i]);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// render the events in the subcomponents\r\n\t\ttimedSegs = this.timeGrid.renderEvents(timedEvents);\r\n\t\tif (this.dayGrid) {\r\n\t\t\tdaySegs = this.dayGrid.renderEvents(dayEvents);\r\n\t\t}\r\n\r\n\t\t// the all-day area is flexible and might have a lot of events, so shift the height\r\n\t\tthis.updateHeight();\r\n\t},\r\n\r\n\r\n\t// Retrieves all segment objects that are rendered in the view\r\n\tgetEventSegs: function() {\r\n\t\treturn this.timeGrid.getEventSegs().concat(\r\n\t\t\tthis.dayGrid ? this.dayGrid.getEventSegs() : []\r\n\t\t);\r\n\t},\r\n\r\n\r\n\t// Unrenders all event elements and clears internal segment data\r\n\tdestroyEvents: function() {\r\n\r\n\t\t// destroy the events in the subcomponents\r\n\t\tthis.timeGrid.destroyEvents();\r\n\t\tif (this.dayGrid) {\r\n\t\t\tthis.dayGrid.destroyEvents();\r\n\t\t}\r\n\r\n\t\t// we DON'T need to call updateHeight() because:\r\n\t\t// A) a renderEvents() call always happens after this, which will eventually call updateHeight()\r\n\t\t// B) in IE8, this causes a flash whenever events are rerendered\r\n\t},\r\n\r\n\r\n\t/* Dragging (for events and external elements)\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// A returned value of `true` signals that a mock \"helper\" event has been rendered.\r\n\trenderDrag: function(dropLocation, seg) {\r\n\t\tif (dropLocation.start.hasTime()) {\r\n\t\t\treturn this.timeGrid.renderDrag(dropLocation, seg);\r\n\t\t}\r\n\t\telse if (this.dayGrid) {\r\n\t\t\treturn this.dayGrid.renderDrag(dropLocation, seg);\r\n\t\t}\r\n\t},\r\n\r\n\r\n\tdestroyDrag: function() {\r\n\t\tthis.timeGrid.destroyDrag();\r\n\t\tif (this.dayGrid) {\r\n\t\t\tthis.dayGrid.destroyDrag();\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t/* Selection\r\n\t------------------------------------------------------------------------------------------------------------------*/\r\n\r\n\r\n\t// Renders a visual indication of a selection\r\n\trenderSelection: function(range) {\r\n\t\tif (range.start.hasTime() || range.end.hasTime()) {\r\n\t\t\tthis.timeGrid.renderSelection(range);\r\n\t\t}\r\n\t\telse if (this.dayGrid) {\r\n\t\t\tthis.dayGrid.renderSelection(range);\r\n\t\t}\r\n\t},\r\n\r\n\r\n\t// Unrenders a visual indications of a selection\r\n\tdestroySelection: function() {\r\n\t\tthis.timeGrid.destroySelection();\r\n\t\tif (this.dayGrid) {\r\n\t\t\tthis.dayGrid.destroySelection();\r\n\t\t}\r\n\t}\r\n\r\n});\r\n\r\nAgendaView.defaults = AGENDA_DEFAULTS;\r\n\r\n;;\r\n\r\n/* A week view with an all-day cell area at the top, and a time grid below\r\n----------------------------------------------------------------------------------------------------------------------*/\r\n\r\nfcViews.agendaWeek = {\r\n\ttype: 'agenda',\r\n\tduration: { weeks: 1 }\r\n};\r\n;;\r\n\r\n/* A day view with an all-day cell area at the top, and a time grid below\r\n----------------------------------------------------------------------------------------------------------------------*/\r\n\r\nfcViews.agendaDay = {\r\n\ttype: 'agenda',\r\n\tduration: { days: 1 }\r\n};\r\n;;\r\n\r\nreturn fc; // export for Node/CommonJS\r\n});\n","define(\r\n    'taoDeliverySchedule/lib/fullcalendar/fullcalendar.amd',[\r\n        'taoDeliverySchedule/lib/fullcalendar/fullcalendar',\r\n        'context'\r\n    ], \r\n    function () {\r\n        'use strict';\r\n    }\r\n);\n","/**  \r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n * \r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n * \r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n * \r\n * Copyright (c) 2015 (original work) Open Assessment Technologies SA;\r\n *               \r\n */\r\ndefine('taoDeliverySchedule/calendar/calendar',[\r\n    'lodash',\r\n    'jquery',\r\n    'i18n',\r\n    'taoDeliverySchedule/calendar/eventService',\r\n    'ui/feedback',\r\n    'context',\r\n    'taoDeliverySchedule/lib/fullcalendar/fullcalendar.amd'\r\n],function (_, $, __, eventService, feedback, context) {\r\n    'use strict';\r\n\r\n    /**\r\n     * Function retuns height of calendar container\r\n     * \r\n     * @param {jQueryElement} $contentBlock\r\n     * @returns {integer} calendar height\r\n     */\r\n    function getCalendarHeight($contentBlock) {\r\n        var height;\r\n        $contentBlock = $contentBlock ? $contentBlock : $('.content-block');\r\n        height = $('body > footer').offset().top - $contentBlock.offset().top;\r\n        return height - parseInt($contentBlock.css('padding-top')) - parseInt($contentBlock.css('padding-bottom'));\r\n    }\r\n\r\n    /**\r\n     * Calendar constructor.\r\n     * \r\n     * @constructor\r\n     * @property {object}        options Calendar options.\r\n     * @property {jQueryElement} options.$container Calendar container.\r\n     * @property {Date}          options.defaultDate Calendar The initial date displayed when the calendar first loads.\r\n     */\r\n    return function (options) {\r\n        if (!(options.$container instanceof $) || !$.contains(document, options.$container[0])) {\r\n            throw new TypeError(\"Calendar requires $container option that should be jQuery element.\");\r\n        }\r\n        var defaultOptions,\r\n        that = this;\r\n        this.calendarLoading = $.Deferred();\r\n\r\n        this.init = function () {\r\n            defaultOptions = {\r\n                lang: context.base_lang,\r\n                defaultDate : new Date(),\r\n                editable : true,\r\n                selectable : true,\r\n                selectHelper : false,\r\n                unselectAuto : false,\r\n                height : getCalendarHeight(),\r\n                eventLimit : false, // allow \"more\" link when too many events\r\n                select : _.noop,\r\n                //timezone : options.$container.data('time-zone-name'),\r\n                timeFormat: 'H:mm',\r\n                axisFormat: 'HH:mm',\r\n                loading : function (loading) {\r\n                    if (loading) {\r\n                        that.calendarLoading = $.Deferred();\r\n                    } else {\r\n                        that.calendarLoading.resolve();\r\n                    }\r\n                },\r\n                eventRender : function (fcEvent, $element) {\r\n                    /*if (fcEvent.end.diff(fcEvent.start, 'hours') >= 24) {\r\n                        fcEvent.allDay = true;\r\n                    }*/\r\n                    $element.addClass(eventService.classAttrPrefix + fcEvent.id);\r\n                    if (fcEvent.recurringEventIds) {\r\n                        $element.append('<span class=\"recurring-count\">1</span>');\r\n                    }\r\n                    if (fcEvent.subEvent && fcEvent.subEventNum) {\r\n                        $element.append('<span class=\"recurring-count\">' + (fcEvent.subEventNum + 1) + '</span>');\r\n                    }\r\n                },\r\n                eventDrop : function (fcEvent, e, revertFunc) {\r\n                    if (fcEvent.subEvent) {\r\n                        revertFunc();\r\n                        feedback().warning(__(\"Sub delivery cannot be changed.\"));\r\n                    } else {\r\n                        eventService.saveEvent(fcEvent, _.noop, function () {revertFunc();});\r\n                    }\r\n                },\r\n                eventResize : function (fcEvent, e, revertFunc) {\r\n                    if (fcEvent.subEvent) {\r\n                        revertFunc();\r\n                        feedback().warning(__(\"Sub delivery cannot be changed.\"));\r\n                    } else {\r\n                        eventService.saveEvent(fcEvent, _.noop, function () {revertFunc();});\r\n                    }\r\n                },\r\n                events : function(start, end, timezone, callback) {\r\n                    $.ajax({\r\n                        url: '/taoDeliverySchedule/CalendarApi?timeZone=' + eventService.getCurrentTZName(),\r\n                        dataType: 'json',\r\n                        data: {\r\n                            start: start.unix(),\r\n                            end: end.unix()\r\n                        },\r\n                        success: function(response) {\r\n                            var events = [];\r\n\r\n                            that.exec('removeEvents');\r\n                            $.each(response, function (key, event) {\r\n                                var recurringEvents = eventService.getRecurringEvents(event);\r\n                                events.push(event);\r\n                                $.each(recurringEvents, function (rEventKey, rEventVal) {\r\n                                    events.push(rEventVal);\r\n                                });\r\n                            });\r\n\r\n                            callback(events);\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n\r\n            options = _.assign(defaultOptions, options);\r\n            options.$container.fullCalendar(options);\r\n        };\r\n\r\n\r\n        this.exec = function () {\r\n            return options.$container.fullCalendar.apply(options.$container, arguments);\r\n        };\r\n\r\n        /**\r\n         * Add event to the calendar.\r\n         * @param {object} eventData Event properties\r\n         * @param {Date} eventData.start Event begin date\r\n         * @param {Date} eventData.end Event end date\r\n         * @returns {undefined}\r\n         */\r\n        this.addEvent = function (eventData) {\r\n            that.exec('renderEvent', eventData, true); // stick? = true\r\n        };\r\n\r\n        /**\r\n         * Load event by id and render it on the calendar. \r\n         * If event already loaded and represented on the calendar then the Deferred object will be resolved immediately.\r\n         * @param {string} eventId\r\n         * @returns {Deferred} \r\n         */\r\n        this.getEvent = function (eventId) {\r\n            var deferred = $.Deferred(),\r\n                fcEvent = that.exec('clientEvents', eventId);\r\n\r\n            if (fcEvent.length === 0) {\r\n                fcEvent = eventService.loadEvent(eventId, function (eventData) {\r\n                    that.exec('renderEvent', eventData);\r\n                    var fcEvent = that.exec('clientEvents', eventId);\r\n                    deferred.resolve(fcEvent[0]);\r\n                });\r\n            } else {\r\n                deferred.resolve(fcEvent[0]);\r\n            }\r\n            return deferred.promise();\r\n        };\r\n\r\n        /**\r\n         * Moves the calendar to an event. \r\n         * If calendar has a scrollbar then it will be scrolled to start of event.\r\n         * Deferred object will be resolved after all event will be loaded.\r\n         * @param {object} fcEvent Calendar event\r\n         * @returns {Deferred} \r\n         */\r\n        this.goToEvent = function (eventId) {\r\n            var deferred = $.Deferred();\r\n            that.getEvent(eventId).done(function(fcEvent) {\r\n                if (!eventService.getEventElement(fcEvent.id).length) {\r\n                    that.exec('gotoDate', fcEvent.start);\r\n                }\r\n                that.calendarLoading.done(function () {\r\n                    var $eventElement = eventService.getEventElement(fcEvent.id),\r\n                        $scroller = options.$container.find('.fc-scroller'),\r\n                        pos;\r\n\r\n                    if ($scroller.length) {\r\n                        pos = $eventElement.offset().top - $scroller.offset().top + $scroller.scrollTop();\r\n                        $scroller.scrollTop(pos);\r\n                    }\r\n\r\n                    deferred.resolve(fcEvent);\r\n                });\r\n            });\r\n\r\n            return deferred.promise();\r\n        };\r\n\r\n        if (context.base_lang !== 'en') {\r\n            require(['taoDeliverySchedule/lib/fullcalendar/lang/' + context.base_lang], function () {\r\n                that.init();\r\n            }, function (err) {\r\n                that.init();\r\n            });\r\n        } else {\r\n            that.init();\r\n        }\r\n    };\r\n});\n","/*\r\n * qTip2 - Pretty powerful tooltips - v2.2.1\r\n * http://qtip2.com\r\n *\r\n * Copyright (c) 2014 \r\n * Released under the MIT licenses\r\n * http://jquery.org/license\r\n *\r\n * Date: Sat Sep 6 2014 11:12 GMT+0100+0100\r\n * Plugins: tips modal viewport svg imagemap ie6\r\n * Styles: core basic css3\r\n */\r\n/*global window: false, jQuery: false, console: false, define: false */\r\n\r\n/* Cache window, document, undefined */\r\n(function( window, document, undefined ) {\r\n\r\n// Uses AMD or browser globals to create a jQuery plugin.\r\n(function( factory ) {\r\n\t\"use strict\";\r\n\tif(typeof define === 'function' && define.amd) {\r\n\t\tdefine('taoDeliverySchedule/lib/qtip/jquery.qtip',['jquery'], factory);\r\n\t}\r\n\telse if(jQuery && !jQuery.fn.qtip) {\r\n\t\tfactory(jQuery);\r\n\t}\r\n}\r\n(function($) {\r\n\t\"use strict\"; // Enable ECMAScript \"strict\" operation for this function. See more: http://ejohn.org/blog/ecmascript-5-strict-mode-json-and-more/\r\n;// Munge the primitives - Paul Irish tip\r\nvar TRUE = true,\r\nFALSE = false,\r\nNULL = null,\r\n\r\n// Common variables\r\nX = 'x', Y = 'y',\r\nWIDTH = 'width',\r\nHEIGHT = 'height',\r\n\r\n// Positioning sides\r\nTOP = 'top',\r\nLEFT = 'left',\r\nBOTTOM = 'bottom',\r\nRIGHT = 'right',\r\nCENTER = 'center',\r\n\r\n// Position adjustment types\r\nFLIP = 'flip',\r\nFLIPINVERT = 'flipinvert',\r\nSHIFT = 'shift',\r\n\r\n// Shortcut vars\r\nQTIP, PROTOTYPE, CORNER, CHECKS,\r\nPLUGINS = {},\r\nNAMESPACE = 'qtip',\r\nATTR_HAS = 'data-hasqtip',\r\nATTR_ID = 'data-qtip-id',\r\nWIDGET = ['ui-widget', 'ui-tooltip'],\r\nSELECTOR = '.'+NAMESPACE,\r\nINACTIVE_EVENTS = 'click dblclick mousedown mouseup mousemove mouseleave mouseenter'.split(' '),\r\n\r\nCLASS_FIXED = NAMESPACE+'-fixed',\r\nCLASS_DEFAULT = NAMESPACE + '-default',\r\nCLASS_FOCUS = NAMESPACE + '-focus',\r\nCLASS_HOVER = NAMESPACE + '-hover',\r\nCLASS_DISABLED = NAMESPACE+'-disabled',\r\n\r\nreplaceSuffix = '_replacedByqTip',\r\noldtitle = 'oldtitle',\r\ntrackingBound,\r\n\r\n// Browser detection\r\nBROWSER = {\r\n\t/*\r\n\t * IE version detection\r\n\t *\r\n\t * Adapted from: http://ajaxian.com/archives/attack-of-the-ie-conditional-comment\r\n\t * Credit to James Padolsey for the original implemntation!\r\n\t */\r\n\tie: (function(){\r\n\t\tfor (\r\n\t\t\tvar v = 4, i = document.createElement(\"div\");\r\n\t\t\t(i.innerHTML = \"<!--[if gt IE \" + v + \"]><i></i><![endif]-->\") && i.getElementsByTagName(\"i\")[0];\r\n\t\t\tv+=1\r\n\t\t) {}\r\n\t\treturn v > 4 ? v : NaN;\r\n\t}()),\r\n\r\n\t/*\r\n\t * iOS version detection\r\n\t */\r\n\tiOS: parseFloat(\r\n\t\t('' + (/CPU.*OS ([0-9_]{1,5})|(CPU like).*AppleWebKit.*Mobile/i.exec(navigator.userAgent) || [0,''])[1])\r\n\t\t.replace('undefined', '3_2').replace('_', '.').replace('_', '')\r\n\t) || FALSE\r\n};\r\n;function QTip(target, options, id, attr) {\r\n\t// Elements and ID\r\n\tthis.id = id;\r\n\tthis.target = target;\r\n\tthis.tooltip = NULL;\r\n\tthis.elements = { target: target };\r\n\r\n\t// Internal constructs\r\n\tthis._id = NAMESPACE + '-' + id;\r\n\tthis.timers = { img: {} };\r\n\tthis.options = options;\r\n\tthis.plugins = {};\r\n\r\n\t// Cache object\r\n\tthis.cache = {\r\n\t\tevent: {},\r\n\t\ttarget: $(),\r\n\t\tdisabled: FALSE,\r\n\t\tattr: attr,\r\n\t\tonTooltip: FALSE,\r\n\t\tlastClass: ''\r\n\t};\r\n\r\n\t// Set the initial flags\r\n\tthis.rendered = this.destroyed = this.disabled = this.waiting =\r\n\t\tthis.hiddenDuringWait = this.positioning = this.triggering = FALSE;\r\n}\r\nPROTOTYPE = QTip.prototype;\r\n\r\nPROTOTYPE._when = function(deferreds) {\r\n\treturn $.when.apply($, deferreds);\r\n};\r\n\r\nPROTOTYPE.render = function(show) {\r\n\tif(this.rendered || this.destroyed) { return this; } // If tooltip has already been rendered, exit\r\n\r\n\tvar self = this,\r\n\t\toptions = this.options,\r\n\t\tcache = this.cache,\r\n\t\telements = this.elements,\r\n\t\ttext = options.content.text,\r\n\t\ttitle = options.content.title,\r\n\t\tbutton = options.content.button,\r\n\t\tposOptions = options.position,\r\n\t\tnamespace = '.'+this._id+' ',\r\n\t\tdeferreds = [],\r\n\t\ttooltip;\r\n\r\n\t// Add ARIA attributes to target\r\n\t$.attr(this.target[0], 'aria-describedby', this._id);\r\n\r\n\t// Create public position object that tracks current position corners\r\n\tcache.posClass = this._createPosClass(\r\n\t\t(this.position = { my: posOptions.my, at: posOptions.at }).my\r\n\t);\r\n\r\n\t// Create tooltip element\r\n\tthis.tooltip = elements.tooltip = tooltip = $('<div/>', {\r\n\t\t'id': this._id,\r\n\t\t'class': [ NAMESPACE, CLASS_DEFAULT, options.style.classes, cache.posClass ].join(' '),\r\n\t\t'width': options.style.width || '',\r\n\t\t'height': options.style.height || '',\r\n\t\t'tracking': posOptions.target === 'mouse' && posOptions.adjust.mouse,\r\n\r\n\t\t/* ARIA specific attributes */\r\n\t\t'role': 'alert',\r\n\t\t'aria-live': 'polite',\r\n\t\t'aria-atomic': FALSE,\r\n\t\t'aria-describedby': this._id + '-content',\r\n\t\t'aria-hidden': TRUE\r\n\t})\r\n\t.toggleClass(CLASS_DISABLED, this.disabled)\r\n\t.attr(ATTR_ID, this.id)\r\n\t.data(NAMESPACE, this)\r\n\t.appendTo(posOptions.container)\r\n\t.append(\r\n\t\t// Create content element\r\n\t\telements.content = $('<div />', {\r\n\t\t\t'class': NAMESPACE + '-content',\r\n\t\t\t'id': this._id + '-content',\r\n\t\t\t'aria-atomic': TRUE\r\n\t\t})\r\n\t);\r\n\r\n\t// Set rendered flag and prevent redundant reposition calls for now\r\n\tthis.rendered = -1;\r\n\tthis.positioning = TRUE;\r\n\r\n\t// Create title...\r\n\tif(title) {\r\n\t\tthis._createTitle();\r\n\r\n\t\t// Update title only if its not a callback (called in toggle if so)\r\n\t\tif(!$.isFunction(title)) {\r\n\t\t\tdeferreds.push( this._updateTitle(title, FALSE) );\r\n\t\t}\r\n\t}\r\n\r\n\t// Create button\r\n\tif(button) { this._createButton(); }\r\n\r\n\t// Set proper rendered flag and update content if not a callback function (called in toggle)\r\n\tif(!$.isFunction(text)) {\r\n\t\tdeferreds.push( this._updateContent(text, FALSE) );\r\n\t}\r\n\tthis.rendered = TRUE;\r\n\r\n\t// Setup widget classes\r\n\tthis._setWidget();\r\n\r\n\t// Initialize 'render' plugins\r\n\t$.each(PLUGINS, function(name) {\r\n\t\tvar instance;\r\n\t\tif(this.initialize === 'render' && (instance = this(self))) {\r\n\t\t\tself.plugins[name] = instance;\r\n\t\t}\r\n\t});\r\n\r\n\t// Unassign initial events and assign proper events\r\n\tthis._unassignEvents();\r\n\tthis._assignEvents();\r\n\r\n\t// When deferreds have completed\r\n\tthis._when(deferreds).then(function() {\r\n\t\t// tooltiprender event\r\n\t\tself._trigger('render');\r\n\r\n\t\t// Reset flags\r\n\t\tself.positioning = FALSE;\r\n\r\n\t\t// Show tooltip if not hidden during wait period\r\n\t\tif(!self.hiddenDuringWait && (options.show.ready || show)) {\r\n\t\t\tself.toggle(TRUE, cache.event, FALSE);\r\n\t\t}\r\n\t\tself.hiddenDuringWait = FALSE;\r\n\t});\r\n\r\n\t// Expose API\r\n\tQTIP.api[this.id] = this;\r\n\r\n\treturn this;\r\n};\r\n\r\nPROTOTYPE.destroy = function(immediate) {\r\n\t// Set flag the signify destroy is taking place to plugins\r\n\t// and ensure it only gets destroyed once!\r\n\tif(this.destroyed) { return this.target; }\r\n\r\n\tfunction process() {\r\n\t\tif(this.destroyed) { return; }\r\n\t\tthis.destroyed = TRUE;\r\n\r\n\t\tvar target = this.target,\r\n\t\t\ttitle = target.attr(oldtitle),\r\n\t\t\ttimer;\r\n\r\n\t\t// Destroy tooltip if rendered\r\n\t\tif(this.rendered) {\r\n\t\t\tthis.tooltip.stop(1,0).find('*').remove().end().remove();\r\n\t\t}\r\n\r\n\t\t// Destroy all plugins\r\n\t\t$.each(this.plugins, function(name) {\r\n\t\t\tthis.destroy && this.destroy();\r\n\t\t});\r\n\r\n\t\t// Clear timers\r\n\t\tfor(timer in this.timers) {\r\n\t\t\tclearTimeout(this.timers[timer]);\r\n\t\t}\r\n\r\n\t\t// Remove api object and ARIA attributes\r\n\t\ttarget.removeData(NAMESPACE)\r\n\t\t\t.removeAttr(ATTR_ID)\r\n\t\t\t.removeAttr(ATTR_HAS)\r\n\t\t\t.removeAttr('aria-describedby');\r\n\r\n\t\t// Reset old title attribute if removed\r\n\t\tif(this.options.suppress && title) {\r\n\t\t\ttarget.attr('title', title).removeAttr(oldtitle);\r\n\t\t}\r\n\r\n\t\t// Remove qTip events associated with this API\r\n\t\tthis._unassignEvents();\r\n\r\n\t\t// Remove ID from used id objects, and delete object references\r\n\t\t// for better garbage collection and leak protection\r\n\t\tthis.options = this.elements = this.cache = this.timers =\r\n\t\t\tthis.plugins = this.mouse = NULL;\r\n\r\n\t\t// Delete epoxsed API object\r\n\t\tdelete QTIP.api[this.id];\r\n\t}\r\n\r\n\t// If an immediate destory is needed\r\n\tif((immediate !== TRUE || this.triggering === 'hide') && this.rendered) {\r\n\t\tthis.tooltip.one('tooltiphidden', $.proxy(process, this));\r\n\t\t!this.triggering && this.hide();\r\n\t}\r\n\r\n\t// If we're not in the process of hiding... process\r\n\telse { process.call(this); }\r\n\r\n\treturn this.target;\r\n};\r\n;function invalidOpt(a) {\r\n\treturn a === NULL || $.type(a) !== 'object';\r\n}\r\n\r\nfunction invalidContent(c) {\r\n\treturn !( $.isFunction(c) || (c && c.attr) || c.length || ($.type(c) === 'object' && (c.jquery || c.then) ));\r\n}\r\n\r\n// Option object sanitizer\r\nfunction sanitizeOptions(opts) {\r\n\tvar content, text, ajax, once;\r\n\r\n\tif(invalidOpt(opts)) { return FALSE; }\r\n\r\n\tif(invalidOpt(opts.metadata)) {\r\n\t\topts.metadata = { type: opts.metadata };\r\n\t}\r\n\r\n\tif('content' in opts) {\r\n\t\tcontent = opts.content;\r\n\r\n\t\tif(invalidOpt(content) || content.jquery || content.done) {\r\n\t\t\tcontent = opts.content = {\r\n\t\t\t\ttext: (text = invalidContent(content) ? FALSE : content)\r\n\t\t\t};\r\n\t\t}\r\n\t\telse { text = content.text; }\r\n\r\n\t\t// DEPRECATED - Old content.ajax plugin functionality\r\n\t\t// Converts it into the proper Deferred syntax\r\n\t\tif('ajax' in content) {\r\n\t\t\tajax = content.ajax;\r\n\t\t\tonce = ajax && ajax.once !== FALSE;\r\n\t\t\tdelete content.ajax;\r\n\r\n\t\t\tcontent.text = function(event, api) {\r\n\t\t\t\tvar loading = text || $(this).attr(api.options.content.attr) || 'Loading...',\r\n\r\n\t\t\t\tdeferred = $.ajax(\r\n\t\t\t\t\t$.extend({}, ajax, { context: api })\r\n\t\t\t\t)\r\n\t\t\t\t.then(ajax.success, NULL, ajax.error)\r\n\t\t\t\t.then(function(content) {\r\n\t\t\t\t\tif(content && once) { api.set('content.text', content); }\r\n\t\t\t\t\treturn content;\r\n\t\t\t\t},\r\n\t\t\t\tfunction(xhr, status, error) {\r\n\t\t\t\t\tif(api.destroyed || xhr.status === 0) { return; }\r\n\t\t\t\t\tapi.set('content.text', status + ': ' + error);\r\n\t\t\t\t});\r\n\r\n\t\t\t\treturn !once ? (api.set('content.text', loading), deferred) : loading;\r\n\t\t\t};\r\n\t\t}\r\n\r\n\t\tif('title' in content) {\r\n\t\t\tif($.isPlainObject(content.title)) {\r\n\t\t\t\tcontent.button = content.title.button;\r\n\t\t\t\tcontent.title = content.title.text;\r\n\t\t\t}\r\n\r\n\t\t\tif(invalidContent(content.title || FALSE)) {\r\n\t\t\t\tcontent.title = FALSE;\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n\r\n\tif('position' in opts && invalidOpt(opts.position)) {\r\n\t\topts.position = { my: opts.position, at: opts.position };\r\n\t}\r\n\r\n\tif('show' in opts && invalidOpt(opts.show)) {\r\n\t\topts.show = opts.show.jquery ? { target: opts.show } :\r\n\t\t\topts.show === TRUE ? { ready: TRUE } : { event: opts.show };\r\n\t}\r\n\r\n\tif('hide' in opts && invalidOpt(opts.hide)) {\r\n\t\topts.hide = opts.hide.jquery ? { target: opts.hide } : { event: opts.hide };\r\n\t}\r\n\r\n\tif('style' in opts && invalidOpt(opts.style)) {\r\n\t\topts.style = { classes: opts.style };\r\n\t}\r\n\r\n\t// Sanitize plugin options\r\n\t$.each(PLUGINS, function() {\r\n\t\tthis.sanitize && this.sanitize(opts);\r\n\t});\r\n\r\n\treturn opts;\r\n}\r\n\r\n// Setup builtin .set() option checks\r\nCHECKS = PROTOTYPE.checks = {\r\n\tbuiltin: {\r\n\t\t// Core checks\r\n\t\t'^id$': function(obj, o, v, prev) {\r\n\t\t\tvar id = v === TRUE ? QTIP.nextid : v,\r\n\t\t\t\tnew_id = NAMESPACE + '-' + id;\r\n\r\n\t\t\tif(id !== FALSE && id.length > 0 && !$('#'+new_id).length) {\r\n\t\t\t\tthis._id = new_id;\r\n\r\n\t\t\t\tif(this.rendered) {\r\n\t\t\t\t\tthis.tooltip[0].id = this._id;\r\n\t\t\t\t\tthis.elements.content[0].id = this._id + '-content';\r\n\t\t\t\t\tthis.elements.title[0].id = this._id + '-title';\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse { obj[o] = prev; }\r\n\t\t},\r\n\t\t'^prerender': function(obj, o, v) {\r\n\t\t\tv && !this.rendered && this.render(this.options.show.ready);\r\n\t\t},\r\n\r\n\t\t// Content checks\r\n\t\t'^content.text$': function(obj, o, v) {\r\n\t\t\tthis._updateContent(v);\r\n\t\t},\r\n\t\t'^content.attr$': function(obj, o, v, prev) {\r\n\t\t\tif(this.options.content.text === this.target.attr(prev)) {\r\n\t\t\t\tthis._updateContent( this.target.attr(v) );\r\n\t\t\t}\r\n\t\t},\r\n\t\t'^content.title$': function(obj, o, v) {\r\n\t\t\t// Remove title if content is null\r\n\t\t\tif(!v) { return this._removeTitle(); }\r\n\r\n\t\t\t// If title isn't already created, create it now and update\r\n\t\t\tv && !this.elements.title && this._createTitle();\r\n\t\t\tthis._updateTitle(v);\r\n\t\t},\r\n\t\t'^content.button$': function(obj, o, v) {\r\n\t\t\tthis._updateButton(v);\r\n\t\t},\r\n\t\t'^content.title.(text|button)$': function(obj, o, v) {\r\n\t\t\tthis.set('content.'+o, v); // Backwards title.text/button compat\r\n\t\t},\r\n\r\n\t\t// Position checks\r\n\t\t'^position.(my|at)$': function(obj, o, v){\r\n\t\t\t'string' === typeof v && (this.position[o] = obj[o] = new CORNER(v, o === 'at'));\r\n\t\t},\r\n\t\t'^position.container$': function(obj, o, v){\r\n\t\t\tthis.rendered && this.tooltip.appendTo(v);\r\n\t\t},\r\n\r\n\t\t// Show checks\r\n\t\t'^show.ready$': function(obj, o, v) {\r\n\t\t\tv && (!this.rendered && this.render(TRUE) || this.toggle(TRUE));\r\n\t\t},\r\n\r\n\t\t// Style checks\r\n\t\t'^style.classes$': function(obj, o, v, p) {\r\n\t\t\tthis.rendered && this.tooltip.removeClass(p).addClass(v);\r\n\t\t},\r\n\t\t'^style.(width|height)': function(obj, o, v) {\r\n\t\t\tthis.rendered && this.tooltip.css(o, v);\r\n\t\t},\r\n\t\t'^style.widget|content.title': function() {\r\n\t\t\tthis.rendered && this._setWidget();\r\n\t\t},\r\n\t\t'^style.def': function(obj, o, v) {\r\n\t\t\tthis.rendered && this.tooltip.toggleClass(CLASS_DEFAULT, !!v);\r\n\t\t},\r\n\r\n\t\t// Events check\r\n\t\t'^events.(render|show|move|hide|focus|blur)$': function(obj, o, v) {\r\n\t\t\tthis.rendered && this.tooltip[($.isFunction(v) ? '' : 'un') + 'bind']('tooltip'+o, v);\r\n\t\t},\r\n\r\n\t\t// Properties which require event reassignment\r\n\t\t'^(show|hide|position).(event|target|fixed|inactive|leave|distance|viewport|adjust)': function() {\r\n\t\t\tif(!this.rendered) { return; }\r\n\r\n\t\t\t// Set tracking flag\r\n\t\t\tvar posOptions = this.options.position;\r\n\t\t\tthis.tooltip.attr('tracking', posOptions.target === 'mouse' && posOptions.adjust.mouse);\r\n\r\n\t\t\t// Reassign events\r\n\t\t\tthis._unassignEvents();\r\n\t\t\tthis._assignEvents();\r\n\t\t}\r\n\t}\r\n};\r\n\r\n// Dot notation converter\r\nfunction convertNotation(options, notation) {\r\n\tvar i = 0, obj, option = options,\r\n\r\n\t// Split notation into array\r\n\tlevels = notation.split('.');\r\n\r\n\t// Loop through\r\n\twhile( option = option[ levels[i++] ] ) {\r\n\t\tif(i < levels.length) { obj = option; }\r\n\t}\r\n\r\n\treturn [obj || options, levels.pop()];\r\n}\r\n\r\nPROTOTYPE.get = function(notation) {\r\n\tif(this.destroyed) { return this; }\r\n\r\n\tvar o = convertNotation(this.options, notation.toLowerCase()),\r\n\t\tresult = o[0][ o[1] ];\r\n\r\n\treturn result.precedance ? result.string() : result;\r\n};\r\n\r\nfunction setCallback(notation, args) {\r\n\tvar category, rule, match;\r\n\r\n\tfor(category in this.checks) {\r\n\t\tfor(rule in this.checks[category]) {\r\n\t\t\tif(match = (new RegExp(rule, 'i')).exec(notation)) {\r\n\t\t\t\targs.push(match);\r\n\r\n\t\t\t\tif(category === 'builtin' || this.plugins[category]) {\r\n\t\t\t\t\tthis.checks[category][rule].apply(\r\n\t\t\t\t\t\tthis.plugins[category] || this, args\r\n\t\t\t\t\t);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}\r\n\t}\r\n}\r\n\r\nvar rmove = /^position\\.(my|at|adjust|target|container|viewport)|style|content|show\\.ready/i,\r\n\trrender = /^prerender|show\\.ready/i;\r\n\r\nPROTOTYPE.set = function(option, value) {\r\n\tif(this.destroyed) { return this; }\r\n\r\n\tvar rendered = this.rendered,\r\n\t\treposition = FALSE,\r\n\t\toptions = this.options,\r\n\t\tchecks = this.checks,\r\n\t\tname;\r\n\r\n\t// Convert singular option/value pair into object form\r\n\tif('string' === typeof option) {\r\n\t\tname = option; option = {}; option[name] = value;\r\n\t}\r\n\telse { option = $.extend({}, option); }\r\n\r\n\t// Set all of the defined options to their new values\r\n\t$.each(option, function(notation, value) {\r\n\t\tif(rendered && rrender.test(notation)) {\r\n\t\t\tdelete option[notation]; return;\r\n\t\t}\r\n\r\n\t\t// Set new obj value\r\n\t\tvar obj = convertNotation(options, notation.toLowerCase()), previous;\r\n\t\tprevious = obj[0][ obj[1] ];\r\n\t\tobj[0][ obj[1] ] = value && value.nodeType ? $(value) : value;\r\n\r\n\t\t// Also check if we need to reposition\r\n\t\treposition = rmove.test(notation) || reposition;\r\n\r\n\t\t// Set the new params for the callback\r\n\t\toption[notation] = [obj[0], obj[1], value, previous];\r\n\t});\r\n\r\n\t// Re-sanitize options\r\n\tsanitizeOptions(options);\r\n\r\n\t/*\r\n\t * Execute any valid callbacks for the set options\r\n\t * Also set positioning flag so we don't get loads of redundant repositioning calls.\r\n\t */\r\n\tthis.positioning = TRUE;\r\n\t$.each(option, $.proxy(setCallback, this));\r\n\tthis.positioning = FALSE;\r\n\r\n\t// Update position if needed\r\n\tif(this.rendered && this.tooltip[0].offsetWidth > 0 && reposition) {\r\n\t\tthis.reposition( options.position.target === 'mouse' ? NULL : this.cache.event );\r\n\t}\r\n\r\n\treturn this;\r\n};\r\n;PROTOTYPE._update = function(content, element, reposition) {\r\n\tvar self = this,\r\n\t\tcache = this.cache;\r\n\r\n\t// Make sure tooltip is rendered and content is defined. If not return\r\n\tif(!this.rendered || !content) { return FALSE; }\r\n\r\n\t// Use function to parse content\r\n\tif($.isFunction(content)) {\r\n\t\tcontent = content.call(this.elements.target, cache.event, this) || '';\r\n\t}\r\n\r\n\t// Handle deferred content\r\n\tif($.isFunction(content.then)) {\r\n\t\tcache.waiting = TRUE;\r\n\t\treturn content.then(function(c) {\r\n\t\t\tcache.waiting = FALSE;\r\n\t\t\treturn self._update(c, element);\r\n\t\t}, NULL, function(e) {\r\n\t\t\treturn self._update(e, element);\r\n\t\t});\r\n\t}\r\n\r\n\t// If content is null... return false\r\n\tif(content === FALSE || (!content && content !== '')) { return FALSE; }\r\n\r\n\t// Append new content if its a DOM array and show it if hidden\r\n\tif(content.jquery && content.length > 0) {\r\n\t\telement.empty().append(\r\n\t\t\tcontent.css({ display: 'block', visibility: 'visible' })\r\n\t\t);\r\n\t}\r\n\r\n\t// Content is a regular string, insert the new content\r\n\telse { element.html(content); }\r\n\r\n\t// Wait for content to be loaded, and reposition\r\n\treturn this._waitForContent(element).then(function(images) {\r\n\t\tif(self.rendered && self.tooltip[0].offsetWidth > 0) {\r\n\t\t\tself.reposition(cache.event, !images.length);\r\n\t\t}\r\n\t});\r\n};\r\n\r\nPROTOTYPE._waitForContent = function(element) {\r\n\tvar cache = this.cache;\r\n\r\n\t// Set flag\r\n\tcache.waiting = TRUE;\r\n\r\n\t// If imagesLoaded is included, ensure images have loaded and return promise\r\n\treturn ( $.fn.imagesLoaded ? element.imagesLoaded() : $.Deferred().resolve([]) )\r\n\t\t.done(function() { cache.waiting = FALSE; })\r\n\t\t.promise();\r\n};\r\n\r\nPROTOTYPE._updateContent = function(content, reposition) {\r\n\tthis._update(content, this.elements.content, reposition);\r\n};\r\n\r\nPROTOTYPE._updateTitle = function(content, reposition) {\r\n\tif(this._update(content, this.elements.title, reposition) === FALSE) {\r\n\t\tthis._removeTitle(FALSE);\r\n\t}\r\n};\r\n\r\nPROTOTYPE._createTitle = function()\r\n{\r\n\tvar elements = this.elements,\r\n\t\tid = this._id+'-title';\r\n\r\n\t// Destroy previous title element, if present\r\n\tif(elements.titlebar) { this._removeTitle(); }\r\n\r\n\t// Create title bar and title elements\r\n\telements.titlebar = $('<div />', {\r\n\t\t'class': NAMESPACE + '-titlebar ' + (this.options.style.widget ? createWidgetClass('header') : '')\r\n\t})\r\n\t.append(\r\n\t\telements.title = $('<div />', {\r\n\t\t\t'id': id,\r\n\t\t\t'class': NAMESPACE + '-title',\r\n\t\t\t'aria-atomic': TRUE\r\n\t\t})\r\n\t)\r\n\t.insertBefore(elements.content)\r\n\r\n\t// Button-specific events\r\n\t.delegate('.qtip-close', 'mousedown keydown mouseup keyup mouseout', function(event) {\r\n\t\t$(this).toggleClass('ui-state-active ui-state-focus', event.type.substr(-4) === 'down');\r\n\t})\r\n\t.delegate('.qtip-close', 'mouseover mouseout', function(event){\r\n\t\t$(this).toggleClass('ui-state-hover', event.type === 'mouseover');\r\n\t});\r\n\r\n\t// Create button if enabled\r\n\tif(this.options.content.button) { this._createButton(); }\r\n};\r\n\r\nPROTOTYPE._removeTitle = function(reposition)\r\n{\r\n\tvar elements = this.elements;\r\n\r\n\tif(elements.title) {\r\n\t\telements.titlebar.remove();\r\n\t\telements.titlebar = elements.title = elements.button = NULL;\r\n\r\n\t\t// Reposition if enabled\r\n\t\tif(reposition !== FALSE) { this.reposition(); }\r\n\t}\r\n};\r\n;PROTOTYPE._createPosClass = function(my) {\r\n\treturn NAMESPACE + '-pos-' + (my || this.options.position.my).abbrev();\r\n};\r\n\r\nPROTOTYPE.reposition = function(event, effect) {\r\n\tif(!this.rendered || this.positioning || this.destroyed) { return this; }\r\n\r\n\t// Set positioning flag\r\n\tthis.positioning = TRUE;\r\n\r\n\tvar cache = this.cache,\r\n\t\ttooltip = this.tooltip,\r\n\t\tposOptions = this.options.position,\r\n\t\ttarget = posOptions.target,\r\n\t\tmy = posOptions.my,\r\n\t\tat = posOptions.at,\r\n\t\tviewport = posOptions.viewport,\r\n\t\tcontainer = posOptions.container,\r\n\t\tadjust = posOptions.adjust,\r\n\t\tmethod = adjust.method.split(' '),\r\n\t\ttooltipWidth = tooltip.outerWidth(FALSE),\r\n\t\ttooltipHeight = tooltip.outerHeight(FALSE),\r\n\t\ttargetWidth = 0,\r\n\t\ttargetHeight = 0,\r\n\t\ttype = tooltip.css('position'),\r\n\t\tposition = { left: 0, top: 0 },\r\n\t\tvisible = tooltip[0].offsetWidth > 0,\r\n\t\tisScroll = event && event.type === 'scroll',\r\n\t\twin = $(window),\r\n\t\tdoc = container[0].ownerDocument,\r\n\t\tmouse = this.mouse,\r\n\t\tpluginCalculations, offset, adjusted, newClass;\r\n\r\n\t// Check if absolute position was passed\r\n\tif($.isArray(target) && target.length === 2) {\r\n\t\t// Force left top and set position\r\n\t\tat = { x: LEFT, y: TOP };\r\n\t\tposition = { left: target[0], top: target[1] };\r\n\t}\r\n\r\n\t// Check if mouse was the target\r\n\telse if(target === 'mouse') {\r\n\t\t// Force left top to allow flipping\r\n\t\tat = { x: LEFT, y: TOP };\r\n\r\n\t\t// Use the mouse origin that caused the show event, if distance hiding is enabled\r\n\t\tif((!adjust.mouse || this.options.hide.distance) && cache.origin && cache.origin.pageX) {\r\n\t\t\tevent =  cache.origin;\r\n\t\t}\r\n\r\n\t\t// Use cached event for resize/scroll events\r\n\t\telse if(!event || (event && (event.type === 'resize' || event.type === 'scroll'))) {\r\n\t\t\tevent = cache.event;\r\n\t\t}\r\n\r\n\t\t// Otherwise, use the cached mouse coordinates if available\r\n\t\telse if(mouse && mouse.pageX) {\r\n\t\t\tevent = mouse;\r\n\t\t}\r\n\r\n\t\t// Calculate body and container offset and take them into account below\r\n\t\tif(type !== 'static') { position = container.offset(); }\r\n\t\tif(doc.body.offsetWidth !== (window.innerWidth || doc.documentElement.clientWidth)) {\r\n\t\t\toffset = $(document.body).offset();\r\n\t\t}\r\n\r\n\t\t// Use event coordinates for position\r\n\t\tposition = {\r\n\t\t\tleft: event.pageX - position.left + (offset && offset.left || 0),\r\n\t\t\ttop: event.pageY - position.top + (offset && offset.top || 0)\r\n\t\t};\r\n\r\n\t\t// Scroll events are a pain, some browsers\r\n\t\tif(adjust.mouse && isScroll && mouse) {\r\n\t\t\tposition.left -= (mouse.scrollX || 0) - win.scrollLeft();\r\n\t\t\tposition.top -= (mouse.scrollY || 0) - win.scrollTop();\r\n\t\t}\r\n\t}\r\n\r\n\t// Target wasn't mouse or absolute...\r\n\telse {\r\n\t\t// Check if event targetting is being used\r\n\t\tif(target === 'event') {\r\n\t\t\tif(event && event.target && event.type !== 'scroll' && event.type !== 'resize') {\r\n\t\t\t\tcache.target = $(event.target);\r\n\t\t\t}\r\n\t\t\telse if(!event.target) {\r\n\t\t\t\tcache.target = this.elements.target;\r\n\t\t\t}\r\n\t\t}\r\n\t\telse if(target !== 'event'){\r\n\t\t\tcache.target = $(target.jquery ? target : this.elements.target);\r\n\t\t}\r\n\t\ttarget = cache.target;\r\n\r\n\t\t// Parse the target into a jQuery object and make sure there's an element present\r\n\t\ttarget = $(target).eq(0);\r\n\t\tif(target.length === 0) { return this; }\r\n\r\n\t\t// Check if window or document is the target\r\n\t\telse if(target[0] === document || target[0] === window) {\r\n\t\t\ttargetWidth = BROWSER.iOS ? window.innerWidth : target.width();\r\n\t\t\ttargetHeight = BROWSER.iOS ? window.innerHeight : target.height();\r\n\r\n\t\t\tif(target[0] === window) {\r\n\t\t\t\tposition = {\r\n\t\t\t\t\ttop: (viewport || target).scrollTop(),\r\n\t\t\t\t\tleft: (viewport || target).scrollLeft()\r\n\t\t\t\t};\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Check if the target is an <AREA> element\r\n\t\telse if(PLUGINS.imagemap && target.is('area')) {\r\n\t\t\tpluginCalculations = PLUGINS.imagemap(this, target, at, PLUGINS.viewport ? method : FALSE);\r\n\t\t}\r\n\r\n\t\t// Check if the target is an SVG element\r\n\t\telse if(PLUGINS.svg && target && target[0].ownerSVGElement) {\r\n\t\t\tpluginCalculations = PLUGINS.svg(this, target, at, PLUGINS.viewport ? method : FALSE);\r\n\t\t}\r\n\r\n\t\t// Otherwise use regular jQuery methods\r\n\t\telse {\r\n\t\t\ttargetWidth = target.outerWidth(FALSE);\r\n\t\t\ttargetHeight = target.outerHeight(FALSE);\r\n\t\t\tposition = target.offset();\r\n\t\t}\r\n\r\n\t\t// Parse returned plugin values into proper variables\r\n\t\tif(pluginCalculations) {\r\n\t\t\ttargetWidth = pluginCalculations.width;\r\n\t\t\ttargetHeight = pluginCalculations.height;\r\n\t\t\toffset = pluginCalculations.offset;\r\n\t\t\tposition = pluginCalculations.position;\r\n\t\t}\r\n\r\n\t\t// Adjust position to take into account offset parents\r\n\t\tposition = this.reposition.offset(target, position, container);\r\n\r\n\t\t// Adjust for position.fixed tooltips (and also iOS scroll bug in v3.2-4.0 & v4.3-4.3.2)\r\n\t\tif((BROWSER.iOS > 3.1 && BROWSER.iOS < 4.1) ||\r\n\t\t\t(BROWSER.iOS >= 4.3 && BROWSER.iOS < 4.33) ||\r\n\t\t\t(!BROWSER.iOS && type === 'fixed')\r\n\t\t){\r\n\t\t\tposition.left -= win.scrollLeft();\r\n\t\t\tposition.top -= win.scrollTop();\r\n\t\t}\r\n\r\n\t\t// Adjust position relative to target\r\n\t\tif(!pluginCalculations || (pluginCalculations && pluginCalculations.adjustable !== FALSE)) {\r\n\t\t\tposition.left += at.x === RIGHT ? targetWidth : at.x === CENTER ? targetWidth / 2 : 0;\r\n\t\t\tposition.top += at.y === BOTTOM ? targetHeight : at.y === CENTER ? targetHeight / 2 : 0;\r\n\t\t}\r\n\t}\r\n\r\n\t// Adjust position relative to tooltip\r\n\tposition.left += adjust.x + (my.x === RIGHT ? -tooltipWidth : my.x === CENTER ? -tooltipWidth / 2 : 0);\r\n\tposition.top += adjust.y + (my.y === BOTTOM ? -tooltipHeight : my.y === CENTER ? -tooltipHeight / 2 : 0);\r\n\r\n\t// Use viewport adjustment plugin if enabled\r\n\tif(PLUGINS.viewport) {\r\n\t\tadjusted = position.adjusted = PLUGINS.viewport(\r\n\t\t\tthis, position, posOptions, targetWidth, targetHeight, tooltipWidth, tooltipHeight\r\n\t\t);\r\n\r\n\t\t// Apply offsets supplied by positioning plugin (if used)\r\n\t\tif(offset && adjusted.left) { position.left += offset.left; }\r\n\t\tif(offset && adjusted.top) {  position.top += offset.top; }\r\n\r\n\t\t// Apply any new 'my' position\r\n\t\tif(adjusted.my) { this.position.my = adjusted.my; }\r\n\t}\r\n\r\n\t// Viewport adjustment is disabled, set values to zero\r\n\telse { position.adjusted = { left: 0, top: 0 }; }\r\n\r\n\t// Set tooltip position class if it's changed\r\n\tif(cache.posClass !== (newClass = this._createPosClass(this.position.my))) {\r\n\t\ttooltip.removeClass(cache.posClass).addClass( (cache.posClass = newClass) );\r\n\t}\r\n\r\n\t// tooltipmove event\r\n\tif(!this._trigger('move', [position, viewport.elem || viewport], event)) { return this; }\r\n\tdelete position.adjusted;\r\n\r\n\t// If effect is disabled, target it mouse, no animation is defined or positioning gives NaN out, set CSS directly\r\n\tif(effect === FALSE || !visible || isNaN(position.left) || isNaN(position.top) || target === 'mouse' || !$.isFunction(posOptions.effect)) {\r\n\t\ttooltip.css(position);\r\n\t}\r\n\r\n\t// Use custom function if provided\r\n\telse if($.isFunction(posOptions.effect)) {\r\n\t\tposOptions.effect.call(tooltip, this, $.extend({}, position));\r\n\t\ttooltip.queue(function(next) {\r\n\t\t\t// Reset attributes to avoid cross-browser rendering bugs\r\n\t\t\t$(this).css({ opacity: '', height: '' });\r\n\t\t\tif(BROWSER.ie) { this.style.removeAttribute('filter'); }\r\n\r\n\t\t\tnext();\r\n\t\t});\r\n\t}\r\n\r\n\t// Set positioning flag\r\n\tthis.positioning = FALSE;\r\n\r\n\treturn this;\r\n};\r\n\r\n// Custom (more correct for qTip!) offset calculator\r\nPROTOTYPE.reposition.offset = function(elem, pos, container) {\r\n\tif(!container[0]) { return pos; }\r\n\r\n\tvar ownerDocument = $(elem[0].ownerDocument),\r\n\t\tquirks = !!BROWSER.ie && document.compatMode !== 'CSS1Compat',\r\n\t\tparent = container[0],\r\n\t\tscrolled, position, parentOffset, overflow;\r\n\r\n\tfunction scroll(e, i) {\r\n\t\tpos.left += i * e.scrollLeft();\r\n\t\tpos.top += i * e.scrollTop();\r\n\t}\r\n\r\n\t// Compensate for non-static containers offset\r\n\tdo {\r\n\t\tif((position = $.css(parent, 'position')) !== 'static') {\r\n\t\t\tif(position === 'fixed') {\r\n\t\t\t\tparentOffset = parent.getBoundingClientRect();\r\n\t\t\t\tscroll(ownerDocument, -1);\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tparentOffset = $(parent).position();\r\n\t\t\t\tparentOffset.left += (parseFloat($.css(parent, 'borderLeftWidth')) || 0);\r\n\t\t\t\tparentOffset.top += (parseFloat($.css(parent, 'borderTopWidth')) || 0);\r\n\t\t\t}\r\n\r\n\t\t\tpos.left -= parentOffset.left + (parseFloat($.css(parent, 'marginLeft')) || 0);\r\n\t\t\tpos.top -= parentOffset.top + (parseFloat($.css(parent, 'marginTop')) || 0);\r\n\r\n\t\t\t// If this is the first parent element with an overflow of \"scroll\" or \"auto\", store it\r\n\t\t\tif(!scrolled && (overflow = $.css(parent, 'overflow')) !== 'hidden' && overflow !== 'visible') { scrolled = $(parent); }\r\n\t\t}\r\n\t}\r\n\twhile((parent = parent.offsetParent));\r\n\r\n\t// Compensate for containers scroll if it also has an offsetParent (or in IE quirks mode)\r\n\tif(scrolled && (scrolled[0] !== ownerDocument[0] || quirks)) {\r\n\t\tscroll(scrolled, 1);\r\n\t}\r\n\r\n\treturn pos;\r\n};\r\n\r\n// Corner class\r\nvar C = (CORNER = PROTOTYPE.reposition.Corner = function(corner, forceY) {\r\n\tcorner = ('' + corner).replace(/([A-Z])/, ' $1').replace(/middle/gi, CENTER).toLowerCase();\r\n\tthis.x = (corner.match(/left|right/i) || corner.match(/center/) || ['inherit'])[0].toLowerCase();\r\n\tthis.y = (corner.match(/top|bottom|center/i) || ['inherit'])[0].toLowerCase();\r\n\tthis.forceY = !!forceY;\r\n\r\n\tvar f = corner.charAt(0);\r\n\tthis.precedance = (f === 't' || f === 'b' ? Y : X);\r\n}).prototype;\r\n\r\nC.invert = function(z, center) {\r\n\tthis[z] = this[z] === LEFT ? RIGHT : this[z] === RIGHT ? LEFT : center || this[z];\r\n};\r\n\r\nC.string = function(join) {\r\n\tvar x = this.x, y = this.y;\r\n\r\n\tvar result = x !== y ?\r\n\t\t(x === 'center' || y !== 'center' && (this.precedance === Y || this.forceY) ? \r\n\t\t\t[y,x] : [x,y]\r\n\t\t) :\r\n\t[x];\r\n\r\n\treturn join !== false ? result.join(' ') : result;\r\n};\r\n\r\nC.abbrev = function() {\r\n\tvar result = this.string(false);\r\n\treturn result[0].charAt(0) + (result[1] && result[1].charAt(0) || '');\r\n};\r\n\r\nC.clone = function() {\r\n\treturn new CORNER( this.string(), this.forceY );\r\n};\r\n\r\n;\r\nPROTOTYPE.toggle = function(state, event) {\r\n\tvar cache = this.cache,\r\n\t\toptions = this.options,\r\n\t\ttooltip = this.tooltip;\r\n\r\n\t// Try to prevent flickering when tooltip overlaps show element\r\n\tif(event) {\r\n\t\tif((/over|enter/).test(event.type) && cache.event && (/out|leave/).test(cache.event.type) &&\r\n\t\t\toptions.show.target.add(event.target).length === options.show.target.length &&\r\n\t\t\ttooltip.has(event.relatedTarget).length) {\r\n\t\t\treturn this;\r\n\t\t}\r\n\r\n\t\t// Cache event\r\n\t\tcache.event = $.event.fix(event);\r\n\t}\r\n\r\n\t// If we're currently waiting and we've just hidden... stop it\r\n\tthis.waiting && !state && (this.hiddenDuringWait = TRUE);\r\n\r\n\t// Render the tooltip if showing and it isn't already\r\n\tif(!this.rendered) { return state ? this.render(1) : this; }\r\n\telse if(this.destroyed || this.disabled) { return this; }\r\n\r\n\tvar type = state ? 'show' : 'hide',\r\n\t\topts = this.options[type],\r\n\t\totherOpts = this.options[ !state ? 'show' : 'hide' ],\r\n\t\tposOptions = this.options.position,\r\n\t\tcontentOptions = this.options.content,\r\n\t\twidth = this.tooltip.css('width'),\r\n\t\tvisible = this.tooltip.is(':visible'),\r\n\t\tanimate = state || opts.target.length === 1,\r\n\t\tsameTarget = !event || opts.target.length < 2 || cache.target[0] === event.target,\r\n\t\tidenticalState, allow, showEvent, delay, after;\r\n\r\n\t// Detect state if valid one isn't provided\r\n\tif((typeof state).search('boolean|number')) { state = !visible; }\r\n\r\n\t// Check if the tooltip is in an identical state to the new would-be state\r\n\tidenticalState = !tooltip.is(':animated') && visible === state && sameTarget;\r\n\r\n\t// Fire tooltip(show/hide) event and check if destroyed\r\n\tallow = !identicalState ? !!this._trigger(type, [90]) : NULL;\r\n\r\n\t// Check to make sure the tooltip wasn't destroyed in the callback\r\n\tif(this.destroyed) { return this; }\r\n\r\n\t// If the user didn't stop the method prematurely and we're showing the tooltip, focus it\r\n\tif(allow !== FALSE && state) { this.focus(event); }\r\n\r\n\t// If the state hasn't changed or the user stopped it, return early\r\n\tif(!allow || identicalState) { return this; }\r\n\r\n\t// Set ARIA hidden attribute\r\n\t$.attr(tooltip[0], 'aria-hidden', !!!state);\r\n\r\n\t// Execute state specific properties\r\n\tif(state) {\r\n\t\t// Store show origin coordinates\r\n\t\tthis.mouse && (cache.origin = $.event.fix(this.mouse));\r\n\r\n\t\t// Update tooltip content & title if it's a dynamic function\r\n\t\tif($.isFunction(contentOptions.text)) { this._updateContent(contentOptions.text, FALSE); }\r\n\t\tif($.isFunction(contentOptions.title)) { this._updateTitle(contentOptions.title, FALSE); }\r\n\r\n\t\t// Cache mousemove events for positioning purposes (if not already tracking)\r\n\t\tif(!trackingBound && posOptions.target === 'mouse' && posOptions.adjust.mouse) {\r\n\t\t\t$(document).bind('mousemove.'+NAMESPACE, this._storeMouse);\r\n\t\t\ttrackingBound = TRUE;\r\n\t\t}\r\n\r\n\t\t// Update the tooltip position (set width first to prevent viewport/max-width issues)\r\n\t\tif(!width) { tooltip.css('width', tooltip.outerWidth(FALSE)); }\r\n\t\tthis.reposition(event, arguments[2]);\r\n\t\tif(!width) { tooltip.css('width', ''); }\r\n\r\n\t\t// Hide other tooltips if tooltip is solo\r\n\t\tif(!!opts.solo) {\r\n\t\t\t(typeof opts.solo === 'string' ? $(opts.solo) : $(SELECTOR, opts.solo))\r\n\t\t\t\t.not(tooltip).not(opts.target).qtip('hide', $.Event('tooltipsolo'));\r\n\t\t}\r\n\t}\r\n\telse {\r\n\t\t// Clear show timer if we're hiding\r\n\t\tclearTimeout(this.timers.show);\r\n\r\n\t\t// Remove cached origin on hide\r\n\t\tdelete cache.origin;\r\n\r\n\t\t// Remove mouse tracking event if not needed (all tracking qTips are hidden)\r\n\t\tif(trackingBound && !$(SELECTOR+'[tracking=\"true\"]:visible', opts.solo).not(tooltip).length) {\r\n\t\t\t$(document).unbind('mousemove.'+NAMESPACE);\r\n\t\t\ttrackingBound = FALSE;\r\n\t\t}\r\n\r\n\t\t// Blur the tooltip\r\n\t\tthis.blur(event);\r\n\t}\r\n\r\n\t// Define post-animation, state specific properties\r\n\tafter = $.proxy(function() {\r\n\t\tif(state) {\r\n\t\t\t// Prevent antialias from disappearing in IE by removing filter\r\n\t\t\tif(BROWSER.ie) { tooltip[0].style.removeAttribute('filter'); }\r\n\r\n\t\t\t// Remove overflow setting to prevent tip bugs\r\n\t\t\ttooltip.css('overflow', '');\r\n\r\n\t\t\t// Autofocus elements if enabled\r\n\t\t\tif('string' === typeof opts.autofocus) {\r\n\t\t\t\t$(this.options.show.autofocus, tooltip).focus();\r\n\t\t\t}\r\n\r\n\t\t\t// If set, hide tooltip when inactive for delay period\r\n\t\t\tthis.options.show.target.trigger('qtip-'+this.id+'-inactive');\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// Reset CSS states\r\n\t\t\ttooltip.css({\r\n\t\t\t\tdisplay: '',\r\n\t\t\t\tvisibility: '',\r\n\t\t\t\topacity: '',\r\n\t\t\t\tleft: '',\r\n\t\t\t\ttop: ''\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// tooltipvisible/tooltiphidden events\r\n\t\tthis._trigger(state ? 'visible' : 'hidden');\r\n\t}, this);\r\n\r\n\t// If no effect type is supplied, use a simple toggle\r\n\tif(opts.effect === FALSE || animate === FALSE) {\r\n\t\ttooltip[ type ]();\r\n\t\tafter();\r\n\t}\r\n\r\n\t// Use custom function if provided\r\n\telse if($.isFunction(opts.effect)) {\r\n\t\ttooltip.stop(1, 1);\r\n\t\topts.effect.call(tooltip, this);\r\n\t\ttooltip.queue('fx', function(n) {\r\n\t\t\tafter(); n();\r\n\t\t});\r\n\t}\r\n\r\n\t// Use basic fade function by default\r\n\telse { tooltip.fadeTo(90, state ? 1 : 0, after); }\r\n\r\n\t// If inactive hide method is set, active it\r\n\tif(state) { opts.target.trigger('qtip-'+this.id+'-inactive'); }\r\n\r\n\treturn this;\r\n};\r\n\r\nPROTOTYPE.show = function(event) { return this.toggle(TRUE, event); };\r\n\r\nPROTOTYPE.hide = function(event) { return this.toggle(FALSE, event); };\r\n;PROTOTYPE.focus = function(event) {\r\n\tif(!this.rendered || this.destroyed) { return this; }\r\n\r\n\tvar qtips = $(SELECTOR),\r\n\t\ttooltip = this.tooltip,\r\n\t\tcurIndex = parseInt(tooltip[0].style.zIndex, 10),\r\n\t\tnewIndex = QTIP.zindex + qtips.length,\r\n\t\tfocusedElem;\r\n\r\n\t// Only update the z-index if it has changed and tooltip is not already focused\r\n\tif(!tooltip.hasClass(CLASS_FOCUS)) {\r\n\t\t// tooltipfocus event\r\n\t\tif(this._trigger('focus', [newIndex], event)) {\r\n\t\t\t// Only update z-index's if they've changed\r\n\t\t\tif(curIndex !== newIndex) {\r\n\t\t\t\t// Reduce our z-index's and keep them properly ordered\r\n\t\t\t\tqtips.each(function() {\r\n\t\t\t\t\tif(this.style.zIndex > curIndex) {\r\n\t\t\t\t\t\tthis.style.zIndex = this.style.zIndex - 1;\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\r\n\t\t\t\t// Fire blur event for focused tooltip\r\n\t\t\t\tqtips.filter('.' + CLASS_FOCUS).qtip('blur', event);\r\n\t\t\t}\r\n\r\n\t\t\t// Set the new z-index\r\n\t\t\ttooltip.addClass(CLASS_FOCUS)[0].style.zIndex = newIndex;\r\n\t\t}\r\n\t}\r\n\r\n\treturn this;\r\n};\r\n\r\nPROTOTYPE.blur = function(event) {\r\n\tif(!this.rendered || this.destroyed) { return this; }\r\n\r\n\t// Set focused status to FALSE\r\n\tthis.tooltip.removeClass(CLASS_FOCUS);\r\n\r\n\t// tooltipblur event\r\n\tthis._trigger('blur', [ this.tooltip.css('zIndex') ], event);\r\n\r\n\treturn this;\r\n};\r\n;PROTOTYPE.disable = function(state) {\r\n\tif(this.destroyed) { return this; }\r\n\r\n\t// If 'toggle' is passed, toggle the current state\r\n\tif(state === 'toggle') {\r\n\t\tstate = !(this.rendered ? this.tooltip.hasClass(CLASS_DISABLED) : this.disabled);\r\n\t}\r\n\r\n\t// Disable if no state passed\r\n\telse if('boolean' !== typeof state) {\r\n\t\tstate = TRUE;\r\n\t}\r\n\r\n\tif(this.rendered) {\r\n\t\tthis.tooltip.toggleClass(CLASS_DISABLED, state)\r\n\t\t\t.attr('aria-disabled', state);\r\n\t}\r\n\r\n\tthis.disabled = !!state;\r\n\r\n\treturn this;\r\n};\r\n\r\nPROTOTYPE.enable = function() { return this.disable(FALSE); };\r\n;PROTOTYPE._createButton = function()\r\n{\r\n\tvar self = this,\r\n\t\telements = this.elements,\r\n\t\ttooltip = elements.tooltip,\r\n\t\tbutton = this.options.content.button,\r\n\t\tisString = typeof button === 'string',\r\n\t\tclose = isString ? button : 'Close tooltip';\r\n\r\n\tif(elements.button) { elements.button.remove(); }\r\n\r\n\t// Use custom button if one was supplied by user, else use default\r\n\tif(button.jquery) {\r\n\t\telements.button = button;\r\n\t}\r\n\telse {\r\n\t\telements.button = $('<a />', {\r\n\t\t\t'class': 'qtip-close ' + (this.options.style.widget ? '' : NAMESPACE+'-icon'),\r\n\t\t\t'title': close,\r\n\t\t\t'aria-label': close\r\n\t\t})\r\n\t\t.prepend(\r\n\t\t\t$('<span />', {\r\n\t\t\t\t'class': 'ui-icon ui-icon-close',\r\n\t\t\t\t'html': '&times;'\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\r\n\t// Create button and setup attributes\r\n\telements.button.appendTo(elements.titlebar || tooltip)\r\n\t\t.attr('role', 'button')\r\n\t\t.click(function(event) {\r\n\t\t\tif(!tooltip.hasClass(CLASS_DISABLED)) { self.hide(event); }\r\n\t\t\treturn FALSE;\r\n\t\t});\r\n};\r\n\r\nPROTOTYPE._updateButton = function(button)\r\n{\r\n\t// Make sure tooltip is rendered and if not, return\r\n\tif(!this.rendered) { return FALSE; }\r\n\r\n\tvar elem = this.elements.button;\r\n\tif(button) { this._createButton(); }\r\n\telse { elem.remove(); }\r\n};\r\n;// Widget class creator\r\nfunction createWidgetClass(cls) {\r\n\treturn WIDGET.concat('').join(cls ? '-'+cls+' ' : ' ');\r\n}\r\n\r\n// Widget class setter method\r\nPROTOTYPE._setWidget = function()\r\n{\r\n\tvar on = this.options.style.widget,\r\n\t\telements = this.elements,\r\n\t\ttooltip = elements.tooltip,\r\n\t\tdisabled = tooltip.hasClass(CLASS_DISABLED);\r\n\r\n\ttooltip.removeClass(CLASS_DISABLED);\r\n\tCLASS_DISABLED = on ? 'ui-state-disabled' : 'qtip-disabled';\r\n\ttooltip.toggleClass(CLASS_DISABLED, disabled);\r\n\r\n\ttooltip.toggleClass('ui-helper-reset '+createWidgetClass(), on).toggleClass(CLASS_DEFAULT, this.options.style.def && !on);\r\n\r\n\tif(elements.content) {\r\n\t\telements.content.toggleClass( createWidgetClass('content'), on);\r\n\t}\r\n\tif(elements.titlebar) {\r\n\t\telements.titlebar.toggleClass( createWidgetClass('header'), on);\r\n\t}\r\n\tif(elements.button) {\r\n\t\telements.button.toggleClass(NAMESPACE+'-icon', !on);\r\n\t}\r\n};\r\n;function delay(callback, duration) {\r\n\t// If tooltip has displayed, start hide timer\r\n\tif(duration > 0) {\r\n\t\treturn setTimeout(\r\n\t\t\t$.proxy(callback, this), duration\r\n\t\t);\r\n\t}\r\n\telse{ callback.call(this); }\r\n}\r\n\r\nfunction showMethod(event) {\r\n\tif(this.tooltip.hasClass(CLASS_DISABLED)) { return; }\r\n\r\n\t// Clear hide timers\r\n\tclearTimeout(this.timers.show);\r\n\tclearTimeout(this.timers.hide);\r\n\r\n\t// Start show timer\r\n\tthis.timers.show = delay.call(this,\r\n\t\tfunction() { this.toggle(TRUE, event); },\r\n\t\tthis.options.show.delay\r\n\t);\r\n}\r\n\r\nfunction hideMethod(event) {\r\n\tif(this.tooltip.hasClass(CLASS_DISABLED) || this.destroyed) { return; }\r\n\r\n\t// Check if new target was actually the tooltip element\r\n\tvar relatedTarget = $(event.relatedTarget),\r\n\t\tontoTooltip = relatedTarget.closest(SELECTOR)[0] === this.tooltip[0],\r\n\t\tontoTarget = relatedTarget[0] === this.options.show.target[0];\r\n\r\n\t// Clear timers and stop animation queue\r\n\tclearTimeout(this.timers.show);\r\n\tclearTimeout(this.timers.hide);\r\n\r\n\t// Prevent hiding if tooltip is fixed and event target is the tooltip.\r\n\t// Or if mouse positioning is enabled and cursor momentarily overlaps\r\n\tif(this !== relatedTarget[0] &&\r\n\t\t(this.options.position.target === 'mouse' && ontoTooltip) ||\r\n\t\t(this.options.hide.fixed && (\r\n\t\t\t(/mouse(out|leave|move)/).test(event.type) && (ontoTooltip || ontoTarget))\r\n\t\t))\r\n\t{\r\n\t\ttry {\r\n\t\t\tevent.preventDefault();\r\n\t\t\tevent.stopImmediatePropagation();\r\n\t\t} catch(e) {}\r\n\r\n\t\treturn;\r\n\t}\r\n\r\n\t// If tooltip has displayed, start hide timer\r\n\tthis.timers.hide = delay.call(this,\r\n\t\tfunction() { this.toggle(FALSE, event); },\r\n\t\tthis.options.hide.delay,\r\n\t\tthis\r\n\t);\r\n}\r\n\r\nfunction inactiveMethod(event) {\r\n\tif(this.tooltip.hasClass(CLASS_DISABLED) || !this.options.hide.inactive) { return; }\r\n\r\n\t// Clear timer\r\n\tclearTimeout(this.timers.inactive);\r\n\r\n\tthis.timers.inactive = delay.call(this,\r\n\t\tfunction(){ this.hide(event); },\r\n\t\tthis.options.hide.inactive\r\n\t);\r\n}\r\n\r\nfunction repositionMethod(event) {\r\n\tif(this.rendered && this.tooltip[0].offsetWidth > 0) { this.reposition(event); }\r\n}\r\n\r\n// Store mouse coordinates\r\nPROTOTYPE._storeMouse = function(event) {\r\n\t(this.mouse = $.event.fix(event)).type = 'mousemove';\r\n\treturn this;\r\n};\r\n\r\n// Bind events\r\nPROTOTYPE._bind = function(targets, events, method, suffix, context) {\r\n\tif(!targets || !method || !events.length) { return; }\r\n\tvar ns = '.' + this._id + (suffix ? '-'+suffix : '');\r\n\t$(targets).bind(\r\n\t\t(events.split ? events : events.join(ns + ' ')) + ns,\r\n\t\t$.proxy(method, context || this)\r\n\t);\r\n\treturn this;\r\n};\r\nPROTOTYPE._unbind = function(targets, suffix) {\r\n\ttargets && $(targets).unbind('.' + this._id + (suffix ? '-'+suffix : ''));\r\n\treturn this;\r\n};\r\n\r\n// Global delegation helper\r\nfunction delegate(selector, events, method) {\r\n\t$(document.body).delegate(selector,\r\n\t\t(events.split ? events : events.join('.'+NAMESPACE + ' ')) + '.'+NAMESPACE,\r\n\t\tfunction() {\r\n\t\t\tvar api = QTIP.api[ $.attr(this, ATTR_ID) ];\r\n\t\t\tapi && !api.disabled && method.apply(api, arguments);\r\n\t\t}\r\n\t);\r\n}\r\n// Event trigger\r\nPROTOTYPE._trigger = function(type, args, event) {\r\n\tvar callback = $.Event('tooltip'+type);\r\n\tcallback.originalEvent = (event && $.extend({}, event)) || this.cache.event || NULL;\r\n\r\n\tthis.triggering = type;\r\n\tthis.tooltip.trigger(callback, [this].concat(args || []));\r\n\tthis.triggering = FALSE;\r\n\r\n\treturn !callback.isDefaultPrevented();\r\n};\r\n\r\nPROTOTYPE._bindEvents = function(showEvents, hideEvents, showTargets, hideTargets, showMethod, hideMethod) {\r\n\t// Get tasrgets that lye within both\r\n\tvar similarTargets = showTargets.filter( hideTargets ).add( hideTargets.filter(showTargets) ),\r\n\t\ttoggleEvents = [];\r\n\r\n\t// If hide and show targets are the same...\r\n\tif(similarTargets.length) {\r\n\r\n\t\t// Filter identical show/hide events\r\n\t\t$.each(hideEvents, function(i, type) {\r\n\t\t\tvar showIndex = $.inArray(type, showEvents);\r\n\r\n\t\t\t// Both events are identical, remove from both hide and show events\r\n\t\t\t// and append to toggleEvents\r\n\t\t\tshowIndex > -1 && toggleEvents.push( showEvents.splice( showIndex, 1 )[0] );\r\n\t\t});\r\n\r\n\t\t// Toggle events are special case of identical show/hide events, which happen in sequence\r\n\t\tif(toggleEvents.length) {\r\n\t\t\t// Bind toggle events to the similar targets\r\n\t\t\tthis._bind(similarTargets, toggleEvents, function(event) {\r\n\t\t\t\tvar state = this.rendered ? this.tooltip[0].offsetWidth > 0 : false;\r\n\t\t\t\t(state ? hideMethod : showMethod).call(this, event);\r\n\t\t\t});\r\n\r\n\t\t\t// Remove the similar targets from the regular show/hide bindings\r\n\t\t\tshowTargets = showTargets.not(similarTargets);\r\n\t\t\thideTargets = hideTargets.not(similarTargets);\r\n\t\t}\r\n\t}\r\n\r\n\t// Apply show/hide/toggle events\r\n\tthis._bind(showTargets, showEvents, showMethod);\r\n\tthis._bind(hideTargets, hideEvents, hideMethod);\r\n};\r\n\r\nPROTOTYPE._assignInitialEvents = function(event) {\r\n\tvar options = this.options,\r\n\t\tshowTarget = options.show.target,\r\n\t\thideTarget = options.hide.target,\r\n\t\tshowEvents = options.show.event ? $.trim('' + options.show.event).split(' ') : [],\r\n\t\thideEvents = options.hide.event ? $.trim('' + options.hide.event).split(' ') : [];\r\n\r\n\t// Catch remove/removeqtip events on target element to destroy redundant tooltips\r\n\tthis._bind(this.elements.target, ['remove', 'removeqtip'], function(event) {\r\n\t\tthis.destroy(true);\r\n\t}, 'destroy');\r\n\r\n\t/*\r\n\t * Make sure hoverIntent functions properly by using mouseleave as a hide event if\r\n\t * mouseenter/mouseout is used for show.event, even if it isn't in the users options.\r\n\t */\r\n\tif(/mouse(over|enter)/i.test(options.show.event) && !/mouse(out|leave)/i.test(options.hide.event)) {\r\n\t\thideEvents.push('mouseleave');\r\n\t}\r\n\r\n\t/*\r\n\t * Also make sure initial mouse targetting works correctly by caching mousemove coords\r\n\t * on show targets before the tooltip has rendered. Also set onTarget when triggered to\r\n\t * keep mouse tracking working.\r\n\t */\r\n\tthis._bind(showTarget, 'mousemove', function(event) {\r\n\t\tthis._storeMouse(event);\r\n\t\tthis.cache.onTarget = TRUE;\r\n\t});\r\n\r\n\t// Define hoverIntent function\r\n\tfunction hoverIntent(event) {\r\n\t\t// Only continue if tooltip isn't disabled\r\n\t\tif(this.disabled || this.destroyed) { return FALSE; }\r\n\r\n\t\t// Cache the event data\r\n\t\tthis.cache.event = event && $.event.fix(event);\r\n\t\tthis.cache.target = event && $(event.target);\r\n\r\n\t\t// Start the event sequence\r\n\t\tclearTimeout(this.timers.show);\r\n\t\tthis.timers.show = delay.call(this,\r\n\t\t\tfunction() { this.render(typeof event === 'object' || options.show.ready); },\r\n\t\t\toptions.prerender ? 0 : options.show.delay\r\n\t\t);\r\n\t}\r\n\r\n\t// Filter and bind events\r\n\tthis._bindEvents(showEvents, hideEvents, showTarget, hideTarget, hoverIntent, function() {\r\n\t\tif(!this.timers) { return FALSE; }\r\n\t\tclearTimeout(this.timers.show);\r\n\t});\r\n\r\n\t// Prerendering is enabled, create tooltip now\r\n\tif(options.show.ready || options.prerender) { hoverIntent.call(this, event); }\r\n};\r\n\r\n// Event assignment method\r\nPROTOTYPE._assignEvents = function() {\r\n\tvar self = this,\r\n\t\toptions = this.options,\r\n\t\tposOptions = options.position,\r\n\r\n\t\ttooltip = this.tooltip,\r\n\t\tshowTarget = options.show.target,\r\n\t\thideTarget = options.hide.target,\r\n\t\tcontainerTarget = posOptions.container,\r\n\t\tviewportTarget = posOptions.viewport,\r\n\t\tdocumentTarget = $(document),\r\n\t\tbodyTarget = $(document.body),\r\n\t\twindowTarget = $(window),\r\n\r\n\t\tshowEvents = options.show.event ? $.trim('' + options.show.event).split(' ') : [],\r\n\t\thideEvents = options.hide.event ? $.trim('' + options.hide.event).split(' ') : [];\r\n\r\n\r\n\t// Assign passed event callbacks\r\n\t$.each(options.events, function(name, callback) {\r\n\t\tself._bind(tooltip, name === 'toggle' ? ['tooltipshow','tooltiphide'] : ['tooltip'+name], callback, null, tooltip);\r\n\t});\r\n\r\n\t// Hide tooltips when leaving current window/frame (but not select/option elements)\r\n\tif(/mouse(out|leave)/i.test(options.hide.event) && options.hide.leave === 'window') {\r\n\t\tthis._bind(documentTarget, ['mouseout', 'blur'], function(event) {\r\n\t\t\tif(!/select|option/.test(event.target.nodeName) && !event.relatedTarget) {\r\n\t\t\t\tthis.hide(event);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t// Enable hide.fixed by adding appropriate class\r\n\tif(options.hide.fixed) {\r\n\t\thideTarget = hideTarget.add( tooltip.addClass(CLASS_FIXED) );\r\n\t}\r\n\r\n\t/*\r\n\t * Make sure hoverIntent functions properly by using mouseleave to clear show timer if\r\n\t * mouseenter/mouseout is used for show.event, even if it isn't in the users options.\r\n\t */\r\n\telse if(/mouse(over|enter)/i.test(options.show.event)) {\r\n\t\tthis._bind(hideTarget, 'mouseleave', function() {\r\n\t\t\tclearTimeout(this.timers.show);\r\n\t\t});\r\n\t}\r\n\r\n\t// Hide tooltip on document mousedown if unfocus events are enabled\r\n\tif(('' + options.hide.event).indexOf('unfocus') > -1) {\r\n\t\tthis._bind(containerTarget.closest('html'), ['mousedown', 'touchstart'], function(event) {\r\n\t\t\tvar elem = $(event.target),\r\n\t\t\t\tenabled = this.rendered && !this.tooltip.hasClass(CLASS_DISABLED) && this.tooltip[0].offsetWidth > 0,\r\n\t\t\t\tisAncestor = elem.parents(SELECTOR).filter(this.tooltip[0]).length > 0;\r\n\r\n\t\t\tif(elem[0] !== this.target[0] && elem[0] !== this.tooltip[0] && !isAncestor &&\r\n\t\t\t\t!this.target.has(elem[0]).length && enabled\r\n\t\t\t) {\r\n\t\t\t\tthis.hide(event);\r\n\t\t\t}\r\n\t\t});\r\n\t}\r\n\r\n\t// Check if the tooltip hides when inactive\r\n\tif('number' === typeof options.hide.inactive) {\r\n\t\t// Bind inactive method to show target(s) as a custom event\r\n\t\tthis._bind(showTarget, 'qtip-'+this.id+'-inactive', inactiveMethod, 'inactive');\r\n\r\n\t\t// Define events which reset the 'inactive' event handler\r\n\t\tthis._bind(hideTarget.add(tooltip), QTIP.inactiveEvents, inactiveMethod);\r\n\t}\r\n\r\n\t// Filter and bind events\r\n\tthis._bindEvents(showEvents, hideEvents, showTarget, hideTarget, showMethod, hideMethod);\r\n\r\n\t// Mouse movement bindings\r\n\tthis._bind(showTarget.add(tooltip), 'mousemove', function(event) {\r\n\t\t// Check if the tooltip hides when mouse is moved a certain distance\r\n\t\tif('number' === typeof options.hide.distance) {\r\n\t\t\tvar origin = this.cache.origin || {},\r\n\t\t\t\tlimit = this.options.hide.distance,\r\n\t\t\t\tabs = Math.abs;\r\n\r\n\t\t\t// Check if the movement has gone beyond the limit, and hide it if so\r\n\t\t\tif(abs(event.pageX - origin.pageX) >= limit || abs(event.pageY - origin.pageY) >= limit) {\r\n\t\t\t\tthis.hide(event);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Cache mousemove coords on show targets\r\n\t\tthis._storeMouse(event);\r\n\t});\r\n\r\n\t// Mouse positioning events\r\n\tif(posOptions.target === 'mouse') {\r\n\t\t// If mouse adjustment is on...\r\n\t\tif(posOptions.adjust.mouse) {\r\n\t\t\t// Apply a mouseleave event so we don't get problems with overlapping\r\n\t\t\tif(options.hide.event) {\r\n\t\t\t\t// Track if we're on the target or not\r\n\t\t\t\tthis._bind(showTarget, ['mouseenter', 'mouseleave'], function(event) {\r\n\t\t\t\t\tif(!this.cache) {return FALSE; }\r\n\t\t\t\t\tthis.cache.onTarget = event.type === 'mouseenter';\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Update tooltip position on mousemove\r\n\t\t\tthis._bind(documentTarget, 'mousemove', function(event) {\r\n\t\t\t\t// Update the tooltip position only if the tooltip is visible and adjustment is enabled\r\n\t\t\t\tif(this.rendered && this.cache.onTarget && !this.tooltip.hasClass(CLASS_DISABLED) && this.tooltip[0].offsetWidth > 0) {\r\n\t\t\t\t\tthis.reposition(event);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\t\t}\r\n\t}\r\n\r\n\t// Adjust positions of the tooltip on window resize if enabled\r\n\tif(posOptions.adjust.resize || viewportTarget.length) {\r\n\t\tthis._bind( $.event.special.resize ? viewportTarget : windowTarget, 'resize', repositionMethod );\r\n\t}\r\n\r\n\t// Adjust tooltip position on scroll of the window or viewport element if present\r\n\tif(posOptions.adjust.scroll) {\r\n\t\tthis._bind( windowTarget.add(posOptions.container), 'scroll', repositionMethod );\r\n\t}\r\n};\r\n\r\n// Un-assignment method\r\nPROTOTYPE._unassignEvents = function() {\r\n\tvar options = this.options,\r\n\t\tshowTargets = options.show.target,\r\n\t\thideTargets = options.hide.target,\r\n\t\ttargets = $.grep([\r\n\t\t\tthis.elements.target[0],\r\n\t\t\tthis.rendered && this.tooltip[0],\r\n\t\t\toptions.position.container[0],\r\n\t\t\toptions.position.viewport[0],\r\n\t\t\toptions.position.container.closest('html')[0], // unfocus\r\n\t\t\twindow,\r\n\t\t\tdocument\r\n\t\t], function(i) {\r\n\t\t\treturn typeof i === 'object';\r\n\t\t});\r\n\r\n\t// Add show and hide targets if they're valid\r\n\tif(showTargets && showTargets.toArray) {\r\n\t\ttargets = targets.concat(showTargets.toArray());\r\n\t}\r\n\tif(hideTargets && hideTargets.toArray) {\r\n\t\ttargets = targets.concat(hideTargets.toArray());\r\n\t}\r\n\r\n\t// Unbind the events\r\n\tthis._unbind(targets)\r\n\t\t._unbind(targets, 'destroy')\r\n\t\t._unbind(targets, 'inactive');\r\n};\r\n\r\n// Apply common event handlers using delegate (avoids excessive .bind calls!)\r\n$(function() {\r\n\tdelegate(SELECTOR, ['mouseenter', 'mouseleave'], function(event) {\r\n\t\tvar state = event.type === 'mouseenter',\r\n\t\t\ttooltip = $(event.currentTarget),\r\n\t\t\ttarget = $(event.relatedTarget || event.target),\r\n\t\t\toptions = this.options;\r\n\r\n\t\t// On mouseenter...\r\n\t\tif(state) {\r\n\t\t\t// Focus the tooltip on mouseenter (z-index stacking)\r\n\t\t\tthis.focus(event);\r\n\r\n\t\t\t// Clear hide timer on tooltip hover to prevent it from closing\r\n\t\t\ttooltip.hasClass(CLASS_FIXED) && !tooltip.hasClass(CLASS_DISABLED) && clearTimeout(this.timers.hide);\r\n\t\t}\r\n\r\n\t\t// On mouseleave...\r\n\t\telse {\r\n\t\t\t// When mouse tracking is enabled, hide when we leave the tooltip and not onto the show target (if a hide event is set)\r\n\t\t\tif(options.position.target === 'mouse' && options.position.adjust.mouse &&\r\n\t\t\t\toptions.hide.event && options.show.target && !target.closest(options.show.target[0]).length) {\r\n\t\t\t\tthis.hide(event);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Add hover class\r\n\t\ttooltip.toggleClass(CLASS_HOVER, state);\r\n\t});\r\n\r\n\t// Define events which reset the 'inactive' event handler\r\n\tdelegate('['+ATTR_ID+']', INACTIVE_EVENTS, inactiveMethod);\r\n});\r\n;// Initialization method\r\nfunction init(elem, id, opts) {\r\n\tvar obj, posOptions, attr, config, title,\r\n\r\n\t// Setup element references\r\n\tdocBody = $(document.body),\r\n\r\n\t// Use document body instead of document element if needed\r\n\tnewTarget = elem[0] === document ? docBody : elem,\r\n\r\n\t// Grab metadata from element if plugin is present\r\n\tmetadata = (elem.metadata) ? elem.metadata(opts.metadata) : NULL,\r\n\r\n\t// If metadata type if HTML5, grab 'name' from the object instead, or use the regular data object otherwise\r\n\tmetadata5 = opts.metadata.type === 'html5' && metadata ? metadata[opts.metadata.name] : NULL,\r\n\r\n\t// Grab data from metadata.name (or data-qtipopts as fallback) using .data() method,\r\n\thtml5 = elem.data(opts.metadata.name || 'qtipopts');\r\n\r\n\t// If we don't get an object returned attempt to parse it manualyl without parseJSON\r\n\ttry { html5 = typeof html5 === 'string' ? $.parseJSON(html5) : html5; } catch(e) {}\r\n\r\n\t// Merge in and sanitize metadata\r\n\tconfig = $.extend(TRUE, {}, QTIP.defaults, opts,\r\n\t\ttypeof html5 === 'object' ? sanitizeOptions(html5) : NULL,\r\n\t\tsanitizeOptions(metadata5 || metadata));\r\n\r\n\t// Re-grab our positioning options now we've merged our metadata and set id to passed value\r\n\tposOptions = config.position;\r\n\tconfig.id = id;\r\n\r\n\t// Setup missing content if none is detected\r\n\tif('boolean' === typeof config.content.text) {\r\n\t\tattr = elem.attr(config.content.attr);\r\n\r\n\t\t// Grab from supplied attribute if available\r\n\t\tif(config.content.attr !== FALSE && attr) { config.content.text = attr; }\r\n\r\n\t\t// No valid content was found, abort render\r\n\t\telse { return FALSE; }\r\n\t}\r\n\r\n\t// Setup target options\r\n\tif(!posOptions.container.length) { posOptions.container = docBody; }\r\n\tif(posOptions.target === FALSE) { posOptions.target = newTarget; }\r\n\tif(config.show.target === FALSE) { config.show.target = newTarget; }\r\n\tif(config.show.solo === TRUE) { config.show.solo = posOptions.container.closest('body'); }\r\n\tif(config.hide.target === FALSE) { config.hide.target = newTarget; }\r\n\tif(config.position.viewport === TRUE) { config.position.viewport = posOptions.container; }\r\n\r\n\t// Ensure we only use a single container\r\n\tposOptions.container = posOptions.container.eq(0);\r\n\r\n\t// Convert position corner values into x and y strings\r\n\tposOptions.at = new CORNER(posOptions.at, TRUE);\r\n\tposOptions.my = new CORNER(posOptions.my);\r\n\r\n\t// Destroy previous tooltip if overwrite is enabled, or skip element if not\r\n\tif(elem.data(NAMESPACE)) {\r\n\t\tif(config.overwrite) {\r\n\t\t\telem.qtip('destroy', true);\r\n\t\t}\r\n\t\telse if(config.overwrite === FALSE) {\r\n\t\t\treturn FALSE;\r\n\t\t}\r\n\t}\r\n\r\n\t// Add has-qtip attribute\r\n\telem.attr(ATTR_HAS, id);\r\n\r\n\t// Remove title attribute and store it if present\r\n\tif(config.suppress && (title = elem.attr('title'))) {\r\n\t\t// Final attr call fixes event delegatiom and IE default tooltip showing problem\r\n\t\telem.removeAttr('title').attr(oldtitle, title).attr('title', '');\r\n\t}\r\n\r\n\t// Initialize the tooltip and add API reference\r\n\tobj = new QTip(elem, config, id, !!attr);\r\n\telem.data(NAMESPACE, obj);\r\n\r\n\treturn obj;\r\n}\r\n\r\n// jQuery $.fn extension method\r\nQTIP = $.fn.qtip = function(options, notation, newValue)\r\n{\r\n\tvar command = ('' + options).toLowerCase(), // Parse command\r\n\t\treturned = NULL,\r\n\t\targs = $.makeArray(arguments).slice(1),\r\n\t\tevent = args[args.length - 1],\r\n\t\topts = this[0] ? $.data(this[0], NAMESPACE) : NULL;\r\n\r\n\t// Check for API request\r\n\tif((!arguments.length && opts) || command === 'api') {\r\n\t\treturn opts;\r\n\t}\r\n\r\n\t// Execute API command if present\r\n\telse if('string' === typeof options) {\r\n\t\tthis.each(function() {\r\n\t\t\tvar api = $.data(this, NAMESPACE);\r\n\t\t\tif(!api) { return TRUE; }\r\n\r\n\t\t\t// Cache the event if possible\r\n\t\t\tif(event && event.timeStamp) { api.cache.event = event; }\r\n\r\n\t\t\t// Check for specific API commands\r\n\t\t\tif(notation && (command === 'option' || command === 'options')) {\r\n\t\t\t\tif(newValue !== undefined || $.isPlainObject(notation)) {\r\n\t\t\t\t\tapi.set(notation, newValue);\r\n\t\t\t\t}\r\n\t\t\t\telse {\r\n\t\t\t\t\treturned = api.get(notation);\r\n\t\t\t\t\treturn FALSE;\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\t// Execute API command\r\n\t\t\telse if(api[command]) {\r\n\t\t\t\tapi[command].apply(api, args);\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\treturn returned !== NULL ? returned : this;\r\n\t}\r\n\r\n\t// No API commands. validate provided options and setup qTips\r\n\telse if('object' === typeof options || !arguments.length) {\r\n\t\t// Sanitize options first\r\n\t\topts = sanitizeOptions($.extend(TRUE, {}, options));\r\n\r\n\t\treturn this.each(function(i) {\r\n\t\t\tvar api, id;\r\n\r\n\t\t\t// Find next available ID, or use custom ID if provided\r\n\t\t\tid = $.isArray(opts.id) ? opts.id[i] : opts.id;\r\n\t\t\tid = !id || id === FALSE || id.length < 1 || QTIP.api[id] ? QTIP.nextid++ : id;\r\n\r\n\t\t\t// Initialize the qTip and re-grab newly sanitized options\r\n\t\t\tapi = init($(this), id, opts);\r\n\t\t\tif(api === FALSE) { return TRUE; }\r\n\t\t\telse { QTIP.api[id] = api; }\r\n\r\n\t\t\t// Initialize plugins\r\n\t\t\t$.each(PLUGINS, function() {\r\n\t\t\t\tif(this.initialize === 'initialize') { this(api); }\r\n\t\t\t});\r\n\r\n\t\t\t// Assign initial pre-render events\r\n\t\t\tapi._assignInitialEvents(event);\r\n\t\t});\r\n\t}\r\n};\r\n\r\n// Expose class\r\n$.qtip = QTip;\r\n\r\n// Populated in render method\r\nQTIP.api = {};\r\n;$.each({\r\n\t/* Allow other plugins to successfully retrieve the title of an element with a qTip applied */\r\n\tattr: function(attr, val) {\r\n\t\tif(this.length) {\r\n\t\t\tvar self = this[0],\r\n\t\t\t\ttitle = 'title',\r\n\t\t\t\tapi = $.data(self, 'qtip');\r\n\r\n\t\t\tif(attr === title && api && 'object' === typeof api && api.options.suppress) {\r\n\t\t\t\tif(arguments.length < 2) {\r\n\t\t\t\t\treturn $.attr(self, oldtitle);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// If qTip is rendered and title was originally used as content, update it\r\n\t\t\t\tif(api && api.options.content.attr === title && api.cache.attr) {\r\n\t\t\t\t\tapi.set('content.text', val);\r\n\t\t\t\t}\r\n\r\n\t\t\t\t// Use the regular attr method to set, then cache the result\r\n\t\t\t\treturn this.attr(oldtitle, val);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn $.fn['attr'+replaceSuffix].apply(this, arguments);\r\n\t},\r\n\r\n\t/* Allow clone to correctly retrieve cached title attributes */\r\n\tclone: function(keepData) {\r\n\t\tvar titles = $([]), title = 'title',\r\n\r\n\t\t// Clone our element using the real clone method\r\n\t\telems = $.fn['clone'+replaceSuffix].apply(this, arguments);\r\n\r\n\t\t// Grab all elements with an oldtitle set, and change it to regular title attribute, if keepData is false\r\n\t\tif(!keepData) {\r\n\t\t\telems.filter('['+oldtitle+']').attr('title', function() {\r\n\t\t\t\treturn $.attr(this, oldtitle);\r\n\t\t\t})\r\n\t\t\t.removeAttr(oldtitle);\r\n\t\t}\r\n\r\n\t\treturn elems;\r\n\t}\r\n}, function(name, func) {\r\n\tif(!func || $.fn[name+replaceSuffix]) { return TRUE; }\r\n\r\n\tvar old = $.fn[name+replaceSuffix] = $.fn[name];\r\n\t$.fn[name] = function() {\r\n\t\treturn func.apply(this, arguments) || old.apply(this, arguments);\r\n\t};\r\n});\r\n\r\n/* Fire off 'removeqtip' handler in $.cleanData if jQuery UI not present (it already does similar).\r\n * This snippet is taken directly from jQuery UI source code found here:\r\n *     http://code.jquery.com/ui/jquery-ui-git.js\r\n */\r\nif(!$.ui) {\r\n\t$['cleanData'+replaceSuffix] = $.cleanData;\r\n\t$.cleanData = function( elems ) {\r\n\t\tfor(var i = 0, elem; (elem = $( elems[i] )).length; i++) {\r\n\t\t\tif(elem.attr(ATTR_HAS)) {\r\n\t\t\t\ttry { elem.triggerHandler('removeqtip'); }\r\n\t\t\t\tcatch( e ) {}\r\n\t\t\t}\r\n\t\t}\r\n\t\t$['cleanData'+replaceSuffix].apply(this, arguments);\r\n\t};\r\n}\r\n;// qTip version\r\nQTIP.version = '2.2.1';\r\n\r\n// Base ID for all qTips\r\nQTIP.nextid = 0;\r\n\r\n// Inactive events array\r\nQTIP.inactiveEvents = INACTIVE_EVENTS;\r\n\r\n// Base z-index for all qTips\r\nQTIP.zindex = 15000;\r\n\r\n// Define configuration defaults\r\nQTIP.defaults = {\r\n\tprerender: FALSE,\r\n\tid: FALSE,\r\n\toverwrite: TRUE,\r\n\tsuppress: TRUE,\r\n\tcontent: {\r\n\t\ttext: TRUE,\r\n\t\tattr: 'title',\r\n\t\ttitle: FALSE,\r\n\t\tbutton: FALSE\r\n\t},\r\n\tposition: {\r\n\t\tmy: 'top left',\r\n\t\tat: 'bottom right',\r\n\t\ttarget: FALSE,\r\n\t\tcontainer: FALSE,\r\n\t\tviewport: FALSE,\r\n\t\tadjust: {\r\n\t\t\tx: 0, y: 0,\r\n\t\t\tmouse: TRUE,\r\n\t\t\tscroll: TRUE,\r\n\t\t\tresize: TRUE,\r\n\t\t\tmethod: 'flipinvert flipinvert'\r\n\t\t},\r\n\t\teffect: function(api, pos, viewport) {\r\n\t\t\t$(this).animate(pos, {\r\n\t\t\t\tduration: 200,\r\n\t\t\t\tqueue: FALSE\r\n\t\t\t});\r\n\t\t}\r\n\t},\r\n\tshow: {\r\n\t\ttarget: FALSE,\r\n\t\tevent: 'mouseenter',\r\n\t\teffect: TRUE,\r\n\t\tdelay: 90,\r\n\t\tsolo: FALSE,\r\n\t\tready: FALSE,\r\n\t\tautofocus: FALSE\r\n\t},\r\n\thide: {\r\n\t\ttarget: FALSE,\r\n\t\tevent: 'mouseleave',\r\n\t\teffect: TRUE,\r\n\t\tdelay: 0,\r\n\t\tfixed: FALSE,\r\n\t\tinactive: FALSE,\r\n\t\tleave: 'window',\r\n\t\tdistance: FALSE\r\n\t},\r\n\tstyle: {\r\n\t\tclasses: '',\r\n\t\twidget: FALSE,\r\n\t\twidth: FALSE,\r\n\t\theight: FALSE,\r\n\t\tdef: TRUE\r\n\t},\r\n\tevents: {\r\n\t\trender: NULL,\r\n\t\tmove: NULL,\r\n\t\tshow: NULL,\r\n\t\thide: NULL,\r\n\t\ttoggle: NULL,\r\n\t\tvisible: NULL,\r\n\t\thidden: NULL,\r\n\t\tfocus: NULL,\r\n\t\tblur: NULL\r\n\t}\r\n};\r\n;var TIP,\r\n\r\n// .bind()/.on() namespace\r\nTIPNS = '.qtip-tip',\r\n\r\n// Common CSS strings\r\nMARGIN = 'margin',\r\nBORDER = 'border',\r\nCOLOR = 'color',\r\nBG_COLOR = 'background-color',\r\nTRANSPARENT = 'transparent',\r\nIMPORTANT = ' !important',\r\n\r\n// Check if the browser supports <canvas/> elements\r\nHASCANVAS = !!document.createElement('canvas').getContext,\r\n\r\n// Invalid colour values used in parseColours()\r\nINVALID = /rgba?\\(0, 0, 0(, 0)?\\)|transparent|#123456/i;\r\n\r\n// Camel-case method, taken from jQuery source\r\n// http://code.jquery.com/jquery-1.8.0.js\r\nfunction camel(s) { return s.charAt(0).toUpperCase() + s.slice(1); }\r\n\r\n/*\r\n * Modified from Modernizr's testPropsAll()\r\n * http://modernizr.com/downloads/modernizr-latest.js\r\n */\r\nvar cssProps = {}, cssPrefixes = [\"Webkit\", \"O\", \"Moz\", \"ms\"];\r\nfunction vendorCss(elem, prop) {\r\n\tvar ucProp = prop.charAt(0).toUpperCase() + prop.slice(1),\r\n\t\tprops = (prop + ' ' + cssPrefixes.join(ucProp + ' ') + ucProp).split(' '),\r\n\t\tcur, val, i = 0;\r\n\r\n\t// If the property has already been mapped...\r\n\tif(cssProps[prop]) { return elem.css(cssProps[prop]); }\r\n\r\n\twhile((cur = props[i++])) {\r\n\t\tif((val = elem.css(cur)) !== undefined) {\r\n\t\t\treturn cssProps[prop] = cur, val;\r\n\t\t}\r\n\t}\r\n}\r\n\r\n// Parse a given elements CSS property into an int\r\nfunction intCss(elem, prop) {\r\n\treturn Math.ceil(parseFloat(vendorCss(elem, prop)));\r\n}\r\n\r\n\r\n// VML creation (for IE only)\r\nif(!HASCANVAS) {\r\n\tvar createVML = function(tag, props, style) {\r\n\t\treturn '<qtipvml:'+tag+' xmlns=\"urn:schemas-microsoft.com:vml\" class=\"qtip-vml\" '+(props||'')+\r\n\t\t\t' style=\"behavior: url(#default#VML); '+(style||'')+ '\" />';\r\n\t};\r\n}\r\n\r\n// Canvas only definitions\r\nelse {\r\n\tvar PIXEL_RATIO = window.devicePixelRatio || 1,\r\n\t\tBACKING_STORE_RATIO = (function() {\r\n\t\t\tvar context = document.createElement('canvas').getContext('2d');\r\n\t\t\treturn context.backingStorePixelRatio || context.webkitBackingStorePixelRatio || context.mozBackingStorePixelRatio ||\r\n\t\t\t\t\tcontext.msBackingStorePixelRatio || context.oBackingStorePixelRatio || 1;\r\n\t\t}()),\r\n\t\tSCALE = PIXEL_RATIO / BACKING_STORE_RATIO;\r\n}\r\n\r\n\r\nfunction Tip(qtip, options) {\r\n\tthis._ns = 'tip';\r\n\tthis.options = options;\r\n\tthis.offset = options.offset;\r\n\tthis.size = [ options.width, options.height ];\r\n\r\n\t// Initialize\r\n\tthis.init( (this.qtip = qtip) );\r\n}\r\n\r\n$.extend(Tip.prototype, {\r\n\tinit: function(qtip) {\r\n\t\tvar context, tip;\r\n\r\n\t\t// Create tip element and prepend to the tooltip\r\n\t\ttip = this.element = qtip.elements.tip = $('<div />', { 'class': NAMESPACE+'-tip' }).prependTo(qtip.tooltip);\r\n\r\n\t\t// Create tip drawing element(s)\r\n\t\tif(HASCANVAS) {\r\n\t\t\t// save() as soon as we create the canvas element so FF2 doesn't bork on our first restore()!\r\n\t\t\tcontext = $('<canvas />').appendTo(this.element)[0].getContext('2d');\r\n\r\n\t\t\t// Setup constant parameters\r\n\t\t\tcontext.lineJoin = 'miter';\r\n\t\t\tcontext.miterLimit = 100000;\r\n\t\t\tcontext.save();\r\n\t\t}\r\n\t\telse {\r\n\t\t\tcontext = createVML('shape', 'coordorigin=\"0,0\"', 'position:absolute;');\r\n\t\t\tthis.element.html(context + context);\r\n\r\n\t\t\t// Prevent mousing down on the tip since it causes problems with .live() handling in IE due to VML\r\n\t\t\tqtip._bind( $('*', tip).add(tip), ['click', 'mousedown'], function(event) { event.stopPropagation(); }, this._ns);\r\n\t\t}\r\n\r\n\t\t// Bind update events\r\n\t\tqtip._bind(qtip.tooltip, 'tooltipmove', this.reposition, this._ns, this);\r\n\r\n\t\t// Create it\r\n\t\tthis.create();\r\n\t},\r\n\r\n\t_swapDimensions: function() {\r\n\t\tthis.size[0] = this.options.height;\r\n\t\tthis.size[1] = this.options.width;\r\n\t},\r\n\t_resetDimensions: function() {\r\n\t\tthis.size[0] = this.options.width;\r\n\t\tthis.size[1] = this.options.height;\r\n\t},\r\n\r\n\t_useTitle: function(corner) {\r\n\t\tvar titlebar = this.qtip.elements.titlebar;\r\n\t\treturn titlebar && (\r\n\t\t\tcorner.y === TOP || (corner.y === CENTER && this.element.position().top + (this.size[1] / 2) + this.options.offset < titlebar.outerHeight(TRUE))\r\n\t\t);\r\n\t},\r\n\r\n\t_parseCorner: function(corner) {\r\n\t\tvar my = this.qtip.options.position.my;\r\n\r\n\t\t// Detect corner and mimic properties\r\n\t\tif(corner === FALSE || my === FALSE) {\r\n\t\t\tcorner = FALSE;\r\n\t\t}\r\n\t\telse if(corner === TRUE) {\r\n\t\t\tcorner = new CORNER( my.string() );\r\n\t\t}\r\n\t\telse if(!corner.string) {\r\n\t\t\tcorner = new CORNER(corner);\r\n\t\t\tcorner.fixed = TRUE;\r\n\t\t}\r\n\r\n\t\treturn corner;\r\n\t},\r\n\r\n\t_parseWidth: function(corner, side, use) {\r\n\t\tvar elements = this.qtip.elements,\r\n\t\t\tprop = BORDER + camel(side) + 'Width';\r\n\r\n\t\treturn (use ? intCss(use, prop) : (\r\n\t\t\tintCss(elements.content, prop) ||\r\n\t\t\tintCss(this._useTitle(corner) && elements.titlebar || elements.content, prop) ||\r\n\t\t\tintCss(elements.tooltip, prop)\r\n\t\t)) || 0;\r\n\t},\r\n\r\n\t_parseRadius: function(corner) {\r\n\t\tvar elements = this.qtip.elements,\r\n\t\t\tprop = BORDER + camel(corner.y) + camel(corner.x) + 'Radius';\r\n\r\n\t\treturn BROWSER.ie < 9 ? 0 :\r\n\t\t\tintCss(this._useTitle(corner) && elements.titlebar || elements.content, prop) ||\r\n\t\t\tintCss(elements.tooltip, prop) || 0;\r\n\t},\r\n\r\n\t_invalidColour: function(elem, prop, compare) {\r\n\t\tvar val = elem.css(prop);\r\n\t\treturn !val || (compare && val === elem.css(compare)) || INVALID.test(val) ? FALSE : val;\r\n\t},\r\n\r\n\t_parseColours: function(corner) {\r\n\t\tvar elements = this.qtip.elements,\r\n\t\t\ttip = this.element.css('cssText', ''),\r\n\t\t\tborderSide = BORDER + camel(corner[ corner.precedance ]) + camel(COLOR),\r\n\t\t\tcolorElem = this._useTitle(corner) && elements.titlebar || elements.content,\r\n\t\t\tcss = this._invalidColour, color = [];\r\n\r\n\t\t// Attempt to detect the background colour from various elements, left-to-right precedance\r\n\t\tcolor[0] = css(tip, BG_COLOR) || css(colorElem, BG_COLOR) || css(elements.content, BG_COLOR) ||\r\n\t\t\tcss(elements.tooltip, BG_COLOR) || tip.css(BG_COLOR);\r\n\r\n\t\t// Attempt to detect the correct border side colour from various elements, left-to-right precedance\r\n\t\tcolor[1] = css(tip, borderSide, COLOR) || css(colorElem, borderSide, COLOR) ||\r\n\t\t\tcss(elements.content, borderSide, COLOR) || css(elements.tooltip, borderSide, COLOR) || elements.tooltip.css(borderSide);\r\n\r\n\t\t// Reset background and border colours\r\n\t\t$('*', tip).add(tip).css('cssText', BG_COLOR+':'+TRANSPARENT+IMPORTANT+';'+BORDER+':0'+IMPORTANT+';');\r\n\r\n\t\treturn color;\r\n\t},\r\n\r\n\t_calculateSize: function(corner) {\r\n\t\tvar y = corner.precedance === Y,\r\n\t\t\twidth = this.options['width'],\r\n\t\t\theight = this.options['height'],\r\n\t\t\tisCenter = corner.abbrev() === 'c',\r\n\t\t\tbase = (y ? width: height) * (isCenter ? 0.5 : 1),\r\n\t\t\tpow = Math.pow,\r\n\t\t\tround = Math.round,\r\n\t\t\tbigHyp, ratio, result,\r\n\r\n\t\tsmallHyp = Math.sqrt( pow(base, 2) + pow(height, 2) ),\r\n\t\thyp = [ (this.border / base) * smallHyp, (this.border / height) * smallHyp ];\r\n\r\n\t\thyp[2] = Math.sqrt( pow(hyp[0], 2) - pow(this.border, 2) );\r\n\t\thyp[3] = Math.sqrt( pow(hyp[1], 2) - pow(this.border, 2) );\r\n\r\n\t\tbigHyp = smallHyp + hyp[2] + hyp[3] + (isCenter ? 0 : hyp[0]);\r\n\t\tratio = bigHyp / smallHyp;\r\n\r\n\t\tresult = [ round(ratio * width), round(ratio * height) ];\r\n\t\treturn y ? result : result.reverse();\r\n\t},\r\n\r\n\t// Tip coordinates calculator\r\n\t_calculateTip: function(corner, size, scale) {\r\n\t\tscale = scale || 1;\r\n\t\tsize = size || this.size;\r\n\r\n\t\tvar width = size[0] * scale,\r\n\t\t\theight = size[1] * scale,\r\n\t\t\twidth2 = Math.ceil(width / 2), height2 = Math.ceil(height / 2),\r\n\r\n\t\t// Define tip coordinates in terms of height and width values\r\n\t\ttips = {\r\n\t\t\tbr:\t[0,0,\t\twidth,height,\twidth,0],\r\n\t\t\tbl:\t[0,0,\t\twidth,0,\t\t0,height],\r\n\t\t\ttr:\t[0,height,\twidth,0,\t\twidth,height],\r\n\t\t\ttl:\t[0,0,\t\t0,height,\t\twidth,height],\r\n\t\t\ttc:\t[0,height,\twidth2,0,\t\twidth,height],\r\n\t\t\tbc:\t[0,0,\t\twidth,0,\t\twidth2,height],\r\n\t\t\trc:\t[0,0,\t\twidth,height2,\t0,height],\r\n\t\t\tlc:\t[width,0,\twidth,height,\t0,height2]\r\n\t\t};\r\n\r\n\t\t// Set common side shapes\r\n\t\ttips.lt = tips.br; tips.rt = tips.bl;\r\n\t\ttips.lb = tips.tr; tips.rb = tips.tl;\r\n\r\n\t\treturn tips[ corner.abbrev() ];\r\n\t},\r\n\r\n\t// Tip coordinates drawer (canvas)\r\n\t_drawCoords: function(context, coords) {\r\n\t\tcontext.beginPath();\r\n\t\tcontext.moveTo(coords[0], coords[1]);\r\n\t\tcontext.lineTo(coords[2], coords[3]);\r\n\t\tcontext.lineTo(coords[4], coords[5]);\r\n\t\tcontext.closePath();\r\n\t},\r\n\r\n\tcreate: function() {\r\n\t\t// Determine tip corner\r\n\t\tvar c = this.corner = (HASCANVAS || BROWSER.ie) && this._parseCorner(this.options.corner);\r\n\r\n\t\t// If we have a tip corner...\r\n\t\tif( (this.enabled = !!this.corner && this.corner.abbrev() !== 'c') ) {\r\n\t\t\t// Cache it\r\n\t\t\tthis.qtip.cache.corner = c.clone();\r\n\r\n\t\t\t// Create it\r\n\t\t\tthis.update();\r\n\t\t}\r\n\r\n\t\t// Toggle tip element\r\n\t\tthis.element.toggle(this.enabled);\r\n\r\n\t\treturn this.corner;\r\n\t},\r\n\r\n\tupdate: function(corner, position) {\r\n\t\tif(!this.enabled) { return this; }\r\n\r\n\t\tvar elements = this.qtip.elements,\r\n\t\t\ttip = this.element,\r\n\t\t\tinner = tip.children(),\r\n\t\t\toptions = this.options,\r\n\t\t\tcurSize = this.size,\r\n\t\t\tmimic = options.mimic,\r\n\t\t\tround = Math.round,\r\n\t\t\tcolor, precedance, context,\r\n\t\t\tcoords, bigCoords, translate, newSize, border, BACKING_STORE_RATIO;\r\n\r\n\t\t// Re-determine tip if not already set\r\n\t\tif(!corner) { corner = this.qtip.cache.corner || this.corner; }\r\n\r\n\t\t// Use corner property if we detect an invalid mimic value\r\n\t\tif(mimic === FALSE) { mimic = corner; }\r\n\r\n\t\t// Otherwise inherit mimic properties from the corner object as necessary\r\n\t\telse {\r\n\t\t\tmimic = new CORNER(mimic);\r\n\t\t\tmimic.precedance = corner.precedance;\r\n\r\n\t\t\tif(mimic.x === 'inherit') { mimic.x = corner.x; }\r\n\t\t\telse if(mimic.y === 'inherit') { mimic.y = corner.y; }\r\n\t\t\telse if(mimic.x === mimic.y) {\r\n\t\t\t\tmimic[ corner.precedance ] = corner[ corner.precedance ];\r\n\t\t\t}\r\n\t\t}\r\n\t\tprecedance = mimic.precedance;\r\n\r\n\t\t// Ensure the tip width.height are relative to the tip position\r\n\t\tif(corner.precedance === X) { this._swapDimensions(); }\r\n\t\telse { this._resetDimensions(); }\r\n\r\n\t\t// Update our colours\r\n\t\tcolor = this.color = this._parseColours(corner);\r\n\r\n\t\t// Detect border width, taking into account colours\r\n\t\tif(color[1] !== TRANSPARENT) {\r\n\t\t\t// Grab border width\r\n\t\t\tborder = this.border = this._parseWidth(corner, corner[corner.precedance]);\r\n\r\n\t\t\t// If border width isn't zero, use border color as fill if it's not invalid (1.0 style tips)\r\n\t\t\tif(options.border && border < 1 && !INVALID.test(color[1])) { color[0] = color[1]; }\r\n\r\n\t\t\t// Set border width (use detected border width if options.border is true)\r\n\t\t\tthis.border = border = options.border !== TRUE ? options.border : border;\r\n\t\t}\r\n\r\n\t\t// Border colour was invalid, set border to zero\r\n\t\telse { this.border = border = 0; }\r\n\r\n\t\t// Determine tip size\r\n\t\tnewSize = this.size = this._calculateSize(corner);\r\n\t\ttip.css({\r\n\t\t\twidth: newSize[0],\r\n\t\t\theight: newSize[1],\r\n\t\t\tlineHeight: newSize[1]+'px'\r\n\t\t});\r\n\r\n\t\t// Calculate tip translation\r\n\t\tif(corner.precedance === Y) {\r\n\t\t\ttranslate = [\r\n\t\t\t\tround(mimic.x === LEFT ? border : mimic.x === RIGHT ? newSize[0] - curSize[0] - border : (newSize[0] - curSize[0]) / 2),\r\n\t\t\t\tround(mimic.y === TOP ? newSize[1] - curSize[1] : 0)\r\n\t\t\t];\r\n\t\t}\r\n\t\telse {\r\n\t\t\ttranslate = [\r\n\t\t\t\tround(mimic.x === LEFT ? newSize[0] - curSize[0] : 0),\r\n\t\t\t\tround(mimic.y === TOP ? border : mimic.y === BOTTOM ? newSize[1] - curSize[1] - border : (newSize[1] - curSize[1]) / 2)\r\n\t\t\t];\r\n\t\t}\r\n\r\n\t\t// Canvas drawing implementation\r\n\t\tif(HASCANVAS) {\r\n\t\t\t// Grab canvas context and clear/save it\r\n\t\t\tcontext = inner[0].getContext('2d');\r\n\t\t\tcontext.restore(); context.save();\r\n\t\t\tcontext.clearRect(0,0,6000,6000);\r\n\r\n\t\t\t// Calculate coordinates\r\n\t\t\tcoords = this._calculateTip(mimic, curSize, SCALE);\r\n\t\t\tbigCoords = this._calculateTip(mimic, this.size, SCALE);\r\n\r\n\t\t\t// Set the canvas size using calculated size\r\n\t\t\tinner.attr(WIDTH, newSize[0] * SCALE).attr(HEIGHT, newSize[1] * SCALE);\r\n\t\t\tinner.css(WIDTH, newSize[0]).css(HEIGHT, newSize[1]);\r\n\r\n\t\t\t// Draw the outer-stroke tip\r\n\t\t\tthis._drawCoords(context, bigCoords);\r\n\t\t\tcontext.fillStyle = color[1];\r\n\t\t\tcontext.fill();\r\n\r\n\t\t\t// Draw the actual tip\r\n\t\t\tcontext.translate(translate[0] * SCALE, translate[1] * SCALE);\r\n\t\t\tthis._drawCoords(context, coords);\r\n\t\t\tcontext.fillStyle = color[0];\r\n\t\t\tcontext.fill();\r\n\t\t}\r\n\r\n\t\t// VML (IE Proprietary implementation)\r\n\t\telse {\r\n\t\t\t// Calculate coordinates\r\n\t\t\tcoords = this._calculateTip(mimic);\r\n\r\n\t\t\t// Setup coordinates string\r\n\t\t\tcoords = 'm' + coords[0] + ',' + coords[1] + ' l' + coords[2] +\r\n\t\t\t\t',' + coords[3] + ' ' + coords[4] + ',' + coords[5] + ' xe';\r\n\r\n\t\t\t// Setup VML-specific offset for pixel-perfection\r\n\t\t\ttranslate[2] = border && /^(r|b)/i.test(corner.string()) ?\r\n\t\t\t\tBROWSER.ie === 8 ? 2 : 1 : 0;\r\n\r\n\t\t\t// Set initial CSS\r\n\t\t\tinner.css({\r\n\t\t\t\tcoordsize: (newSize[0]+border) + ' ' + (newSize[1]+border),\r\n\t\t\t\tantialias: ''+(mimic.string().indexOf(CENTER) > -1),\r\n\t\t\t\tleft: translate[0] - (translate[2] * Number(precedance === X)),\r\n\t\t\t\ttop: translate[1] - (translate[2] * Number(precedance === Y)),\r\n\t\t\t\twidth: newSize[0] + border,\r\n\t\t\t\theight: newSize[1] + border\r\n\t\t\t})\r\n\t\t\t.each(function(i) {\r\n\t\t\t\tvar $this = $(this);\r\n\r\n\t\t\t\t// Set shape specific attributes\r\n\t\t\t\t$this[ $this.prop ? 'prop' : 'attr' ]({\r\n\t\t\t\t\tcoordsize: (newSize[0]+border) + ' ' + (newSize[1]+border),\r\n\t\t\t\t\tpath: coords,\r\n\t\t\t\t\tfillcolor: color[0],\r\n\t\t\t\t\tfilled: !!i,\r\n\t\t\t\t\tstroked: !i\r\n\t\t\t\t})\r\n\t\t\t\t.toggle(!!(border || i));\r\n\r\n\t\t\t\t// Check if border is enabled and add stroke element\r\n\t\t\t\t!i && $this.html( createVML(\r\n\t\t\t\t\t'stroke', 'weight=\"'+(border*2)+'px\" color=\"'+color[1]+'\" miterlimit=\"1000\" joinstyle=\"miter\"'\r\n\t\t\t\t) );\r\n\t\t\t});\r\n\t\t}\r\n\r\n\t\t// Opera bug #357 - Incorrect tip position\r\n\t\t// https://github.com/Craga89/qTip2/issues/367\r\n\t\twindow.opera && setTimeout(function() {\r\n\t\t\telements.tip.css({\r\n\t\t\t\tdisplay: 'inline-block',\r\n\t\t\t\tvisibility: 'visible'\r\n\t\t\t});\r\n\t\t}, 1);\r\n\r\n\t\t// Position if needed\r\n\t\tif(position !== FALSE) { this.calculate(corner, newSize); }\r\n\t},\r\n\r\n\tcalculate: function(corner, size) {\r\n\t\tif(!this.enabled) { return FALSE; }\r\n\r\n\t\tvar self = this,\r\n\t\t\telements = this.qtip.elements,\r\n\t\t\ttip = this.element,\r\n\t\t\tuserOffset = this.options.offset,\r\n\t\t\tisWidget = elements.tooltip.hasClass('ui-widget'),\r\n\t\t\tposition = {  },\r\n\t\t\tprecedance, corners;\r\n\r\n\t\t// Inherit corner if not provided\r\n\t\tcorner = corner || this.corner;\r\n\t\tprecedance = corner.precedance;\r\n\r\n\t\t// Determine which tip dimension to use for adjustment\r\n\t\tsize = size || this._calculateSize(corner);\r\n\r\n\t\t// Setup corners and offset array\r\n\t\tcorners = [ corner.x, corner.y ];\r\n\t\tif(precedance === X) { corners.reverse(); }\r\n\r\n\t\t// Calculate tip position\r\n\t\t$.each(corners, function(i, side) {\r\n\t\t\tvar b, bc, br;\r\n\r\n\t\t\tif(side === CENTER) {\r\n\t\t\t\tb = precedance === Y ? LEFT : TOP;\r\n\t\t\t\tposition[ b ] = '50%';\r\n\t\t\t\tposition[MARGIN+'-' + b] = -Math.round(size[ precedance === Y ? 0 : 1 ] / 2) + userOffset;\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tb = self._parseWidth(corner, side, elements.tooltip);\r\n\t\t\t\tbc = self._parseWidth(corner, side, elements.content);\r\n\t\t\t\tbr = self._parseRadius(corner);\r\n\r\n\t\t\t\tposition[ side ] = Math.max(-self.border, i ? bc : (userOffset + (br > b ? br : -b)));\r\n\t\t\t}\r\n\t\t});\r\n\r\n\t\t// Adjust for tip size\r\n\t\tposition[ corner[precedance] ] -= size[ precedance === X ? 0 : 1 ];\r\n\r\n\t\t// Set and return new position\r\n\t\ttip.css({ margin: '', top: '', bottom: '', left: '', right: '' }).css(position);\r\n\t\treturn position;\r\n\t},\r\n\r\n\treposition: function(event, api, pos, viewport) {\r\n\t\tif(!this.enabled) { return; }\r\n\r\n\t\tvar cache = api.cache,\r\n\t\t\tnewCorner = this.corner.clone(),\r\n\t\t\tadjust = pos.adjusted,\r\n\t\t\tmethod = api.options.position.adjust.method.split(' '),\r\n\t\t\thorizontal = method[0],\r\n\t\t\tvertical = method[1] || method[0],\r\n\t\t\tshift = { left: FALSE, top: FALSE, x: 0, y: 0 },\r\n\t\t\toffset, css = {}, props;\r\n\r\n\t\tfunction shiftflip(direction, precedance, popposite, side, opposite) {\r\n\t\t\t// Horizontal - Shift or flip method\r\n\t\t\tif(direction === SHIFT && newCorner.precedance === precedance && adjust[side] && newCorner[popposite] !== CENTER) {\r\n\t\t\t\tnewCorner.precedance = newCorner.precedance === X ? Y : X;\r\n\t\t\t}\r\n\t\t\telse if(direction !== SHIFT && adjust[side]){\r\n\t\t\t\tnewCorner[precedance] = newCorner[precedance] === CENTER ?\r\n\t\t\t\t\t(adjust[side] > 0 ? side : opposite) : (newCorner[precedance] === side ? opposite : side);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\tfunction shiftonly(xy, side, opposite) {\r\n\t\t\tif(newCorner[xy] === CENTER) {\r\n\t\t\t\tcss[MARGIN+'-'+side] = shift[xy] = offset[MARGIN+'-'+side] - adjust[side];\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tprops = offset[opposite] !== undefined ?\r\n\t\t\t\t\t[ adjust[side], -offset[side] ] : [ -adjust[side], offset[side] ];\r\n\r\n\t\t\t\tif( (shift[xy] = Math.max(props[0], props[1])) > props[0] ) {\r\n\t\t\t\t\tpos[side] -= adjust[side];\r\n\t\t\t\t\tshift[side] = FALSE;\r\n\t\t\t\t}\r\n\r\n\t\t\t\tcss[ offset[opposite] !== undefined ? opposite : side ] = shift[xy];\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// If our tip position isn't fixed e.g. doesn't adjust with viewport...\r\n\t\tif(this.corner.fixed !== TRUE) {\r\n\t\t\t// Perform shift/flip adjustments\r\n\t\t\tshiftflip(horizontal, X, Y, LEFT, RIGHT);\r\n\t\t\tshiftflip(vertical, Y, X, TOP, BOTTOM);\r\n\r\n\t\t\t// Update and redraw the tip if needed (check cached details of last drawn tip)\r\n\t\t\tif(newCorner.string() !== cache.corner.string() || cache.cornerTop !== adjust.top || cache.cornerLeft !== adjust.left) {\r\n\t\t\t\tthis.update(newCorner, FALSE);\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\t// Setup tip offset properties\r\n\t\toffset = this.calculate(newCorner);\r\n\r\n\t\t// Readjust offset object to make it left/top\r\n\t\tif(offset.right !== undefined) { offset.left = -offset.right; }\r\n\t\tif(offset.bottom !== undefined) { offset.top = -offset.bottom; }\r\n\t\toffset.user = this.offset;\r\n\r\n\t\t// Perform shift adjustments\r\n\t\tif(shift.left = (horizontal === SHIFT && !!adjust.left)) { shiftonly(X, LEFT, RIGHT); }\r\n\t\tif(shift.top = (vertical === SHIFT && !!adjust.top)) { shiftonly(Y, TOP, BOTTOM); }\r\n\r\n\t\t/*\r\n\t\t* If the tip is adjusted in both dimensions, or in a\r\n\t\t* direction that would cause it to be anywhere but the\r\n\t\t* outer border, hide it!\r\n\t\t*/\r\n\t\tthis.element.css(css).toggle(\r\n\t\t\t!((shift.x && shift.y) || (newCorner.x === CENTER && shift.y) || (newCorner.y === CENTER && shift.x))\r\n\t\t);\r\n\r\n\t\t// Adjust position to accomodate tip dimensions\r\n\t\tpos.left -= offset.left.charAt ? offset.user :\r\n\t\t\thorizontal !== SHIFT || shift.top || !shift.left && !shift.top ? offset.left + this.border : 0;\r\n\t\tpos.top -= offset.top.charAt ? offset.user :\r\n\t\t\tvertical !== SHIFT || shift.left || !shift.left && !shift.top ? offset.top + this.border : 0;\r\n\r\n\t\t// Cache details\r\n\t\tcache.cornerLeft = adjust.left; cache.cornerTop = adjust.top;\r\n\t\tcache.corner = newCorner.clone();\r\n\t},\r\n\r\n\tdestroy: function() {\r\n\t\t// Unbind events\r\n\t\tthis.qtip._unbind(this.qtip.tooltip, this._ns);\r\n\r\n\t\t// Remove the tip element(s)\r\n\t\tif(this.qtip.elements.tip) {\r\n\t\t\tthis.qtip.elements.tip.find('*')\r\n\t\t\t\t.remove().end().remove();\r\n\t\t}\r\n\t}\r\n});\r\n\r\nTIP = PLUGINS.tip = function(api) {\r\n\treturn new Tip(api, api.options.style.tip);\r\n};\r\n\r\n// Initialize tip on render\r\nTIP.initialize = 'render';\r\n\r\n// Setup plugin sanitization options\r\nTIP.sanitize = function(options) {\r\n\tif(options.style && 'tip' in options.style) {\r\n\t\tvar opts = options.style.tip;\r\n\t\tif(typeof opts !== 'object') { opts = options.style.tip = { corner: opts }; }\r\n\t\tif(!(/string|boolean/i).test(typeof opts.corner)) { opts.corner = TRUE; }\r\n\t}\r\n};\r\n\r\n// Add new option checks for the plugin\r\nCHECKS.tip = {\r\n\t'^position.my|style.tip.(corner|mimic|border)$': function() {\r\n\t\t// Make sure a tip can be drawn\r\n\t\tthis.create();\r\n\r\n\t\t// Reposition the tooltip\r\n\t\tthis.qtip.reposition();\r\n\t},\r\n\t'^style.tip.(height|width)$': function(obj) {\r\n\t\t// Re-set dimensions and redraw the tip\r\n\t\tthis.size = [ obj.width, obj.height ];\r\n\t\tthis.update();\r\n\r\n\t\t// Reposition the tooltip\r\n\t\tthis.qtip.reposition();\r\n\t},\r\n\t'^content.title|style.(classes|widget)$': function() {\r\n\t\tthis.update();\r\n\t}\r\n};\r\n\r\n// Extend original qTip defaults\r\n$.extend(TRUE, QTIP.defaults, {\r\n\tstyle: {\r\n\t\ttip: {\r\n\t\t\tcorner: TRUE,\r\n\t\t\tmimic: FALSE,\r\n\t\t\twidth: 6,\r\n\t\t\theight: 6,\r\n\t\t\tborder: TRUE,\r\n\t\t\toffset: 0\r\n\t\t}\r\n\t}\r\n});\r\n;var MODAL, OVERLAY,\r\n\tMODALCLASS = 'qtip-modal',\r\n\tMODALSELECTOR = '.'+MODALCLASS;\r\n\r\nOVERLAY = function()\r\n{\r\n\tvar self = this,\r\n\t\tfocusableElems = {},\r\n\t\tcurrent, onLast,\r\n\t\tprevState, elem;\r\n\r\n\t// Modified code from jQuery UI 1.10.0 source\r\n\t// http://code.jquery.com/ui/1.10.0/jquery-ui.js\r\n\tfunction focusable(element) {\r\n\t\t// Use the defined focusable checker when possible\r\n\t\tif($.expr[':'].focusable) { return $.expr[':'].focusable; }\r\n\r\n\t\tvar isTabIndexNotNaN = !isNaN($.attr(element, 'tabindex')),\r\n\t\t\tnodeName = element.nodeName && element.nodeName.toLowerCase(),\r\n\t\t\tmap, mapName, img;\r\n\r\n\t\tif('area' === nodeName) {\r\n\t\t\tmap = element.parentNode;\r\n\t\t\tmapName = map.name;\r\n\t\t\tif(!element.href || !mapName || map.nodeName.toLowerCase() !== 'map') {\r\n\t\t\t\treturn false;\r\n\t\t\t}\r\n\t\t\timg = $('img[usemap=#' + mapName + ']')[0];\r\n\t\t\treturn !!img && img.is(':visible');\r\n\t\t}\r\n\t\treturn (/input|select|textarea|button|object/.test( nodeName ) ?\r\n\t\t\t\t!element.disabled :\r\n\t\t\t\t'a' === nodeName ?\r\n\t\t\t\t\telement.href || isTabIndexNotNaN :\r\n\t\t\t\t\tisTabIndexNotNaN\r\n\t\t\t);\r\n\t}\r\n\r\n\t// Focus inputs using cached focusable elements (see update())\r\n\tfunction focusInputs(blurElems) {\r\n\t\t// Blurring body element in IE causes window.open windows to unfocus!\r\n\t\tif(focusableElems.length < 1 && blurElems.length) { blurElems.not('body').blur(); }\r\n\r\n\t\t// Focus the inputs\r\n\t\telse { focusableElems.first().focus(); }\r\n\t}\r\n\r\n\t// Steal focus from elements outside tooltip\r\n\tfunction stealFocus(event) {\r\n\t\tif(!elem.is(':visible')) { return; }\r\n\r\n\t\tvar target = $(event.target),\r\n\t\t\ttooltip = current.tooltip,\r\n\t\t\tcontainer = target.closest(SELECTOR),\r\n\t\t\ttargetOnTop;\r\n\r\n\t\t// Determine if input container target is above this\r\n\t\ttargetOnTop = container.length < 1 ? FALSE :\r\n\t\t\t(parseInt(container[0].style.zIndex, 10) > parseInt(tooltip[0].style.zIndex, 10));\r\n\r\n\t\t// If we're showing a modal, but focus has landed on an input below\r\n\t\t// this modal, divert focus to the first visible input in this modal\r\n\t\t// or if we can't find one... the tooltip itself\r\n\t\tif(!targetOnTop && target.closest(SELECTOR)[0] !== tooltip[0]) {\r\n\t\t\tfocusInputs(target);\r\n\t\t}\r\n\r\n\t\t// Detect when we leave the last focusable element...\r\n\t\tonLast = event.target === focusableElems[focusableElems.length - 1];\r\n\t}\r\n\r\n\t$.extend(self, {\r\n\t\tinit: function() {\r\n\t\t\t// Create document overlay\r\n\t\t\telem = self.elem = $('<div />', {\r\n\t\t\t\tid: 'qtip-overlay',\r\n\t\t\t\thtml: '<div></div>',\r\n\t\t\t\tmousedown: function() { return FALSE; }\r\n\t\t\t})\r\n\t\t\t.hide();\r\n\r\n\t\t\t// Make sure we can't focus anything outside the tooltip\r\n\t\t\t$(document.body).bind('focusin'+MODALSELECTOR, stealFocus);\r\n\r\n\t\t\t// Apply keyboard \"Escape key\" close handler\r\n\t\t\t$(document).bind('keydown'+MODALSELECTOR, function(event) {\r\n\t\t\t\tif(current && current.options.show.modal.escape && event.keyCode === 27) {\r\n\t\t\t\t\tcurrent.hide(event);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Apply click handler for blur option\r\n\t\t\telem.bind('click'+MODALSELECTOR, function(event) {\r\n\t\t\t\tif(current && current.options.show.modal.blur) {\r\n\t\t\t\t\tcurrent.hide(event);\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\treturn self;\r\n\t\t},\r\n\r\n\t\tupdate: function(api) {\r\n\t\t\t// Update current API reference\r\n\t\t\tcurrent = api;\r\n\r\n\t\t\t// Update focusable elements if enabled\r\n\t\t\tif(api.options.show.modal.stealfocus !== FALSE) {\r\n\t\t\t\tfocusableElems = api.tooltip.find('*').filter(function() {\r\n\t\t\t\t\treturn focusable(this);\r\n\t\t\t\t});\r\n\t\t\t}\r\n\t\t\telse { focusableElems = []; }\r\n\t\t},\r\n\r\n\t\ttoggle: function(api, state, duration) {\r\n\t\t\tvar docBody = $(document.body),\r\n\t\t\t\ttooltip = api.tooltip,\r\n\t\t\t\toptions = api.options.show.modal,\r\n\t\t\t\teffect = options.effect,\r\n\t\t\t\ttype = state ? 'show': 'hide',\r\n\t\t\t\tvisible = elem.is(':visible'),\r\n\t\t\t\tvisibleModals = $(MODALSELECTOR).filter(':visible:not(:animated)').not(tooltip),\r\n\t\t\t\tzindex;\r\n\r\n\t\t\t// Set active tooltip API reference\r\n\t\t\tself.update(api);\r\n\r\n\t\t\t// If the modal can steal the focus...\r\n\t\t\t// Blur the current item and focus anything in the modal we an\r\n\t\t\tif(state && options.stealfocus !== FALSE) {\r\n\t\t\t\tfocusInputs( $(':focus') );\r\n\t\t\t}\r\n\r\n\t\t\t// Toggle backdrop cursor style on show\r\n\t\t\telem.toggleClass('blurs', options.blur);\r\n\r\n\t\t\t// Append to body on show\r\n\t\t\tif(state) {\r\n\t\t\t\telem.appendTo(document.body);\r\n\t\t\t}\r\n\r\n\t\t\t// Prevent modal from conflicting with show.solo, and don't hide backdrop is other modals are visible\r\n\t\t\tif((elem.is(':animated') && visible === state && prevState !== FALSE) || (!state && visibleModals.length)) {\r\n\t\t\t\treturn self;\r\n\t\t\t}\r\n\r\n\t\t\t// Stop all animations\r\n\t\t\telem.stop(TRUE, FALSE);\r\n\r\n\t\t\t// Use custom function if provided\r\n\t\t\tif($.isFunction(effect)) {\r\n\t\t\t\teffect.call(elem, state);\r\n\t\t\t}\r\n\r\n\t\t\t// If no effect type is supplied, use a simple toggle\r\n\t\t\telse if(effect === FALSE) {\r\n\t\t\t\telem[ type ]();\r\n\t\t\t}\r\n\r\n\t\t\t// Use basic fade function\r\n\t\t\telse {\r\n\t\t\t\telem.fadeTo( parseInt(duration, 10) || 90, state ? 1 : 0, function() {\r\n\t\t\t\t\tif(!state) { elem.hide(); }\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Reset position and detach from body on hide\r\n\t\t\tif(!state) {\r\n\t\t\t\telem.queue(function(next) {\r\n\t\t\t\t\telem.css({ left: '', top: '' });\r\n\t\t\t\t\tif(!$(MODALSELECTOR).length) { elem.detach(); }\r\n\t\t\t\t\tnext();\r\n\t\t\t\t});\r\n\t\t\t}\r\n\r\n\t\t\t// Cache the state\r\n\t\t\tprevState = state;\r\n\r\n\t\t\t// If the tooltip is destroyed, set reference to null\r\n\t\t\tif(current.destroyed) { current = NULL; }\r\n\r\n\t\t\treturn self;\r\n\t\t}\r\n\t});\r\n\r\n\tself.init();\r\n};\r\nOVERLAY = new OVERLAY();\r\n\r\nfunction Modal(api, options) {\r\n\tthis.options = options;\r\n\tthis._ns = '-modal';\r\n\r\n\tthis.init( (this.qtip = api) );\r\n}\r\n\r\n$.extend(Modal.prototype, {\r\n\tinit: function(qtip) {\r\n\t\tvar tooltip = qtip.tooltip;\r\n\r\n\t\t// If modal is disabled... return\r\n\t\tif(!this.options.on) { return this; }\r\n\r\n\t\t// Set overlay reference\r\n\t\tqtip.elements.overlay = OVERLAY.elem;\r\n\r\n\t\t// Add unique attribute so we can grab modal tooltips easily via a SELECTOR, and set z-index\r\n\t\ttooltip.addClass(MODALCLASS).css('z-index', QTIP.modal_zindex + $(MODALSELECTOR).length);\r\n\r\n\t\t// Apply our show/hide/focus modal events\r\n\t\tqtip._bind(tooltip, ['tooltipshow', 'tooltiphide'], function(event, api, duration) {\r\n\t\t\tvar oEvent = event.originalEvent;\r\n\r\n\t\t\t// Make sure mouseout doesn't trigger a hide when showing the modal and mousing onto backdrop\r\n\t\t\tif(event.target === tooltip[0]) {\r\n\t\t\t\tif(oEvent && event.type === 'tooltiphide' && /mouse(leave|enter)/.test(oEvent.type) && $(oEvent.relatedTarget).closest(OVERLAY.elem[0]).length) {\r\n\t\t\t\t\ttry { event.preventDefault(); } catch(e) {}\r\n\t\t\t\t}\r\n\t\t\t\telse if(!oEvent || (oEvent && oEvent.type !== 'tooltipsolo')) {\r\n\t\t\t\t\tthis.toggle(event, event.type === 'tooltipshow', duration);\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t}, this._ns, this);\r\n\r\n\t\t// Adjust modal z-index on tooltip focus\r\n\t\tqtip._bind(tooltip, 'tooltipfocus', function(event, api) {\r\n\t\t\t// If focus was cancelled before it reached us, don't do anything\r\n\t\t\tif(event.isDefaultPrevented() || event.target !== tooltip[0]) { return; }\r\n\r\n\t\t\tvar qtips = $(MODALSELECTOR),\r\n\r\n\t\t\t// Keep the modal's lower than other, regular qtips\r\n\t\t\tnewIndex = QTIP.modal_zindex + qtips.length,\r\n\t\t\tcurIndex = parseInt(tooltip[0].style.zIndex, 10);\r\n\r\n\t\t\t// Set overlay z-index\r\n\t\t\tOVERLAY.elem[0].style.zIndex = newIndex - 1;\r\n\r\n\t\t\t// Reduce modal z-index's and keep them properly ordered\r\n\t\t\tqtips.each(function() {\r\n\t\t\t\tif(this.style.zIndex > curIndex) {\r\n\t\t\t\t\tthis.style.zIndex -= 1;\r\n\t\t\t\t}\r\n\t\t\t});\r\n\r\n\t\t\t// Fire blur event for focused tooltip\r\n\t\t\tqtips.filter('.' + CLASS_FOCUS).qtip('blur', event.originalEvent);\r\n\r\n\t\t\t// Set the new z-index\r\n\t\t\ttooltip.addClass(CLASS_FOCUS)[0].style.zIndex = newIndex;\r\n\r\n\t\t\t// Set current\r\n\t\t\tOVERLAY.update(api);\r\n\r\n\t\t\t// Prevent default handling\r\n\t\t\ttry { event.preventDefault(); } catch(e) {}\r\n\t\t}, this._ns, this);\r\n\r\n\t\t// Focus any other visible modals when this one hides\r\n\t\tqtip._bind(tooltip, 'tooltiphide', function(event) {\r\n\t\t\tif(event.target === tooltip[0]) {\r\n\t\t\t\t$(MODALSELECTOR).filter(':visible').not(tooltip).last().qtip('focus', event);\r\n\t\t\t}\r\n\t\t}, this._ns, this);\r\n\t},\r\n\r\n\ttoggle: function(event, state, duration) {\r\n\t\t// Make sure default event hasn't been prevented\r\n\t\tif(event && event.isDefaultPrevented()) { return this; }\r\n\r\n\t\t// Toggle it\r\n\t\tOVERLAY.toggle(this.qtip, !!state, duration);\r\n\t},\r\n\r\n\tdestroy: function() {\r\n\t\t// Remove modal class\r\n\t\tthis.qtip.tooltip.removeClass(MODALCLASS);\r\n\r\n\t\t// Remove bound events\r\n\t\tthis.qtip._unbind(this.qtip.tooltip, this._ns);\r\n\r\n\t\t// Delete element reference\r\n\t\tOVERLAY.toggle(this.qtip, FALSE);\r\n\t\tdelete this.qtip.elements.overlay;\r\n\t}\r\n});\r\n\r\n\r\nMODAL = PLUGINS.modal = function(api) {\r\n\treturn new Modal(api, api.options.show.modal);\r\n};\r\n\r\n// Setup sanitiztion rules\r\nMODAL.sanitize = function(opts) {\r\n\tif(opts.show) {\r\n\t\tif(typeof opts.show.modal !== 'object') { opts.show.modal = { on: !!opts.show.modal }; }\r\n\t\telse if(typeof opts.show.modal.on === 'undefined') { opts.show.modal.on = TRUE; }\r\n\t}\r\n};\r\n\r\n// Base z-index for all modal tooltips (use qTip core z-index as a base)\r\nQTIP.modal_zindex = QTIP.zindex - 200;\r\n\r\n// Plugin needs to be initialized on render\r\nMODAL.initialize = 'render';\r\n\r\n// Setup option set checks\r\nCHECKS.modal = {\r\n\t'^show.modal.(on|blur)$': function() {\r\n\t\t// Initialise\r\n\t\tthis.destroy();\r\n\t\tthis.init();\r\n\r\n\t\t// Show the modal if not visible already and tooltip is visible\r\n\t\tthis.qtip.elems.overlay.toggle(\r\n\t\t\tthis.qtip.tooltip[0].offsetWidth > 0\r\n\t\t);\r\n\t}\r\n};\r\n\r\n// Extend original api defaults\r\n$.extend(TRUE, QTIP.defaults, {\r\n\tshow: {\r\n\t\tmodal: {\r\n\t\t\ton: FALSE,\r\n\t\t\teffect: TRUE,\r\n\t\t\tblur: TRUE,\r\n\t\t\tstealfocus: TRUE,\r\n\t\t\tescape: TRUE\r\n\t\t}\r\n\t}\r\n});\r\n;PLUGINS.viewport = function(api, position, posOptions, targetWidth, targetHeight, elemWidth, elemHeight)\r\n{\r\n\tvar target = posOptions.target,\r\n\t\ttooltip = api.elements.tooltip,\r\n\t\tmy = posOptions.my,\r\n\t\tat = posOptions.at,\r\n\t\tadjust = posOptions.adjust,\r\n\t\tmethod = adjust.method.split(' '),\r\n\t\tmethodX = method[0],\r\n\t\tmethodY = method[1] || method[0],\r\n\t\tviewport = posOptions.viewport,\r\n\t\tcontainer = posOptions.container,\r\n\t\tcache = api.cache,\r\n\t\tadjusted = { left: 0, top: 0 },\r\n\t\tfixed, newMy, containerOffset, containerStatic,\r\n\t\tviewportWidth, viewportHeight, viewportScroll, viewportOffset;\r\n\r\n\t// If viewport is not a jQuery element, or it's the window/document, or no adjustment method is used... return\r\n\tif(!viewport.jquery || target[0] === window || target[0] === document.body || adjust.method === 'none') {\r\n\t\treturn adjusted;\r\n\t}\r\n\r\n\t// Cach container details\r\n\tcontainerOffset = container.offset() || adjusted;\r\n\tcontainerStatic = container.css('position') === 'static';\r\n\r\n\t// Cache our viewport details\r\n\tfixed = tooltip.css('position') === 'fixed';\r\n\tviewportWidth = viewport[0] === window ? viewport.width() : viewport.outerWidth(FALSE);\r\n\tviewportHeight = viewport[0] === window ? viewport.height() : viewport.outerHeight(FALSE);\r\n\tviewportScroll = { left: fixed ? 0 : viewport.scrollLeft(), top: fixed ? 0 : viewport.scrollTop() };\r\n\tviewportOffset = viewport.offset() || adjusted;\r\n\r\n\t// Generic calculation method\r\n\tfunction calculate(side, otherSide, type, adjust, side1, side2, lengthName, targetLength, elemLength) {\r\n\t\tvar initialPos = position[side1],\r\n\t\t\tmySide = my[side],\r\n\t\t\tatSide = at[side],\r\n\t\t\tisShift = type === SHIFT,\r\n\t\t\tmyLength = mySide === side1 ? elemLength : mySide === side2 ? -elemLength : -elemLength / 2,\r\n\t\t\tatLength = atSide === side1 ? targetLength : atSide === side2 ? -targetLength : -targetLength / 2,\r\n\t\t\tsideOffset = viewportScroll[side1] + viewportOffset[side1] - (containerStatic ? 0 : containerOffset[side1]),\r\n\t\t\toverflow1 = sideOffset - initialPos,\r\n\t\t\toverflow2 = initialPos + elemLength - (lengthName === WIDTH ? viewportWidth : viewportHeight) - sideOffset,\r\n\t\t\toffset = myLength - (my.precedance === side || mySide === my[otherSide] ? atLength : 0) - (atSide === CENTER ? targetLength / 2 : 0);\r\n\r\n\t\t// shift\r\n\t\tif(isShift) {\r\n\t\t\toffset = (mySide === side1 ? 1 : -1) * myLength;\r\n\r\n\t\t\t// Adjust position but keep it within viewport dimensions\r\n\t\t\tposition[side1] += overflow1 > 0 ? overflow1 : overflow2 > 0 ? -overflow2 : 0;\r\n\t\t\tposition[side1] = Math.max(\r\n\t\t\t\t-containerOffset[side1] + viewportOffset[side1],\r\n\t\t\t\tinitialPos - offset,\r\n\t\t\t\tMath.min(\r\n\t\t\t\t\tMath.max(\r\n\t\t\t\t\t\t-containerOffset[side1] + viewportOffset[side1] + (lengthName === WIDTH ? viewportWidth : viewportHeight),\r\n\t\t\t\t\t\tinitialPos + offset\r\n\t\t\t\t\t),\r\n\t\t\t\t\tposition[side1],\r\n\r\n\t\t\t\t\t// Make sure we don't adjust complete off the element when using 'center'\r\n\t\t\t\t\tmySide === 'center' ? initialPos - myLength : 1E9\r\n\t\t\t\t)\r\n\t\t\t);\r\n\r\n\t\t}\r\n\r\n\t\t// flip/flipinvert\r\n\t\telse {\r\n\t\t\t// Update adjustment amount depending on if using flipinvert or flip\r\n\t\t\tadjust *= (type === FLIPINVERT ? 2 : 0);\r\n\r\n\t\t\t// Check for overflow on the left/top\r\n\t\t\tif(overflow1 > 0 && (mySide !== side1 || overflow2 > 0)) {\r\n\t\t\t\tposition[side1] -= offset + adjust;\r\n\t\t\t\tnewMy.invert(side, side1);\r\n\t\t\t}\r\n\r\n\t\t\t// Check for overflow on the bottom/right\r\n\t\t\telse if(overflow2 > 0 && (mySide !== side2 || overflow1 > 0)  ) {\r\n\t\t\t\tposition[side1] -= (mySide === CENTER ? -offset : offset) + adjust;\r\n\t\t\t\tnewMy.invert(side, side2);\r\n\t\t\t}\r\n\r\n\t\t\t// Make sure we haven't made things worse with the adjustment and reset if so\r\n\t\t\tif(position[side1] < viewportScroll && -position[side1] > overflow2) {\r\n\t\t\t\tposition[side1] = initialPos; newMy = my.clone();\r\n\t\t\t}\r\n\t\t}\r\n\r\n\t\treturn position[side1] - initialPos;\r\n\t}\r\n\r\n\t// Set newMy if using flip or flipinvert methods\r\n\tif(methodX !== 'shift' || methodY !== 'shift') { newMy = my.clone(); }\r\n\r\n\t// Adjust position based onviewport and adjustment options\r\n\tadjusted = {\r\n\t\tleft: methodX !== 'none' ? calculate( X, Y, methodX, adjust.x, LEFT, RIGHT, WIDTH, targetWidth, elemWidth ) : 0,\r\n\t\ttop: methodY !== 'none' ? calculate( Y, X, methodY, adjust.y, TOP, BOTTOM, HEIGHT, targetHeight, elemHeight ) : 0,\r\n\t\tmy: newMy\r\n\t};\r\n\r\n\treturn adjusted;\r\n};\r\n;PLUGINS.polys = {\r\n\t// POLY area coordinate calculator\r\n\t//\tSpecial thanks to Ed Cradock for helping out with this.\r\n\t//\tUses a binary search algorithm to find suitable coordinates.\r\n\tpolygon: function(baseCoords, corner) {\r\n\t\tvar result = {\r\n\t\t\twidth: 0, height: 0,\r\n\t\t\tposition: {\r\n\t\t\t\ttop: 1e10, right: 0,\r\n\t\t\t\tbottom: 0, left: 1e10\r\n\t\t\t},\r\n\t\t\tadjustable: FALSE\r\n\t\t},\r\n\t\ti = 0, next,\r\n\t\tcoords = [],\r\n\t\tcompareX = 1, compareY = 1,\r\n\t\trealX = 0, realY = 0,\r\n\t\tnewWidth, newHeight;\r\n\r\n\t\t// First pass, sanitize coords and determine outer edges\r\n\t\ti = baseCoords.length; while(i--) {\r\n\t\t\tnext = [ parseInt(baseCoords[--i], 10), parseInt(baseCoords[i+1], 10) ];\r\n\r\n\t\t\tif(next[0] > result.position.right){ result.position.right = next[0]; }\r\n\t\t\tif(next[0] < result.position.left){ result.position.left = next[0]; }\r\n\t\t\tif(next[1] > result.position.bottom){ result.position.bottom = next[1]; }\r\n\t\t\tif(next[1] < result.position.top){ result.position.top = next[1]; }\r\n\r\n\t\t\tcoords.push(next);\r\n\t\t}\r\n\r\n\t\t// Calculate height and width from outer edges\r\n\t\tnewWidth = result.width = Math.abs(result.position.right - result.position.left);\r\n\t\tnewHeight = result.height = Math.abs(result.position.bottom - result.position.top);\r\n\r\n\t\t// If it's the center corner...\r\n\t\tif(corner.abbrev() === 'c') {\r\n\t\t\tresult.position = {\r\n\t\t\t\tleft: result.position.left + (result.width / 2),\r\n\t\t\t\ttop: result.position.top + (result.height / 2)\r\n\t\t\t};\r\n\t\t}\r\n\t\telse {\r\n\t\t\t// Second pass, use a binary search algorithm to locate most suitable coordinate\r\n\t\t\twhile(newWidth > 0 && newHeight > 0 && compareX > 0 && compareY > 0)\r\n\t\t\t{\r\n\t\t\t\tnewWidth = Math.floor(newWidth / 2);\r\n\t\t\t\tnewHeight = Math.floor(newHeight / 2);\r\n\r\n\t\t\t\tif(corner.x === LEFT){ compareX = newWidth; }\r\n\t\t\t\telse if(corner.x === RIGHT){ compareX = result.width - newWidth; }\r\n\t\t\t\telse{ compareX += Math.floor(newWidth / 2); }\r\n\r\n\t\t\t\tif(corner.y === TOP){ compareY = newHeight; }\r\n\t\t\t\telse if(corner.y === BOTTOM){ compareY = result.height - newHeight; }\r\n\t\t\t\telse{ compareY += Math.floor(newHeight / 2); }\r\n\r\n\t\t\t\ti = coords.length; while(i--)\r\n\t\t\t\t{\r\n\t\t\t\t\tif(coords.length < 2){ break; }\r\n\r\n\t\t\t\t\trealX = coords[i][0] - result.position.left;\r\n\t\t\t\t\trealY = coords[i][1] - result.position.top;\r\n\r\n\t\t\t\t\tif((corner.x === LEFT && realX >= compareX) ||\r\n\t\t\t\t\t(corner.x === RIGHT && realX <= compareX) ||\r\n\t\t\t\t\t(corner.x === CENTER && (realX < compareX || realX > (result.width - compareX))) ||\r\n\t\t\t\t\t(corner.y === TOP && realY >= compareY) ||\r\n\t\t\t\t\t(corner.y === BOTTOM && realY <= compareY) ||\r\n\t\t\t\t\t(corner.y === CENTER && (realY < compareY || realY > (result.height - compareY)))) {\r\n\t\t\t\t\t\tcoords.splice(i, 1);\r\n\t\t\t\t\t}\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\tresult.position = { left: coords[0][0], top: coords[0][1] };\r\n\t\t}\r\n\r\n\t\treturn result;\r\n\t},\r\n\r\n\trect: function(ax, ay, bx, by) {\r\n\t\treturn {\r\n\t\t\twidth: Math.abs(bx - ax),\r\n\t\t\theight: Math.abs(by - ay),\r\n\t\t\tposition: {\r\n\t\t\t\tleft: Math.min(ax, bx),\r\n\t\t\t\ttop: Math.min(ay, by)\r\n\t\t\t}\r\n\t\t};\r\n\t},\r\n\r\n\t_angles: {\r\n\t\ttc: 3 / 2, tr: 7 / 4, tl: 5 / 4,\r\n\t\tbc: 1 / 2, br: 1 / 4, bl: 3 / 4,\r\n\t\trc: 2, lc: 1, c: 0\r\n\t},\r\n\tellipse: function(cx, cy, rx, ry, corner) {\r\n\t\tvar c = PLUGINS.polys._angles[ corner.abbrev() ],\r\n\t\t\trxc = c === 0 ? 0 : rx * Math.cos( c * Math.PI ),\r\n\t\t\trys = ry * Math.sin( c * Math.PI );\r\n\r\n\t\treturn {\r\n\t\t\twidth: (rx * 2) - Math.abs(rxc),\r\n\t\t\theight: (ry * 2) - Math.abs(rys),\r\n\t\t\tposition: {\r\n\t\t\t\tleft: cx + rxc,\r\n\t\t\t\ttop: cy + rys\r\n\t\t\t},\r\n\t\t\tadjustable: FALSE\r\n\t\t};\r\n\t},\r\n\tcircle: function(cx, cy, r, corner) {\r\n\t\treturn PLUGINS.polys.ellipse(cx, cy, r, r, corner);\r\n\t}\r\n};\r\n;PLUGINS.svg = function(api, svg, corner)\r\n{\r\n\tvar doc = $(document),\r\n\t\telem = svg[0],\r\n\t\troot = $(elem.ownerSVGElement),\r\n\t\townerDocument = elem.ownerDocument,\r\n\t\tstrokeWidth2 = (parseInt(svg.css('stroke-width'), 10) || 0) / 2,\r\n\t\tframeOffset, mtx, transformed, viewBox,\r\n\t\tlen, next, i, points,\r\n\t\tresult, position, dimensions;\r\n\r\n\t// Ascend the parentNode chain until we find an element with getBBox()\r\n\twhile(!elem.getBBox) { elem = elem.parentNode; }\r\n\tif(!elem.getBBox || !elem.parentNode) { return FALSE; }\r\n\r\n\t// Determine which shape calculation to use\r\n\tswitch(elem.nodeName) {\r\n\t\tcase 'ellipse':\r\n\t\tcase 'circle':\r\n\t\t\tresult = PLUGINS.polys.ellipse(\r\n\t\t\t\telem.cx.baseVal.value,\r\n\t\t\t\telem.cy.baseVal.value,\r\n\t\t\t\t(elem.rx || elem.r).baseVal.value + strokeWidth2,\r\n\t\t\t\t(elem.ry || elem.r).baseVal.value + strokeWidth2,\r\n\t\t\t\tcorner\r\n\t\t\t);\r\n\t\tbreak;\r\n\r\n\t\tcase 'line':\r\n\t\tcase 'polygon':\r\n\t\tcase 'polyline':\r\n\t\t\t// Determine points object (line has none, so mimic using array)\r\n\t\t\tpoints = elem.points || [\r\n\t\t\t\t{ x: elem.x1.baseVal.value, y: elem.y1.baseVal.value },\r\n\t\t\t\t{ x: elem.x2.baseVal.value, y: elem.y2.baseVal.value }\r\n\t\t\t];\r\n\r\n\t\t\tfor(result = [], i = -1, len = points.numberOfItems || points.length; ++i < len;) {\r\n\t\t\t\tnext = points.getItem ? points.getItem(i) : points[i];\r\n\t\t\t\tresult.push.apply(result, [next.x, next.y]);\r\n\t\t\t}\r\n\r\n\t\t\tresult = PLUGINS.polys.polygon(result, corner);\r\n\t\tbreak;\r\n\r\n\t\t// Unknown shape or rectangle? Use bounding box\r\n\t\tdefault:\r\n\t\t\tresult = elem.getBBox();\r\n\t\t\tresult = {\r\n\t\t\t\twidth: result.width,\r\n\t\t\t\theight: result.height,\r\n\t\t\t\tposition: {\r\n\t\t\t\t\tleft: result.x,\r\n\t\t\t\t\ttop: result.y\r\n\t\t\t\t}\r\n\t\t\t};\r\n\t\tbreak;\r\n\t}\r\n\r\n\t// Shortcut assignments\r\n\tposition = result.position;\r\n\troot = root[0];\r\n\r\n\t// Convert position into a pixel value\r\n\tif(root.createSVGPoint) {\r\n\t\tmtx = elem.getScreenCTM();\r\n\t\tpoints = root.createSVGPoint();\r\n\r\n\t\tpoints.x = position.left;\r\n\t\tpoints.y = position.top;\r\n\t\ttransformed = points.matrixTransform( mtx );\r\n\t\tposition.left = transformed.x;\r\n\t\tposition.top = transformed.y;\r\n\t}\r\n\r\n\t// Check the element is not in a child document, and if so, adjust for frame elements offset\r\n\tif(ownerDocument !== document && api.position.target !== 'mouse') {\r\n\t\tframeOffset = $((ownerDocument.defaultView || ownerDocument.parentWindow).frameElement).offset();\r\n\t\tif(frameOffset) {\r\n\t\t\tposition.left += frameOffset.left;\r\n\t\t\tposition.top += frameOffset.top;\r\n\t\t}\r\n\t}\r\n\r\n\t// Adjust by scroll offset of owner document\r\n\townerDocument = $(ownerDocument);\r\n\tposition.left += ownerDocument.scrollLeft();\r\n\tposition.top += ownerDocument.scrollTop();\r\n\r\n\treturn result;\r\n};\r\n;PLUGINS.imagemap = function(api, area, corner, adjustMethod)\r\n{\r\n\tif(!area.jquery) { area = $(area); }\r\n\r\n\tvar shape = (area.attr('shape') || 'rect').toLowerCase().replace('poly', 'polygon'),\r\n\t\timage = $('img[usemap=\"#'+area.parent('map').attr('name')+'\"]'),\r\n\t\tcoordsString = $.trim(area.attr('coords')),\r\n\t\tcoordsArray = coordsString.replace(/,$/, '').split(','),\r\n\t\timageOffset, coords, i, next, result, len;\r\n\r\n\t// If we can't find the image using the map...\r\n\tif(!image.length) { return FALSE; }\r\n\r\n\t// Pass coordinates string if polygon\r\n\tif(shape === 'polygon') {\r\n\t\tresult = PLUGINS.polys.polygon(coordsArray, corner);\r\n\t}\r\n\r\n\t// Otherwise parse the coordinates and pass them as arguments\r\n\telse if(PLUGINS.polys[shape]) {\r\n\t\tfor(i = -1, len = coordsArray.length, coords = []; ++i < len;) {\r\n\t\t\tcoords.push( parseInt(coordsArray[i], 10) );\r\n\t\t}\r\n\r\n\t\tresult = PLUGINS.polys[shape].apply(\r\n\t\t\tthis, coords.concat(corner)\r\n\t\t);\r\n\t}\r\n\r\n\t// If no shapre calculation method was found, return false\r\n\telse { return FALSE; }\r\n\r\n\t// Make sure we account for padding and borders on the image\r\n\timageOffset = image.offset();\r\n\timageOffset.left += Math.ceil((image.outerWidth(FALSE) - image.width()) / 2);\r\n\timageOffset.top += Math.ceil((image.outerHeight(FALSE) - image.height()) / 2);\r\n\r\n\t// Add image position to offset coordinates\r\n\tresult.position.left += imageOffset.left;\r\n\tresult.position.top += imageOffset.top;\r\n\r\n\treturn result;\r\n};\r\n;var IE6,\r\n\r\n/*\r\n * BGIFrame adaption (http://plugins.jquery.com/project/bgiframe)\r\n * Special thanks to Brandon Aaron\r\n */\r\nBGIFRAME = '<iframe class=\"qtip-bgiframe\" frameborder=\"0\" tabindex=\"-1\" src=\"javascript:\\'\\';\" ' +\r\n\t' style=\"display:block; position:absolute; z-index:-1; filter:alpha(opacity=0); ' +\r\n\t\t'-ms-filter:\"progid:DXImageTransform.Microsoft.Alpha(Opacity=0)\";\"></iframe>';\r\n\r\nfunction Ie6(api, qtip) {\r\n\tthis._ns = 'ie6';\r\n\tthis.init( (this.qtip = api) );\r\n}\r\n\r\n$.extend(Ie6.prototype, {\r\n\t_scroll : function() {\r\n\t\tvar overlay = this.qtip.elements.overlay;\r\n\t\toverlay && (overlay[0].style.top = $(window).scrollTop() + 'px');\r\n\t},\r\n\r\n\tinit: function(qtip) {\r\n\t\tvar tooltip = qtip.tooltip,\r\n\t\t\tscroll;\r\n\r\n\t\t// Create the BGIFrame element if needed\r\n\t\tif($('select, object').length < 1) {\r\n\t\t\tthis.bgiframe = qtip.elements.bgiframe = $(BGIFRAME).appendTo(tooltip);\r\n\r\n\t\t\t// Update BGIFrame on tooltip move\r\n\t\t\tqtip._bind(tooltip, 'tooltipmove', this.adjustBGIFrame, this._ns, this);\r\n\t\t}\r\n\r\n\t\t// redraw() container for width/height calculations\r\n\t\tthis.redrawContainer = $('<div/>', { id: NAMESPACE+'-rcontainer' })\r\n\t\t\t.appendTo(document.body);\r\n\r\n\t\t// Fixup modal plugin if present too\r\n\t\tif( qtip.elements.overlay && qtip.elements.overlay.addClass('qtipmodal-ie6fix') ) {\r\n\t\t\tqtip._bind(window, ['scroll', 'resize'], this._scroll, this._ns, this);\r\n\t\t\tqtip._bind(tooltip, ['tooltipshow'], this._scroll, this._ns, this);\r\n\t\t}\r\n\r\n\t\t// Set dimensions\r\n\t\tthis.redraw();\r\n\t},\r\n\r\n\tadjustBGIFrame: function() {\r\n\t\tvar tooltip = this.qtip.tooltip,\r\n\t\t\tdimensions = {\r\n\t\t\t\theight: tooltip.outerHeight(FALSE),\r\n\t\t\t\twidth: tooltip.outerWidth(FALSE)\r\n\t\t\t},\r\n\t\t\tplugin = this.qtip.plugins.tip,\r\n\t\t\ttip = this.qtip.elements.tip,\r\n\t\t\ttipAdjust, offset;\r\n\r\n\t\t// Adjust border offset\r\n\t\toffset = parseInt(tooltip.css('borderLeftWidth'), 10) || 0;\r\n\t\toffset = { left: -offset, top: -offset };\r\n\r\n\t\t// Adjust for tips plugin\r\n\t\tif(plugin && tip) {\r\n\t\t\ttipAdjust = (plugin.corner.precedance === 'x') ? [WIDTH, LEFT] : [HEIGHT, TOP];\r\n\t\t\toffset[ tipAdjust[1] ] -= tip[ tipAdjust[0] ]();\r\n\t\t}\r\n\r\n\t\t// Update bgiframe\r\n\t\tthis.bgiframe.css(offset).css(dimensions);\r\n\t},\r\n\r\n\t// Max/min width simulator function\r\n\tredraw: function() {\r\n\t\tif(this.qtip.rendered < 1 || this.drawing) { return this; }\r\n\r\n\t\tvar tooltip = this.qtip.tooltip,\r\n\t\t\tstyle = this.qtip.options.style,\r\n\t\t\tcontainer = this.qtip.options.position.container,\r\n\t\t\tperc, width, max, min;\r\n\r\n\t\t// Set drawing flag\r\n\t\tthis.qtip.drawing = 1;\r\n\r\n\t\t// If tooltip has a set height/width, just set it... like a boss!\r\n\t\tif(style.height) { tooltip.css(HEIGHT, style.height); }\r\n\t\tif(style.width) { tooltip.css(WIDTH, style.width); }\r\n\r\n\t\t// Simulate max/min width if not set width present...\r\n\t\telse {\r\n\t\t\t// Reset width and add fluid class\r\n\t\t\ttooltip.css(WIDTH, '').appendTo(this.redrawContainer);\r\n\r\n\t\t\t// Grab our tooltip width (add 1 if odd so we don't get wrapping problems.. huzzah!)\r\n\t\t\twidth = tooltip.width();\r\n\t\t\tif(width % 2 < 1) { width += 1; }\r\n\r\n\t\t\t// Grab our max/min properties\r\n\t\t\tmax = tooltip.css('maxWidth') || '';\r\n\t\t\tmin = tooltip.css('minWidth') || '';\r\n\r\n\t\t\t// Parse into proper pixel values\r\n\t\t\tperc = (max + min).indexOf('%') > -1 ? container.width() / 100 : 0;\r\n\t\tmax = ((max.indexOf('%') > -1 ? perc : 1) * parseInt(max, 10)) || width;\r\n\t\t\tmin = ((min.indexOf('%') > -1 ? perc : 1) * parseInt(min, 10)) || 0;\r\n\r\n\t\t\t// Determine new dimension size based on max/min/current values\r\n\t\t\twidth = max + min ? Math.min(Math.max(width, min), max) : width;\r\n\r\n\t\t\t// Set the newly calculated width and remvoe fluid class\r\n\t\t\ttooltip.css(WIDTH, Math.round(width)).appendTo(container);\r\n\t\t}\r\n\r\n\t\t// Set drawing flag\r\n\t\tthis.drawing = 0;\r\n\r\n\t\treturn this;\r\n\t},\r\n\r\n\tdestroy: function() {\r\n\t\t// Remove iframe\r\n\t\tthis.bgiframe && this.bgiframe.remove();\r\n\r\n\t\t// Remove bound events\r\n\t\tthis.qtip._unbind([window, this.qtip.tooltip], this._ns);\r\n\t}\r\n});\r\n\r\nIE6 = PLUGINS.ie6 = function(api) {\r\n\t// Proceed only if the browser is IE6\r\n\treturn BROWSER.ie === 6 ? new Ie6(api) : FALSE;\r\n};\r\n\r\nIE6.initialize = 'render';\r\n\r\nCHECKS.ie6 = {\r\n\t'^content|style$': function() {\r\n\t\tthis.redraw();\r\n\t}\r\n};\r\n;}));\r\n}( window, document ));\r\n\n","/**  \r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n * \r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n * \r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n * \r\n * Copyright (c) 2015 (original work) Open Assessment Technologies SA;\r\n *               \r\n */\r\ndefine('taoDeliverySchedule/calendar/tooltips/eventTooltip',[\r\n    'lodash',\r\n    'jquery',\r\n    'taoDeliverySchedule/lib/qtip/jquery.qtip'\r\n], function (_, $) {\r\n    'use strict';\r\n    /**\r\n     * Calendar tooltop constructor.\r\n     * \r\n     * @constructor\r\n     * @property {object}         options Tooltop options.\r\n     * @property {jQueryElement}  options.$container Determines the HTML element which the tooltip is appended to\r\n     */\r\n    return function (options) {\r\n        var that = this,\r\n            defaultOptions = {\r\n                prerender : true,\r\n                content : {\r\n                    text : ' ',\r\n                    title : ' '\r\n                },\r\n                position : {\r\n                    my : 'bottom center',\r\n                    at : 'top center',\r\n                    adjust: {\r\n                        scroll : false,\r\n                        method : 'shift'\r\n                    },\r\n                    viewport : $(document)\r\n                },\r\n                show : false,\r\n                hide : false,\r\n                style : {\r\n                    width : 280,\r\n                    classes : 'qtip-light qtip-shadow'\r\n                }\r\n            };\r\n\r\n        this.init = function () {\r\n            if (typeof options === 'object') {\r\n                options = _.merge(defaultOptions, options);\r\n            } else {\r\n                options = defaultOptions;\r\n            }\r\n            this.tooltip = $('<div/>').qtip(options).qtip('api');\r\n            this.tooltip.elements.content.on('click', '.js-close', function () {\r\n                that.hide();\r\n            });\r\n        };\r\n\r\n        /**\r\n         * Hide tooltip\r\n         * @returns {undefined}\r\n         */\r\n        this.hide = function () {\r\n            if (!this.isShown()) {\r\n                return;\r\n            }\r\n            this.tooltip.hide();\r\n        };\r\n\r\n        /**\r\n         * Whether tooltip is shown.\r\n         * @returns {boolean}\r\n         */\r\n        this.isShown = function () {\r\n            return this.tooltip.elements.tooltip.is(':visible');\r\n        };\r\n\r\n        /**\r\n         * Set dialogue (qtip2) options.\r\n         * @see http://qtip2.com/api#api-methods.set\r\n         * @param {type} options\r\n         * @returns {undefined}\r\n         */\r\n        this.set = function (options) {\r\n            this.tooltip.set(options);\r\n        };\r\n\r\n        /**\r\n         * Validate tooltip form by given rules. Error fields will me marked by <i>error</i> class and tooltip with error message.\r\n         * @param {object} rules - Rules for calidate form.\r\n         * Example:\r\n         * <pre>\r\n         * {\r\n         *   '.js-delivery-end-date, .js-delivery-start-date' : { //field selector\r\n         *     validate : function () { //valudate function. Must return boolean value (whether field is valid). <i>this<i> valiable inside function refers to field element.\r\n         *       return /^\\d\\d\\d\\d-\\d\\d-\\d\\d$/.test($(this).val());\r\n         *     },\r\n         *     message : __('The format of date is invalid') //error message\r\n         *   },\r\n         *   '.js-label' : {\r\n         *     validate : function () {\r\n         *       return $(this).val().length !== 0;\r\n         *     },\r\n         *     message : __('This field is required')\r\n         *   }\r\n         * }\r\n         * </pre>\r\n         * @returns {Boolean} whether form is valid\r\n         */\r\n        this.validate = function (rules) {\r\n            var formIsValid = true,\r\n                qtipApi,\r\n                selector,\r\n                $elements;\r\n\r\n            for (selector in rules) {\r\n                $elements = that.$form.find(selector);\r\n                $elements.each(function () {\r\n                    var valid = rules[selector].validate.apply(this);\r\n                    qtipApi = $(this).qtip('api');\r\n                    if (!qtipApi) {\r\n                        qtipApi = $(this).qtip({\r\n                            content: {\r\n                                text: rules[selector].message\r\n                            },\r\n                            position: {\r\n                                target: 'mouse', // Track the mouse as the positioning target\r\n                                adjust: { x: 5, y: 5 } // Offset it slightly from under the mouse\r\n                            }\r\n                        }).qtip('api');\r\n                    }\r\n\r\n                    $elements.toggleClass('error', !valid);\r\n                    qtipApi.toggle(!valid).disable(valid);\r\n\r\n                    formIsValid = formIsValid && valid;\r\n                });\r\n            }\r\n\r\n            return formIsValid;\r\n        };\r\n\r\n        this.init();\r\n    };\r\n});\n","\ndefine('tpl!taoDeliverySchedule/calendar/tooltips/eventTooltip', ['handlebars'], function(hb){ \nreturn hb.template(function (Handlebars,depth0,helpers,partials,data) {\n  this.compilerInfo = [4,'>= 1.0.0'];\nhelpers = this.merge(helpers, Handlebars.helpers); data = data || {};\n  var buffer = \"\", stack1, helper, options, helperMissing=helpers.helperMissing, escapeExpression=this.escapeExpression, functionType=\"function\", self=this;\n\nfunction program1(depth0,data) {\n  \n  var buffer = \"\", stack1, helper, options;\n  buffer += \"\\r\\n        <b>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"End\", options) : helperMissing.call(depth0, \"__\", \"End\", options)))\n    + \":</b> \";\n  if (helper = helpers.end) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.end); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"<br>\\r\\n        \";\n  return buffer;\n  }\n\nfunction program3(depth0,data) {\n  \n  var buffer = \"\", helper, options;\n  buffer += \"\\r\\n        <a href=\\\"#\\\" class=\\\"js-go-to-parent-event\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Go to parent event\", options) : helperMissing.call(depth0, \"__\", \"Go to parent event\", options)))\n    + \" &raquo;</a>\\r\\n    \";\n  return buffer;\n  }\n\nfunction program5(depth0,data) {\n  \n  var buffer = \"\", helper, options;\n  buffer += \"\\r\\n        <a href=\\\"#\\\" class=\\\"js-delete-event\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Delete\", options) : helperMissing.call(depth0, \"__\", \"Delete\", options)))\n    + \"</a>\\r\\n        <a href=\\\"#\\\" class=\\\"js-edit-event\\\">\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Edit delivery\", options) : helperMissing.call(depth0, \"__\", \"Edit delivery\", options)))\n    + \" &raquo;</a>\\r\\n    \";\n  return buffer;\n  }\n\n  buffer += \"<div class=\\\"event-tooltip\\\">\\r\\n    <span class=\\\"event-tooltip__close js-close icon icon-result-nok\\\"></span>\\r\\n    <p class=\\\"event-tooltip__content\\\">\\r\\n        <b>\"\n    + escapeExpression((helper = helpers.__ || (depth0 && depth0.__),options={hash:{},data:data},helper ? helper.call(depth0, \"Start\", options) : helperMissing.call(depth0, \"__\", \"Start\", options)))\n    + \":</b> \";\n  if (helper = helpers.start) { stack1 = helper.call(depth0, {hash:{},data:data}); }\n  else { helper = (depth0 && depth0.start); stack1 = typeof helper === functionType ? helper.call(depth0, {hash:{},data:data}) : helper; }\n  buffer += escapeExpression(stack1)\n    + \"<br>\\r\\n        \";\n  stack1 = helpers['if'].call(depth0, (depth0 && depth0.end), {hash:{},inverse:self.noop,fn:self.program(1, program1, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\r\\n    </p>\\r\\n    <form class=\\\"hidden\\\">\\r\\n        <input type=\\\"hidden\\\" name=\\\"id\\\" value=\\\"\"\n    + escapeExpression(((stack1 = ((stack1 = (depth0 && depth0.fcEvent)),stack1 == null || stack1 === false ? stack1 : stack1.id)),typeof stack1 === functionType ? stack1.apply(depth0) : stack1))\n    + \"\\\" />\\r\\n        <input type=\\\"hidden\\\" name=\\\"classUri\\\" value=\\\"\"\n    + escapeExpression(((stack1 = ((stack1 = (depth0 && depth0.fcEvent)),stack1 == null || stack1 === false ? stack1 : stack1.classUri)),typeof stack1 === functionType ? stack1.apply(depth0) : stack1))\n    + \"\\\" />\\r\\n        <input type=\\\"hidden\\\" name=\\\"uri\\\" value=\\\"\"\n    + escapeExpression(((stack1 = ((stack1 = (depth0 && depth0.fcEvent)),stack1 == null || stack1 === false ? stack1 : stack1.uri)),typeof stack1 === functionType ? stack1.apply(depth0) : stack1))\n    + \"\\\" />\\r\\n    </form>\\r\\n    <hr>\\r\\n    <p class=\\\"event-tooltip__controls\\\">\\r\\n    \";\n  stack1 = helpers['if'].call(depth0, ((stack1 = (depth0 && depth0.fcEvent)),stack1 == null || stack1 === false ? stack1 : stack1.subEvent), {hash:{},inverse:self.program(5, program5, data),fn:self.program(3, program3, data),data:data});\n  if(stack1 || stack1 === 0) { buffer += stack1; }\n  buffer += \"\\r\\n    </p>\\r\\n</div>\";\n  return buffer;\n  });\n});\n\n","/*!\n  * Bean - copyright (c) Jacob Thornton 2011-2012\n  * https://github.com/fat/bean\n  * MIT license\n  */\n(function(e,t,n){typeof module!=\"undefined\"&&module.exports?module.exports=n():typeof define==\"function\"&&define.amd?define('taoDeliverySchedule/lib/bean.min',n):t[e]=n()})(\"bean\",this,function(e,t){e=e||\"bean\",t=t||this;var n=window,r=t[e],i=/[^\\.]*(?=\\..*)\\.|.*/,s=/\\..*/,o=\"addEventListener\",u=\"removeEventListener\",a=document||{},f=a.documentElement||{},l=f[o],c=l?o:\"attachEvent\",h={},p=Array.prototype.slice,d=function(e,t){return e.split(t||\" \")},v=function(e){return typeof e==\"string\"},m=function(e){return typeof e==\"function\"},g=\"click dblclick mouseup mousedown contextmenu mousewheel mousemultiwheel DOMMouseScroll mouseover mouseout mousemove selectstart selectend keydown keypress keyup orientationchange focus blur change reset select submit load unload beforeunload resize move DOMContentLoaded readystatechange message error abort scroll \",y=\"show input invalid touchstart touchmove touchend touchcancel gesturestart gesturechange gestureend textinput readystatechange pageshow pagehide popstate hashchange offline online afterprint beforeprint dragstart dragenter dragover dragleave drag drop dragend loadstart progress suspend emptied stalled loadmetadata loadeddata canplay canplaythrough playing waiting seeking seeked ended durationchange timeupdate play pause ratechange volumechange cuechange checking noupdate downloading cached updateready obsolete \",b=function(e,t,n){for(n=0;n<t.length;n++)t[n]&&(e[t[n]]=1);return e}({},d(g+(l?y:\"\"))),w=function(){var e=\"compareDocumentPosition\"in f?function(e,t){return t.compareDocumentPosition&&(t.compareDocumentPosition(e)&16)===16}:\"contains\"in f?function(e,t){return t=t.nodeType===9||t===window?f:t,t!==e&&t.contains(e)}:function(e,t){while(e=e.parentNode)if(e===t)return 1;return 0},t=function(t){var n=t.relatedTarget;return n?n!==this&&n.prefix!==\"xul\"&&!/document/.test(this.toString())&&!e(n,this):n==null};return{mouseenter:{base:\"mouseover\",condition:t},mouseleave:{base:\"mouseout\",condition:t},mousewheel:{base:/Firefox/.test(navigator.userAgent)?\"DOMMouseScroll\":\"mousewheel\"}}}(),E=function(){var e=d(\"altKey attrChange attrName bubbles cancelable ctrlKey currentTarget detail eventPhase getModifierState isTrusted metaKey relatedNode relatedTarget shiftKey srcElement target timeStamp type view which propertyName\"),t=e.concat(d(\"button buttons clientX clientY dataTransfer fromElement offsetX offsetY pageX pageY screenX screenY toElement\")),r=t.concat(d(\"wheelDelta wheelDeltaX wheelDeltaY wheelDeltaZ axis\")),i=e.concat(d(\"char charCode key keyCode keyIdentifier keyLocation location\")),s=e.concat(d(\"data\")),o=e.concat(d(\"touches targetTouches changedTouches scale rotation\")),u=e.concat(d(\"data origin source\")),l=e.concat(d(\"state\")),c=/over|out/,h=[{reg:/key/i,fix:function(e,t){return t.keyCode=e.keyCode||e.which,i}},{reg:/click|mouse(?!(.*wheel|scroll))|menu|drag|drop/i,fix:function(e,n,r){n.rightClick=e.which===3||e.button===2,n.pos={x:0,y:0};if(e.pageX||e.pageY)n.clientX=e.pageX,n.clientY=e.pageY;else if(e.clientX||e.clientY)n.clientX=e.clientX+a.body.scrollLeft+f.scrollLeft,n.clientY=e.clientY+a.body.scrollTop+f.scrollTop;return c.test(r)&&(n.relatedTarget=e.relatedTarget||e[(r==\"mouseover\"?\"from\":\"to\")+\"Element\"]),t}},{reg:/mouse.*(wheel|scroll)/i,fix:function(){return r}},{reg:/^text/i,fix:function(){return s}},{reg:/^touch|^gesture/i,fix:function(){return o}},{reg:/^message$/i,fix:function(){return u}},{reg:/^popstate$/i,fix:function(){return l}},{reg:/.*/,fix:function(){return e}}],p={},v=function(e,t,r){if(!arguments.length)return;e=e||((t.ownerDocument||t.document||t).parentWindow||n).event,this.originalEvent=e,this.isNative=r,this.isBean=!0;if(!e)return;var i=e.type,s=e.target||e.srcElement,o,u,a,f,l;this.target=s&&s.nodeType===3?s.parentNode:s;if(r){l=p[i];if(!l)for(o=0,u=h.length;o<u;o++)if(h[o].reg.test(i)){p[i]=l=h[o].fix;break}f=l(e,this,i);for(o=f.length;o--;)!((a=f[o])in this)&&a in e&&(this[a]=e[a])}};return v.prototype.preventDefault=function(){this.originalEvent.preventDefault?this.originalEvent.preventDefault():this.originalEvent.returnValue=!1},v.prototype.stopPropagation=function(){this.originalEvent.stopPropagation?this.originalEvent.stopPropagation():this.originalEvent.cancelBubble=!0},v.prototype.stop=function(){this.preventDefault(),this.stopPropagation(),this.stopped=!0},v.prototype.stopImmediatePropagation=function(){this.originalEvent.stopImmediatePropagation&&this.originalEvent.stopImmediatePropagation(),this.isImmediatePropagationStopped=function(){return!0}},v.prototype.isImmediatePropagationStopped=function(){return this.originalEvent.isImmediatePropagationStopped&&this.originalEvent.isImmediatePropagationStopped()},v.prototype.clone=function(e){var t=new v(this,this.element,this.isNative);return t.currentTarget=e,t},v}(),S=function(e,t){return!l&&!t&&(e===a||e===n)?f:e},x=function(){var e=function(e,t,n,r){var i=function(n,i){return t.apply(e,r?p.call(i,n?0:1).concat(r):i)},s=function(n,r){return t.__beanDel?t.__beanDel.ft(n.target,e):r},o=n?function(e){var t=s(e,this);if(n.apply(t,arguments))return e&&(e.currentTarget=t),i(e,arguments)}:function(e){return t.__beanDel&&(e=e.clone(s(e))),i(e,arguments)};return o.__beanDel=t.__beanDel,o},t=function(t,n,r,i,s,o,u){var a=w[n],f;n==\"unload\"&&(r=A(O,t,n,r,i)),a&&(a.condition&&(r=e(t,r,a.condition,o)),n=a.base||n),this.isNative=f=b[n]&&!!t[c],this.customType=!l&&!f&&n,this.element=t,this.type=n,this.original=i,this.namespaces=s,this.eventType=l||f?n:\"propertychange\",this.target=S(t,f),this[c]=!!this.target[c],this.root=u,this.handler=e(t,r,null,o)};return t.prototype.inNamespaces=function(e){var t,n,r=0;if(!e)return!0;if(!this.namespaces)return!1;for(t=e.length;t--;)for(n=this.namespaces.length;n--;)e[t]==this.namespaces[n]&&r++;return e.length===r},t.prototype.matches=function(e,t,n){return this.element===e&&(!t||this.original===t)&&(!n||this.handler===n)},t}(),T=function(){var e={},t=function(n,r,i,s,o,u){var a=o?\"r\":\"$\";if(!r||r==\"*\")for(var f in e)f.charAt(0)==a&&t(n,f.substr(1),i,s,o,u);else{var l=0,c,h=e[a+r],p=n==\"*\";if(!h)return;for(c=h.length;l<c;l++)if((p||h[l].matches(n,i,s))&&!u(h[l],h,l,r))return}},n=function(t,n,r,i){var s,o=e[(i?\"r\":\"$\")+n];if(o)for(s=o.length;s--;)if(!o[s].root&&o[s].matches(t,r,null))return!0;return!1},r=function(e,n,r,i){var s=[];return t(e,n,r,null,i,function(e){return s.push(e)}),s},i=function(t){var n=!t.root&&!this.has(t.element,t.type,null,!1),r=(t.root?\"r\":\"$\")+t.type;return(e[r]||(e[r]=[])).push(t),n},s=function(n){t(n.element,n.type,null,n.handler,n.root,function(t,n,r){return n.splice(r,1),t.removed=!0,n.length===0&&delete e[(t.root?\"r\":\"$\")+t.type],!1})},o=function(){var t,n=[];for(t in e)t.charAt(0)==\"$\"&&(n=n.concat(e[t]));return n};return{has:n,get:r,put:i,del:s,entries:o}}(),N,C=function(e){arguments.length?N=e:N=a.querySelectorAll?function(e,t){return t.querySelectorAll(e)}:function(){throw new Error(\"Bean: No selector engine installed\")}},k=function(e,t){if(!l&&t&&e&&e.propertyName!=\"_on\"+t)return;var n=T.get(this,t||e.type,null,!1),r=n.length,i=0;e=new E(e,this,!0),t&&(e.type=t);for(;i<r&&!e.isImmediatePropagationStopped();i++)n[i].removed||n[i].handler.call(this,e)},L=l?function(e,t,n){e[n?o:u](t,k,!1)}:function(e,t,n,r){var i;n?(T.put(i=new x(e,r||t,function(t){k.call(e,t,r)},k,null,null,!0)),r&&e[\"_on\"+r]==null&&(e[\"_on\"+r]=0),i.target.attachEvent(\"on\"+i.eventType,i.handler)):(i=T.get(e,r||t,k,!0)[0],i&&(i.target.detachEvent(\"on\"+i.eventType,i.handler),T.del(i)))},A=function(e,t,n,r,i){return function(){r.apply(this,arguments),e(t,n,i)}},O=function(e,t,n,r){var i=t&&t.replace(s,\"\"),o=T.get(e,i,null,!1),u={},a,f;for(a=0,f=o.length;a<f;a++)(!n||o[a].original===n)&&o[a].inNamespaces(r)&&(T.del(o[a]),!u[o[a].eventType]&&o[a][c]&&(u[o[a].eventType]={t:o[a].eventType,c:o[a].type}));for(a in u)T.has(e,u[a].t,null,!1)||L(e,u[a].t,!1,u[a].c)},M=function(e,t){var n=function(t,n){var r,i=v(e)?N(e,n):e;for(;t&&t!==n;t=t.parentNode)for(r=i.length;r--;)if(i[r]===t)return t},r=function(e){var r=n(e.target,this);r&&t.apply(r,arguments)};return r.__beanDel={ft:n,selector:e},r},_=l?function(e,t,r){var i=a.createEvent(e?\"HTMLEvents\":\"UIEvents\");i[e?\"initEvent\":\"initUIEvent\"](t,!0,!0,n,1),r.dispatchEvent(i)}:function(e,t,n){n=S(n,e),e?n.fireEvent(\"on\"+t,a.createEventObject()):n[\"_on\"+t]++},D=function(e,t,n){var r=v(t),o,u,a,f;if(r&&t.indexOf(\" \")>0){t=d(t);for(f=t.length;f--;)D(e,t[f],n);return e}u=r&&t.replace(s,\"\"),u&&w[u]&&(u=w[u].base);if(!t||r){if(a=r&&t.replace(i,\"\"))a=d(a,\".\");O(e,u,n,a)}else if(m(t))O(e,null,t);else for(o in t)t.hasOwnProperty(o)&&D(e,o,t[o]);return e},P=function(e,t,n,r){var o,u,a,f,l,v,g;if(n===undefined&&typeof t==\"object\"){for(u in t)t.hasOwnProperty(u)&&P.call(this,e,u,t[u]);return}m(n)?(l=p.call(arguments,3),r=o=n):(o=r,l=p.call(arguments,4),r=M(n,o,N)),a=d(t),this===h&&(r=A(D,e,t,r,o));for(f=a.length;f--;)g=T.put(v=new x(e,a[f].replace(s,\"\"),r,o,d(a[f].replace(i,\"\"),\".\"),l,!1)),v[c]&&g&&L(e,v.eventType,!0,v.customType);return e},H=function(e,t,n,r){return P.apply(null,v(n)?[e,n,t,r].concat(arguments.length>3?p.call(arguments,5):[]):p.call(arguments))},B=function(){return P.apply(h,arguments)},j=function(e,t,n){var r=d(t),o,u,a,f,l;for(o=r.length;o--;){t=r[o].replace(s,\"\");if(f=r[o].replace(i,\"\"))f=d(f,\".\");if(!f&&!n&&e[c])_(b[t],t,e);else{l=T.get(e,t,null,!1),n=[!1].concat(n);for(u=0,a=l.length;u<a;u++)l[u].inNamespaces(f)&&l[u].handler.apply(e,n)}}return e},F=function(e,t,n){var r=T.get(t,n,null,!1),i=r.length,s=0,o,u;for(;s<i;s++)r[s].original&&(o=[e,r[s].type],(u=r[s].handler.__beanDel)&&o.push(u.selector),o.push(r[s].original),P.apply(null,o));return e},I={on:P,add:H,one:B,off:D,remove:D,clone:F,fire:j,Event:E,setSelectorEngine:C,noConflict:function(){return t[e]=r,this}};if(n.attachEvent){var q=function(){var e,t=T.entries();for(e in t)t[e].type&&t[e].type!==\"unload\"&&D(t[e].element,t[e].type);n.detachEvent(\"onunload\",q),n.CollectGarbage&&n.CollectGarbage()};n.attachEvent(\"onunload\",q)}return C(),I});\n","/**  \n * This program is free software; you can redistribute it and/or\n * modify it under the terms of the GNU General Public License\n * as published by the Free Software Foundation; under version 2\n * of the License (non-upgradable).\n * \n * This program is distributed in the hope that it will be useful,\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\n * GNU General Public License for more details.\n * \n * You should have received a copy of the GNU General Public License\n * along with this program; if not, write to the Free Software\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\n * \n * Copyright (c) 2015 (original work) Open Assessment Technologies SA;\n *               \n */\ndefine('taoDeliverySchedule/calendar/mediator',[\n    'taoDeliverySchedule/lib/bean.min'\n], function (bean) {\n    'use strict';\n    var eventContainer = {};\n    return {\n        on : function (eventName, eventHandler) {\n            return bean.on(eventContainer, eventName, eventHandler);\n        },\n        off : function (eventName) {\n            return bean.off(eventContainer, eventName);\n        },\n        fire : function (eventName) {\n            var args = Array.prototype.slice.call(arguments, 1);\n            return bean.fire(eventContainer, eventName, args);\n        } \n    };\n});\n","/**  \r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n * \r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n * \r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n * \r\n * Copyright (c) 2015 (original work) Open Assessment Technologies SA;\r\n *               \r\n */\r\ndefine('taoDeliverySchedule/calendar/tooltips/editEventTooltip',[\r\n    'lodash',\r\n    'jquery',\r\n    'taoDeliverySchedule/calendar/tooltips/eventTooltip',\r\n    'tpl!taoDeliverySchedule/calendar/tooltips/eventTooltip',\r\n    'taoDeliverySchedule/calendar/mediator',\r\n    'taoDeliverySchedule/lib/qtip/jquery.qtip'\r\n], function (_, $, eventTooltip, tooltipTpl, mediator) {\r\n    'use strict';\r\n\r\n    return function () {\r\n        var that = this;\r\n\r\n        eventTooltip.apply(this, arguments);\r\n\r\n        /**\r\n         * Init event tooltip.\r\n         * @returns {undefined}\r\n         */\r\n        this.init = function () {\r\n            that.set({\r\n                'events.hide': function () {mediator.fire('hide.editEventTooltip'); },\r\n                'position.adjust.resize' : true\r\n            });\r\n\r\n            that.tooltip.elements.content.on('click', '.js-edit-event', function (e) {\r\n                e.preventDefault();\r\n                mediator.fire('edit.editEventTooltip');\r\n            });\r\n\r\n            that.tooltip.elements.content.on('click', '.js-delete-event', function (e) {\r\n                e.preventDefault();\r\n                mediator.fire('delete.editEventTooltip', that.getId());\r\n            });\r\n\r\n            that.tooltip.elements.content.on('click', '.js-go-to-parent-event', function (e) {\r\n                e.preventDefault();\r\n                mediator.fire('to-parent.editEventTooltip', that.getId());\r\n            });\r\n        };\r\n\r\n        /**\r\n         * Show tooltip\r\n         * @param {object} fullcalendar event\r\n         * @returns {undefined}\r\n         */\r\n        this.show = function (fcEvent) {\r\n            var tplOptions = {\r\n                start : fcEvent.start.format('ddd, MMMM D, H:mm'),\r\n                end : fcEvent.end ? fcEvent.end.format('ddd, MMMM D, H:mm') : false,\r\n                color : fcEvent.color || 'transparent',\r\n                fcEvent : fcEvent\r\n            };\r\n\r\n            that.tooltip.set({\r\n                'content.text' : tooltipTpl(tplOptions),\r\n                'content.title' : '<b>' + _.escape(fcEvent.title) + '</b>'\r\n            });\r\n            that.tooltip.elements.titlebar.css({'border-bottom' : '2px solid ' + tplOptions.color});\r\n            that.tooltip.show();\r\n        };\r\n\r\n        /**\r\n         * Get event id\r\n         * @returns {string}\r\n         */\r\n        this.getId = function () {\r\n            return that.tooltip.elements.tooltip.find('input[name=\"id\"]').val();\r\n        };\r\n\r\n        /**\r\n         * Get event class uri\r\n         * @returns {string}\r\n         */\r\n        this.getClassUri = function () {\r\n            return that.tooltip.elements.tooltip.find('input[name=\"classUri\"]').val();\r\n        };\r\n\r\n        this.init();\r\n    };\r\n});\r\n\r\n\r\n\n","/**  \r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n * \r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n * \r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n * \r\n * Copyright (c) 2015 (original work) Open Assessment Technologies SA;\r\n *               \r\n */\r\ndefine('taoDeliverySchedule/calendar/tooltips/createEventTooltip',[\r\n    'lodash',\r\n    'jquery',\r\n    'taoDeliverySchedule/calendar/tooltips/eventTooltip',\r\n    'handlebars',\r\n    'i18n',\r\n    'taoDeliverySchedule/calendar/mediator',\r\n    'taoDeliverySchedule/lib/qtip/jquery.qtip'\r\n], function (_, $, eventTooltip, Handlebars, __, mediator) {\r\n    'use strict';\r\n    return function () {\r\n        var that = this;\r\n\r\n        eventTooltip.apply(this, arguments);\r\n\r\n        this.validateRules = {\r\n            '[name=\"label\"]' : {\r\n                validate : function () {\r\n                    return $(this).val().length !== 0;\r\n                },\r\n                message : __('This field is required')\r\n            }\r\n        };\r\n\r\n        /**\r\n         * Init create event tooltip\r\n         * @returns {undefined}\r\n         */\r\n        this.init = function () {\r\n            that.set({\r\n                'content.title' : __('Create a new delivery'),\r\n                'style.width' : 400,\r\n                'position.adjust.resize' : true,\r\n                'events.hide': function () {mediator.fire('hide.createEventTooltip'); }\r\n            });\r\n        };\r\n\r\n        /**\r\n         * Load form template and show tooltip. \r\n         * \r\n         * @param {object} options\r\n         * @property {object} options.start momentjs object\r\n         * @property {object} options.end momentjs object\r\n         * @property {string} options.end classUri\r\n         * @property {string} options.end id\r\n         * @returns {undefined}\r\n         */\r\n        this.show = function (options) {\r\n            var timeZone = parseInt(options.timeZone, 10),\r\n                startUTCStr = options.start.clone().zone(timeZone).format('YYYY-MM-DD HH:mm'),\r\n                endUTCStr = options.end.clone().zone(timeZone).format('YYYY-MM-DD HH:mm'),\r\n                tplOptions = {\r\n                    start : options.start.format('ddd, MMMM D, H:mm'),\r\n                    end : options.end ? options.end.format('ddd, MMMM D, H:mm') : false\r\n                };\r\n\r\n            $.ajax({\r\n                url : '/taoDeliverySchedule/Main/createDeliveryForm',\r\n                type : 'GET',\r\n                data : {\r\n                    classUri : options.classUri,\r\n                    id : options.id\r\n                },\r\n                success : function (response) {\r\n                    var tpl = Handlebars.compile(response),\r\n                        $form;\r\n\r\n\r\n                    that.tooltip.set({\r\n                        'content.text' : tpl(tplOptions),\r\n                        'position.target' : options.target || options.e.target\r\n                    });\r\n                    that.tooltip.show();\r\n\r\n                    $form = that.getForm();\r\n                    $form.find('#label').focus();\r\n                    $form.find('[name=\"start\"]').val(startUTCStr);\r\n                    $form.find('[name=\"end\"]').val(endUTCStr);\r\n\r\n                    that.$form = $form;\r\n\r\n                    that.$form.on('keyup', 'input, select', function() {\r\n                        that.validate(that.validateRules);\r\n                    });\r\n\r\n                    that.$form.find('[name=\"test\"]').on('change', function () {\r\n                        var text = $(this).find('option[value=\"' + $(this).val() + '\"]').text(),\r\n                            $label = $form.find('#label');\r\n                        $label.val(text).focus();\r\n                    }).trigger('change');\r\n\r\n                    that.tooltip.elements.content.find('.js-create-event').on('click', function () {\r\n                        $form.submit();\r\n                    });\r\n\r\n                    $form.on('submit', function (e) {\r\n                        e.preventDefault();\r\n                        that.submit($(this), e);\r\n                    });\r\n                }\r\n            });\r\n        };\r\n\r\n        /**\r\n         * Fire <b>submit.createEventTooltip</b> event.\r\n         * @param {object} e event\r\n         * @fires createEventTooltip#submit.createEventTooltip\r\n         * @returns {undefined}\r\n         */\r\n        this.submit = function (e) {\r\n            if (this.validate(this.validateRules)) {\r\n                mediator.fire('submit.createEventTooltip', that.getFormData());\r\n            }\r\n        };\r\n\r\n        /**\r\n         * Get form jQeeryElement.\r\n         * @returns {jQeeryElement} form element\r\n         */\r\n        this.getForm = function () {\r\n            return that.tooltip.elements.content.find('form');\r\n        };\r\n\r\n        /**\r\n         * Convert form data to JS object\r\n         * @returns {object} form data\r\n         */\r\n        this.getFormData = function () {\r\n            var data = {},\r\n                $form = that.getForm();\r\n            $form.serializeArray().map(function (x) {data[x.name] = x.value; });\r\n            return data;\r\n        };\r\n\r\n        this.init();\r\n    };\r\n});\r\n\r\n\r\n\n","/**  \r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n * \r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n * \r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n * \r\n * Copyright (c) 2015 (original work) Open Assessment Technologies SA;\r\n *               \r\n */\r\ndefine('taoDeliverySchedule/calendar/modals/modal',[\r\n    'lodash',\r\n    'jquery',\r\n    'taoDeliverySchedule/lib/qtip/jquery.qtip'\r\n], function (_, $) {\r\n    'use strict';\r\n    /**\r\n     * Calendar modal constructor.\r\n     * \r\n     * @constructor\r\n     * @param {object} options Modal options.\r\n     */\r\n    return function (options) {\r\n        var that = this,\r\n            defaultOptions = {\r\n                prerender : true,\r\n                content : {\r\n                    text : ' ',\r\n                    title : ' '\r\n                },\r\n                position: {\r\n                    my : 'center', at: 'center',\r\n                    target : $(window),\r\n                    adjust : {\r\n                        scroll : false\r\n                    }\r\n                },\r\n                show : {\r\n                    ready : false,\r\n                    modal : {\r\n                        on : true,\r\n                        blur : false,\r\n                        //escape : true\r\n                    }\r\n                },\r\n                hide : false,\r\n                style : {\r\n                    width : 800,\r\n                    classes : 'dialogue qtip-light qtip-shadow'\r\n                }\r\n            };\r\n\r\n        this.init = function () {\r\n            $.fn.qtip.modal_zindex = 8800;\r\n            options = _.merge(defaultOptions, options);\r\n            this.modal = $('<div />').qtip(options).qtip('api');\r\n        };\r\n\r\n        /**\r\n         * Hide dialogue\r\n         * @returns {undefined}\r\n         */\r\n        this.hide = function () {\r\n            if (!that.isShown()) {\r\n                return;\r\n            }\r\n            this.modal.hide();\r\n        };\r\n\r\n        /**\r\n         * Whether dialogue is shown.\r\n         * @returns {boolean}\r\n         */\r\n        this.isShown = function () {\r\n            return this.modal.elements.tooltip.is(':visible');\r\n        };\r\n\r\n        /**\r\n         * Set dialogue (qtip2) options.\r\n         * @see http://qtip2.com/api#api-methods.set\r\n         * @param {type} options\r\n         * @returns {undefined}\r\n         */\r\n        this.set = function (options) {\r\n            this.modal.set(options);\r\n        };\r\n\r\n        this.init();\r\n    };\r\n});\r\n\r\n\r\n\n","/**  \r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n * \r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n * \r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n * \r\n * Copyright (c) 2015 (original work) Open Assessment Technologies SA;\r\n *               \r\n */\r\ndefine('taoDeliverySchedule/calendar/testTakersService',[\r\n    'lodash',\r\n    'jquery',\r\n    'ui/feedback',\r\n    'layout/loading-bar'\r\n], function (_, $, feedback, loadingBar) {\r\n    'use strict';\r\n    var instance = null;\r\n\r\n    function TestTakersService() {\r\n        var that = this;\r\n\r\n        if (instance !== null) {\r\n            throw new Error(\"Cannot instantiate more than one TestTakersService, use TestTakersService.getInstance()\");\r\n        }\r\n\r\n        this.loadTestTakers = function (options) {\r\n            var deferred = $.Deferred();\r\n\r\n            $.ajax({\r\n                url : '/taoDeliverySchedule/TestTakersApi',\r\n                type : 'GET',\r\n                data : options,\r\n                success : function (response) {\r\n                    deferred.resolve(response);\r\n                },\r\n                error : function (xhr, err) {\r\n                    deferred.rejext(xhr);\r\n                }\r\n            });\r\n\r\n            return deferred.promise();\r\n        };\r\n    };\r\n\r\n    TestTakersService.getInstance = function () {\r\n        // Gets an instance of the singleton.\r\n        if (instance === null) {\r\n            instance = new TestTakersService();\r\n        }\r\n        return instance;\r\n    };\r\n\r\n    return TestTakersService.getInstance();\r\n});\n","/**  \r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n * \r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n * \r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n * \r\n * Copyright (c) 2015 (original work) Open Assessment Technologies SA;\r\n *               \r\n */\r\n\r\n/**\r\n * Dual listbox widget for managing delivery test takers.\r\n * @param {type} _ lodash\r\n * @param {type} $ jQuery\r\n * @param {type} Handlebars\r\n * @param {type} __ i18n\r\n * @param {type} feedback\r\n * @param {type} testTakersService {@link /taoDeliverySchedule/calendar/testTakersService.js}\r\n * @returns {Function} Constructor\r\n * Usage example:\r\n * <pre>\r\n * testTakersList = new TestTakersList({\r\n *   container : $('.js-tt-list'),\r\n *   data : {ttexcluded : response.ttexcluded, ttassigned : response.ttassigned},\r\n *   deliveryId : response.id\r\n * });\r\n * </pre>\r\n */\r\ndefine(\r\n    'taoDeliverySchedule/calendar/widgets/testTakersList',[\r\n        'lodash',\r\n        'jquery',\r\n        'handlebars',\r\n        'i18n',\r\n        'ui/feedback',\r\n        'taoDeliverySchedule/calendar/testTakersService'\r\n    ],\r\n    function (_, $, Handlebars, __, feedback, testTakersService) {\r\n        'use stirct';\r\n        return function (options) {\r\n            var that = this,\r\n                $container = options.container,\r\n                $assignedList = $container.find('.js-assigned-tt-list'),\r\n                $excludedList = $container.find('.js-excluded-tt-list'),\r\n                assignedSummaryTpl,\r\n                excludedSummaryTpl;\r\n            \r\n            /**\r\n             * Init widget\r\n             * @returns {undefined}\r\n             */\r\n            this.init = function () {\r\n                $container.on('keyup', '.tt-list__filter', function () {\r\n                    that.applyFilter($(this));\r\n                });\r\n                $container.on('click', '.js-reset-filter', function (e) {\r\n                    e.preventDefault();\r\n                    var $input = $(this).closest('td').find('.tt-list__filter');\r\n                    $input.val('');\r\n                    that.applyFilter($input);\r\n                });\r\n                \r\n                $container.find('.tt-select').on('change', function () {\r\n                    that.moveOptions($(this).find('option:selected'));\r\n                });\r\n                \r\n                assignedSummaryTpl = Handlebars.compile($('.js-assigned-summary-wrap').html());\r\n                excludedSummaryTpl = Handlebars.compile($('.js-excluded-summary-wrap').html());\r\n                $('.js-assigned-summary-wrap').empty();\r\n                $('.js-excluded-summary-wrap').empty();\r\n                \r\n                if (options.data) {\r\n                    that.render(options.data);\r\n                }\r\n            };\r\n            \r\n            /**\r\n             * Move options to another selectbox.\r\n             * @param {jQueryElement} $options option elements to move.\r\n             * @returns {jQueryElement} moved option elements\r\n             */\r\n            this.moveOptions = function ($options) {\r\n                $options.each(function () {\r\n                    var $option = $(this);\r\n                    if ($.contains($assignedList[0], $option[0])) {\r\n                        $excludedList.append($option);\r\n                    } else {\r\n                        $assignedList.append($option);\r\n                    }\r\n                });\r\n                that.unselectOptions();\r\n                $('.tt-list__filter').each(function () {\r\n                    that.applyFilter($(this));\r\n                });\r\n                return $options;\r\n            };\r\n            \r\n            /**\r\n             * Unselect selected rows in both selectboxes\r\n             * @returns {undefined}\r\n             */\r\n            this.unselectOptions = function () {\r\n                $('.tt-select option').each(function () {\r\n                    $(this)[0].selected = false;\r\n                });\r\n            };\r\n            \r\n            /**\r\n             * Render both lists according to the given data.\r\n             * @param {object} data test-akers data\r\n             * @property {array} data.ttassigned array of assigned test-takers\r\n             * @property {object} data.ttassigned[].uri \r\n             * @property {object} data.ttassigned[].label \r\n             * @property {array} data.ttexcluded array of excluded test-takers\r\n             * @property {object} data.ttexcluded[].uri \r\n             * @property {object} data.ttexcluded[].label \r\n             * @returns {undefined}\r\n             */\r\n            this.render = function (data) {\r\n                $assignedList.empty();\r\n                $excludedList.empty();\r\n                $.each(data.ttassigned, function (key, val) {\r\n                    $assignedList.append(\r\n                        $('<option value=\"' + val.uri + '\">' + val.label + '</option>')\r\n                    );\r\n                });\r\n                $.each(data.ttexcluded, function (key, val) {\r\n                    $excludedList.append(\r\n                        $('<option value=\"' + val.uri + '\">' + val.label + '</option>')\r\n                    );\r\n                });\r\n                \r\n                that.updateSummary();\r\n            };\r\n            \r\n            /**\r\n             * Load testakers assigned to the given groups and update both lists according to the given data.\r\n             * @param {array} groups array of groups ids\r\n             * @returns {undefined}\r\n             */\r\n            this.updateGroups = function (groups) {\r\n                testTakersService.loadTestTakers(\r\n                    {groups : groups, uri : options.deliveryId}\r\n                ).done(\r\n                    function (data) {\r\n                        that.render(data);\r\n                    }\r\n                );\r\n            };\r\n            \r\n            /**\r\n             * Update messages over the lists.\r\n             * @returns {undefined}\r\n             */\r\n            this.updateSummary = function () {\r\n                var data = {\r\n                    ttassigned : {\r\n                        total : $assignedList.find('option').length,\r\n                        filtered : $assignedList.find('option.filtered').length\r\n                    },\r\n                    ttexcluded : {\r\n                        total : $excludedList.find('option').length,\r\n                        filtered : $excludedList.find('option.filtered').length\r\n                    }\r\n                };\r\n                \r\n                data.ttexcluded.message = data.ttexcluded.total ? __('%d test-taker(s) are excluded', String(data.ttexcluded.total)) : '&nbsp;';\r\n                data.ttassigned.message = __('Delivery is assigned to %d test-takers', String(data.ttassigned.total));\r\n                \r\n                $('.js-assigned-summary-wrap').html(assignedSummaryTpl(data.ttassigned));\r\n                $('.js-excluded-summary-wrap').html(excludedSummaryTpl(data.ttexcluded));\r\n            };\r\n            \r\n            /**\r\n             * Apply filters to the lists.\r\n             * @param {jQueryElement} $input filter filed\r\n             * @returns {undefined}\r\n             */\r\n            this.applyFilter = function ($input) {\r\n                var $container = $input.closest('td'),\r\n                    $select = $container.find('.tt-select'),\r\n                    str = $input.val(),\r\n                    filtered = 0;\r\n                \r\n                $select.find('span > option').unwrap();\r\n                $select.find('option').removeClass('filtered').each(function (key, option) {\r\n                    var $option = $(option);\r\n                    if ($option.text().indexOf(str) < 0) {\r\n                        //IE cannot hide option by usual .hide() function\r\n                        $option.addClass('filtered').wrap(\"<span>\").parent().hide();\r\n                        filtered++;\r\n                    }\r\n                });\r\n                \r\n                that.updateSummary();\r\n            };\r\n            \r\n            this.init();\r\n        };\r\n    }\r\n);\r\n\r\n\r\n\n","/**\r\n * jQuery serializeObject\r\n * @copyright 2014, macek <paulmacek@gmail.com>\r\n * @link https://github.com/macek/jquery-serialize-object\r\n * @license BSD\r\n * @version 2.4.5\r\n */\r\n!function(e,r){if(\"function\"==typeof define&&define.amd)define('taoDeliverySchedule/lib/jquery.serialize-object.min',[\"exports\",\"jquery\"],function(e,i){return r(e,i)});else if(\"undefined\"!=typeof exports){var i=require(\"jquery\");r(exports,i)}else r(e,e.jQuery||e.Zepto||e.ender||e.$)}(this,function(e,r){function i(e,i){function n(e,r,i){return e[r]=i,e}function a(e,r){for(var i,a=e.match(t.key);void 0!==(i=a.pop());)if(t.push.test(i)){var o=s(e.replace(/\\[\\]$/,\"\"));r=n([],o,r)}else t.fixed.test(i)?r=n([],i,r):t.named.test(i)&&(r=n({},i,r));return r}function s(e){return void 0===h[e]&&(h[e]=0),h[e]++}function o(e){switch(r('[name=\"'+e.name+'\"]',i).attr(\"type\")){case\"checkbox\":return\"on\"===e.value?!0:e.value;default:return e.value}}function u(r){if(!t.validate.test(r.name))return this;var i=a(r.name,o(r));return c=e.extend(!0,c,i),this}function f(r){if(!e.isArray(r))throw new Error(\"formSerializer.addPairs expects an Array\");for(var i=0,t=r.length;t>i;i++)this.addPair(r[i]);return this}function d(){return c}function l(){return JSON.stringify(d())}var c={},h={};this.addPair=u,this.addPairs=f,this.serialize=d,this.serializeJSON=l}var t={validate:/^[a-z_][a-z0-9_]*(?:\\[(?:\\d*|[a-z0-9_]+)\\])*$/i,key:/[a-z0-9_]+|(?=\\[\\])/gi,push:/^$/,fixed:/^\\d+$/,named:/^[a-z0-9_]+$/i};return i.patterns=t,i.serializeObject=function(){return this.length>1?new Error(\"jquery-serialize-object can only serialize one form at a time\"):new i(r,this).addPairs(this.serializeArray()).serialize()},i.serializeJSON=function(){return this.length>1?new Error(\"jquery-serialize-object can only serialize one form at a time\"):new i(r,this).addPairs(this.serializeArray()).serializeJSON()},\"undefined\"!=typeof r.fn&&(r.fn.serializeObject=i.serializeObject,r.fn.serializeJSON=i.serializeJSON),e.FormSerializer=i,i});\n","/**  \r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n * \r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n * \r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n * \r\n * Copyright (c) 2015 (original work) Open Assessment Technologies SA;\r\n *               \r\n */\r\n\r\n/*global window,RRule,define*/\r\ndefine('taoDeliverySchedule/calendar/modals/editEventModal',[\r\n'lodash',\r\n'jquery',\r\n'taoDeliverySchedule/calendar/modals/modal',\r\n'text!editDeliveryForm',\r\n'i18n',\r\n'generis.tree.select',\r\n'moment',\r\n'handlebars',\r\n'taoDeliverySchedule/calendar/eventService',\r\n'taoDeliverySchedule/calendar/widgets/testTakersList',\r\n'taoDeliverySchedule/calendar/mediator',\r\n'taoDeliverySchedule/lib/rrule/rrule.amd',\r\n'taoDeliverySchedule/lib/jquery.serialize-object.min',\r\n'taoDeliverySchedule/lib/qtip/jquery.qtip',\r\n'jqueryui'], function (_, $, modal, formTpl, __, GenerisTreeSelectClass, moment, Handlebars, eventService, TestTakersList, mediator) {\r\n    'use strict';\r\n    return function () {\r\n        var that = this,\r\n            initialData,\r\n            testTakersList;\r\n\r\n        modal.apply(this, arguments);\r\n\r\n        function pad(value) {\r\n            return value < 10 ? '0' + value : value;\r\n        }\r\n\r\n        function createOffset(val) {\r\n            var offset = Math.abs(val),\r\n                sign = (offset < 0) ? \"-\" : \"+\",\r\n                hours = pad(Math.floor(offset / 60)),\r\n                minutes = pad(offset % 60);\r\n\r\n            return sign + hours + \":\" + minutes;\r\n        }\r\n\r\n        /**\r\n         * Initialization edit modal\r\n         * @returns {undefined}\r\n         */\r\n        this.init = function () {\r\n            formTpl = Handlebars.compile(formTpl);\r\n\r\n            that.set({\r\n                'position.my'     : 'top center',\r\n                'position.at'     : 'top center',\r\n                'position.target' : $(window),\r\n                'style.width'     : 900,\r\n                'style.classes'   : 'edit-delivery-modal dialogue qtip-light qtip-shadow'\r\n            });\r\n            that.modal.elements.content.on('click', '.js-close', function () {\r\n                that.hide();\r\n            });\r\n        };\r\n\r\n        /**\r\n         * Show edit delivery modal\r\n         * @param {object} fcEvent fullcalendar event object\r\n         */\r\n        this.show = function (fcEvent) {\r\n            $.ajax({\r\n                url : '/taoDeliverySchedule/CalendarApi?full=1',\r\n                type : 'GET',\r\n                data : {\r\n                    uri : fcEvent.id\r\n                },\r\n                success : function (response) {\r\n                    var color = response.color || 'transparent';\r\n\r\n                    response.publishedFromatted = moment(response.published * 1000).format(\"YYYY-MM-DD HH:mm\");\r\n                    response.executionsMessage = that.getExecutionsMessage(response.executions);\r\n\r\n                    that.modal.set({\r\n                        'content.text'   : formTpl(response),\r\n                        'content.title'  : _.escape(response.title)\r\n                    });\r\n\r\n                    that.modal.show();\r\n                    that.modal.elements.titlebar.css({'border-bottom' : '2px solid ' + color});\r\n\r\n                    testTakersList = new TestTakersList({\r\n                        container : $('.js-tt-list'),\r\n                        data : {ttexcluded : response.ttexcluded, ttassigned : response.ttassigned},\r\n                        deliveryId : response.id\r\n                    });\r\n\r\n                    that.initDatepickers();\r\n                    that.initGroupTree(response);\r\n                    that.initForm(response);\r\n                }\r\n            });\r\n        };\r\n\r\n        /**\r\n         * Hide edit form. If any data on the form was changed then confirmation window will be shown.\r\n         * @returns {undefined}\r\n         */\r\n        this.hide = function () {\r\n            if (!that.isShown()) {\r\n                return;\r\n            }\r\n            if (!that.modified()) {\r\n                that.modal.hide();\r\n            } else {\r\n                var message = '<div><p>' + __('Do you want to save your changes?') + '</p>' +\r\n                    '<button class=\"btn-success small js-confirm-save\">' + __('Save') + '</button> ' +\r\n                    '<button class=\"btn-info small js-confirm-cancel\">' + __('Cancel') + '</button> ' +\r\n                    '<button class=\"btn-warning small js-confirm-discard\">' + __('Discard') + '</button></div>';\r\n\r\n                $('<div />').qtip({\r\n                    content: {\r\n                        text: $(message),\r\n                        title: __(\"The delivery has been modified.\")\r\n                    },\r\n                    position: {\r\n                        my: 'center',\r\n                        at: 'center',\r\n                        target: $(window),\r\n                        adjust: {\r\n                            y: -200\r\n                        }\r\n                    },\r\n                    show: {\r\n                        ready: true,\r\n                        modal: {\r\n                            on: false,\r\n                            blur: false\r\n                        }\r\n                    },\r\n                    hide: false,\r\n                    style: 'dialogue qtip-light qtip-shadow',\r\n                    events: {\r\n                        render: function (event, api) {\r\n                            $('.js-confirm-cancel', api.elements.content).click(function (e) {\r\n                                api.hide(e);\r\n                            });\r\n                            $('.js-confirm-discard', api.elements.content).click(function (e) {\r\n                                api.hide(e);\r\n                                that.modal.hide();\r\n                            });\r\n                            $('.js-confirm-save', api.elements.content).click(function (e) {\r\n                                api.hide(e);\r\n                                that.$form.submit();\r\n                            });\r\n                        },\r\n                        hide: function (event, api) { api.destroy(); }\r\n                    }\r\n                });\r\n            }\r\n        };\r\n\r\n        this.modified = function () {\r\n            return !_.isEqual(initialData, that.getFormData());\r\n        };\r\n\r\n        /**\r\n         * Initialize form (bind validation on submit event etc.)\r\n         * @param {object} data - delivery data\r\n         * @returns {undefined}\r\n         */\r\n        this.initForm = function (data) {\r\n            that.$form = that.modal.elements.content.find('.edit-delivery-form');\r\n\r\n            if (data.resultserver) {\r\n                that.$form.find('select[name=\"resultserver\"] option[value=\"' + data.resultserver + '\"]').attr('selected', 'selected');\r\n            }\r\n\r\n            that.$form.on('submit', function (e) {\r\n                e.preventDefault();\r\n\r\n                if (that.validate()) {\r\n                    var formData = that.getFormData(),\r\n                        fcEvent = eventService.getEventById(formData.id);\r\n\r\n                    _.assign(fcEvent, formData);\r\n                    fcEvent.start = $.fullCalendar.moment.parseZone(formData.start);\r\n                    fcEvent.end = $.fullCalendar.moment.parseZone(formData.end);\r\n\r\n                    eventService.saveEvent(fcEvent, function () {\r\n                        initialData = that.getFormData();\r\n                        that.hide();\r\n                    });\r\n                }\r\n            });\r\n\r\n            that.parseRrule(data);\r\n\r\n            $('.js-repeat-toggle')\r\n                .prop('checked', !!data.recurrence)\r\n                .on('change', function () {\r\n                    $('.repeat-event-table').toggle($(this).is(':checked'));\r\n                    that.updateRruleValue();\r\n                })\r\n                .trigger('change');\r\n\r\n            $('[name=\"rrule[freq]\"]')\r\n                .on('change', function () {\r\n                    $('.js-byday-row').toggle($(this).val() == RRule.WEEKLY);\r\n                })\r\n                .trigger('change');\r\n\r\n            $('[name^=\"rrule[\"]').on('change', function () {\r\n                that.updateRruleValue();\r\n            });\r\n\r\n            that.$form.on('change', 'input, select', function () {\r\n                that.validate();\r\n            });\r\n\r\n            that.$form.on('click', '[type=\"submit\"]', function () {\r\n                that.$form.submit();\r\n            });\r\n\r\n            initialData = that.getFormData();\r\n        };\r\n\r\n        /**\r\n         * Initialize test taker groups tress\r\n         * @param {object} options\r\n         * @param {array} options.groups - List of group ids assigned to the delivery\r\n         * @returns {undefined}\r\n         */\r\n        this.initGroupTree = function (options) {\r\n            that.groupTree = new GenerisTreeSelectClass('.js-groups', '/tao/GenerisTree/getData', {\r\n                checkedNodes: options.groups,\r\n                serverParameters: {\r\n                    openNodes: [\"http:\\/\\/www.tao.lu\\/Ontologies\\/TAOGroup.rdf#Group\"],\r\n                    rootNode: \"http:\\/\\/www.tao.lu\\/Ontologies\\/TAOGroup.rdf#Group\"\r\n                },\r\n                paginate: 10,\r\n                onChangeCallback : function () {\r\n                    testTakersList.updateGroups(that.groupTree.getChecked());\r\n                }\r\n            });\r\n        };\r\n\r\n        /**\r\n         * Initialize datepickers and timepickers.\r\n         * @returns {undefined}\r\n         */\r\n        this.initDatepickers = function () {\r\n            var start = moment($('.js-delivery-start').val()).parseZone(),\r\n                end = moment($('.js-delivery-end').val()).parseZone(),\r\n                timeList = [];\r\n\r\n            for (var i = 0; i < 24; i++) {\r\n                var hour = (i < 10) ? ('0' + i) : i; \r\n                timeList.push(hour + ':00', hour + ':30');\r\n            }\r\n\r\n            $('.js-delivery-start-date, .js-delivery-end-date').datepicker({\r\n                dateFormat : \"yy-mm-dd\",\r\n                beforeShow: function (textbox, instance) {\r\n                    instance.dpDiv.addClass('edit-delivery-form__datepicker');\r\n                }\r\n            });\r\n            $('.js-delivery-start-date').datepicker('setDate', start.format('YYYY-MM-DD'));\r\n            $('.js-delivery-end-date').datepicker('setDate', end.format('YYYY-MM-DD'));\r\n\r\n            $('.js-delivery-start-time, .js-delivery-end-time').autocomplete({\r\n                source : function (request, response) {\r\n                    response(_.filter(timeList, function (val) {\r\n                        return val.indexOf(request.term) === 0;\r\n                    }));\r\n                },\r\n                minLength: 0,\r\n                close: function(event, ui) {\r\n                    $(this).trigger('change');\r\n                },\r\n                appendTo : '.edit-delivery-form'\r\n            }).click(function(event, ui){     \r\n                $(this).autocomplete('search', '');\r\n            });\r\n\r\n            $('.js-delivery-start-time, .js-delivery-end-time').on('blur', function (e) {\r\n                $(this).val($(this).val().substr(0,5));\r\n            });\r\n\r\n            $('.js-delivery-start-time').val(start.format('HH:mm'));\r\n            $('.js-delivery-end-time').val(end.format('HH:mm'));\r\n        };\r\n\r\n        /**\r\n         * Parse date, time and timezone inputs and set time value in UTC timezone to hiddent inputs \r\n         * that will be sent to the server.\r\n         * @returns {undefined}\r\n         */\r\n        this.updateDatetime = function () {\r\n            var startMoment = that.getStartMoment(),\r\n                endMoment = that.getEndMoment();\r\n\r\n            startMoment.parseZone();\r\n            endMoment.parseZone();\r\n\r\n            $('.js-delivery-start').val(startMoment.format('YYYY-MM-DDTHH:mm:ssZZ'));\r\n            $('.js-delivery-end').val(endMoment.format('YYYY-MM-DDTHH:mm:ssZZ'));\r\n        };\r\n\r\n        /**\r\n         * Parse recurence rule params and store processed value in hidden input\r\n         * that will be sent to the server.\r\n         * @param {object} formData Form data. If not given then data will be fetched from form automatically.\r\n         * @see {@link http://tools.ietf.org/html/rfc2445}\r\n         * @returns {string} recurrence rule\r\n         */\r\n        this.updateRruleValue = function (formData) {\r\n            var value = '',\r\n                data = formData || that.$form.serializeObject(),\r\n                rrule,\r\n                rruleData = _.clone(data.rrule);\r\n\r\n            rruleData.dtstart = that.getStartMoment().clone().utc().toDate();\r\n\r\n            if ($('.js-repeat-toggle').is(':checked')) {\r\n                var rrule = new RRule(rruleData);\r\n                value = rrule.toString();\r\n                $('.js-rrule-summary').text(RRule.fromString(rrule.toString()).toText());\r\n            }\r\n\r\n            $('[name=\"recurrence\"]').val(value);\r\n\r\n            return value;\r\n        };\r\n\r\n        /**\r\n         * Function parse rrule value obtained from the server and populate inputs by appropriate values.\r\n         * @see {@link http://tools.ietf.org/html/rfc2445}\r\n         * @returns {undefined}\r\n         */\r\n        this.parseRrule = function () {\r\n            var rule = $('[name=\"recurrence\"]').val().toUpperCase(),\r\n                rrule,\r\n                startMoment = that.getStartMoment();\r\n            if (!rule) {\r\n                return;\r\n            }\r\n\r\n            rule += ';DTSTART=' + startMoment.clone().utc().format('YYYYMMDDTHHmmss') + 'Z';\r\n            rrule = RRule.fromString(rule);\r\n            $.each(rrule.options, function (key, value) {\r\n                if (!rrule.origOptions[key]) {\r\n                    return;\r\n                }\r\n                var $input = $('[name^=\"rrule[' + key.toLowerCase() + ']\"]');\r\n                if ($input && $input.length) {\r\n                    if (_.isArray(value)) {\r\n                        $.each(value, function (i, num) {\r\n                            $input.eq(num).prop('checked', true);\r\n                        });\r\n                    } else {\r\n                        $input.val(value);\r\n                    }\r\n                }\r\n            });\r\n            this.updateRruleValue();\r\n        };\r\n\r\n        /**\r\n         * Return message about the number of attempts. \r\n         * @param {integer} executions Number of attempts\r\n         * @returns {string}\r\n         */\r\n        this.getExecutionsMessage = function (executions) {\r\n            var message = __('No information available');\r\n            if(executions >= 0) {\r\n                if(executions == 0) {\r\n                    message =__('No attempt has been started yet.');\r\n                } else if(executions == 1) {\r\n                    message = __('There is currently 1 attempt');\r\n                } else {\r\n                    message = __('There are currently %s attempts', String(executions));\r\n                }\r\n            } \r\n            return message;\r\n        };\r\n\r\n        /**\r\n         * Validate form and mark/unmark error inputs.\r\n         * @returns {boolean} Whether the form is valid.\r\n         */\r\n        this.validate = function () {\r\n            var rules = {\r\n                '.js-delivery-end-time, .js-delivery-start-time' : {\r\n                    validate : function () {\r\n                        return /^\\d\\d:\\d\\d$/.test($(this).val());\r\n                    },\r\n                    message : __('The format of time is invalid')\r\n                },\r\n                '.js-delivery-end-date, .js-delivery-start-date' : {\r\n                    validate : function () {\r\n                        return /^\\d\\d\\d\\d-\\d\\d-\\d\\d$/.test($(this).val());\r\n                    },\r\n                    message : __('The format of date is invalid')\r\n                },\r\n                '.js-label' : {\r\n                    validate : function () {\r\n                        return $(this).val().length !== 0;\r\n                    },\r\n                    message : __('This field is required')\r\n                },\r\n                '.js-maxexec' : {\r\n                    validate : function () {\r\n                        return /^\\d*$/.test($(this).val());\r\n                    },\r\n                    message : __('Value must be a number')\r\n                },   \r\n                '[name=\"resultserver\"]' : {\r\n                    validate : function () {\r\n                        return $.trim($(this).val()).length !== 0;\r\n                    },\r\n                    message : __('This field is required')\r\n                },   \r\n                '[name=\"rrule[count]\"]' : {\r\n                    validate : function () {\r\n                        return /^\\d*$/.test($(this).val()) || !$('.js-repeat-toggle').is(':checked');\r\n                    },\r\n                    message : __('Value must be a number')\r\n                }           \r\n            },\r\n            formIsValid = true,\r\n            qtipApi,\r\n            $elements;\r\n\r\n            that.updateDatetime();\r\n\r\n            for (var selector in rules) {\r\n                $elements = that.$form.find(selector);\r\n                $elements.each(function () {\r\n                    var valid = rules[selector].validate.apply(this);\r\n                    qtipApi = $(this).qtip('api');\r\n                    if (!qtipApi) {\r\n                        qtipApi = $(this).qtip({\r\n                            content: {\r\n                                text: rules[selector].message\r\n                            },\r\n                            position: {\r\n                                target: 'mouse', // Track the mouse as the positioning target\r\n                                adjust: { x: 5, y: 5 } // Offset it slightly from under the mouse\r\n                            }\r\n                        }).qtip('api');\r\n                    }\r\n\r\n                    $elements.toggleClass('error', !valid);\r\n                    qtipApi.toggle(!valid).disable(valid);\r\n\r\n                    formIsValid = formIsValid && valid;\r\n                });\r\n            }\r\n\r\n            return formIsValid;\r\n        };\r\n\r\n        /**\r\n         * Get moment of start time\r\n         * @returns {object} Moment instance\r\n         */\r\n        this.getStartMoment = function () {\r\n            var timezone = $('.js-delivery-time-zone').val(),\r\n                startVal = $('.js-delivery-start-date').val() \r\n                           + ' ' + $('.js-delivery-start-time').val() \r\n                           + ' ' + createOffset(timezone),\r\n                startMoment = moment(startVal, 'YYYY-MM-DD HH:mm Z');\r\n            return startMoment;\r\n        };\r\n\r\n        /**\r\n         * Get moment of end time\r\n         * @returns {object} Moment instance\r\n         */\r\n        this.getEndMoment = function () {\r\n            var timezone = $('.js-delivery-time-zone').val(),\r\n                endVal =   $('.js-delivery-end-date').val() \r\n                           + ' ' + $('.js-delivery-end-time').val()\r\n                           + ' ' + createOffset(timezone),\r\n                endMoment = moment(endVal, 'YYYY-MM-DD HH:mm Z');\r\n\r\n            return endMoment;\r\n        };\r\n\r\n        /**\r\n         * Convert form data to JS object\r\n         * @returns {object} form data\r\n         */\r\n        this.getFormData = function () {\r\n            var data = {};\r\n            that.updateDatetime();\r\n            that.updateRruleValue();\r\n            data = that.$form.serializeObject();\r\n            data.ttexcluded = [];\r\n            $('.js-excluded-tt-list option').each(\r\n                function () {\r\n                    data.ttexcluded.push(this.value);\r\n                }\r\n            );\r\n            data.groups = that.groupTree.getChecked();\r\n            return data;\r\n        };\r\n\r\n        this.init();\r\n    };\r\n});\n","/**  \r\n * This program is free software; you can redistribute it and/or\r\n * modify it under the terms of the GNU General Public License\r\n * as published by the Free Software Foundation; under version 2\r\n * of the License (non-upgradable).\r\n * \r\n * This program is distributed in the hope that it will be useful,\r\n * but WITHOUT ANY WARRANTY; without even the implied warranty of\r\n * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\r\n * GNU General Public License for more details.\r\n * \r\n * You should have received a copy of the GNU General Public License\r\n * along with this program; if not, write to the Free Software\r\n * Foundation, Inc., 51 Franklin Street, Fifth Floor, Boston, MA  02110-1301, USA.\r\n * \r\n * Copyright (c) 2015 (original work) Open Assessment Technologies SA;\r\n *               \r\n */\r\n/*global define*/\r\ndefine('taoDeliverySchedule/controller/Main/index',[\r\n    'lodash',\r\n    'jquery',\r\n    'i18n',\r\n    'handlebars',\r\n    'layout/actions/binder',\r\n    'taoDeliverySchedule/calendar/calendar',\r\n    'taoDeliverySchedule/calendar/eventService',\r\n    'taoDeliverySchedule/calendar/tooltips/editEventTooltip',\r\n    'taoDeliverySchedule/calendar/tooltips/createEventTooltip',\r\n    'taoDeliverySchedule/calendar/modals/editEventModal',\r\n    'layout/actions',\r\n    'ui/feedback',\r\n    'text!timeZoneList',\r\n    'taoDeliverySchedule/calendar/mediator',\r\n    'taoDeliverySchedule/lib/rrule/rrule.amd',\r\n    'css!/taoDeliverySchedule/views/css/taodeliveryschedule'\r\n],\r\nfunction (\r\n    _,\r\n    $,\r\n    __,\r\n    Handlebars,\r\n    binder,\r\n    Calendar,\r\n    eventService,\r\n    EditEventTooltip,\r\n    CreateEventTooltip,\r\n    EditEventModal,\r\n    actionManager,\r\n    feedback,\r\n    timeZoneListTpl,\r\n    mediator\r\n) {\r\n    'use strict';\r\n\r\n    function DeliverySchedule() {\r\n        timeZoneListTpl = Handlebars.compile(timeZoneListTpl);\r\n        var calendar,\r\n            that = this,\r\n            editEventTooltip,\r\n            createEventTooltip,\r\n            editEventModal,\r\n            tree,\r\n            $treeElt = $('#tree-manage_delivery_schedule'),\r\n            $calendarContainer = $('.js-delivery-calendar'),\r\n            timeZone = $('.js-delivery-calendar').data('time-zone-name') || 'UTC',\r\n            $tzSelect = $(timeZoneListTpl());\r\n\r\n        this.start = function () {\r\n            that.initTree();\r\n            eventService.setTZ(timeZone);\r\n            \r\n            calendar = new Calendar({\r\n                $container : $calendarContainer,\r\n                select : function (start, end, e) {\r\n                    editEventTooltip.hide();\r\n                    actionManager.exec(\r\n                        'delivery-new',\r\n                        _.extend(\r\n                            actionManager._resourceContext,\r\n                            {\r\n                                start : start,\r\n                                end : end,\r\n                                e : e,\r\n                                target : e.target,\r\n                                timeZone : $tzSelect.val()\r\n                            },\r\n                            {action : actionManager.getBy('delivery-new')}\r\n                        )\r\n                    );\r\n                },\r\n                eventClick : function (fcEvent, e) {\r\n                    createEventTooltip.hide();\r\n                    that.selectEvent(fcEvent.id, e);\r\n                },\r\n                eventResizeStart : function (fcEvent, e) {\r\n                    that.hideTooltips();\r\n                },\r\n                viewRender : function () {\r\n                    $('.fc-scroller').on('scroll', function (e) {\r\n                        if (editEventTooltip.tooltip.elements.tooltip.is(':visible')) {\r\n                            editEventTooltip.tooltip.reposition(e);\r\n                        }\r\n                        if (createEventTooltip.tooltip.elements.tooltip.is(':visible')) {\r\n                            createEventTooltip.tooltip.reposition(e);\r\n                        }\r\n                    });\r\n                },\r\n                viewDisplay : function () {\r\n                    that.hideTooltips();\r\n                },\r\n                viewDestroy : function () {\r\n                    that.hideTooltips();\r\n                }\r\n            });\r\n\r\n            that.initTzSelect();\r\n            that.initTooltips();\r\n\r\n            //bind events\r\n            binder.register('schedule_month_mode', function () {\r\n                that.hideTooltips();\r\n                calendar.exec('changeView', 'month');\r\n            });\r\n            binder.register('schedule_week_mode', function () {\r\n                that.hideTooltips();\r\n                calendar.exec('changeView', 'agendaWeek');\r\n            });\r\n            binder.register('schedule_day_mode', function () {\r\n                that.hideTooltips();\r\n                calendar.exec('changeView', 'agendaDay');\r\n            });\r\n            binder.register('delivery-new', function (context) {\r\n                that.showCreateEventTooltip(context);\r\n            });\r\n            binder.register('delivery-edit', function (context) {\r\n                that.showEditEventModal(context);\r\n            });\r\n            binder.register('delivery-select', function (treeInstance) {\r\n                if (!editEventTooltip.isShown() || editEventTooltip.getId() !== treeInstance.uri) {\r\n                    that.selectEvent(treeInstance.uri);\r\n                }\r\n            });\r\n            binder.register('class-select', function (treeInstance) {\r\n                that.hideTooltips();\r\n            });\r\n        };\r\n\r\n        /**\r\n         * Initialize tooltips.\r\n         * @returns {undefined}\r\n         */\r\n        this.initTooltips = function () {\r\n            $.fn.qtip.zindex = 9000;\r\n\r\n            //set up edit delivery tooltip\r\n            editEventTooltip = new EditEventTooltip();\r\n            mediator.on('edit.editEventTooltip', function () {\r\n                actionManager.exec(\r\n                    'delivery-edit',\r\n                    _.extend(\r\n                        actionManager._resourceContext,\r\n                        {action : actionManager.getBy('delivery-edit')}\r\n                    )\r\n                );\r\n            });\r\n            mediator.on('hide.editEventTooltip', function () {\r\n                eventService.highlightEvent(false);\r\n            });\r\n            mediator.on('delete.editEventTooltip', function (eventId) {\r\n                eventService.deleteEvent(eventId);\r\n            });\r\n            mediator.on('to-parent.editEventTooltip', function (eventId) {\r\n                var fcEvent = eventService.getEventById(eventId);\r\n                if (fcEvent.parentEventId) {\r\n                    that.selectEvent(fcEvent.parentEventId);\r\n                }\r\n            });\r\n\r\n            //set up create delivery tooltip\r\n            createEventTooltip = new CreateEventTooltip();\r\n            mediator.on('submit.createEventTooltip', function (data) {\r\n                eventService.createEvent({\r\n                    data : data,\r\n                    success : that.hideTooltips\r\n                });\r\n            });\r\n            mediator.on('hide.createEventTooltip', function (data) {\r\n                calendar.exec('unselect');\r\n            });\r\n\r\n            editEventModal = new EditEventModal();\r\n        };\r\n\r\n        /**\r\n         * Initialize time zone selectbox.\r\n         * @returns {undefined}\r\n         */\r\n        this.initTzSelect = function () {\r\n            $tzSelect.find('option:contains(' + timeZone + ')').attr('selected', 'selected');\r\n            $('.fc-toolbar .fc-right').prepend($tzSelect);\r\n\r\n            $tzSelect.on('change', function () {\r\n                that.hideTooltips();\r\n                timeZone = eventService.getCurrentTZName();\r\n                calendar.exec('refetchEvents');\r\n            });\r\n        };\r\n\r\n        /**\r\n         * Initialize tree and bind events.\r\n         * @returns {undefined}\r\n         */\r\n        this.initTree = function () {\r\n            tree = $.tree.reference($treeElt);\r\n\r\n            $($treeElt).on(\r\n                'refresh.taotree',\r\n                function () {\r\n                    calendar.exec('refetchEvents');\r\n                }\r\n            );\r\n\r\n            $($treeElt).on(\r\n                'removenode.taotree',\r\n                function (e, data) {\r\n                    var fcEvent = eventService.getEventById(data.id),\r\n                        eventsToBeRemoved;\r\n                    that.hideTooltips();\r\n                    if (fcEvent) {\r\n                        eventsToBeRemoved = [fcEvent.id];\r\n                        if (fcEvent.recurringEventIds && fcEvent.recurringEventIds.length) {\r\n                            eventsToBeRemoved = eventsToBeRemoved.concat(fcEvent.recurringEventIds);\r\n                        }\r\n                        calendar.exec('removeEvents', function (eventToRemove) {\r\n                            return eventsToBeRemoved.indexOf(eventToRemove.id) !== -1;\r\n                        });\r\n                    }\r\n                }\r\n            );\r\n        };\r\n\r\n        /**\r\n         * Hide all tooltips on calendar\r\n         * @returns {undefined}\r\n         */\r\n        this.hideTooltips = function () {\r\n            editEventTooltip.hide();\r\n            createEventTooltip.hide();\r\n        };\r\n\r\n        /**\r\n         * Show event tooltip\r\n         * @param {object} fcEvent Calendar event\r\n         * @param {Event} e jQuery event\r\n         * @returns {undefined}\r\n         */\r\n        this.showEditEventTooltip = function (fcEvent, e) {\r\n            var $eventElement = eventService.getEventElement(fcEvent.id),\r\n                $moreLinks;\r\n\r\n            calendar.exec('unselect');\r\n\r\n            if (!$eventElement.length) {\r\n                return;\r\n            }\r\n\r\n            eventService.highlightEvent(fcEvent);\r\n\r\n            if (typeof e === 'undefined' || e.isTrigger) {\r\n                if (!$eventElement.is(':visible')) {\r\n                    $moreLinks = $eventElement.closest('.fc-content-skeleton').find('a.fc-more');\r\n                    $eventElement = $moreLinks.eq(0);\r\n                }\r\n                editEventTooltip.set({\r\n                    'position.target' : $eventElement\r\n                });\r\n                editEventTooltip.set({\r\n                    'position.adjust.y' : 4,\r\n                    'position.adjust.x' : 0,\r\n                    'position.my' : 'bottom center',\r\n                    'position.at' : 'top center'\r\n                });\r\n            } else {\r\n                editEventTooltip.set({\r\n                    'position.adjust.y' : e.offsetY || (e.pageY - $eventElement.offset().top),\r\n                    'position.adjust.x' : e.offsetX || (e.pageX - $eventElement.offset().left),\r\n                    'position.target' : e.currentTarget,\r\n                    'position.my' : 'bottom center',\r\n                    'position.at' : 'top left'\r\n                });\r\n            }\r\n\r\n            editEventTooltip.show(fcEvent);\r\n        };\r\n\r\n        /**\r\n         * Show create delivery tooltip.\r\n         * @param {object} context Action context (uri, classUri, id, start, end etc.).\r\n         * @see {@link /tao/views/js/layout/actions.js} for further information.\r\n         * @returns {undefined}\r\n         */\r\n        this.showCreateEventTooltip = function (context) {\r\n            createEventTooltip.show(context);\r\n        };\r\n\r\n        /**\r\n         * Show delivery edit form in modal window.\r\n         * @param {object} context Action context (uri, classUri, id, start, end etc.).\r\n         * @see {@link /tao/views/js/layout/actions.js} for further information.\r\n         * @returns {undefined}\r\n         */\r\n        this.showEditEventModal = function (context) {\r\n            var fcEvent = eventService.getEventById(context.uri);\r\n            this.hideTooltips();\r\n            editEventModal.show(fcEvent);\r\n        };\r\n\r\n        /**\r\n         * Select event and show edit tooltip.\r\n         * @param {string} eventId\r\n         * @param {object} e If triggered by clicking on the event \r\n         * then the tooltip coordinates will be the same as click coordinates.\r\n         * @returns {undefined}\r\n         */\r\n        this.selectEvent = function (eventId, e) {\r\n            calendar.goToEvent(eventId).done(function (fcEvent) {\r\n                that.showEditEventTooltip(fcEvent, e);\r\n                that.selectTreeNode(fcEvent.id);\r\n            });\r\n        };\r\n\r\n        /**\r\n         * Select node on the tree\r\n         * @param {string} eventId\r\n         * @returns {undefined}\r\n         */\r\n        this.selectTreeNode = function (eventId) {\r\n            tree.deselect_branch(tree.selected);\r\n            calendar.getEvent(eventId).done(function (fcEvent) {\r\n                //if node under the 'more' button\r\n                if ($('#tree-manage_delivery_schedule #' + fcEvent.id).length === 0) {\r\n                    tree.select_branch($('#' + fcEvent.classId + ' .more'));\r\n                    //after the `more` element has been deleted.\r\n                    $treeElt.one('delete.taotree', function (e, elt) {\r\n                        if ($(elt).hasClass('more')) {\r\n                            tree.select_branch($('#' + eventId));\r\n                        }\r\n                    });\r\n                }\r\n\r\n                if (fcEvent.classId) {\r\n                    tree.open_branch('#' + fcEvent.classId, false, function () {\r\n                        tree.select_branch($('#' + fcEvent.id));\r\n                    });\r\n                } else {\r\n                    tree.select_branch($('#' + fcEvent.id));\r\n                }\r\n            });\r\n        };\r\n    }\r\n\r\n    return new DeliverySchedule();\r\n});\n"]}